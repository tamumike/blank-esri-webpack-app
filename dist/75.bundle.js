(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/PointCloudWorker":1258,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/PointCloudWorker":1258,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderSlot":1281,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderPass":1297,"esri/views/layers/LayerView":1299,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/layers/LayerView":1299,"esri/core/requireUtils":1323,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/requireUtils":1323,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/LayerView3D":1325,"esri/views/3d/layers/i3s/I3SBinaryReader":1352,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SBinaryReader":1352,"esri/views/3d/support/orientedBoundingBox":1353,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/orientedBoundingBox":1353,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/utils":1355,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/support/layerViewUpdatingProperties":1357,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/symbols/support/unitConversionUtils":1359,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/support/symbolColorUtils":1437,"esri/views/3d/layers/i3s/LEPCC":1442,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SUtil":1452,"esri/views/3d/support/dito":1461,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/numberUtils":1517,"esri/views/3d/layers/i3s/PointCloudRendererUtil":1629,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/PointCloudRendererUtil":1629,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/IdleQueue":1712,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/PointCloudLayerView3D":2160,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/LoDUtil":2161,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/PagedNodeIndex":2162,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/PointRenderer":2163,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/PointCloudPointRenderer.xml":2164})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{1258:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(6),r(20),r(1352),r(1442),r(1629),r(40),r(74)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=function(){function e(){}return e.prototype.process=function(e){var t=this.transform(e);return r.resolve({result:t,transferList:[t.rgb]})},e.prototype.transform=function(e){var t=this.readGeometry(e.schema,e.geometryBuffer),r=a.evaluateRenderer(e.rendererInfo,e.primaryAttribute,e.modulationAttribute,t,t.length/3);this._applyElevationOffsetInPlace(t,e.elevationOffset);var i=this._transformCoordinates(t,e.obb,n.fromJSON(e.inSR),n.fromJSON(e.outSR));return{obb:e.obb,points:i,rgb:r.buffer}},e.prototype.readGeometry=function(e,t){if(null==e.encoding||""===e.encoding){for(var r=i.createGeometryDataIndex(t,e,!1),n=i.createTypedView(t,r.vertexAttributes.position),a=r.header.fields,s=[a.offsetX,a.offsetY,a.offsetZ],l=[a.scaleX,a.scaleY,a.scaleZ],u=n.length/3,d=new Float64Array(3*u),c=0;c<u;c++)d[3*c]=n[3*c]*l[0]+s[0],d[3*c+1]=n[3*c+1]*l[1]+s[1],d[3*c+2]=n[3*c+2]*l[2]+s[2];return d}if("lepcc-xyz"===e.encoding)return o.decodeXYZ(t).result},e.prototype._transformCoordinates=function(e,t,r,n){var i=e.length/3;if(!l.bufferToBuffer(e,r,0,e,n,0,i))throw Error("Can't reproject");var o=s.vec3.createFrom(t.center[0],t.center[1],t.center[2]),a=s.vec3.create(),u=s.vec3.create();s.quat4.conjugate(t.quaternion,d);for(var c=new Float32Array(3*i),p=0;p<i;p++)a[0]=e[3*p]-o[0],a[1]=e[3*p+1]-o[1],a[2]=e[3*p+2]-o[2],s.quat4.multiplyVec3(d,a,u),t.halfSize[0]=Math.max(t.halfSize[0],Math.abs(u[0])),t.halfSize[1]=Math.max(t.halfSize[1],Math.abs(u[1])),t.halfSize[2]=Math.max(t.halfSize[2],Math.abs(u[2])),c[3*p]=a[0],c[3*p+1]=a[1],c[3*p+2]=a[2];return c},e.prototype._applyElevationOffsetInPlace=function(e,t){var r=e.length/3;if(0!==t)for(var n=0;n<r;n++)e[3*n+2]+=t},e}(),d=s.quat4.create();return u}.apply(null,n))||(e.exports=i)},1281:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r;return function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL",e[e.STENCIL_MATERIAL=2]="STENCIL_MATERIAL",e[e.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL",e[e.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL",e[e.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL",e[e.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT",e[e.POSTPROCESSING_ATMOSPHERE_OPAQUE=11]="POSTPROCESSING_ATMOSPHERE_OPAQUE",e[e.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT",e[e.POSTPROCESSING_EXTERNAL=13]="POSTPROCESSING_EXTERNAL",e[e.HUDMATERIAL1=14]="HUDMATERIAL1",e[e.HUDMATERIAL2=15]="HUDMATERIAL2",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.MAX_SLOTS=18]="MAX_SLOTS"}(r||(r={})),r}.apply(null,n))||(e.exports=i)},1297:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r;return function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_DEPTH=1]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=2]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP",e[e.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT",e[e.MAX_PASS=5]="MAX_PASS"}(r||(r={})),r}.apply(null,n))||(e.exports=i)},1299:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(4),r(42),r(16),r(147),r(7),r(146),r(6),r(1)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handles=new a,t.layer=null,t.parent=null,t.view=null,t}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";return l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+n+"', id: '"+r+"')",t),d.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null!=e?e:1};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},n([c.property()],t.prototype,"layer",void 0),n([c.property()],t.prototype,"parent",void 0),n([c.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),n([c.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),n([c.property()],t.prototype,"view",void 0),n([c.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),n([c.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),n([c.subclass("esri.views.layers.LayerView")],t)}(c.declared(i,o,s,u))}.apply(null,n))||(e.exports=i)},1323:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(23)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.when=function e(t,n){if(Array.isArray(n)){var i=new r;return t(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.resolve(e)}),i.promise}return e(t,[n]).then(function(e){return e[0]})},t.getAbsMid=function(e,t,r){return t.toAbsMid?t.toAbsMid(e):r.id.replace(/\/[^\/]*$/gi,"/")+e}}.apply(null,n))||(e.exports=i)},1325:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(6),r(15),r(1),r(412),r(1299)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return i.create(function(t,r){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var n=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);n?r(n):t()})})},n([a.property()],t.prototype,"view",void 0),n([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(l))}.apply(null,n))||(e.exports=i)},1352:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(5),r(7),r(1442)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,n){for(var i="",o=0;o<n;){var a=e[t+o];if(a<128)i+=String.fromCharCode(a),o++;else if(a>=192&&a<224){if(o+1>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var s=(31&a)<<6|63&e[t+o+1];i+=String.fromCharCode(s),o+=2}else if(a>=224&&a<240){if(o+2>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");s=(15&a)<<12|(63&e[t+o+1])<<6|63&e[t+o+2];i+=String.fromCharCode(s),o+=3}else{if(!(a>=240&&a<248))throw new r("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");if(o+3>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");if((s=(7&a)<<18|(63&e[t+o+1])<<12|(63&e[t+o+2])<<6|63&e[t+o+3])>=65536){var l=55296+(s-65536>>10),u=56320+(1023&s);i+=String.fromCharCode(l,u)}else i+=String.fromCharCode(s);o+=4}}return i}function s(e,r){for(var n={byteOffset:0,byteCount:0,fields:Object.create(null)},i=0,o=0;o<r.length;o++){var a=r[o],s=a.valueType||a.type,l=t.valueType2ArrayBufferReader[s];n.fields[a.property]=l(e,i),i+=t.valueType2TypedArrayClassMap[s].BYTES_PER_ELEMENT}return n.byteCount=i,n}function l(e,t,n){var i,o,s=[],l=0;for(o=0;o<e;o+=1){if((i=t[o])>0){if(s.push(a(n,l,i-1)),0!==n[l+i-1])throw new r("string-array-error","Invalid string array: missing null termination.")}else s.push(null);l+=i}return s}function u(e,r){return new(0,t.valueType2TypedArrayClassMap[r.valueType])(e,r.byteOffset,r.count*r.valuesPerElement)}function d(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function c(e,t,i){for(var o=null!=t.header?s(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},a={header:o,byteOffset:o.byteCount,byteCount:0,entries:Object.create(null)},l=o.byteCount,u=0;u<t.ordering.length;u++){var d=t.ordering[u],c=n.clone(t[d]);if(c.count=o.fields.count,"String"===c.valueType){if(c.byteOffset=l,c.byteCount=o.fields[d+"ByteCount"],"UTF-8"!==c.encoding)throw new r("unsupported-encoding","Unsupported String encoding.",{encoding:c.encoding})}else{if(!f(c.valueType))throw new r("unsupported-value-type","Unsupported binary valueType",{valueType:c.valueType});var p=h(c.valueType);l+=l%p!=0?p-l%p:0,c.byteOffset=l,c.byteCount=p*c.valuesPerElement*c.count}l+=c.byteCount,a.entries[d]=c}return a.byteCount=l-a.byteOffset,a}function p(e,t,n){if(t!==e&&v.error("Invalid "+n+" buffer size\n expected: "+e+", actual: "+t+")"),t<e)throw new r("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function f(e){return t.valueType2TypedArrayClassMap.hasOwnProperty(e)}function h(e){return f(e)&&t.valueType2TypedArrayClassMap[e].BYTES_PER_ELEMENT}Object.defineProperty(t,"__esModule",{value:!0});var v=i.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");t.readHeader=s,t.readStringArray=l,t.createTypedView=u,t.createRawView=d,t.createAttributeDataIndex=c,t.createGeometryDataIndex=function(e,t,r){var i=s(e,t&&t.header),o=i.byteCount,a={header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:n.clone(t.vertexAttributes)},l=a.vertexAttributes;r||null==l.region||delete l.region;for(var u=i.fields,d=null!=u.vertexCount?u.vertexCount:u.count,c=0;c<t.ordering.length;c++){var f=t.ordering[c];null!=l[f]&&(l[f].byteOffset=o,l[f].count=d,o+=h(l[f].valueType)*l[f].valuesPerElement*d)}var v=u.faceCount;if(t.faces&&v){a.faces=n.clone(t.faces);var g=a.faces;for(c=0;c<t.ordering.length;c++){var m=t.ordering[c];null!=g[m]&&(g[m].byteOffset=o,g[m].count=v,o+=h(g[m].valueType)*g[m].valuesPerElement*v)}}var y=u.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&y){a.featureAttributes=n.clone(t.featureAttributes);var b=a.featureAttributes;for(c=0;c<t.featureAttributeOrder.length;c++){var _=t.featureAttributeOrder[c];b[_].byteOffset=o,b[_].count=y;var w=h(b[_].valueType);"UInt64"===b[_].valueType&&(w=8),o+=w*b[_].valuesPerElement*y}}return p(o,e.byteLength,"geometry"),a.byteCount=o-a.byteOffset,a},t.readBinaryAttribute=function(e,t,n){if("lepcc-rgb"===e.encoding)return o.decodeRGB(t);if("lepcc-intensity"===e.encoding)return o.decodeIntensity(t);if(null!=e.encoding&&""!==e.encoding)throw new r("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(v.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(v.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");var i=c(t,e,n);p(i.byteOffset+i.byteCount,t.byteLength,"attribute");var a=i.entries.attributeValues||i.entries.objectIds;if(a){if("String"===a.valueType){var s=i.entries.attributeByteCounts,f=u(t,s),h=d(t,a);return l(s.count,f,h)}return u(t,a)}throw new r("bad-attribute-storage-info","Bad attributeStorageInfo specification.")},t.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},t.valueType2ArrayBufferReader={Float32:function(e,t){return new DataView(e,0).getFloat32(t,!0)},Float64:function(e,t){return new DataView(e,0).getFloat64(t,!0)},UInt8:function(e,t){return new DataView(e,0).getUint8(t)},Int8:function(e,t){return new DataView(e,0).getInt8(t)},UInt16:function(e,t){return new DataView(e,0).getUint16(t,!0)},Int16:function(e,t){return new DataView(e,0).getInt16(t,!0)},UInt32:function(e,t){return new DataView(e,0).getUint32(t,!0)},Int32:function(e,t){return new DataView(e,0).getInt32(t,!0)}},t.isValueType=f,t.getBytesPerValue=h}.apply(null,n))||(e.exports=i)},1353:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(406),r(40),r(1461),r(1300)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,r){return{center:n.vec3d.createFrom(e[0],e[1],e[2]),halfSize:d.createFrom(t[0],t[1],t[2]),quaternion:u.createFrom(r[0],r[1],r[2],r[3])}}function s(e,t){var r=o.plane.distance(t,e.center),n=l(e,t);return r>n?1:r<-n?-1:0}function l(e,t){u.conjugate(e.quaternion,p),u.multiplyVec3(p,t,f);var r=e.halfSize;return Math.abs(f[0]*r[0])+Math.abs(f[1]*r[1])+Math.abs(f[2]*r[2])}Object.defineProperty(t,"__esModule",{value:!0});var u=n.quat4,d=n.vec3,c=n.mat3d,p=u.create(),f=d.create(),h=d.create(),v=c.create(),g=function(){return function(e){var t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(var r=0;r<e;r++)this.obbs[r]={center:new Float64Array(this.buffer,56*r+0,3),halfSize:new Float32Array(this.buffer,56*r+24,3),quaternion:new Float32Array(this.buffer,56*r+36,4)}}}();t.ObbArray=g,t.create=a,t.clone=function(e){return a(e.center,e.halfSize,e.quaternion)},t.set=function(e,t){n.vec3d.set(e.center,t.center),n.vec3.set(e.halfSize,t.halfSize),n.quat4.set(e.quaternion,t.quaternion)},t.compute=function(e,t){return t||(t=a([0,0,0],[-1,-1,-1],[0,0,0,1])),i.computeOBB(e,t),t},t.intersectPlane=s,t.toAaBoundingBox=function(e,t){t||(t=r.create());var n=u.toMat3(e.quaternion,v),i=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),o=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),a=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-o,t[2]=e.center[2]-a,t[3]=e.center[0]+i,t[4]=e.center[1]+o,t[5]=e.center[2]+a,t},t.minimumDistancePlane=function(e,t){return o.plane.distance(t,e.center)-l(e,t)},t.maximumDistancePlane=function(e,t){return o.plane.distance(t,e.center)+l(e,t)},t.isVisible=function(e,t){return s(e,t[0])<=0&&s(e,t[1])<=0&&s(e,t[2])<=0&&s(e,t[3])<=0&&s(e,t[4])<=0&&s(e,t[5])<=0},t.intersectLine=function(e,t,r,i){void 0===i&&(i=0),u.conjugate(e.quaternion,p),n.vec3.subtract(t,e.center,f);for(var o=u.multiplyVec3(p,f,f),a=u.multiplyVec3(p,r,h),s=-1/0,l=1/0,d=0;d<3;d++)if(Math.abs(a[d])>1e-6){var c=(i+e.halfSize[d]-o[d])/a[d],v=(-i-e.halfSize[d]-o[d])/a[d];s=Math.max(s,Math.min(c,v)),l=Math.min(l,Math.max(c,v))}else if(o[d]>e.halfSize[d]+i||o[d]<-e.halfSize[d]-i)return!1;return s<=l}}.apply(null,n))||(e.exports=i)},1355:function(e,t,r){var n,i;n=[r(442),r(31),r(5),r(1517),r(443)],void 0===(i=function(e,t,r,n,i){function o(e,t,r){var n="";return 0===t?n=s.lt+" ":t===r&&(n=s.gt+" "),n+e}var a={},s={lte:"<=",gte:">=",lt:"<",gt:">",pct:"%",ld:"â€“"},l={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},u={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},d={dateOptions:{formatLength:"short",fullYear:!0},timeOptions:{formatLength:"short"}};return r.mixin(a,{meterIn:{inches:1/.0254,feet:1/.3048,"us-feet":3.28084,yards:1/.9144,miles:1/1609.344,"nautical-miles":1/1852,millimeters:1e3,centimeters:100,decimeters:10,meters:1,kilometers:.001,"decimal-degrees":180/20015077},timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(t,n){var o,a=[];null==t||t instanceof Date||(t=new Date(t)),n=n||{};var s=(n=r.mixin({},n)).selector?n.selector.toLowerCase():null,l=!s||s.indexOf("time")>-1,u=!s||s.indexOf("date")>-1;return l&&(n.timeOptions=n.timeOptions||d.timeOptions,n.timeOptions&&(n.timeOptions=r.mixin({},n.timeOptions),n.timeOptions.selector=n.timeOptions.selector||"time",a.push(n.timeOptions))),u&&(n.dateOptions=n.dateOptions||d.dateOptions,n.dateOptions&&(n.dateOptions=r.mixin({},n.dateOptions),n.dateOptions.selector=n.dateOptions.selector||"date",a.push(n.dateOptions))),a&&a.length?o=1==(a=a.map(function(r){return e.format(t,r)})).length?a[0]:i["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(e,t){return a[t]}):o=e.format(t),o},createColorStops:function(e){var t=e.values,r=e.colors,i=e.labelIndexes,s=e.isDate,l=e.dateFormatOptions;return t.map(function(e,u){var d,c=null;(!i||i.indexOf(u)>-1)&&((d=s?a.formatDate(e,l):n.format(e))&&(c=o(d,u,t.length-1)));return{value:e,color:r[u],label:c}})},updateColorStops:function(e){var t,r=e.stops,i=e.changes,s=e.isDate,l=e.dateFormatOptions,u=[],d=r.map(function(e){return e.value});i.forEach(function(e){u.push(e.index),d[e.index]=e.value}),t=n.round(d,{indexes:u}),r.forEach(function(e,i){if(e.value=d[i],null!=e.label){var u,c=null;(u=s?a.formatDate(t[i],l):n.format(t[i]))&&(c=o(u,i,r.length-1)),e.label=c}})},createClassBreakLabel:function(e){var t=e.minValue,r=e.maxValue,i=e.isFirstBreak,o=e.normalizationType,a=i?"":s.gt+" ",l="percent-of-total"===o?s.pct:"";return t=null==t?"":n.format(t),r=null==r?"":n.format(r),a+t+l+" "+s.ld+" "+r+l},setLabelsForClassBreaks:function(e){var t=e.classBreakInfos,r=e.classificationMethod,i=e.normalizationType,o=[];t&&t.length&&("standard-deviation"===r?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):e.round?(o.push(t[0].minValue),t.forEach(function(e){o.push(e.maxValue)}),o=n.round(o),t.forEach(function(e,t){e.label=a.createClassBreakLabel({minValue:0===t?o[0]:o[t],maxValue:o[t+1],isFirstBreak:0===t,normalizationType:i})})):t.forEach(function(e,t){e.label=a.createClassBreakLabel({minValue:e.minValue,maxValue:e.maxValue,isFirstBreak:0===t,normalizationType:i})}))},updateClassBreak:function(e){var t,r=e.classBreaks,n=e.classificationMethod,i=e.normalizationType,o=e.change,s=o.index,l=o.value,u=-1,d=-1,c=r.length;"standard-deviation"!==n?(0===s?u=s:s===c?d=s-1:(d=s-1,u=s),u>-1&&u<c&&((t=r[u]).minValue=l,t.label=a.createClassBreakLabel({minValue:t.minValue,maxValue:t.maxValue,isFirstBreak:0===u,normalizationType:i})),d>-1&&d<c&&((t=r[d]).maxValue=l,t.label=a.createClassBreakLabel({minValue:t.minValue,maxValue:t.maxValue,isFirstBreak:0===d,normalizationType:i}))):console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method.")},calculateDateFormatInterval:function(e){var t,r,n,i,o,a,s,u,d,c,p=e.length,f=1/0;for(e=e.map(function(e){return new Date(e)}),t=0;t<p-1;t++){for(n=e[t],o=[],u=1/0,d="",r=t+1;r<p;r++)i=e[r],a=(n.getFullYear()!==i.getFullYear()?"year":n.getMonth()!==i.getMonth()&&"month")||n.getDate()!==i.getDate()&&"day"||n.getHours()!==i.getHours()&&"hour"||n.getMinutes()!==i.getMinutes()&&"minute"||n.getSeconds()!==i.getSeconds()&&"second"||"millisecond",(s=l[a])<u&&(u=s,d=a),o.push(a);u<f&&(f=u,c=d)}return c},createUniqueValueLabel:function(e){var t=e.value,r=e.fieldInfo,i=e.domain,o=e.dateFormatInterval,s=String(t),l=i&&i.codedValues?i.getName(t):null;return l?s=l:"number"==typeof t&&(s=r&&"date"===r.type?a.formatDate(t,o&&u[o]):n.format(t)),s},cloneColorVariable:function(e){var n;return e&&((n=r.mixin({},e)).colors=function(e){return e&&e.map(function(e){return new t(e)})}(n.colors),n.stops=n.stops&&n.stops.map(function(e){return(e=r.mixin({},e)).color&&(e.color=new t(e.color)),e}),n.legendOptions&&(n.legendOptions=r.mixin({},n.legendOptions))),n},cloneOpacityVariable:function(e){var t;if(e){var n=(t=r.mixin({},e)).opacityValues;n&&(t.opacityValues=n.slice(0)),(n=t.stops)&&(t.stops=n.map(function(e){return r.mixin({},e)})),(n=t.legendOptions)&&(t.legendOptions=r.mixin({},n))}return t},cloneSizeVariable:function(e){var t;if(e){(t=r.mixin({},e)).stops&&(t.stops=t.stops.map(function(e){return r.mixin({},e)}));var n=t.minSize;n&&"object"==typeof n&&(t.minSize=a.cloneSizeVariable(n)),(n=t.maxSize)&&"object"==typeof n&&(t.maxSize=a.cloneSizeVariable(n)),(n=t.legendOptions)&&(t.legendOptions=r.mixin({},n),(n=n.customValues)&&(t.legendOptions.customValues=n.slice(0)))}return t}}),a}.apply(null,n))||(e.exports=i)},1357:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,n))||(e.exports=i)},1359:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1355)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.supportsUnit=function(e){return null!=r.meterIn[e]},t.getMetersPerUnit=function(e){return 1/(r.meterIn[e]||1)}}.apply(null,n))||(e.exports=i)},1437:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSymbolColor=function(e,t,r){if(null==e||"ignore"===t)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);r[0]=Math.floor(255*e[0]),r[1]=Math.floor(255*e[1]),r[2]=Math.floor(255*e[2]);var n=Math.floor(85*e[3]);r[3]=0===n?0:"tint"===t?n:"replace"===t?n+85:n+170}}.apply(null,n))||(e.exports=i)},1442:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8)],void 0===(i=function(e,t,r){function n(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+d.identifierOffset,d.identifierLength)),version:t.getUint16(r+d.versionOffset,u),checksum:t.getUint32(r+d.checksumOffset,u)}}function i(e,t){return{sizeLo:e.getUint32(t+c.sizeLo,u),sizeHi:e.getUint32(t+c.sizeHi,u),minX:e.getFloat64(t+c.minX,u),minY:e.getFloat64(t+c.minY,u),minZ:e.getFloat64(t+c.minZ,u),maxX:e.getFloat64(t+c.maxX,u),maxY:e.getFloat64(t+c.maxY,u),maxZ:e.getFloat64(t+c.maxZ,u),errorX:e.getFloat64(t+c.errorX,u),errorY:e.getFloat64(t+c.errorY,u),errorZ:e.getFloat64(t+c.errorZ,u),count:e.getUint32(t+c.count,u),reserved:e.getUint32(t+c.reserved,u)}}function o(e,t,r){var n=[];t=a(e,t,n);for(var i=[],o=0;o<n.length;o++){i.length=0,t=a(e,t,i);for(var s=0;s<i.length;s++)r.push(i[s]+n[o])}return t}function a(e,t,n){var i=new DataView(e,t),o=i.getUint8(0),a=31&o,s=!!(32&o),l=(192&o)>>6,d=0;if(0===l)d=i.getUint32(1,u),t+=5;else if(1===l)d=i.getUint16(1,u),t+=3;else{if(2!==l)throw new r("lepcc-decode-error","Bad count type");d=i.getUint8(1),t+=2}if(s)throw new r("lepcc-decode-error","LUT not implemented");for(var c=Math.ceil(d*a/8),p=new Uint8Array(e,t,c),f=0,h=0,v=0,g=-1>>>32-a,m=0;m<d;m++){for(;h<a;)f|=p[v]<<h,h+=8,v+=1;n[m]=f&g,f>>>=a,(h-=a)+a>32&&(f|=p[v-1]>>8-h)}return t+v}function s(e,t){return{sizeLo:e.getUint32(t+p.sizeLo,u),sizeHi:e.getUint32(t+p.sizeHi,u),count:e.getUint32(t+p.count,u),colorMapCount:e.getUint16(t+p.colorMapCount,u),lookupMethod:e.getUint8(t+p.lookupMethod),compressionMethod:e.getUint8(t+p.compressionMethod)}}function l(e,t){return{sizeLo:e.getUint32(t+f.sizeLo,u),sizeHi:e.getUint32(t+f.sizeHi,u),count:e.getUint32(t+f.count,u),scaleFactor:e.getUint16(t+f.scaleFactor,u),bitsPerPoint:e.getUint8(t+f.bitsPerPoint),reserved:e.getUint8(t+f.reserved)}}Object.defineProperty(t,"__esModule",{value:!0});var u=!0,d={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16},c={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};t.decodeXYZ=function(e){var t=new DataView(e,0),a=0,s=n(e,t,a),l=s.identifier,u=s.version;if(a+=d.byteCount,"LEPCC     "!==l)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var p=i(t,a);if(a+=c.byteCount,p.sizeHi*Math.pow(2,32)+p.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var f=new Float64Array(3*p.count),h=[],v=[],g=[],m=[];if((a=o(e,a=o(e,a=o(e,a=o(e,a,h),v),g),m))!==e.byteLength)throw new r("lepcc-decode-error","Bad length");for(var y=0,b=0,_=0;_<h.length;_++){b+=h[_];for(var w=0,S=0;S<v[_];S++){w+=g[y];var x=m[y];f[3*y]=Math.min(p.maxX,p.minX+2*p.errorX*w),f[3*y+1]=Math.min(p.maxY,p.minY+2*p.errorY*b),f[3*y+2]=Math.min(p.maxZ,p.minZ+2*p.errorZ*x),y++}}return{errorX:p.errorX,errorY:p.errorY,errorZ:p.errorZ,result:f}};var p={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};t.decodeRGB=function(e){var t=new DataView(e,0),i=0,o=n(e,t,i),a=o.identifier,l=o.version;if(i+=d.byteCount,"ClusterRGB"!==a)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var u=s(t,i);if(i+=p.byteCount,u.sizeHi*Math.pow(2,32)+u.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");if(2!==u.lookupMethod&&1!==u.lookupMethod||0!==u.compressionMethod){if(0===u.lookupMethod&&0===u.compressionMethod){if(3*u.count+i!==e.byteLength||0!==u.colorMapCount)throw new r("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(u.lookupMethod<=2&&1===u.compressionMethod){if(i+3!==e.byteLength||1!==u.colorMapCount)throw new r("lepcc-decode-error","Bad count");for(var c=t.getUint8(i),f=t.getUint8(i+1),h=t.getUint8(i+2),v=new Uint8Array(3*u.count),g=0;g<u.count;g++)v[3*g]=c,v[3*g+1]=f,v[3*g+2]=h;return v}throw new r("lepcc-decode-error","Bad method "+u.lookupMethod+","+u.compressionMethod)}if(3*u.colorMapCount+u.count+i!==e.byteLength||u.colorMapCount>256)throw new r("lepcc-decode-error","Bad count");var m=new Uint8Array(e,i,3*u.colorMapCount),y=new Uint8Array(e,i+3*u.colorMapCount,u.count);for(v=new Uint8Array(3*u.count),g=0;g<u.count;g++){var b=y[g];v[3*g]=m[3*b],v[3*g+1]=m[3*b+1],v[3*g+2]=m[3*b+2]}return v};var f={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};t.decodeIntensity=function(e){var t=new DataView(e,0),i=0,o=n(e,t,i),s=o.identifier,u=o.version;if(i+=d.byteCount,"Intensity "!==s)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var c=l(t,i);if(i+=f.byteCount,c.sizeHi*Math.pow(2,32)+c.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var p=new Uint16Array(c.count);if(8===c.bitsPerPoint){if(c.count+i!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(var h=new Uint8Array(e,i,c.count),v=0;v<c.count;v++)p[v]=h[v]*c.scaleFactor}else if(16===c.bitsPerPoint){if(2*c.count+i!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(h=new Uint16Array(e,i,c.count),v=0;v<c.count;v++)p[v]=h[v]*c.scaleFactor}else{if(a(e,i,h=[])!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(v=0;v<c.count;v++)p[v]=h[v]*c.scaleFactor}return p}}.apply(null,n))||(e.exports=i)},1452:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(27),r(8),r(6),r(19),r(20),r(26),r(421),r(148),r(1352),r(74),r(1437)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p){function f(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function h(e,t){var r,n=t[0],i=t[1],o=t[2],a=t[3],s=0;n<e[0]&&(s+=(r=e[0]-n)*r);i<e[1]&&(s+=(r=e[1]-i)*r);o<e[2]&&(s+=(r=e[2]-o)*r);n>e[3]&&(s+=(r=n-e[3])*r);i>e[4]&&(s+=(r=i-e[4])*r);o>e[5]&&(s+=(r=o-e[5])*r);if(s>a*a)return 0;if(s>0)return 1;var l=1/0;return n-e[0]<l&&(l=n-e[0]),i-e[1]<l&&(l=i-e[1]),o-e[2]<l&&(l=o-e[2]),e[3]-n<l&&(l=e[3]-n),e[4]-i<l&&(l=e[4]-i),e[5]-o<l&&(l=e[5]-o),l>a?2:1}function v(e,t,r){for(var n=[],i=r&&r.missingFields,o=r&&r.originalFields,a=0,s=e;a<s.length;a++){for(var l=s[a],u=l.toLowerCase(),d=!1,c=0,p=t;c<p.length;c++){var f=p[c];if(u===f.name.toLowerCase()){n.push(f.name),d=!0,o&&o.push(l);break}}!d&&i&&i.push(l)}return n}function g(e,t,r){if(null!=e.maxRecordCount&&t.length>e.maxRecordCount){var o=function(e,t){for(var r=e.length,n=Math.ceil(r/t),i=[],o=0;o<n;o++){var a=Math.floor(r*o/n),s=Math.floor(r*(o+1)/n);i.push(e.slice(a,s))}return i}(t,e.maxRecordCount);return i.all(o.map(function(t){return g(e,t,r)})).then(b)}var a=new u({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return new l(e.parsedUrl.path).execute(a).then(function(e){return e&&e.features&&e.features.length===t.length?e.features.map(function(e){return e.attributes}):i.reject(new n("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function m(e,t,a,s,l){for(var u=[],c=0;c<t.attributeData.length;c++){var p=t.attributeData[c],f=e[c];if(f&&-1!==s.indexOf(f.name)){var h=o.makeAbsolute(p.href,t.baseUrl);u.push({url:h,storageInfo:f})}}return i.eachAlways(u.map(function(e){return r(e.url,{responseType:"array-buffer"}).then(function(t){return d.readBinaryAttribute(e.storageInfo,t.data)})})).then(function(e){var t=[];if(!l.ignoreUnavailableFields&&e.some(function(e){return null==e.value})){for(var r=[],o=0;o<e.length;o++)null==e[o].value&&r.push({name:u[o].storageInfo.name,error:e[o].error});return i.reject(new n("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:r}))}for(var s=0,d=a;s<d.length;s++){var c=d[s],p={};for(o=0;o<e.length;o++)null!=e[o].value&&(p[u[o].storageInfo.name]=y(e[o].value,c));t.push(p)}return t})}function y(e,t){var r=e[t];return e instanceof Int16Array?r===I?null:r:e instanceof Int32Array?r===A?null:r:r!=r?null:r}function b(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];t=t.concat(i)}return t}function _(e){var t=new a(f(e.store.indexCRS||e.store.geographicCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function w(e){var t=new a(f(e.store.vertexCRS||e.store.projectedCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function S(e,t,r){if(!s.canProject(e,t))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&e.isGeographic)throw new n("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{})}function x(e,t,r){var n=_(e),i=w(e);S(n,t,r),S(i,t,r)}function P(e){return"mesh-3d"===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.DDS_ENCODING_STRING="image/vnd-ms.dds",t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"],t.extractWkid=f,t.getAppropriateTextureEncoding=function(e,r){if(Array.isArray(e)){if(r){var n=e.indexOf(t.DDS_ENCODING_STRING);if(n>-1)return n}for(var i=0;i<e.length;i++)if(t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(e[i])>-1)return i;throw new Error("Could not find appropriate texture encoding (among "+e.toString()+")")}return-1},t.findIntersectingNodes=function e(t,r,n,i,o,a){if(null!=n){var s=n.mbs;if(r!==i&&(s=C,c.mbsToMbs(n.mbs,i,s,r)),0!==h(t,s)&&(a(n),n.children))for(var l=0;l<n.children.length;++l)e(t,r,o[n.children[l].id],i,o,a)}},t.buildTopNodeMap=function(e,t,r,n){if(void 0===n&&(n=Number.POSITIVE_INFINITY),t<=0)e.clear();else{var i=new Map,o=Number.POSITIVE_INFINITY;e.forEach(function(a,s){var l=r(a);if(s<t)return o=Math.min(o,l),void i.set(a.id,l);if(!(l<=o||l>=n)){i.set(a.id,l);for(var u=o=i.get(e.front().id),d=0,c=1;c<t;++c){var p=e.data[c],f=i.get(p.id);f<o&&(d=c,u=o,o=f)}e.data[d]=a,o=u}}),e.length=Math.min(e.length,t),e.sort(function(e,t){return i.get(t.id)-i.get(e.id)})}};var C=[0,0,0,0];t.intersectBoundingBoxWithMbs=h,t.findFieldsCaseInsensitive=v,t.whenGraphicAttributes=function(e,t,r,o,a,s){var l=!0===(s&&s.populateObjectId),u=s.ignoreUnavailableFields?void 0:[],d=1===o.length&&"*"===o[0];!d&&l&&(o=function(e,t){return e.filter(function(e){return e.toLowerCase()!==t.toLowerCase()}).concat([t])}(o,r));var c=d?o:v(o,e.fields,{missingFields:u});if(u&&0!==u.length)return i.reject(new n("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:u}));if(0===t.length)return i.resolve(t);var p=e.associatedLayer,f=e.attributeStorageInfo,h=d?e.fields.map(function(e){return e.name}):c;if(p)return function(e,t,r,n){t.sort(function(e,t){return e.attributes[r]-t.attributes[r]});var i=t.map(function(e){return e.attributes[r]}),o=[],a=v(n,e.fields,{originalFields:o});return g(e,i,a).then(function(e){for(var r=0;r<t.length;r++){var n=t[r],i=e[r];n.attributes={};for(var s=0;s<o.length;s++)n.attributes[o[s]]=i[a[s]]}return t})}(p,t,r,h);var y=function(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];o in t.attributes||r.push(o)}return r}(h,t[0]);if(0===y.length)return i.resolve(t);if(f){var b=a();return null==b?i.reject(new n("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):m(f,b.node,b.indices,y,s).then(function(e){for(var r=0;r<t.length;r++){for(var n=0,i=h;n<i.length;n++){var o=i[n];o in e[r]||(e[r][o]=t[r].attributes[o])}t[r].attributes=e[r]}return t})}return i.reject(new n("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var I=-Math.pow(2,15),A=-Math.pow(2,31);t.getCachedAttributeValue=y,t.convertFlatRangesToOffsets=function(e,t,r){void 0===r&&(r=2);for(var i=null!=t?t:e.length/r,o=new Uint32Array(i+1),a=0;a<i;a++){var s=e[a*r],l=3*s;o[a]=l;var u=(a-1)*r+1;if(u>=0&&s-1!==e[u])throw new n("Face ranges are not continuous")}var d=3*(e[(i-1)*r+1]+1);return o[o.length-1]=d,o},t.getIndexCrs=_,t.getVertexCrs=w,t.getCacheKeySuffix=function(e,t){return t===c.SphericalECEFSpatialReference?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null},t.checkSpatialReference=S,t.checkSpatialReferences=x,t.checkSceneLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{})},t.checkSceneLayerCompatibleWithView=function(e,t){x(e,t.spatialReference,t.viewingMode)},t.checkPointCloudLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})},t.checkPointCloudLayerCompatibleWithView=function(e,t){S(e.spatialReference,t.spatialReference,t.viewingMode)},t.encodeSymbolColor=p.encodeSymbolColor,t.rendererNeedsTextures=function(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;var t=e.getSymbols();if(0===t.length)return!0;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(!P(i)||0===i.symbolLayers.length)return!0;for(var o=0,a=i.symbolLayers.items;o<a.length;o++){var s=a[o];if("fill"!==s.type||null==s.material||"replace"!==s.material.colorMixMode)return!0}}return!1}}.apply(null,n))||(e.exports=i)},1461:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(40)],void 0===(i=function(e,t,r){function n(e,t,n,i,o,s,l,u,d,c,p){return function(e,t,n){for(var i=r.vec3d.dist2(e.maxVert[0],e.minVert[0]),o=0,a=1;a<7;++a){var s=r.vec3d.dist2(e.maxVert[a],e.minVert[a]);s>i&&(i=s,o=a)}r.vec3d.set(e.minVert[o],t),r.vec3d.set(e.maxVert[o],n)}(e,i,o),r.vec3d.dist2(i,o)<f?1:(r.vec3d.subtract(i,o,l),r.vec3d.normalize(l),function(e,t,n,i){for(var o=e.data,a=e.offsetIdx,s=e.strideIdx,l=Number.NEGATIVE_INFINITY,u=0,d=a;d<o.length;d+=s){r.vec3d.set3(o[d]-t[0],o[d+1]-t[1],o[d+2]-t[2],P);var c=n[0]*P[0]+n[1]*P[1]+n[2]*P[2],p=r.vec3d.length2(n),f=r.vec3d.length2(P)-c*c/p;f>l&&(l=f,u=d)}return r.vec3d.set3(o[u],o[u+1],o[u+2],i),l}(t,i,l,s)<f?2:(r.vec3d.subtract(o,s,u),r.vec3d.normalize(u),r.vec3d.subtract(s,i,d),r.vec3d.normalize(d),r.vec3d.cross(u,l,n),r.vec3d.normalize(n),a(t,n,l,u,d,c),0))}function i(e,t,n,i,s,l,u,d,c,p){o(e,t,n,i,s,g,m),void 0!==g[0]&&(r.vec3d.subtract(g,n,y),r.vec3d.normalize(y),r.vec3d.subtract(g,i,b),r.vec3d.normalize(b),r.vec3d.subtract(g,s,_),r.vec3d.normalize(_),r.vec3d.cross(b,l,w),r.vec3d.normalize(w),r.vec3d.cross(_,u,S),r.vec3d.normalize(S),r.vec3d.cross(y,d,x),r.vec3d.normalize(x),a(e,w,l,b,y,c),a(e,S,u,_,b,c),a(e,x,d,y,_,c)),void 0!==m[0]&&(r.vec3d.subtract(m,n,y),r.vec3d.normalize(y),r.vec3d.subtract(m,i,b),r.vec3d.normalize(b),r.vec3d.subtract(m,s,_),r.vec3d.normalize(_),r.vec3d.cross(b,l,w),r.vec3d.normalize(w),r.vec3d.cross(_,u,S),r.vec3d.normalize(S),r.vec3d.cross(y,d,x),r.vec3d.normalize(x),a(e,w,l,b,y,c),a(e,S,u,_,b,c),a(e,x,d,y,_,c))}function o(e,t,n,i,o,a,s){!function(e,t,n,i,o){var a=e.data,s=e.offsetIdx,l=e.strideIdx;r.vec3d.set3(a[s],a[s+1],a[s+2],i),r.vec3d.set(i,o),n[0]=r.vec3d.dot(E,t),n[1]=n[0];for(var u=s+l;u<a.length;u+=l){r.vec3d.set3(a[u],a[u+1],a[u+2],E);var d=r.vec3d.dot(E,t);d<n[0]&&(n[0]=d,r.vec3d.set(E,i)),d>n[1]&&(n[1]=d,r.vec3d.set(E,o))}}(e,t,C,s,a);var l=r.vec3.dot(n,t);C[1]-f<=l&&(a[0]=void 0),C[0]+f>=l&&(s[0]=void 0)}function a(e,t,n,i,o,a){if(!(r.vec3d.length2(t)<f)){r.vec3d.cross(n,t,I),r.vec3d.cross(i,t,A),r.vec3d.cross(o,t,R),s(e,t,C),N[1]=C[0],O[1]=C[1],M[1]=O[1]-N[1];for(var l=[n,i,o],u=[I,A,R],d=0;d<3;++d){s(e,l[d],C),N[0]=C[0],O[0]=C[1],s(e,u[d],C),N[2]=C[0],O[2]=C[1],M[0]=O[0]-N[0],M[2]=O[2]-N[2];var c=p(M);c<a.quality&&(r.vec3d.set(l[d],a.b0),r.vec3d.set(t,a.b1),r.vec3d.set(u[d],a.b2),a.quality=c)}}}function s(e,t,r){var n=e.data,i=e.offsetIdx,o=e.strideIdx;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(var a=i;a<n.length;a+=o){var s=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)}}function l(e,t,n){r.vec3d.set(e,n.center),r.vec3d.scale(t,.5,n.halfSize),r.quat4.identity(n.quaternion)}function u(e,t,n){r.vec3d.set(t,z),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?z[0]=0:Math.abs(t[1])>Math.abs(t[2])?z[1]=0:z[2]=0,r.vec3d.length2(z)<f&&(z[0]=z[1]=z[2]=1),r.vec3d.cross(t,z,T),r.vec3d.normalize(T),r.vec3d.cross(t,T,k),r.vec3d.normalize(k),d(e,t,T,k,U,L),r.vec3d.subtract(L,U,D),c(t,T,k,U,L,D,n)}function d(e,t,r,n,i,o){s(e,t,C),i[0]=C[0],o[0]=C[1],s(e,r,C),i[1]=C[0],o[1]=C[1],s(e,n,C),i[2]=C[0],o[2]=C[1]}function c(e,t,n,i,o,a,s){V[0]=e[0],V[3]=e[1],V[6]=e[2],V[1]=t[0],V[4]=t[1],V[7]=t[2],V[2]=n[0],V[5]=n[1],V[8]=n[2],r.quat4.fromRotationMatrix(V,s.quaternion),r.vec3d.add(i,o,j),r.vec3d.scale(j,.5),r.vec3d.scale(e,j[0],s.center),r.vec3d.scale(t,j[1],F),r.vec3d.add(s.center,F),r.vec3d.scale(n,j[2],F),r.vec3d.add(s.center,F),r.vec3d.scale(a,.5,s.halfSize)}function p(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}Object.defineProperty(t,"__esModule",{value:!0});var f=1e-6,h=r.vec3d.create(),v=r.vec3d.create();t.computeOBB=function(e,t){var o=e.data,a=e.strideIdx,s=o.length/a;if(!(s<=0)){var f=new B(e);r.vec3d.add(f.minProj,f.maxProj,h),r.vec3d.scale(h,.5),r.vec3d.subtract(f.maxProj,f.minProj,v);var g=p(v),m=new W;m.quality=g,s<14&&(e={data:new Float64Array(f.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var y=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),x=r.vec3d.create(),P=r.vec3d.create();switch(n(f,e,P,y,b,_,w,S,x,m)){case 1:return void l(h,v,t);case 2:return void u(e,w,t)}i(e,P,y,b,_,w,S,x,m),d(e,m.b0,m.b1,m.b2,U,L);var C=r.vec3d.create();r.vec3d.subtract(L,U,C),m.quality=p(C),m.quality<g?c(m.b0,m.b1,m.b2,U,L,C,t):l(h,v,t)}};var g=r.vec3d.create(),m=r.vec3d.create(),y=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),x=r.vec3d.create(),P=r.vec3d.create(),C=r.vec2d.create(),I=r.vec3d.create(),A=r.vec3d.create(),R=r.vec3d.create(),O=r.vec3d.create(),N=r.vec3d.create(),M=r.vec3d.create(),E=r.vec3d.create(),z=r.vec3d.create(),T=r.vec3d.create(),k=r.vec3d.create(),U=r.vec3d.create(),L=r.vec3d.create(),D=r.vec3d.create(),F=r.vec3d.create(),V=r.mat3d.create(),j=r.vec3d.create(),B=function(){return function(e){this.minVert=[],this.maxVert=[],this.buffer=new ArrayBuffer(448);var t=0;for(this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;this.minVert.length<7;)this.minVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(;this.maxVert.length<7;)this.maxVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(var n=0;n<7;++n)this.minProj[n]=Number.POSITIVE_INFINITY,this.maxProj[n]=Number.NEGATIVE_INFINITY;var i=[],o=[],a=e.data,s=e.offsetIdx,l=e.strideIdx;for(n=s;n<a.length;n+=l){var u=a[n];u<this.minProj[0]&&(this.minProj[0]=u,i[0]=n),u>this.maxProj[0]&&(this.maxProj[0]=u,o[0]=n),(u=a[n+1])<this.minProj[1]&&(this.minProj[1]=u,i[1]=n),u>this.maxProj[1]&&(this.maxProj[1]=u,o[1]=n),(u=a[n+2])<this.minProj[2]&&(this.minProj[2]=u,i[2]=n),u>this.maxProj[2]&&(this.maxProj[2]=u,o[2]=n),(u=a[n]+a[n+1]+a[n+2])<this.minProj[3]&&(this.minProj[3]=u,i[3]=n),u>this.maxProj[3]&&(this.maxProj[3]=u,o[3]=n),(u=a[n]+a[n+1]-a[n+2])<this.minProj[4]&&(this.minProj[4]=u,i[4]=n),u>this.maxProj[4]&&(this.maxProj[4]=u,o[4]=n),(u=a[n]-a[n+1]+a[n+2])<this.minProj[5]&&(this.minProj[5]=u,i[5]=n),u>this.maxProj[5]&&(this.maxProj[5]=u,o[5]=n),(u=a[n]-a[n+1]-a[n+2])<this.minProj[6]&&(this.minProj[6]=u,i[6]=n),u>this.maxProj[6]&&(this.maxProj[6]=u,o[6]=n)}for(n=0;n<7;++n){var d=i[n];r.vec3d.set3(a[d],a[d+1],a[d+2],this.minVert[n]),d=o[n],r.vec3d.set3(a[d],a[d+1],a[d+2],this.maxVert[n])}}}(),W=function(){return function(){this.b0=r.vec3d.createFrom(1,0,0),this.b1=r.vec3d.createFrom(0,1,0),this.b2=r.vec3d.createFrom(0,0,1),this.quality=0}}()}.apply(null,n))||(e.exports=i)},1517:function(e,t,r){var n,i;n=[r(156),r(212)],void 0===(i=function(e,t){function r(e,t){return e-t}function n(e,t){var r,n;return(r=Number(e.toFixed(t)))<e?n=r+1/Math.pow(10,t):(n=r,r-=1/Math.pow(10,t)),[r=Number(r.toFixed(t)),n=Number(n.toFixed(t))]}function i(e,t,r,n,i){var o,a,s=l.percentChange(e,t,r,n);return o=null==s.previous||s.previous<=i,a=null==s.next||s.next<=i,o&&a||s.previous+s.next<=2*i}var o=/^-?(\d+)(\.(\d+))?$/i,a=new RegExp("\\"+t.decimal+"0+$","g"),s=new RegExp("(\\d)0*$","g"),l={numDigits:function(e){var t=String(e),r=t.match(o),n={integer:0,fractional:0};if(r&&r[1])n.integer=r[1].split("").length,n.fractional=r[3]?r[3].split("").length:0;else if(t.toLowerCase().indexOf("e")>-1){var i,a,s=t.split("e"),u=s[0],d=s[1];u&&d&&(u=Number(u),(a=(d=Number(d))>0)||(d=Math.abs(d)),i=l.numDigits(u),a?(i.integer+=d,d>i.fractional?i.fractional=0:i.fractional-=d):(i.fractional+=d,d>i.integer?i.integer=1:i.integer-=d),n=i)}return n},percentChange:function(e,t,r,n){var i,o,a={previous:null,next:null};return null!=r&&(o=t-r-(i=e-r),a.previous=Math.floor(Math.abs(100*o/i))),null!=n&&(o=n-t-(i=n-e),a.next=Math.floor(Math.abs(100*o/i))),a},round:function(e,t){var o,a,s,u,d,c,p,f,h,v,g=e.slice(0),m=t&&null!=t.tolerance?t.tolerance:2,y=t&&t.indexes,b=!(!t||null==t.strictBounds)&&t.strictBounds;if(y)y.sort(r);else for(y=[],p=0;p<g.length;p++)y.push(p);for(p=0;p<y.length;p++)if(o=g[v=y[p]],a=0===v?null:g[v-1],s=v===g.length-1?null:g[v+1],u=l.numDigits(o).fractional){for(f=0,h=!1;f<=u&&!h;)c=n(o,f),h=i(o,d=b&&0===p?c[1]:c[0],a,s,m),f++;h&&(g[v]=d)}return g},format:function(t,r){r=r||{places:20,round:-1};var n=e.format(t,r);return n&&(n=n.replace(s,"$1").replace(a,"")),n}};return l}.apply(null,n))||(e.exports=i)},1629:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1551),r(1554),r(1555),r(1352)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t&&null!=i.attributeValues&&"UInt8"===i.attributeValues.valueType&&3===i.attributeValues.valuesPerElement)return{storageInfo:i,useElevation:!1}}return null}function s(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t){var o="embedded-elevation"===i.encoding;return{storageInfo:o?null:i,useElevation:o}}}return"elevation"===t.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function l(e,t,r,n){if(e&&e.useElevation){for(var i=new Float64Array(n),a=0;a<n;a++)i[a]=r[3*a+2];return i}return e&&t?o.readBinaryAttribute(e.storageInfo,t,n):null}function u(e){return null==e||"none"===e?null:"low-four-bit"===e?function(e){return 15&e}:"high-four-bit"===e?function(e){return(240&e)>>4}:"absolute-value"===e?function(e){return Math.abs(e)}:"modulo-ten"===e?function(e){return e%10}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getRendererInfo=function(e){var t=e.renderer,r=t&&t.type,n=t&&e.renderer.toJSON()||null,i=null,o=!1;"point-cloud-unique-value"===r?i=s(e.attributeStorageInfo,t.field):"point-cloud-stretch"===r?i=s(e.attributeStorageInfo,t.field):"point-cloud-class-breaks"===r?i=s(e.attributeStorageInfo,t.field):o="point-cloud-rgb"===r?null!=(i=a(e.attributeStorageInfo,t.field)):null!=(i=a(e.attributeStorageInfo,"RGB"));var l=null;return t&&t.colorModulation&&(l=s(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:n,isRGBRenderer:o,primaryAttribute:i,modulationAttribute:l}},t.evaluateRenderer=function(e,t,o,a,s){var d=e.rendererJSON,c=e.isRGBRenderer,p=e.primaryAttribute,f=e.modulationAttribute,h=l(p,t,a,s),v=l(f,o,a,s),g=null,m=null;if(h&&c)g=h;else if(h&&"pointCloudUniqueValueRenderer"===d.type){var y=(m=i.fromJSON(d)).colorUniqueValueInfos;g=new Uint8Array(3*s);for(var b=u(m.fieldTransformType),_=0;_<s;_++)for(var w=(P=b?b(h[_]):h[_])+"",S=0;S<y.length;S++)if(y[S].values.indexOf(w)>=0){g[3*_]=y[S].color.r,g[3*_+1]=y[S].color.g,g[3*_+2]=y[S].color.b;break}}else if(h&&"pointCloudStretchRenderer"===d.type){var x=(m=n.fromJSON(d)).stops;for(g=new Uint8Array(3*s),b=u(m.fieldTransformType),_=0;_<s;_++){var P=b?b(h[_]):h[_],C=x.length-1;if(P<x[0].value)g[3*_]=x[0].color.r,g[3*_+1]=x[0].color.g,g[3*_+2]=x[0].color.b;else if(P>=x[C].value)g[3*_]=x[C].color.r,g[3*_+1]=x[C].color.g,g[3*_+2]=x[C].color.b;else for(S=1;S<x.length;S++)if(P<x[S].value){var I=(P-x[S-1].value)/(x[S].value-x[S-1].value);g[3*_]=x[S].color.r*I+x[S-1].color.r*(1-I),g[3*_+1]=x[S].color.g*I+x[S-1].color.g*(1-I),g[3*_+2]=x[S].color.b*I+x[S-1].color.b*(1-I);break}}}else if(h&&"pointCloudClassBreaksRenderer"===d.type){var A=(m=r.fromJSON(d)).colorClassBreakInfos;for(g=new Uint8Array(3*s),b=u(m.fieldTransformType),_=0;_<s;_++)for(P=b?b(h[_]):h[_],S=0;S<A.length;S++)if(P>=A[S].minValue&&P<=A[S].maxValue){g[3*_]=A[S].color.r,g[3*_+1]=A[S].color.g,g[3*_+2]=A[S].color.b;break}}else for(g=new Uint8Array(3*s),_=0;_<g.length;_++)g[_]=255;if(v&&m&&m.colorModulation){var R=m.colorModulation.minValue,O=m.colorModulation.maxValue;for(_=0;_<s;_++){var N=(P=v[_])>=O?1:P<=R?.3:.3+.7*(P-R)/(O-R);g[3*_]=N*g[3*_],g[3*_+1]=N*g[3*_+1],g[3*_+2]=N*g[3*_+2]}}return g},t.getSplatSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null},t.getFixedSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null},t.rendererUsesFixedSizes=function(e){var t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type}}.apply(null,n))||(e.exports=i)},1712:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(23)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=new r;return this._deferreds.push(t),this._values.push(e),t.promise},e.prototype.length=function(){return this._deferreds.length},e.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())},e.prototype.cancelAll=function(){for(var e=0,t=this._deferreds;e<t.length;e++)t[e].cancel();this._deferreds.length=0,this._values.length=0},e}();t.IdleQueue=n}.apply(null,n))||(e.exports=i)},2160:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(0),r(108),r(78),r(27),r(407),r(407),r(16),r(7),r(6),r(1323),r(32),r(15),r(410),r(1),r(406),r(79),r(1359),r(1325),r(1258),r(1452),r(1712),r(2161),r(2162),r(1629),r(2163),r(1357),r(40),r(1300),r(1353),r(74),r(1281),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,v,g,m,y,b,_,w,S,x,P,C,I,A,R,O,N,M,E,z,T){var k=d.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),U=N.plane.create();return function(t){function d(){var e=null!==t&&t.apply(this,arguments)||this;return e.maximumPointCount=4e6,e._renderer=null,e._rendererAdded=!1,e._renderedNodes=new Set,e._updateViewNeeded=!0,e._idleUpdatesEnabled=!0,e._lodFactor=1,e._worker=new w,e._workerThread=null,e._maxLoggedBoxWarnings=5,e._pageMultiplier=1,e._handles=new u,e._indexQueue=[],e._workQueue=[],e._idleQueue=new x.IdleQueue,e._indexPagesLoading=new Map,e._loadingNodes=new Map,e._layerIsVisible=!1,e._totalWork=0,e._index=null,e._loadingInitNodePage=!1,e._nodeIdArray=[],e}return r(d,t),Object.defineProperty(d.prototype,"pointScale",{get:function(){var e=I.getSplatSizeAlgorithm(this.layer.renderer);return e&&null!=e.scaleFactor?e.scaleFactor:1},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"useRealWorldSymbolSizes",{get:function(){var e=I.getFixedSizeAlgorithm(this.layer.renderer);return!(!e||null==e.useRealWorldSymbolSizes)&&e.useRealWorldSymbolSizes},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"pointSize",{get:function(){var e=I.getFixedSizeAlgorithm(this.layer.renderer);return e&&null!=e.size?e.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_clippingBox",{get:function(){var e=m.create(),t=this.view.renderSpatialReference;return E.extentToBoundingBox(this.view.clippingArea,e,t)?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_elevationOffset",{get:function(){var e=this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){var t=y.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=b.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),d.prototype.initialize=function(){var t=this;S.checkPointCloudLayerValid(this.layer),S.checkPointCloudLayerCompatibleWithView(this.layer,this.view),this._initRenderer();var r=this._initNodePages(),n={idleBegin:function(){return t._idleBegin()},idleEnd:function(){return t._idleEnd()},needsUpdate:function(){return!0},idleFrame:function(e){return t._process(e)}},i={idleBegin:function(){return t._idleBegin()},idleEnd:function(){return t._idleEnd()},needsUpdate:function(){return t._updateViewNeeded||t._workQueue.length>0},idleFrame:function(e){return t._processWhileSuspended(e)}};v.open(p.getAbsMid("./PointCloudWorker",e,T),{client:this}).then(function(e){t.destroyed?e.close():t._workerThread=e}),this._handles.add(h.init(this,"_clippingBox",function(){return t._setUpdateViewNeeded()})),this._handles.add(h.init(this.layer,"elevationInfo",function(){return t._elevationInfoChanged()})),this._handles.add(h.init(this,"_elevationOffset",function(){return t._elevationOffsetChanged()})),this._handles.add(h.init(this.layer,"renderer",function(){return t._rendererChanged()})),this._handles.add(h.init(this,"clippingArea",function(){t._setUpdateViewNeeded()})),this._handles.add(this.view.state.watch("camera",function(){t._setUpdateViewNeeded()})),this.view.resourceController.memoryEvents.on("quality-changed",function(){return t._setUpdateViewNeeded()}),this.addResolvingPromise(r),this.when(function(){t._handles.add(t.view.resourceController.registerFrameWorker(function(e){return t._frame(e)})),t._handles.add(h.init(t,"suspended",function(e){t._idleFrameWorker&&(t._idleFrameWorker.remove(),t._idleFrameWorker=null),t._idleFrameWorker=e?t.view.resourceController.registerIdleFrameWorker(i):t.view.resourceController.registerIdleFrameWorker(n)}))})},d.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0,this._updateLoading()},d.prototype.destroy=function(){this._cancelNodeLoading(),this._workerThread&&(this._workerThread.close(),this._workerThread=null),this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null),this._handles.destroy(),this._destroyRenderer()},d.prototype._initRenderer=function(){var e=this;this._renderer=new A,this._renderer.layerUid=this.layer.uid,this._handles.add(h.init(this,"_clippingBox",function(t){e._renderer.clippingBox=t})),this._handles.add(h.init(this,"_clippingBox",function(t){e._renderer.clippingBox=t})),this._handles.add(h.init(this,"suspended",function(t){e._setPointsVisible(!t)})),this._handles.add(h.init(this,"pointScale",function(t){e._renderer.scaleFactor=t})),this._renderer.minSizePx=Math.sqrt(2),this._handles.add(h.init(this,"useRealWorldSymbolSizes",function(t){e._renderer.useRealWorldSymbolSizes=t})),this._handles.add(h.init(this,"pointSize",function(t){var r=f.pt2px(t);e._renderer.size=t,e._renderer.sizePx=r})),this._handles.add(h.init(this,["inverseDensity","maximumPointCount"],function(){e._setUpdateViewNeeded()})),this._handles.add(h.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(t){e._lodFactor=t,e._setUpdateViewNeeded()}))},d.prototype._destroyRenderer=function(){this._setPointsVisible(!1)},d.prototype._setPointsVisible=function(e){e&&!this._rendererAdded?(this.view._stage.addExternalRenderer([z.OPAQUE_EXTERNAL],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeExternalRenderer(this._renderer),this._rendererAdded=!1)},d.prototype._rendererChanged=function(){this._clearNodeState(),this._renderer.useFixedSizes=I.rendererUsesFixedSizes(this.layer.renderer),this._setUpdateViewNeeded()},d.prototype._elevationInfoChanged=function(){var e=this.layer.elevationInfo&&this.layer.elevationInfo.unit;e&&!b.supportsUnit(e)&&k.warn("elevationInfo.unit","'"+e+"' is not a valid unit")},d.prototype._elevationOffsetChanged=function(){this._clearNodeState(),this._initNodePages()},d.prototype.displayNodes=function(e){this._workQueue=P.nodeDiff(l.keysOfSet(this._renderedNodes),e,this._index),P.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index),P.splitWorkEntries(this._workQueue,8,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")},d.prototype.cancelLoading=function(){this._cancelNodeLoading(),this._cancelIndexLoading()},d.prototype._cancelNodeLoading=function(){var e=[];this._loadingNodes.forEach(function(t){return e.push(t)}),this._loadingNodes.clear();for(var t=0,r=e;t<r.length;t++)r[t].cancel();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()},d.prototype._updateQueues=function(){var e=this,t=new Set;this._workQueue.forEach(function(e){e.load.forEach(function(e){t.add(e)})});var r=[],n=new Map;this._loadingNodes.forEach(function(e,i){t.has(i)?n.set(i,e):r.push(e)}),this._loadingNodes=n;for(var i=0,o=r;i<o.length;i++)o[i].cancel();this._workQueue=this._workQueue.filter(function(t){for(var r=0,n=t.load;r<n.length;r++){var i=n[r];if(e._loadingNodes.has(i))return!1}return!0}),this._totalWork=this._computeWork(),this._updateLoading()},d.prototype._cancelIndexLoading=function(){this._indexQueue=[],this._indexPagesLoading.forEach(function(e){return e.cancel()}),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()},d.prototype._clearNodeState=function(){var e=this;this._renderedNodes.forEach(function(t){return e._removeFromRenderer(t)}),this._cancelNodeLoading()},d.prototype._idleBegin=function(){this._setUpdateViewNeeded()},d.prototype._idleEnd=function(){this._setUpdateViewNeeded()},d.prototype._frame=function(e){this.suspended?this._processWhileSuspended(e):this._process(e)},d.prototype._process=function(e){if(this._idleUpdatesEnabled){for(this._updateViewNeeded&&!e.done()&&this._updateWorkQueues();this._indexQueue.length>0&&!e.done();)this._processIndexQueue();for(this._processWorkQueue(e);this._idleQueue.length()>0&&!e.done();)this._idleQueue.process()}},d.prototype._processWhileSuspended=function(e){if(this._idleUpdatesEnabled)for(this._cancelNodeLoading(),this._updateViewNeeded&&!e.done()&&this._updateWorkQueues();this._workQueue.length>0&&!e.done();)this._processWorkQueueRemoveOnly()},d.prototype._processIndexQueue=function(){var e=this,t=this._indexQueue.shift();this._indexPagesLoading.set(t,this._loadNodePage(t)),this._indexPagesLoading.get(t).then(function(r){e._index.addPage(t,r,e._elevationOffset),e._setUpdateViewNeeded()}).always(function(){e._indexPagesLoading.delete(t)})},d.prototype._processWorkQueue=function(e){for(;!e.done();){var t=this._scheduleWorkEntry();if(!t)return;this._processWorkEntry(t)}},d.prototype._scheduleWorkEntry=function(){var e=this;if(this._loadingNodes.size>=8)return null;for(var t=0;t<this._workQueue.length;++t){var r=this._workQueue[t];if(!s.find(r.remove,function(t){return!e._renderedNodes.has(t)})){for(var n=t;n>0;--n)this._workQueue[n]=this._workQueue[n-1];return this._workQueue.shift(),r}}return null},d.prototype._processWorkEntry=function(e){var t=this;if(0!==e.load.length)o(e.load.map(function(e){return t._loadingNodes.has(e)||t._loadingNodes.set(e,t.loadNode(e)),t._loadingNodes.get(e)})).then(function(r){for(var n=0;n<e.load.length;n++)t._addToRenderer(e.load[n],r[n]);for(n=0;n<e.remove.length;n++)t._removeFromRenderer(e.remove[n])}).always(function(){for(var r=0;r<e.load.length;r++)t._loadingNodes.delete(e.load[r]);t._updateLoading()}),this._updateLoading();else for(var r=0;r<e.remove.length;r++)this._removeFromRenderer(e.remove[r])},d.prototype._processWorkQueueRemoveOnly=function(){for(var e=this._workQueue.shift(),t=0;t<e.remove.length;t++)this._removeFromRenderer(e.remove[t]);this._updateLoading()},d.prototype._computeWork=function(){for(var e=0,t=0;t<this._workQueue.length;t++)e+=this._workQueue[t].load.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,(e+=this._loadingInitNodePage?100:0)+(this._updateViewNeeded?100:0)},Object.defineProperty(d.prototype,"updatingPercentageValue",{get:function(){var e=this._computeWork();return 100*Math.min(this._totalWork,e)/this._totalWork},enumerable:!0,configurable:!0}),d.prototype._updateLoading=function(){this.notifyChange("updating"),this.notifyChange("updatingPercentageValue")},d.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible},d.prototype.isUpdating=function(){return this._computeWork()>0},d.prototype._initNodePages=function(){var e=this,t=this.layer.store.index,r=t.nodesPerPage||t.nodePerIndexBlock;return this._index=new C(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,r),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=t.nodesPerPage?1:t.nodePerIndexBlock,this._loadNodePage(0).then(function(t){e._index.addPage(0,t,e._elevationOffset),e._loadingInitNodePage=!1,e._setUpdateViewNeeded()})},d.prototype._loadNodePage=function(e){var t=this,r=this.baseUrl+"/nodepages/"+e*this._pageMultiplier;return this._requestJSON(r).then(function(r){return r.data.nodes.map(function(r,n){return{resourceId:null!=r.resourceId?r.resourceId:e*t._index.pageSize+n,obb:r.obb,firstChild:r.firstChild,childCount:r.childCount,vertexCount:null!=r.vertexCount?r.vertexCount:r.pointCount,lodThreshold:null!=r.lodThreshold?r.lodThreshold:r.effectiveArea}})})},d.prototype._updateWorkQueues=function(){for(var e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(n/(.75*t));n>t;)e*=i,r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(2);this.displayNodes(r),this._updateViewNeeded=!1,this._updateLoading()},d.prototype._computePointCount=function(e){for(var t=0,r=0;r<e.length;r++){var n=this._index.getNode(e[r]);n&&(t+=n.vertexCount)}return t},d.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryFactor},d.prototype._computeNodesForMinimumDensity=function(e){var t=this,r=this.view.state.camera,n=r.frustumPlanes,i=this._clippingBox,o=r.viewForward,a=O.vec3d.dot(o,r.eye),s=N.plane.fromNormalAndOffset(o,-a,U),l=r.perPixelRatio,u=e*e,d=this._nodeIdArray;return d.length=0,this._traverseVisible({frustumPlanes:n,clippingBox:i},{predicate:function(e,r,n){if(!n)return!1;if(0===r.childCount)return d.push(e),!1;var i=t._index.getRenderObb(e);return!(t._computeAveragePixelArea(i,r.lodThreshold,r.vertexCount,s,l)<=u&&(d.push(e),1))},pageMiss:function(e,r){d.push(e),t._indexQueue.indexOf(r)<0&&t._indexQueue.push(r)}}),d},d.prototype._computeAveragePixelArea=function(e,t,r,n,i){var o=Math.max(1e-7,M.minimumDistancePlane(e,n));return t/(o*o)/(4*i*i)/r},d.prototype.loadNode=function(e){var t=this,r=this._index.getNode(e),n=I.getRendererInfo(this.layer),a=[];return this._idleQueue.push().then(function(){var e=r.resourceId,i=t.loadGeometry(e),s=t.loadAttribute(e,n.primaryAttribute),l=t.loadAttribute(e,n.modulationAttribute);return o(a=[i,s,l])}).then(function(r){var i=r[0],o=r[1],a=r[2],s=[i];o&&s.push(o),a&&s.push(a);var l={geometryBuffer:i,primaryAttribute:o,modulationAttribute:a,schema:t.layer.store.defaultGeometrySchema,rendererInfo:n,obb:t._index.getRenderObb(e),elevationOffset:t._elevationOffset,inSR:t.layer.spatialReference.toJSON(),outSR:t.view.renderCoordsHelper.spatialReference.toJSON()};return t._workerThread?t._workerThread.invoke("process",l,s):c.resolve(t._worker.transform(l))}).catch(function(e){if(e instanceof i)for(var t=0,r=a;t<r.length;t++){r[t].cancel()}else console.error(e);return c.reject(e)})},d.prototype.loadGeometry=function(e){var t=this.baseUrl+"/nodes/"+e+"/geometries/0";return this._requestBinary(t).then(function(e){return e.data})},d.prototype.loadAttribute=function(e,t){if(!t||!t.storageInfo)return c.resolve(null);var r=t.storageInfo.key,n=this.baseUrl+"/nodes/"+e+"/attributes/"+r;return this._requestBinary(n).then(function(e){return e.data})},d.prototype._requestJSON=function(e){return a(e,{query:{f:"json"},responseType:"json"})},d.prototype._requestBinary=function(e){return a(e,{responseType:"array-buffer"})},d.prototype._removeFromRenderer=function(e){this._renderedNodes.has(e)&&(this._renderer.removeNode(""+e),this._renderedNodes.delete(e))},d.prototype._addToRenderer=function(e,t){if(!this._renderedNodes.has(e)){this._renderedNodes.add(e);var r=this._index.getNode(e),n=this._index.getRenderObb(e);(t.obb.halfSize[0]>n.halfSize[0]||t.obb.halfSize[1]>n.halfSize[1]||t.obb.halfSize[2]>n.halfSize[2])&&(this._maxLoggedBoxWarnings>0&&(k.warn("Node",e,"reported bounding box too small, got",n,"but points cover",t.obb),0==--this._maxLoggedBoxWarnings&&k.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(e,t.obb));var i=Math.sqrt(r.lodThreshold/r.vertexCount);this._renderer.addNode({id:""+e,coordinates:t.points,origin:n.center,rgb:t.rgb,splatSize:i,obb:n,isLeaf:0===r.childCount})}},d.prototype.removeCachedData=function(){var e=this;this.suspended&&this._renderedNodes.forEach(function(t){return e._removeFromRenderer(t)})},d.prototype.getCachedMemory=function(){return 0},d.prototype.getUsedMemory=function(){var e=this;return l.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+15*e._index.getNode(r).vertexCount+128},0)/1024/1024},d.prototype.getUnloadedMemory=function(){var e=this,t=this._renderedNodes.size;if(t<4)return 0;for(var r=l.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount}),n=this._loadingNodes.size,i=0;i<this._workQueue.length;i++)n+=this._workQueue[i].load.length,n-=this._workQueue[i].remove.length;return n<0?0:(n*r/t*15+128*n)/1024/1024},d.prototype.getStats=function(){var e=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":l.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length()}},n([g.property()],d.prototype,"layer",void 0),n([g.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],d.prototype,"baseUrl",void 0),n([g.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"pointScale",null),n([g.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"useRealWorldSymbolSizes",null),n([g.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"pointSize",null),n([g.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"inverseDensity",null),n([g.property()],d.prototype,"maximumPointCount",void 0),n([g.property({readOnly:!0,dependsOn:["view.clippingArea"]})],d.prototype,"_clippingBox",null),n([g.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],d.prototype,"_elevationOffset",null),n([g.property(R.updatingPercentage)],d.prototype,"updatingPercentage",void 0),n([g.property({readOnly:!0})],d.prototype,"updatingPercentageValue",null),n([g.subclass("esri.views.3d.layers.PointCloudLayerView3D")],d)}(g.declared(_))}.apply(null,n))||(e.exports=i)},2161:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(40)],void 0===(i=function(e,t,r){function n(e,t,r){for(var n=e;n>0;){var i=t.indexOf(n);if(i>=0)return i;n=r.getParentId(n)}return t.indexOf(n)}function i(e,t){for(var r=[e.remove[0]],n=[];1===r.length;){var i=r.pop();n.length=0;for(var o=0;o<e.load.length;o++){for(var a=e.load[o],s=t.getParentId(a);s!==i;)a=s,s=t.getParentId(a);var l=r.indexOf(a);l<0&&(l=r.length,r.push(a),n.push([])),n[l].push(e.load[o])}}var u=[];u.push({remove:e.remove,load:r});for(o=0;o<r.length;o++)n[o].length>1?u.push({remove:[r[o]],load:n[o]}):r[o]=n[o][0];return u}Object.defineProperty(t,"__esModule",{value:!0}),t.nodeDiff=function(e,t,r){for(var i=0;i<t.length;i++)s[i]=!1,l[i]=null;for(i=0;i<e.length;i++)o[i]=!1,a[i]=null;for(i=0;i<t.length;i++)(u=n(t[i],e,r))>=0&&(s[i]=!0,null!=a[u]?a[u].push(t[i]):a[u]=[t[i]]);for(i=0;i<e.length;i++){var u;(u=n(e[i],t,r))>=0&&(o[i]=!0,null!=l[u]?l[u].push(e[i]):l[u]=[e[i]])}var d=[];for(i=0;i<e.length;i++)null!=a[i]||o[i]||d.push({load:[],remove:[e[i]]});for(i=0;i<t.length;i++)null!=l[i]||s[i]||d.push({load:[t[i]],remove:[]});for(i=0;i<t.length;i++)null!=l[i]&&(l[i].length>1||l[i][0]!==t[i])&&d.push({load:[t[i]],remove:l[i]});for(i=0;i<e.length;i++)null!=a[i]&&(a[i].length>1||a[i][0]!==e[i])&&d.push({load:a[i],remove:[e[i]]});return d};var o=[!1],a=[null],s=[!1],l=[null];t.sortFrontToBack=function(e,t,n){return e.sort(function(e,i){if(0===e.load.length&&0===i.load.length)return 0;if(0===e.load.length)return-1;if(0===i.load.length)return 1;if(0===e.remove.length&&0===i.remove.length){var o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]);return r.vec3d.dot(o,t)-r.vec3d.dot(a,t)}return 0===e.remove.length?-1:0===i.remove.length?1:1===e.load.length&&1===i.load.length?(o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]),r.vec3d.dot(o,t)-r.vec3d.dot(a,t)):1===e.load.length?-1:1===i.load.length?1:(o=n.getRenderCenter(e.remove[0]),a=n.getRenderCenter(i.remove[0]),r.vec3d.dot(o,t)-r.vec3d.dot(a,t))})},t.splitWorkEntries=function(e,t,r){for(var n=0;n<e.length;++n){var o=e[n];if(o.load.length>t&&1===o.remove.length){var a=i(o,r);e[n]=a[0];for(var s=1;s<a.length;s++)e.push(a[s])}}},t.splitWorkEntry=i}.apply(null,n))||(e.exports=i)},2162:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(406),r(40),r(1353),r(74)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,n){var o=e.index;if(o.hasNodes(0,1)){var a=e.queue;a.length=0,a.push(0);var s=e.masks;for(s.length=0,s.push(0);a.length>0;){var u=a.pop(),d=s.pop(),c=o.getNode(u),p=o.getRenderObb(u),f=!0;if(null!=t.clippingBox)if(0==(d&(g=1<<t.frustumPlanes.length))){var h=i.toAaBoundingBox(p,e.tempAabb);r.contains(t.clippingBox,h)?d|=g:r.intersects(t.clippingBox,h)||(f=!1)}for(var v=0;v<t.frustumPlanes.length&&f;v++){var g;if(0==(d&(g=1<<v))){var m=i.intersectPlane(p,t.frustumPlanes[v]);m>0?f=!1:m<0&&(d|=g)}}if(n.predicate(u,c,f)){for(var y=c.firstChild,b=c.childCount,_=!1,w=l(y,o.pageSize),S=l(y+b-1,o.pageSize),x=w;x<=S;x++)if(!o.hasPage(x)){n.pageMiss(u,x),_=!0;break}if(!_)for(v=0;v<b;v++)a.push(y+v),s.push(d)}}}}function s(e,t,r,a){for(var s=new i.ObbArray(e.length),l=0;l<e.length;l++){var u=e[l].obb,c=s.obbs[l];if(i.set(u,c),n.vec3.set3(u.center[0],u.center[1],u.center[2]+a,d),!t.isGeographic&&r===o.SphericalECEFSpatialReference){o.computeLinearTransformation(t,d,p,r);var h=2*Math.sqrt(1+p[0]+p[5]+p[10]);f[0]=(p[9]-p[6])/h,f[1]=(p[2]-p[8])/h,f[2]=(p[4]-p[1])/h,f[3]=.25*h,n.quat4.conjugate(f),n.quat4.multiply(f,c.quaternion,c.quaternion)}o.bufferToBuffer(d,t,0,c.center,r,0,1)}return s.obbs}function l(e,t){return e/t|0}function u(e,t){return e%t}var d=n.vec3d.create(),c=function(){function e(e,t,r){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=r}return e.prototype.addPage=function(e,t,r){for(void 0===r&&(r=0);this._pages.length<e;)this._pages.push(null);var n=s(t,this._nodeSR,this._renderSR,r);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},function(e,t){for(var r=[0];r.length;)for(var n=r.pop(),i=e[l(n,t)].nodes[u(n,t)],o=0;o<i.childCount;o++){var a=i.firstChild+o;null!=e[l(a,t)]&&(e[l(a,t)].parents[u(a,t)]=n,r.push(a))}}(this._pages,this.pageSize)},e.prototype.hasPage=function(e){return!!this._pages[e]},e.prototype.getNode=function(e){var t=this.pageSize;return this._pages[l(e,t)].nodes[u(e,t)]},e.prototype.getRenderObb=function(e){var t=this.pageSize;return this._pages[l(e,t)].renderObbs[u(e,t)]},e.prototype.getRenderCenter=function(e){return this.getRenderObb(e).center},e.prototype.setRenderObb=function(e,t){var r=this.pageSize;i.set(t,this._pages[l(e,r)].renderObbs[u(e,r)])},e.prototype.getParentId=function(e){var t=this.pageSize;return this._pages[l(e,t)].parents[u(e,t)]},e.prototype.hasNodes=function(e,t){for(var r=l(e,this.pageSize),n=l(e+t-1,this.pageSize),i=r;i<=n;i++)if(null==this._pages[i])return!1;return!0},e.prototype.createVisibilityTraverse=function(){var e={index:this,queue:[],masks:[],tempAabb:r.create()};return function(t,r){return a(e,t,r)}},e}(),p=n.mat4d.create(),f=n.quat4.create();return c}.apply(null,n))||(e.exports=i)},2163:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2164),r(406),r(1300),r(1353),r(1278),r(1297),r(1287),r(1283),r(1286)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d){function c(e){return e?256:64}function p(e,t,r,n,i){if(r.drawScreenSpace)return r.fixedSize*t*n;var o=c(i)*t*n;return r.drawFixedSize?Math.min(r.fixedSize/2,o):r.screenMinSize>0?Math.min(Math.max(r.screenMinSize*t*n,e/2),o):Math.min(e/2,o)}function f(e,t,r,n,i){return r.drawScreenSpace?0:p(e,t,r,n,i)}function h(e,t,r){return null==r&&(r=a.vec3d.create()),r[0]=e.origin[0]+e.coordinates[3*t],r[1]=e.origin[1]+e.coordinates[3*t+1],r[2]=e.origin[2]+e.coordinates[3*t+2],r}var v={aPosition:0,aColor:1},g={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]};return function(){function e(){this.didRender=!1,this.needsRender=!0,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._clipBox=n.create(n.POSITIVE_INFINITY),this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null,this.tempMatrix4=a.mat4.create(),this.tempVec3=a.vec3.create(),this.nodes=[]}return e.prototype.initializeRenderContext=function(e){e.shaderSnippets.fsPointCloudPointRenderer||e.shaderSnippets._parse(r);var t=e.shaderSnippets.vsPointCloudPointRenderer,n=e.shaderSnippets.fsPointCloudPointRenderer;this._programWorld=new u(e.rctx,t,n,v,[]),this._programScreen=new u(e.rctx,t,n,v,["DRAW_SCREEN_SIZE"]),this._programWorldDepth=new u(e.rctx,t,n,v,["DEPTH_PASS"]),this._programScreenDepth=new u(e.rctx,t,n,v,["DRAW_SCREEN_SIZE","DEPTH_PASS"]),this.needsRender=!0},e.prototype.uninitializeRenderContext=function(e){this._programWorld&&this._programWorld.dispose(),this._programScreen&&this._programScreen.dispose(),this._programWorldDepth&&this._programWorldDepth.dispose(),this._programScreenDepth&&this._programScreenDepth.dispose(),this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null},e.prototype.intersect=function(e,t,r,s){var l=a.vec3d.create(),u=a.vec3d.create(),d=a.vec3d.create(),c=a.vec3d.create(),v=i.plane.create(),g=e.camera.perPixelRatio,m=e.camera.near,y=this._getSizeParams();a.vec3d.subtract(r,t,u);var b=1/a.vec3d.length(u);a.vec3d.scale(u,b,u),a.vec3d.negate(u,d),a.vec4d.set4(u[0],u[1],u[2],-a.vec3d.dot(u,t),v);var _={},w={},S=n.create(),x=n.create(this._clipBox);n.offset(x,-t[0],-t[1],-t[2],x);for(var P=0,C=this.nodes;P<C.length;P++){var I=C[P],A=I.splatSize*this._scaleFactor,R=o.minimumDistancePlane(I.obb,v),O=o.maximumDistancePlane(I.obb,v);R-=f(A,R+m,y,g,I.isLeaf);var N=(O-=f(A,O+m,y,g,I.isLeaf))<0,M=null!=_.dist&&null!=w.dist&&_.dist<R*b&&w.dist>O*b;if(!N&&!M){var E=p(A,O+m,y,g,I.isLeaf);if(o.intersectLine(I.obb,t,u,E)){var z=E*E;o.toAaBoundingBox(I.obb,S),n.offset(S,-t[0],-t[1],-t[2],S);var T=!n.contains(x,S);a.vec3d.subtract(I.origin,t,c);for(var k=0;k<I.pointCount;k++)if(l[0]=c[0]+I.coordinates[3*k],l[1]=c[1]+I.coordinates[3*k+1],l[2]=c[2]+I.coordinates[3*k+2],!T||n.containsPoint(x,l)){var U=a.vec3d.dot(l,u),L=U+m,D=f(A,L,y,g,I.isLeaf);if(!(U-D<0)){var F=a.vec3d.length2(l)-U*U;if(!(F>z)){var V=p(A,L-=D,y,g,I.isLeaf);if(!(F>V*V)){var j=this.layerUid+"/"+I.id+"/"+k,B=(U-D)*b;(null==_.dist||B<_.dist)&&(_.point=h(I,k,_.point),_.dist=B,_.normal=d,_.pointId=j,_.layerUid=this.layerUid),(null==w.dist||B>w.dist)&&(w.point=h(I,k,w.point),w.dist=B,w.normal=d,w.pointId=j,w.layerUid=this.layerUid)}}}}}}}if(null!=_.dist){var W=e.getMinResult();if(null==W.dist||_.dist<W.dist){var G={type:"external",point:_.point,metadata:{pointId:_.pointId,layerUid:_.layerUid}};W.set(G,_.pointId,_.dist,_.normal,void 0),W.setIntersector("PointRenderer")}}if(null!=w.dist){var q=e.getMaxResult();if(null==q.dist||w.dist>q.dist){G={type:"external",point:w.point,metadata:{pointId:w.pointId,layerUid:w.layerUid}};q.set(G,w.pointId,w.dist,w.normal,void 0),q.setIntersector("PointRenderer")}}},e.prototype.render=function(e){if(e.pass!==s.MATERIAL&&e.pass!==s.MATERIAL_DEPTH)return!1;for(var t=e.pass===s.MATERIAL_DEPTH,r=e.rctx,i=0,o=this.nodes;i<o.length;i++){null==(g=o[i]).vao&&this._initNode(e,g)}var l=this._getSizeParams(),u=t?l.drawScreenSpace?this._programScreenDepth:this._programWorldDepth:l.drawScreenSpace?this._programScreen:this._programWorld;if(null==u||0===this.nodes.length)return!0;var d=this._clipBox,p=!n.equals(d,n.POSITIVE_INFINITY,function(e,t){return e===t});p||(a.vec3.set3(-1/0,-1/0,-1/0,this.tempVec3),u.setUniform3fv("uClipMin",this.tempVec3),a.vec3.set3(1/0,1/0,1/0,this.tempVec3),u.setUniform3fv("uClipMax",this.tempVec3)),r.setDepthTestEnabled(!0),r.bindProgram(u);var f=e.camera.projectionMatrix;u.setUniformMatrix4fv("uProjectionMatrix",f),t&&u.setUniform2f("nearFar",e.camera.near,e.camera.far),l.drawFixedSize&&u.setUniform2f("uPointScale",l.fixedSize,e.camera.fullHeight);for(var h=0,v=this.nodes;h<v.length;h++){var g=v[h];if(u.setUniform2f("uScreenMinMaxSize",l.screenMinSize,c(g.isLeaf)),!l.drawFixedSize){var m=g.splatSize*this._scaleFactor;u.setUniform2f("uPointScale",m,e.camera.fullHeight)}var y=g.origin;p&&(a.vec3.set3(d[0]-y[0],d[1]-y[1],d[2]-y[2],this.tempVec3),u.setUniform3fv("uClipMin",this.tempVec3),a.vec3.set3(d[3]-y[0],d[4]-y[1],d[5]-y[2],this.tempVec3),u.setUniform3fv("uClipMax",this.tempVec3)),a.mat4.identity(this.tempMatrix4),a.mat4.translate(this.tempMatrix4,y,this.tempMatrix4),a.mat4.multiply(e.camera.viewMatrix,this.tempMatrix4,this.tempMatrix4),u.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),r.bindVAO(g.vao),r.drawArrays(0,0,g.pointCount)}return!0},Object.defineProperty(e.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size!==e&&(this._size=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizePx",{get:function(){return this._sizePx},set:function(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clippingBox",{set:function(e){n.set(this._clipBox,e||n.POSITIVE_INFINITY)},enumerable:!0,configurable:!0}),e.prototype.addNode=function(e){this.nodes.push({id:e.id,splatSize:e.splatSize,obb:e.obb,origin:a.vec3.create(e.origin),coordinates:e.coordinates,pointCount:e.coordinates.length/3,rgb:e.rgb,vao:null,isLeaf:e.isLeaf}),this._requestRender()},e.prototype.removeNode=function(e){this.nodes=this.nodes.filter(function(t){return t.id===e&&t.vao&&(t.vao.dispose(!0),t.vao=null),t.id!==e}),this._requestRender()},e.prototype.removeAll=function(){this.nodes.forEach(function(e){e.vao&&(e.vao.dispose(!0),e.vao=null)}),this.nodes=[],this._requestRender()},e.prototype._initNode=function(e,t){var r=e.rctx;t.vao=new d(r,v,g,{positions:l.createVertex(r,35044,t.coordinates),colors:l.createVertex(r,35044,t.rgb)})},e.prototype._requestRender=function(){this.didRender=!1,this.needsRender=!0},e.prototype._getSizeParams=function(){var e=this._useFixedSizes,t=e&&!this._useRealWorldSymbolSizes,r=t?this._sizePx:this._size,n=this._minSizePx;return e&&(n=0),{drawScreenSpace:t,drawFixedSize:e,fixedSize:r,screenMinSize:n}},e}()}.apply(null,n))||(e.exports=i)},2164:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsPointCloudPointRenderer"><![CDATA[\n$vsprecisionf\n\nattribute vec3 aPosition;\nattribute vec3 aColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform vec2 uScreenMinMaxSize;\nuniform vec2 uPointScale;\nuniform vec3 uClipMin;\nuniform vec3 uClipMax;\n\n#ifdef DEPTH_PASS\nuniform vec2 nearFar;\n\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\n\nvoid main(void) {\n\n  // Move clipped points outside of clipspace\n  if (aPosition.x < uClipMin.x || aPosition.y < uClipMin.y || aPosition.z < uClipMin.z ||\n      aPosition.x > uClipMax.x || aPosition.y > uClipMax.y || aPosition.z > uClipMax.z) {\n    gl_Position = vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n\n  // Position in camera space\n  vec4 camera = uModelViewMatrix * vec4(aPosition, 1.0);\n\n  float pointSize = uPointScale.x;\n  vec4 position = uProjectionMatrix * camera;\n\n  // Calculate Size\n  #ifdef DRAW_SCREEN_SIZE\n    float clampedScreenSize = pointSize;\n  #else\n    float pointRadius = 0.5 * pointSize;\n    vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);\n    vec4 positionOffset = uProjectionMatrix * cameraOffset;\n    float radius = abs(positionOffset.y - position.y);\n\n    float viewHeight = uPointScale.y;\n\n    // screen diameter = (2 * r / w) * (h / 2)\n    float screenPointSize = (radius / position.w) * viewHeight;\n    float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n\n    // Shift towards camera, to move rendered point out of terrain i.e. to\n    // the camera-facing end of the virtual point when considering it as a\n    // 3D sphere.\n    camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n    position = uProjectionMatrix * camera;\n  #endif\n\n  gl_PointSize = clampedScreenSize;\n  gl_Position = position;\n\n  #ifdef DEPTH_PASS\n  depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n  #else\n  vColor = aColor;\n  #endif\n}\n]]></snippet>\n\n<snippet name="fsPointCloudPointRenderer"><![CDATA[\n$fsprecisionf\n\n#ifdef DEPTH_PASS\n$float2rgba\n\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\n\nvoid main(void) {\n  vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);\n  float r2 = dot(vOffset, vOffset);\n\n  if (r2 > 0.25) {\n    discard;\n  }\n\n  #ifdef DEPTH_PASS\n  gl_FragColor = float2rgba(depth);\n  #else\n  gl_FragColor = vec4(vColor, 1.0);\n  #endif\n}\n]]></snippet>\n\n</snippets>\n'}}]);