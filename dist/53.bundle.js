(function(){(this||window).webpackJsonp.registerAbsMids({"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/FeatureLayer":428,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/IntegratedMeshLayer":430,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/SceneLayer":458,"esri/views/3d/layers/SceneLayerWorker":1252,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/SceneLayerWorker":1252,"esri/symbols/support/styleUtils":1253,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/symbols/support/styleUtils":1253,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderSlot":1281,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":1282,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/MaterialUtil":1284,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":1288,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ShaderVariations":1289,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/graphics/graphicUtils":1291,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Material":1292,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/glUtil3D":1293,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/IdGen":1294,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterial":1295,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ModelContentType":1296,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderPass":1297,"esri/views/layers/LayerView":1299,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/layers/LayerView":1299,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/Stage":1301,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/debugFlags":1302,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/Lightsources":1304,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/DefaultMaterial":1305,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Camera":1307,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Geometry":1308,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/PooledArray":1309,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/graphics/Graphics3DSymbolCommonCode":1310,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Object3D":1311,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/imageUtils":1312,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/depthRange":1313,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/HUDMaterial":1316,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/iteratorUtils":1319,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightUtils":1320,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderGeometry":1322,"esri/core/requireUtils":1323,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/requireUtils":1323,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/LayerView3D":1325,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/PerformanceTimer":1328,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Model":1329,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderOccludedHelper":1330,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Renderer":1331,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeView":1332,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/localOriginHelper":1333,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialTexture":1334,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":1335,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":1336,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightHelper":1337,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/OffscreenRenderingHelper":1338,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/SSAOHelper":1339,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Texture":1340,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/graphics/featureExpressionInfoUtils":1341,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Selector":1344,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":1345,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/doublePrecisionUtils":1346,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/ColorMaterial":1347,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/LineCalloutMaterial":1348,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/RibbonLineMaterial":1349,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/intersectionUtils":1350,"esri/views/3d/layers/i3s/I3SBinaryReader":1352,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SBinaryReader":1352,"esri/views/3d/support/orientedBoundingBox":1353,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/orientedBoundingBox":1353,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Performance":1354,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/utils":1355,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/support/layerViewUpdatingProperties":1357,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/HeapSort":1358,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/symbols/support/unitConversionUtils":1359,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GeometryRecord":1360,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ModelDirtySet":1361,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/View":1362,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/occluded.xml":1363,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DrapedRenderer":1364,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderContext":1365,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ExternalRendererContainer":1366,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Float32ArrayList":1367,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/FxaaRenderPass":1368,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightTextureHelper":1369,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/InstanceBufferData":1370,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/IntervalUtilities":1371,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LinearDepthTextureHelper":1372,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/NormalTextureHelper":1373,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/SmaaRenderPass":1374,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/StencilRenderingHelper":1375,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/buffer/bufferViewUtil":1376,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LocalOriginManager":1377,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":1378,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":1379,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":1380,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":1381,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":1382,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeRendererUtils.xml":1383,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer.xml":1384,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/strokes":1385,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/util":1386,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/SceneLighting":1387,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/SphericalHarmonics":1388,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LongVectorMath":1389,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/HUDMaterial.xml":1390,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/webgl/Profiling":1391,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial.xml":1392,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialRep":1393,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLTextureRep":1394,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/highlight.xml":1395,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/offscreen.xml":1396,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderTargetHelper":1397,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ProgramRepository":1398,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ShaderSnippets":1399,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/ssao.xml":1400,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/tracer":1401,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/webgl-debug":1402,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/repository":1403,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/hud.xml":1404,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/util.xml":1405,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/CheckerBoardMaterial":1406,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/CheckerBoardMaterial.xml":1407,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/ColorMaterial.xml":1408,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/DefaultMaterial.xml":1409,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/LineCalloutMaterial.xml":1410,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/MeasurementArrowMaterial":1411,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/MeasurementArrowMaterial.xml":1412,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/RibbonLineMaterial.xml":1413,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/BlendLayers":1414,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/BlendLayers.xml":1415,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/SimpleGLMaterial":1416,"dojo/text!C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/SimpleGLMaterial.xml":1417,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Viewport":1418,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Visualizer":1419,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/TimeProfiler":1420,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/depthRangeUtils":1421,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ShadowMap":1422,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DDSUtil":1423,"esri/renderers/support/LegendOptions":1427,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/LegendOptions":1427,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/Renderer":1432,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/support/symbolColorUtils":1437,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/support/edgeUtils":1438,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Octree":1439,"esri/views/3d/layers/i3s/LEPCC":1442,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/PromiseLightweight":1450,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/Evented":1451,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SUtil":1452,"esri/renderers/support/jsonUtils":1453,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/jsonUtils":1453,"esri/views/3d/support/dito":1461,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/BoundingInfo":1467,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Layer":1469,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightSet":1470,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/support/attributeUtils":1471,"esri/renderers":1475,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers":1475,"esri/layers/support/LabelClass":1476,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/LabelClass":1476,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/graphics/ElevationContext":1480,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/SimpleRenderer":1482,"esri/renderers/support/styleUtils":1483,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/styleUtils":1483,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/ClassBreaksRenderer":1492,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/HeatmapRenderer":1493,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/UniqueValueRenderer":1494,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/diffUtils":1495,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/labelUtils":1496,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/SceneLayerView3D":1513,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/types":1514,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/graphics/QueryEngine":1516,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/numberUtils":1517,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/FeatureProcessing":1518,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/FeatureReduction":1519,"esri/views/3d/layers/i3s/I3SGeometryUtil":1522,"esri/views/3d/layers/i3s/I3SProjectionUtil":1523,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SQueryEngine":1530,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/typeUtils":1534,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/FeatureReductionSelection":1546,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/FeatureTemplate":1547,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/string":1548,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/LabelExpressionInfo":1549,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/labelingInfo":1550,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/Highlights":1612,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SElevationProvider":1613,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/IDBCache":1614,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/graphics/sources/MemorySource":1623,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/AuthoringInfo":1640,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/AuthoringInfoVisualVariable":1641,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/ClassBreakInfo":1642,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/HeatmapColorStop":1643,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/renderers/support/UniqueValueInfo":1644,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/FeatureIndex":1645,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/FeatureType":1646,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/Relationship":1647,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/support/RangeInfo":1649,"esri/core/sql/WhereClause":1669,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/core/sql/WhereClause":1669,"esri/core/sql/StandardizedFunctions":1670,"esri/core/sql/WhereGrammar":1671,"esri/core/sql/sql92grammar":1672,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/layers/graphics/controllers/I3SOnDemandController":1711,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/IdleQueue":1712,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SIndex":2143,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SLodHandling":2144,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SNodeLoader":2145,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SViewportQueries":2146,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/ResourceController":2147,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/MemoryController":2148,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/layers/support/MemoryManagedLayerView":2149,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/StreamDataLoader":2150,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/AsyncQuotaRoundRobinQueue":2151,"C:/Users/mlinden.LUCIDENERGY/Desktop/Web Apps/Node Dev/blank-esri-webpack-app/node_modules/arcgis-js-api/views/3d/support/StreamDataSupplier":2152})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[53,0,4,35,51,58],{1252:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(6),r(20),r(1522),r(1523),r(40),r(1486),r(1353),r(74),r(1425),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){var p=function(){function e(){}return e.prototype.process=function(e){var t=[e.geometryBuffer];return r.resolve({result:this.transform(e,t),transferList:t})},e.prototype.transform=function(e,t){var r=n.fromJSON(e.indexSR),p=n.fromJSON(e.vertexSR),h=n.fromJSON(e.renderSR),m=!1,v=0,g=[],y=e.obb?null:l.create([0,0,0],[-1,-1,-1],[0,0,0,1]);a.vec3d.set(e.center,f),f[2]+=e.elevationOffset;var b=a.mat4d.create();u.computeLinearTransformation(r,f,b,h);for(var _=0,x=e.geometryData;_<x.length;_++)for(var w=x[_],S=w.geometries,C=w.componentOffsets,D=0,E=S;D<E.length;D++){var A=E[D],T=e.layouts[v];++v;var O=[{name:c.VertexAttrConstants.COLOR,byteValue:255}],I=[c.VertexAttrConstants.NORMAL,c.VertexAttrConstants.NORMALCOMPRESSED,c.VertexAttrConstants.SYMBOLCOLOR,c.VertexAttrConstants.COMPONENTINDEX],R=i.interleaveGeometryBuffer(A,e.geometryBuffer,T,O,I),P=new d(new Float32Array(R),T),M=P.getAttribute(c.VertexAttrConstants.POSITION),L=o.reprojectPoints(M,e.center,e.elevationOffset,r,p,h);if(y&&this._updateObb(y,M,b),e.needNormals){var N={normals:P.getAttribute(c.VertexAttrConstants.NORMALCOMPRESSED),positions:M,normalInd:P.getIndices(c.VertexAttrConstants.NORMALCOMPRESSED),positionInd:P.getIndices(c.VertexAttrConstants.POSITION)};i.processAndInterleaveNormals(e.normalReferenceFrame,A,e.geometryBuffer,L.globalTrafo,N)}var F=P.getAttribute(c.VertexAttrConstants.COMPONENTINDEX);F&&this._createComponentNumbers(F,C);var U=P.getAttribute(c.VertexAttrConstants.COLOR);U&&!m&&(m=this._hasColors(U));var V=T[0].stride,j=1-.8*V/(V+4),k=s.deduplicate(R,V/4,j);if(null!=k){var z=k.uniqueCount<65536?new Uint16Array(k.indices):k.indices,B=i.extractPositionData(k.buffer,T,z);g.push({layout:T,interleavedVertexData:k.buffer,indices:z,corMatrices:L,hasColors:m,positionData:B}),t&&(t.push(k.buffer),t.push(z.buffer),t.push(B.data.buffer),t.push(B.indices.buffer))}else{B=i.extractPositionData(R,T);g.push({layout:T,interleavedVertexData:R,corMatrices:L,hasColors:m,positionData:B}),t&&(t.push(R),t.push(B.data.buffer),t.push(B.indices.buffer))}}return y&&(a.mat4d.multiplyVec3(b,y.center,y.center),u.vectorToVector(y.center,h,y.center,p),y.center[2]-=e.elevationOffset),{geometryBuffer:e.geometryBuffer,transformedGeometries:g,obb:y}},e.prototype._hasColors=function(e){for(var t=e.data,r=e.size,n=e.offsetIdx,i=e.strideIdx,o=n;o<t.length;o+=i)for(var a=0;a<r;a++)if(255!==t[o+a])return!0;return!1},e.prototype._createComponentNumbers=function(e,t){for(var r=e.data,n=e.offsetIdx,i=e.strideIdx,o=r.length/i,a=0,s=n,l=0;l<o;l++)l>=t[a+1]&&a++,r[s]=a,s+=i},e.prototype._updateObb=function(e,t,r){if(e.halfSize[0]>0){a.vec3.subtract(e.center,e.halfSize,f),a.vec3.add(e.center,e.halfSize,h);for(var n=t.offsetIdx;n<t.data.length;n+=t.strideIdx)f[0]=Math.min(f[0],t.data[n]),f[1]=Math.min(f[1],t.data[n+1]),f[2]=Math.min(f[2],t.data[n+2]),h[0]=Math.max(h[0],t.data[n]),h[1]=Math.max(h[1],t.data[n+1]),h[2]=Math.max(h[2],t.data[n+2]);a.vec3.subtract(h,f,e.halfSize),a.vec3d.scale(e.halfSize,.5),a.vec3d.add(f,h,e.center),a.vec3d.scale(e.center,.5)}else{l.compute(t,e);var i=2*Math.sqrt(1+r[0]+r[5]+r[10]);m[0]=(r[9]-r[6])/i,m[1]=(r[2]-r[8])/i,m[2]=(r[4]-r[1])/i,m[3]=.25*i,a.quat4.conjugate(m),a.quat4.multiply(m,e.quaternion,e.quaternion)}},e}(),f=a.vec3d.create(),h=a.vec3d.create(),m=a.quat4.create();return p}.apply(null,n))||(e.exports=i)},1253:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(27),r(420),r(8),r(6),r(19),r(51),r(163),r(150),r(454),r(218)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){function p(e,t){return t.load().then(function(){var r=new l({disableExtraQuery:!0,query:"owner:"+g+" AND type:"+y+' AND typekeywords:"'+e+'"'});return t.queryItems(r)}).then(function(t){var r=t.results,n=null,o=e.toLowerCase();if(r&&Array.isArray(r))for(var a=0,s=r;a<s.length;a++){var l=s[a];if(l.typeKeywords.some(function(e){return e.toLowerCase()===o})&&l.type===y&&l.owner===g){n=l;break}}if(n)return n.load();throw new i("symbolstyleutils:style-not-found","The style '"+e+"' could not be found",{styleName:e})})}function f(e,t){return e.styleUrl?function(e,t){return m(e).then(function(t){return{data:t.data,baseUrl:a.removeFile(e),styleUrl:e}})}(e.styleUrl):e.styleName?function(e,t){var r,n=t.portal||s.getDefault(),i=n.url+" - "+(n.user&&n.user.username)+" - "+e;return v[i]||(v[i]=p(e,n).then(function(e){return r=e,e.fetchData()}).then(function(t){return{data:t,baseUrl:r.itemUrl,styleName:e}})),v[i]}(e.styleName,t):o.reject(new i("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function h(e,t,r){for(var s=e.data,l={portal:r.portal,url:a.urlToObject(e.baseUrl),origin:"portal-item"},p=0,f=s.items;p<f.length;p++){var h=function(i){if(i.name!==t)return"continue";var o=a.read(i.webRef,l),s={portal:r.portal,url:a.urlToObject(a.removeFile(o)),origin:"portal-item"};return{value:m(o).then(function(o){var p=u.fromJSON(o.data,s);if(p&&p.isInstanceOf(n.BaseSymbol3D)){if(i.thumbnail)if(i.thumbnail.href){var f=a.read(i.thumbnail.href,l);p.thumbnail=new c.default({url:f})}else i.thumbnail.imageData&&(p.thumbnail=new c.default({url:"data:image/png;base64,"+i.thumbnail.imageData}));e.styleUrl?p.styleOrigin=new d({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(p.styleOrigin=new d({portal:r.portal,styleName:e.styleName,name:t}))}return p})}}(f[p]);if("object"==typeof h)return h.value}return o.reject(new i("symbolstyleutils:symbol-name-not-found","The symbol name '"+t+"' could not be found",{symbolName:t}))}function m(e){var t={responseType:"json",query:{f:"json"}};return r(a.normalize(e),t)}Object.defineProperty(t,"__esModule",{value:!0});var v={};t.fetchStyle=f,t.resolveWebStyleSymbol=function(e,t){return e.name?f(e,t).then(function(r){return h(r,e.name,t)}):o.reject(new i("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))},t.fetchSymbolFromStyle=h,t.styleNameFromItem=function(e){for(var t=0,r=e.typeKeywords;t<r.length;t++){var n=r[t];if(/^Esri.*Style$/.test(n)&&"Esri Style"!==n)return n}};var g="esri_en",y="Style"}.apply(null,n))||(e.exports=i)},1281:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r;return function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL",e[e.STENCIL_MATERIAL=2]="STENCIL_MATERIAL",e[e.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL",e[e.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL",e[e.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL",e[e.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT",e[e.POSTPROCESSING_ATMOSPHERE_OPAQUE=11]="POSTPROCESSING_ATMOSPHERE_OPAQUE",e[e.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT",e[e.POSTPROCESSING_EXTERNAL=13]="POSTPROCESSING_EXTERNAL",e[e.HUDMATERIAL1=14]="HUDMATERIAL1",e[e.HUDMATERIAL2=15]="HUDMATERIAL2",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.MAX_SLOTS=18]="MAX_SLOTS"}(r||(r={})),r}.apply(null,n))||(e.exports=i)},1282:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,n))||(e.exports=i)},1284:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(406),r(1290),r(1346),r(1278),r(1335),r(1277),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function u(e,t,r,n,i,o){if(void 0===i||3!==o)for(var a=0;a<o;++a)r[n+a]=e[t+a];else!function(e,t,r,n,i){var o=e[t],a=e[t+1],s=e[t+2];r[n]=i[0]*o+i[4]*a+i[8]*s+i[12],r[n+1]=i[1]*o+i[5]*a+i[9]*s+i[13],r[n+2]=i[2]*o+i[6]*a+i[10]*s+i[14]}(e,t,r,n,i);return o}function d(e,t,r,n,i,o){for(var a=e.length,s=0;s<a;++s){var l=3*e[s],u=t[l],d=t[l+1],c=t[l+2];n[i]=r[0]*u+r[4]*d+r[8]*c+r[12],n[i+1]=r[1]*u+r[5]*d+r[9]*c+r[13],n[i+2]=r[2]*u+r[6]*d+r[10]*c+r[14],i+=o}}function c(e,t,r,n,i,o){for(var a=e.length,s=0;s<a;++s){for(var l=r*e[s],u=0;u<r;++u)n[i+u]=t[l+u];i+=o}}function p(e,t,r,n,i,o){var a=new Uint8Array(n);i*=4,o*=4;var s=e.length;if(4===r)for(var l=0;l<s;++l){var u=4*e[l];a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=t[u+3],i+=o}else if(3===r)for(l=0;l<s;++l){u=3*e[l];a[i]=t[u],a[i+1]=t[u+1],a[i+2]=t[u+2],a[i+3]=255,i+=o}}function f(e,t,r,n,i,o,a){var s=new Uint8Array(i);o*=4,a*=4;var l=e.length;if(4===n)for(var u=0;u<l;++u){var d=4*e[u];s[o]=t[d]*r[0],s[o+1]=t[d+1]*r[1],s[o+2]=t[d+2]*r[2],s[o+3]=t[d+3]*r[3],o+=a}else if(3===n){var c=255*r[3];for(u=0;u<l;++u){d=3*e[u];s[o]=t[d]*r[0],s[o+1]=t[d+1]*r[1],s[o+2]=t[d+2]*r[2],s[o+3]=c,o+=a}}}function h(e,t,r,n,i,o){var a=new Uint16Array(n);i*=2,o*=2;for(var s=e.length,l=0;l<s;++l){for(var u=r*e[l],d=0;d<r;++d)a[i+d]=t[u+d];i+=o}}function m(e,t,n,i,o){var a=b(t,n,E);if(r.setMin(C,e.getBBMin()),r.setMax(C,e.getBBMax()),_(C,t,a,i)){var s=e.getPrimitiveIndices(),l=e.getIndices(),u=e.getPosition(),d=s?s.length:l.length/3;if(d>L){var c=e.getChildren();if(void 0!==c){for(var p=0;p<8;++p)void 0!==c[p]&&m(c[p],t,n,i,o);return}}g(t,n,0,d,l,u,s,o)}}function v(e,t,i,o,a,s){var l=b(i,o,E),u=e.getBoundingInfo();if(r.setMin(C,u.getBBMin()),r.setMax(C,u.getBBMax()),_(C,i,l,a))for(var d=e.data,c=e.getComponentCount(),p=d.getIndices(D.POSITION),f=d.getAttribute(D.POSITION),h=d.componentOffsets,m=0;m<c;m++)if(!t||n.getVisibility(t,m)){if(_(e.getComponentAABB(m,C),i,l,a))g(i,o,h[m]/3,h[m+1]/3,p,f,void 0,s)}}function g(e,t,r,n,i,o,a,s){for(var l=o.data,u=o.offsetIdx,d=o.strideIdx,c=e[0],p=e[1],f=e[2],h=t[0]-c,m=t[1]-p,v=t[2]-f,g=r;g<n;g++){var b=a?a[g]:g,_=u+d*i[3*b],x=u+d*i[3*b+1],w=u+d*i[3*b+2],S=l[_],C=l[_+1],D=l[_+2],E=l[x]-S,O=l[x+1]-C,I=l[x+2]-D,R=l[w]-S,P=l[w+1]-C,M=l[w+2]-D,L=m*M-P*v,N=v*R-M*h,F=h*P-R*m,U=E*L+O*N+I*F,V=c-S,j=p-C,k=f-D,z=j*I-O*k,B=k*E-I*V,G=V*O-E*j;if(U>A){if((H=V*L+j*N+k*F)<0||H>U)continue;if((W=h*z+m*B+v*G)<0||H+W>U)continue}else{if(!(U<-A))continue;var H,W;if((H=V*L+j*N+k*F)>0||H<U)continue;if((W=h*z+m*B+v*G)>0||H+W<U)continue}var q=(R*z+P*B+M*G)/U;q>=0&&s(q,y(E,O,I,R,P,M,T),b)}}function y(e,t,r,n,i,a,s){return o.vec3d.set3(e,t,r,O),o.vec3d.set3(n,i,a,I),o.vec3d.normalize(o.vec3d.cross(O,I,s))}function b(e,t,r){return o.vec3d.set3(1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]),r)}function _(e,t,r,n){var i=(e[0]-n-t[0])*r[0],o=(e[3]+n-t[0])*r[0],a=Math.min(i,o),s=Math.max(i,o),l=(e[1]-n-t[1])*r[1],u=(e[4]+n-t[1])*r[1];if((a=Math.max(a,Math.min(l,u)))>(s=Math.min(s,Math.max(l,u))))return!1;var d=(e[2]-n-t[2])*r[2],c=(e[5]+n-t[2])*r[2];return(a=Math.max(a,Math.min(d,c)))<=(s=Math.min(s,Math.max(d,c)))}function x(e,t,r,n,i){return a.scale(e,n,r,i)}function w(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(t,"__esModule",{value:!0});var S=o.mat4d.create(),C=r.create(),D=s.VertexAttrConstants;t.IDENTITY=o.mat4d.identity(),t.fill=u,t.fillColor=function(e,t,r,n,i){for(var o=0;o<i;++o)r[n+o]=e[t+o];return i},t.fillInterleaved=function(e,t,r,n,i,o,a,s){for(var u=l.getStride(i)/4,m=0;m<i.length;m++){var v=i[m],g=a+v.offset/4,y=v.name,b=e.vertexAttr[y];if(null!=b&&(null==s||null!=s[y]))switch(y){case"uv0":c(e.indices[y],b.data,b.size,o,g,u);break;case"region":h(e.indices[y],b.data,b.size,o.buffer,g,u);break;case"color":n&&n.color?f(e.indices[y],b.data,n.color,b.size,o.buffer,g,u):p(e.indices[y],b.data,b.size,o.buffer,g,u);break;case"symbolColor":p(e.indices[y],b.data,b.size,o.buffer,g,u);break;default:var _=y===D.POSITION?t:y===D.NORMAL?r:void 0;void 0!==_&&3===b.size?d(e.indices[y],b.data,_,o,g,u):c(e.indices[y],b.data,b.size,o,g,u)}}},t.triangleVertexArrayToWireframeLines=function(e,t,r,n){for(var i=Math.floor(r/3)-1;i>=0;i--){var o=t+3*i*n,a=t+3*i*2*n+5*n;u(e,o,e,a,null,n),u(e,o+n,e,a-=n,null,n),u(e,o+n,e,a-=n,null,n),u(e,o+2*n,e,a-=n,null,n),u(e,o+2*n,e,a-=n,null,n),u(e,o,e,a-=n,null,n)}},t.intersectTriangleGeometry=function(e,t,r,i,o,a,l){s.assert("triangle"===e.data.primitiveType);var u=t&&t.componentVisibilities,d=i.tolerance;e.getComponentCount()>1?v(e,u,o,a,d,l):u&&!n.getVisibility(u,0)||m(e.getBoundingInfo(),o,a,d,l)};var E=o.vec3d.create(),A=Math.pow(2,-52),T=o.vec3d.create();t.intersectTriangles=g;var O=o.vec3d.create(),I=o.vec3d.create();t.computeNormal=y,t.intersectAabbInvDir=_,t.transformToWorld=function(e,t,r){return o.vec4d.set4(e[0]-t[0],e[1]-t[1],e[2]-t[2],1,r)},t.transformToView=function(e,t,r,n){return o.mat4d.translate(r,t,S),r=S,o.mat4d.multiplyVec4(r,e,n)},t.transformToProjection=function(e,t,r,n){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n[3]=e[3],o.mat4d.multiplyVec4(t,n)},t.transformToNDC=function(e,t){return o.vec4d.scale(e,1/Math.abs(e[3]),t)},t.applyScreenSizePerspectiveScale=x,t.verticalOffsetAtDistance=function(e,t,r,n,i){var o=r.screenLength||0;i&&(o=x(o,0,t,n,i));var a=o*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return s.clamp(a*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)},t.aquireIfNotUndefined=function(e,t,r){if(void 0!==e)return t.aquire(e,r)},t.releaseIfNotUndefined=function(e,t){void 0!==e&&t.release(e)};var R=o.mat4.create();t.bindView=function(e,t,r){o.mat4d.translate(t,e,R),r.setUniform3fv("localOrigin",e),r.setUniformMatrix4fv("view",R)},t.bindCamPos=function(e,t,r){r.setUniform3f("camPos",t[3]-e[0],t[7]-e[1],t[11]-e[2])};var P=o.vec3d.create(),M=o.vec3d.create();t.bindViewOriginDouble=function(e,t){i.encodeDoubleArraySplit(e,P,M,3),t.setUniform3fv("viewOriginHi",P),t.setUniform3fv("viewOriginLo",M)},t.bindVerticalOffset=function(e,t,r){if(e){var n=function(e,t,r,n){return void 0===n&&(n=N),n.screenLength=e.screenLength,n.perDistance=Math.tan(.5*t)/(.5*r),n.minWorldLength=e.minWorldLength,n.maxWorldLength=e.maxWorldLength,n}(e,t.fovY,t.viewport[3]);r.setUniform4f("verticalOffset",n.screenLength,n.perDistance,n.minWorldLength,n.maxWorldLength)}},t.bindScreenSizePerspective=function(e,t,r){if(void 0===r&&(r="screenSizePerspectiveAlignment"),e){var n=e.parameters,i=e.paddingPixelsOverride;t.setUniform4f(r,n.divisor,n.offset,n.minPixelSize,i)}},t.copyParameters=function e(t,r){var n=r?e(r):{};for(var i in t){var o=t[i];o&&o.forEach&&(o=w(o)),null==o&&i in n||(n[i]=o)}return n},t.updateParameters=function(e,t){var r=!1;for(var n in t){var i=t[n];void 0!==i&&(r=!0,Array.isArray(i)?e[n]=i.slice():e[n]=i)}return r},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var L=1e3,N={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}.apply(null,n))||(e.exports=i)},1288:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,n))||(e.exports=i)},1289:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(5),r(1282),r(1277),r(1283)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(e,t,r,n,i,a){this.variables=[],this.sealed=!1,this.programCache={},o.assert(2===t.length,"you must specify shader snippet prefixes for vertex and fragment shaders"),this.programNamePrefix=e,this.shaderSnippetPrefixes=t,this.baseDefines=r,this.programRep=n,this.snippets=i,this.rctx=a,this.baseDefines=r?r.slice():[]}return e.prototype.addDefine=function(e,t,r,n){o.assert(!this.sealed,"you cannot add another variable after the first program has been generated"),o.assert(!!e,"you must specify a program name suffix"),this.variables.push({programNameSuffixes:["",e],shaderNameSuffixes:n||e,defineStr:t,affectsShaderTypes:r||[!0,!0]})},e.prototype.addBinaryShaderSnippetSuffix=function(e,t,r){o.assert(!this.sealed,"you cannot add another variable after the first program has been generated"),o.assert(!!e,"you must specify a program name suffix"),this.variables.push({programNameSuffixes:["",e],shaderSnippetSuffixes:["",t],affectsShaderTypes:r||[!0,!0]})},e.prototype.addNaryShaderSnippetSuffix=function(e,t){o.assert(!this.sealed,"you cannot add another variable after the first program has been generated");var r=e.map(function(e){return o.assert(null!=e.value,"value must always be specified"),e.value});this.variables.push({values:r,programNameSuffixes:e.map(function(e,t){return null!=e.programNameSuffix?e.programNameSuffix:r[t]}),shaderSnippetSuffixes:e.map(function(e,t){return null!=e.shaderSnippetSuffix?e.shaderSnippetSuffix:r[t]}),affectsShaderTypes:t||[!0,!0]})},e.prototype.getShaderVariation=function(e){o.assert(e.length===this.variables.length,"you must specify a value for each variable");for(var t=this.programNamePrefix,r=n.clone(this.shaderSnippetPrefixes),i=n.clone(this.shaderSnippetPrefixes),a=n.clone(this.baseDefines),s=0;s<this.variables.length;s++){var l=this.variables[s],u=e[s],d=void 0;l.values?(d=l.values.indexOf(u.toString()),o.assert(d>=0,"invalid value "+u+" for variable "+s)):d=u?1:0,t+=l.programNameSuffixes[d];for(var c=0;c<2;c++)l.affectsShaderTypes[c]&&(l.shaderSnippetSuffixes&&(r[c]+=l.shaderSnippetSuffixes[d],i[c]+=l.shaderSnippetSuffixes[d]),l.defineStr&&d&&(a.push(l.defineStr),i[c]+=l.shaderNameSuffixes))}return{programName:t,shaderSnippetNames:r,shaderNames:i,defines:a}},e.prototype.getProgram=function(e,t,r,n){void 0===t&&(t=this.snippets),void 0===r&&(r=this.rctx),void 0===n&&(n=i.Default3D),this.sealed=!0;var s=e.reduce(function(e,t){return e+t.toString()},"");if(this.programCache[s])return this.programCache[s];var l=this.getShaderVariation(e),u=this.programRep.get(l.programName);if(u)return u;var d=l.shaderSnippetNames[0],c=t[d];o.assert(null!=c,"shader snippet '"+d+"' does not exist");var p=l.shaderSnippetNames[1],f=t[p];return o.assert(null!=f,"shader snippet '"+p+"' does not exist"),u=new a(r,c,f,n,l.defines),this.programCache[s]=u,this.programRep.add(l.programName,u),u},e}()}.apply(null,n))||(e.exports=i)},1291:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(29),r(406),r(54),r(414),r(154),r(26),r(408),r(40),r(63)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d){function c(e){var t=e.paths[0];if(!t||0===t.length)return null;var r=a.getPointOnPath(t,a.getPathLength(t)/2);return l.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}Object.defineProperty(t,"__esModule",{value:!0});var p=[1,1,1];t.computeCentroid=function(e){if("point"===e.type)return e;if(l.isHydratedGeometry(e))switch(e.type){case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return c(e);case"mesh":return e.extent.center}else switch(e.type){case"extent":return function(e){var t=d.isFinite(e.zmin);return l.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e);case"polygon":return function(e){var t=o.ringsCentroid(e.rings,l.hasZ(e));return l.makeDehydratedPoint(t[0],t[1],t[2],e.spatialReference)}(e);case"polyline":return c(e)}},t.convertPointSR=function(e,t){var n=e.spatialReference;n.isWebMercator&&t.isWGS84?(s.xyToLngLat(e.x,e.y,f),e.x=f[0],e.y=f[1],e.spatialReference=r.SpatialReference.WGS84):t.isWebMercator&&n.isWGS84&&(s.lngLatToXY(e.x,e.y,f),e.x=f[0],e.y=f[1],e.spatialReference=r.SpatialReference.WebMercator)},t.enlargeExtent=function(e,t,r){if(e){t||(t=i.create());var n=e,o=.5*n.width*(r-1),a=.5*n.height*(r-1);return n.width<1e-7*n.height?o+=a/20:n.height<1e-7*n.width&&(a+=o/20),u.vec4d.set4(n.xmin-o,n.ymin-a,n.xmax+o,n.ymax+a,t),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var r=0;r<e.geometries.length;++r){var n=e.geometries[r].data.vertexAttributes.auxpos1;n&&n.data[3]!==t&&(n.data[3]=t,e.geometryVertexAttrsUpdated(r))}},t.mixinColorAndOpacity=function(e,t){var r=[1,1,1,1];return null!=e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),null!==t&&void 0!==t?r[3]=t:null!=e&&e.length>3&&(r[3]=e[3]),r},t.overrideColor=function(e,t,r,n,i,o){void 0===o&&(o=[0,0,0,0]);for(var a=0;a<3;++a)e&&null!=e[a]?o[a]=e[a]:r&&null!=r[a]?o[a]=r[a]:o[a]=i[a];return o[3]=null!=t?t:null!=n?n:i[3],o},t.computeObjectScale=function(e,t,r,n){void 0===e&&(e=p),void 0===n&&(n=1);var i=new Array(3);if(null==t||null==r)i[0]=1,i[1]=1,i[2]=1;else{for(var o=void 0,a=0,s=2;s>=0;s--){var l=e[s],u=void 0,d=null!=l,c=0===s&&!o&&!d,f=r[s];"symbolValue"===l||c?u=0!==f?t[s]/f:1:d&&"proportional"!==l&&isFinite(l)&&(u=0!==f?l/f:1),null!=u&&(i[s]=u,o=u,a=Math.max(a,Math.abs(u)))}for(s=2;s>=0;s--)null==i[s]?i[s]=o:0===i[s]&&(i[s]=.001*a)}for(s=2;s>=0;s--)i[s]/=n;return i},t.computeSizeWithResourceSize=function(e,t){var r=t.isPrimitive,n=t.width,i=t.depth,o=t.height,a=r?10:1;if(null==n&&null==o&&null==i)return[a*e[0],a*e[1],a*e[2]];for(var s,l=[n,i,o],u=0;u<3;u++){var d=l[u];if(null!=d){s=d/e[u];break}}for(u=0;u<3;u++)null==l[u]&&(l[u]=e[u]*s);return l},t.validateSymbolLayerSize=function(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),function e(t){if(Array.isArray(t)){for(var r=0,n=t;r<n.length;r++)if(!e(n[r]))return!1;return!0}return null==t||t>=0}(e)?null:"Symbol sizes may not be negative values"},t.computeObjectRotation=function(e,t,r,n){void 0===n&&(n=u.mat4d.identity());var i=e||0,o=t||0,a=r||0;return 0!==i&&u.mat4d.rotateZ(n,-i/180*Math.PI,n),0!==o&&u.mat4d.rotateX(n,o/180*Math.PI,n),0!==a&&u.mat4d.rotateY(n,a/180*Math.PI,n),n},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:n.isPoint(e)?t.minDemResolutionForPoints:.01*n.maximumDimension(e)};var f=[0,0]}.apply(null,n))||(e.exports=i)},1292:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1294),r(1296)],void 0===(i=function(e,t,r,n){return function(){function e(t){this._parentStage=null,this._visible=!0,this._renderOccluded=!1,this._renderPriority=0,this.supportsEdges=!1,this.id=e._idGen.gen(t)}return Object.defineProperty(e.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0}),e.prototype.addParentStage=function(e){this._parentStage=e},e.prototype.removeParentStage=function(e){this._parentStage=null},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this._visible},e.prototype.notifyDirty=function(e){this.parentStage&&this.parentStage.notifyDirty(n.MATERIAL,this,e)},e._idGen=new r,e}()}.apply(null,n))||(e.exports=i)},1293:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1282),r(1288),r(1287),r(1280),r(1286)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t){void 0===t&&(t=n.Pos2);var o=t===n.Pos3Tex?new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]):new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new a(e,r.Default3D,{geometry:t},{geometry:i.createVertex(e,35044,o)})};var s=4;t.createEmptyTexture=function(e,t){return void 0===t&&(t=s),new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,r){void 0===r&&(r=s);for(var n=new Uint8Array(r*r*4),i=0;i<n.length;i+=4)n[i+0]=255*t[0],n[i+1]=255*t[1],n[i+2]=255*t[2],n[i+3]=255*t[3];return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},n)}}.apply(null,n))||(e.exports=i)},1294:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}()}.apply(null,n))||(e.exports=i)},1295:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e,t){this.material=e,this.programRep=t}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this.material.isVisible()},e.prototype.getPrograms=function(){return[this.getProgram()]},e}()}.apply(null,n))||(e.exports=i)},1296:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){}return e.LAYER="layers",e.OBJECT="objects",e.GEOMETRY="geometries",e.MATERIAL="materials",e.TEXTURE="textures",e}()}.apply(null,n))||(e.exports=i)},1297:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r;return function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_DEPTH=1]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=2]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP",e[e.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT",e[e.MAX_PASS=5]="MAX_PASS"}(r||(r={})),r}.apply(null,n))||(e.exports=i)},1299:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(4),r(42),r(16),r(147),r(7),r(146),r(6),r(1)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handles=new a,t.layer=null,t.parent=null,t.view=null,t}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";return l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+n+"', id: '"+r+"')",t),d.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null!=e?e:1};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},n([c.property()],t.prototype,"layer",void 0),n([c.property()],t.prototype,"parent",void 0),n([c.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),n([c.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),n([c.property()],t.prototype,"view",void 0),n([c.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),n([c.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),n([c.subclass("esri.views.layers.LayerView")],t)}(c.declared(i,o,s,u))}.apply(null,n))||(e.exports=i)},1301:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1278),r(1296),r(1344),r(1277),r(1304),r(1329),r(1362)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=r.vec2d,d=r.vec2,c=r.vec3d,p=function(){function e(e,t,r){this._intersectTolerance=i.DEFAULT_TOLERANCE,this._viewContent=[],this._externalIntersectionHandlers=[],this.container=t,this.viewingMode=e,this.model=new s,this.view=new l(t,this,this.model.getDirtySet(),r),this._validateHUDSelector=new i(this.viewingMode),this._validateHUDSelector.enableHUDSelection=!1,this.view.setLighting({lights:[new a.MainLight(c.createFrom(.7,.7,.7)),new a.AmbientLight(c.createFrom(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return e.prototype.setNeedsRender=function(){this.view.setNeedsRender()},e.prototype.dispose=function(){this.view.dispose(),this.view=null,this.model=null},e.prototype.beginMod=function(){e.DebugSettings.fineGrainedContentValidation&&this.model.validateContent()},e.prototype.endMod=function(t){void 0===t&&(t=!1),e.DebugSettings.fineGrainedContentValidation&&!t&&this.model.validateContent()},e.prototype.add=function(e,t){this.model.add(e,t),"function"==typeof t.addParentStage&&t.addParentStage(this)},e.prototype.remove=function(e,t){var r=this.model.remove(e,t);return"function"==typeof r.removeParentStage&&r.removeParentStage(this),r},e.prototype.notifyDirty=function(e,t,r,n){this.model.notifyDirty(e,t,r,n)},e.prototype.processDirty=function(){var t=this.model.getDirtySet(),r=t.getDirtyMaterials();if(t.hasDirtyGeometryRecords()||r){e.DebugSettings.endFrameContentValidation&&this.model.validateContent(),e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var n=t.commitLayers(this._viewContent);(n[0].length+n[1].length+n[2].length>0||r)&&this.view.modify(n[0],n[1],n[2],r),e.DebugSettings.logDirtySet&&(console.log("RGs add: "+n[0].map(function(e){return e.uniqueName})),console.log("RGs remove: "+n[1].map(function(e){return e.uniqueName}))),t.commit(),t.clearDirtyMaterials(),this.view.setNeedsRender()}},e.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet(),r=t.getDirtyMaterials(),n=t.commitLayers([e]);(n[0].length+n[1].length+n[2].length>0||r)&&this.view.modify(n[0],n[1],n[2],r),t.clearDirtyMaterials(),this.view.setNeedsRender()},e.prototype.get=function(e,t){return this.model.get(e,t)},e.prototype.getAll=function(e){return this.model.getAll(e)},e.prototype.addTextureListener=function(e){this.view.addTextureListener(e)},e.prototype.removeTextureListener=function(e){this.view.removeTextureListener(e)},e.prototype.getContainer=function(){return this.container},e.prototype.getCamera=function(){return this.view.getCamera()},e.prototype.setCamera=function(e){this.view.setCamera(e)},e.prototype.getViewParams=function(e){return this.view.getViewParams(e)},e.prototype.setViewParams=function(e){this.view.setViewParams(e)},e.prototype.getLayers=function(){return this.model.getAll(n.LAYER)},e.prototype.setLighting=function(e){this.view.setLighting(e)},e.prototype.getCanvas=function(){return this.view.getCanvas()},e.prototype.setRenderParams=function(e){this.view.setRenderParams(e)},e.prototype.getRenderParams=function(){return this.view.getRenderParams()},e.prototype.has=function(e){return this.view.has(e)},e.prototype.getViewContent=function(){return this._viewContent.slice(0)},e.prototype.setViewContent=function(e){var t=o.array2object(this._viewContent),r=o.array2object(e),n=o.subtractObjects(r,t),i=o.subtractObjects(t,r);this.processDirty();var a=this.model.getDirtySet(),s=a.getResidentRenderGeometriesFilteredByLayers(o.object2array(n)),l=a.getResidentRenderGeometriesFilteredByLayers(o.object2array(i));this.view.modify(s,l,[]),this._viewContent=e.slice(0)},e.prototype.addToViewContent=function(e){for(var t=[],r=0;r<e.length;r++)-1===this._viewContent.indexOf(e[r])&&t.push(e[r]);if(e.length>0){this.processDirty();var n=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.view.modify(n,[],[]),this._viewContent.push.apply(this._viewContent,t)}},e.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),r=this._viewContent,n=[],i=0;i<e.length;i++){var o=r.indexOf(e[i]);o>-1&&(r[o]=r[r.length-1],r.pop(),n.push(e[i]))}var a=t.getResidentRenderGeometriesFilteredByLayers(n);this.view.modify([],a,[])},e.prototype.getLocalOrigin=function(e,t,r){return this.model.getOrigin(e,t,r)},e.prototype.getFrameTask=function(){return this.view.getFrameTask()},e.prototype.requestScreenCapture=function(e,t){this.view.requestScreenCapture(e,t)},e.prototype.getAllTexturesLoaded=function(){return this.view.getAllTexturesLoaded()},e.prototype.getTextureLoaded=function(e){return this.view.getTextureLoaded(e)},e.prototype.addExternalRenderer=function(e,t){return"function"==typeof t.intersect&&this._externalIntersectionHandlers.push(t),this.view.addExternalRenderer(e,t)},e.prototype.removeExternalRenderer=function(e){var t=this._externalIntersectionHandlers.indexOf(e);return t>-1&&this._externalIntersectionHandlers.splice(t,1),this.view.removeExternalRenderer(e)},e.prototype.getContentDebugStrings=function(e){return this.model.formatDebugInfo(e)},e.prototype.getRenderStats=function(){return this.view.getCombinedStats()},e.prototype.getRenderStatString=function(e){var t=this.getRenderStats(),r="";if(e){for(var n in r+="<table>",t)r+="<tr><td>"+n+'</td><td style="text-align: right">'+Math.round(t[n])+"</td></tr>";r+="</table>"}else for(var n in t)r+=n+": "+t[n]+"\n";return r},e.prototype.pick=function(e,t,r,n){var i=c.create(),o=c.create();return this.view.getPickRay(e,i,o),this.pickRay(i,o,e,e,t,r,n)},e.prototype.pickRayWithBeginPoint=function(e,t,r,n,i){this.view.pickRayWithBeginPoint(e,t,r,n,i)},e.prototype.pickRay=function(e,t,r,n,o,a,l){var u,d=this.view.getCamera();if(r||(r=f,d.projectPoint(t,r)),o){u=new Array(o.length);for(var p=0;p<u.length;p++)u[p]=this.model.get(s.ContentType.LAYER,o[p])}else{u=[];var v=this.getViewContent(),g=this.model.getAll(s.ContentType.LAYER);for(p=0;p<v.length;p++){var y=g[v[p]];y&&y.isPickable&&u.push(y)}}l?l.init(u,e,t,r,d,this._intersectTolerance,a):l=new i(this.viewingMode,u,e,t,r,d,this._intersectTolerance,a);for(p=0;p<this._externalIntersectionHandlers.length;p++)this._externalIntersectionHandlers[p].intersect(l,e,t,r);if(l.getHudResults().length){var b=l.getHudResults();b.sort(function(e,t){return t.dist-e.dist});var _=b[b.length-1],x=h;d.projectPoint(_.center,x),x[0]=Math.round(x[0]),x[1]=Math.round(x[1]);var w=m;this.view.getPickRay(x,e,w);var S=c.dist(_.center,e)/c.dist(e,w)*.99;this._validateHUDSelector.init(u,e,w,x,d,this._intersectTolerance,a);for(p=0;p<this._externalIntersectionHandlers.length;p++)this._externalIntersectionHandlers[p].intersect(this._validateHUDSelector,e,w,x);var C=this._validateHUDSelector.getMinResult();(null==C.dist||S<=C.dist)&&l.getMinResult().copyFrom(_)}return l},e.prototype.getIntersectTolerance=function(){return this._intersectTolerance},e.prototype.setIntersectTolerance=function(e){void 0===e&&(e=1e-5),this._intersectTolerance=e},e.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()},e.DebugSettings={fineGrainedContentValidation:!1,endFrameContentValidation:!1,logDirtySet:!1},e.ModelContentType=n,e}(),f=u.create(),h=d.create(),m=c.create();return p}.apply(null,n))||(e.exports=i)},1302:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(0),r(4),r(1)],void 0===(i=function(e,t,r,n,i,o){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_TEST_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,t.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t}return r(t,e),n([o.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0),n([o.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),n([o.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),n([o.property()],t.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),n([o.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),n([o.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),n([o.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),n([o.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),n([o.property()],t.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),n([o.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),n([o.property()],t.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),n([o.property()],t.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),n([o.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),n([o.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),n([o.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),n([o.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),n([o.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),n([o.subclass()],t)}(o.declared(i)))}.apply(null,n))||(e.exports=i)},1304:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(40)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r.vec3d,i=function(){return function(e,t,r){void 0===e&&(e=n.create()),void 0===t&&(t=n.createFrom(.57735,.57735,.57735)),void 0===r&&(r=!0),this.intensity=e,this.direction=t,this.castShadows=r}}();t.MainLight=i;var o=function(){return function(e,t){void 0===e&&(e=n.create()),void 0===t&&(t=n.createFrom(.57735,.57735,.57735)),this.intensity=n.create(),this.direction=n.create(),this.intensity=e,this.direction=t}}();t.FillLight=o;var a=function(){return function(e){void 0===e&&(e=n.create()),this.intensity=e}}();t.AmbientLight=a;var s=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();t.SphericalHarmonicsLight=s}.apply(null,n))||(e.exports=i)},1305:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(9),r(1409),r(1291),r(1463),r(1462),r(1282),r(1278),r(1334),r(1292),r(1281),r(1289),r(1277),r(1284),r(1283),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g){function y(e){return e.cullFace?"none"!==e.cullFace:!e.transparent}function b(e,t){var r=e.gl;y(t)?(e.setFaceCullingEnabled(!0),"front"===t.cullFace&&e.setCullFace(r.FRONT)):e.setFaceCullingEnabled(!1)}function _(e,t){var r=e.gl;y(t)?(e.setFaceCullingEnabled(!1),"front"===t.cullFace&&e.setCullFace(r.BACK)):e.setFaceCullingEnabled(!0)}function x(e,t){return e?p.TRANSPARENT_MATERIAL:t?p.STENCIL_MATERIAL:p.OPAQUE_MATERIAL}function w(e,t){var r=t.vvSizeEnabled;t.vvSizeEnabled?(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)):r&&e.setUniform3fv("vvSizeValue",t.vvSizeValue),r&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),o.computeObjectRotation(t.vvSymbolRotation[2],t.vvSymbolRotation[0],t.vvSymbolRotation[1],T.identity(W)),e.setUniformMatrix3fv("vvSymbolRotation",T.toMat3(W,H))),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function S(e,t){e.vvSizeEnabled=t.vvSizeEnabled,e.vvSizeMinSize=t.vvSizeMinSize,e.vvSizeMaxSize=t.vvSizeMaxSize,e.vvSizeOffset=t.vvSizeOffset,e.vvSizeFactor=t.vvSizeFactor,e.vvSizeValue=t.vvSizeValue,e.vvSymbolAnchor=t.vvSymbolAnchor,e.vvSymbolRotation=t.vvSymbolRotation}var C,D=u.vec3d,E=u.vec4d,A=u.mat3d,T=u.mat4d,O=h.assert,I=1,R=function(e){function t(r,n){var i=e.call(this,n)||this;return i.supportsEdges=!0,i.params=m.copyParameters(r,U),i.instanced=!!r.instanced,i.vertexBufferLayout=t.getVertexBufferLayout(i.params),i.instanceBufferLayout=i.instanced?t.getInstanceBufferLayout(i.params):null,i}return r(t,e),t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=C&&t.instanced,n=t.vertexColors,i=t.symbolColors,o=!!r&&r.indexOf("color")>-1,a=t.vvColorEnabled,s="replace"===t.colorMixMode,l=t.opacity>0,u=t.externalColor&&t.externalColor[3]>0;return n&&(o||a||i)?!!s||l:n?s?u:l:o||a||i?!!s||l:s?u:l},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){var e=this.params;return{textureId:e.textureId,ambient:e.ambient,diffuse:e.diffuse,specular:e.specular,externalColor:e.externalColor,colorMixMode:e.colorMixMode,opacity:e.opacity,layerOpacity:e.layerOpacity,transparent:e.transparent,polygonOffset:e.polygonOffset,atlasRegions:e.atlasRegions,flipV:e.flipV,doubleSided:e.doubleSided,doubleSidedType:e.doubleSidedType,cullFace:e.cullFace,writeStencil:e.writeStencil,receiveSSAO:e.receiveSSAO,castShadows:e.castShadows,verticalOffset:e.verticalOffset,screenSizePerspective:e.screenSizePerspective,vvSizeEnabled:e.vvSizeEnabled,vvSizeMinSize:e.vvSizeMinSize,vvSizeMaxSize:e.vvSizeMaxSize,vvSizeOffset:e.vvSizeOffset,vvSizeFactor:e.vvSizeFactor,vvSizeValue:e.vvSizeValue,vvColorEnabled:e.vvColorEnabled,vvColorValues:e.vvColorValues,vvColorColors:e.vvColorColors,instancedDoublePrecision:e.instancedDoublePrecision,compressedNormals:e.compressedNormals,groundNormalShading:e.groundNormalShading,vvSymbolAnchor:e.vvSymbolAnchor,vvSymbolRotation:e.vvSymbolRotation}},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"textureId"===r&&O(t.textureId,"Can only change texture of material that already has a texture"),"castShadows"===r&&O(e.castShadows===t.castShadows,"Can not change shadow casting behavior."),t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.getOutputAmount=function(e){return e*(g.getStride(this.vertexBufferLayout)/4)},t.prototype.getVertexBufferLayout=function(){return this.vertexBufferLayout},t.prototype.getInstanceBufferLayout=function(){return this.instanceBufferLayout},t.prototype.fillInterleaved=function(e,t,r,n,i,o,a){m.fillInterleaved(e,t,r,n,this.vertexBufferLayout,i,o,a)},t.prototype.intersect=function(e,t,r,n,i,o,a,s){if(null!==this.params.verticalOffset){var l=n.camera;D.set3(r[12],r[13],r[14],Z);var u=D.subtract(Z,l.eye,K),d=D.length(u),c=D.scale(u,1/d),p=null,f=null;switch(n.viewingMode){case"global":f=D.normalize(Z,Q);break;case"local":f=D.set(Y,Q)}this.params.screenSizePerspective&&(p=D.dot(f,c));var h=m.verticalOffsetAtDistance(l,d,this.params.verticalOffset,p,this.params.screenSizePerspective);D.scale(f,h),A.multiplyVec3(n.transformInverseRotation,f,X),i=D.subtract(i,X,q),o=D.subtract(o,X,$)}m.intersectTriangleGeometry(e,t,r,n,i,o,a)},t.prototype.getGLMaterials=function(){return{color:P,depthShadowMap:this.params.castShadows?L:null,normal:N,depth:M,highlight:F}},t.prototype.getAllTextureIds=function(){var e=this.params,t=[];return e.textureId&&t.push(e.textureId),t},t.loadShaders=function(e,t,r){e._parse(i),C=null!==r.capabilities.instancing;var n=new f("phong",["vsPhong","fsPhong"],null,t,e,r);n.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]),n.addDefine("Color","VERTEXCOLORS"),n.addDefine("symbolColor","SYMBOLVERTEXCOLORS"),n.addDefine("FlipV","FLIPV"),n.addDefine("DoubleSided","DOUBLESIDED"),n.addDefine("WindingOrderDoubleSided","WINDINGORDERDOUBLESIDED"),n.addDefine("Instanced","INSTANCED"),n.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION"),n.addDefine("InstColor","INSTANCEDCOLOR"),n.addDefine("ReceiveShadows","RECEIVE_SHADOWS"),n.addDefine("ReceiveSSAO","RECEIVE_SSAO"),n.addDefine("vvSize","VV_SIZE"),n.addDefine("vvColor","VV_COLOR"),n.addDefine("VerticalOffset","VERTICAL_OFFSET"),n.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),n.addDefine("groundNormalShading","GROUND_NORMAL_SHADING"),n.addDefine("compressedNormals","COMPRESSED_NORMALS"),n.addDefine("componentColor","COMPONENTCOLORS"),n.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD"),n.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION"),t.addShaderVariations(j,n);var o=new f("depth",["vsDepth","fsDepth"],null,t,e,r);o.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]),o.addDefine("FlipV","FLIPV"),o.addDefine("Instanced","INSTANCED"),o.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION"),o.addDefine("ShadowMap","BIAS_SHADOWMAP"),o.addDefine("vvSize","VV_SIZE"),o.addDefine("VerticalOffset","VERTICAL_OFFSET"),o.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),o.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD"),o.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION"),t.addShaderVariations(k,o);var a=new f("normal",["vsNormal","fsNormal"],null,t,e,r);a.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]),a.addDefine("FlipV","FLIPV"),a.addDefine("Instanced","INSTANCED"),a.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION"),a.addDefine("vvSize","VV_SIZE"),a.addDefine("VerticalOffset","VERTICAL_OFFSET"),a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),a.addDefine("compressedNormals","COMPRESSED_NORMALS"),a.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD"),a.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION"),t.addShaderVariations(z,a);var s=new f("highlight",["vsHighlight","fsHighlight"],null,t,e,r);s.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]),s.addDefine("FlipV","FLIPV"),s.addDefine("Instanced","INSTANCED"),s.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION"),s.addDefine("vvSize","VV_SIZE"),s.addDefine("VerticalOffset","VERTICAL_OFFSET"),s.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),s.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD"),s.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION"),t.addShaderVariations(B,s);var u=new v(r,e.vsDepth,e.fsDepth,l.Default3D,["BIAS_SHADOWMAP 1"]),d=new v(r,e.vsDepthTextured,e.fsDepthTextured,l.Default3D,["BIAS_SHADOWMAP 1"]),c=new v(r,e.vsDepth,e.fsDepth,l.Default3D),p=new v(r,e.vsDepthTextured,e.fsDepthTextured,l.Default3D),h=new v(r,e.vsNormal,e.fsNormal,l.Default3D),m=new v(r,e.vsNormalTextured,e.fsNormalTextured,l.Default3D),g=new v(r,e.vsHighlight,e.fsHighlight,l.Default3D),y=new v(r,e.vsHighlightTextured,e.fsHighlightTextured,l.Default3D);t.add("depthShadowMap",u),t.add("depthTexturedShadowMap",d),t.add("depth",c),t.add("depthTextured",p),t.add("normal",h),t.add("normalTextured",m),t.add("highlight",g),t.add("highlightTextured",y)},t.getVertexBufferLayout=function(e){var t=s.newLayout().vec3f("position");return e.groundNormalShading||(t=e.compressedNormals?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal")),e.textureId&&(t=t.vec2f("uv0"),e.atlasRegions&&(t=t.vec4u16("region"))),e.vertexColors&&(t=t.vec4u8("color")),e.symbolColors&&(t=t.vec4u8("symbolColor")),e.componentIndices&&(t=t.u16("componentIndex").u16("_padding",{glPadding:!0})),a.glLayout(t)},t.getInstanceBufferLayout=function(e){var t=s.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),a.glLayout(t,{divisor:1})},t}(c),P=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParams().textureId)||this;i.programs=[[null,null],[null,null]],i.params=m.copyParameters(t.getParams()),i.slot=x(i.params.transparent,i.params.writeStencil);var o=i.params;i.texturing=o.textureId?o.atlasRegions?"AtlasTextured":"Textured":"none";var a=C&&o.instanced;return i.instanced=!!a,i.instancedColor=!!a&&a.indexOf("color")>-1,i.pseudoInstancedColor=!C&&o.instanced&&o.instanced.indexOf("color")>-1,i._loadPrograms(),i}return r(t,e),t.prototype._loadPrograms=function(){this.programs[0][0]=this._loadProgram(!1,!1),this.programs[1][0]=this._loadProgram(!0,!1),this.params.receiveSSAO?(this.programs[0][1]=this._loadProgram(!1,!0),this.programs[1][1]=this._loadProgram(!0,!0),this.allPrograms=this.programs[0].concat(this.programs[1])):(this.programs[0][1]=this.programs[0][0],this.programs[1][1]=this.programs[1][0],this.allPrograms=[this.programs[0][0],this.programs[1][0]])},t.prototype._loadProgram=function(e,t){var r=this.params;return this.programRep.getShaderVariationsProgram(j,[this.texturing,r.vertexColors,r.symbolColors,r.flipV,r.doubleSided&&"normal"===r.doubleSidedType,r.doubleSided&&"winding-order"===r.doubleSidedType,!!this.instanced,r.instancedDoublePrecision,this.instancedColor,e,t,r.vvSizeEnabled,r.vvColorEnabled,null!==r.verticalOffset,null!==r.screenSizePerspective,r.groundNormalShading,r.compressedNormals,null!=r.componentColorBuffer,r.transparent,V])},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.programs[0][0]},t.prototype.getPrograms=function(){return this.allPrograms},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.ambient=e.ambient,t.diffuse=e.diffuse,t.specular=e.specular,t.externalColor=e.externalColor,t.colorMixMode=e.colorMixMode,t.opacity=e.opacity,t.layerOpacity=e.layerOpacity,t.polygonOffset=e.polygonOffset,t.flipV=e.flipV,t.doubleSided=e.doubleSided,t.doubleSidedType=e.doubleSidedType,t.cullFace=e.cullFace,t.receiveSSAO=e.receiveSSAO,t.castShadows=e.castShadows,t.verticalOffset=e.verticalOffset,t.screenSizePerspective=e.screenSizePerspective,S(t,e),t.vvColorEnabled=e.vvColorEnabled,t.vvColorValues=e.vvColorValues,t.vvColorColors=e.vvColorColors,t.transparent!==e.transparent&&(this.slot=x(e.transparent,e.writeStencil),t.transparent=e.transparent),t.instancedDoublePrecision=e.instancedDoublePrecision,t.compressedNormals=e.compressedNormals,t.groundNormalShading=e.groundNormalShading,this.updateTexture(e.textureId),e.atlasRegions&&(t.atlasRegions=e.atlasRegions),t.blendModeOneOne=e.blendModeOneOne,t.inverseWindingOrder=e.inverseWindingOrder,this._loadPrograms()},t.prototype.bind=function(e,t){var r=e.gl,n=this.params,i=this.program=this.programs[t.shadowMappingEnabled?1:0][t.ssaoEnabled?1:0];e.bindProgram(i),i.setUniform3fv("ambient",n.ambient),i.setUniform3fv("diffuse",n.diffuse),i.setUniform3fv("specular",n.specular),i.setUniform4fv("externalColor",n.externalColor),i.setUniform1i("colorMixMode",m.colorMixModes[n.colorMixMode]),i.setUniform1f("opacity",n.opacity),i.setUniform1f("layerOpacity",n.layerOpacity),m.bindVerticalOffset(n.verticalOffset,t,i),m.bindScreenSizePerspective(n.screenSizePerspective,i),w(i,n),this.bindTexture(e,i),"none"!==this.texturing&&this.bindTextureSize(e,i),e.setBlendFunctionSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),n.inverseWindingOrder&&e.setFrontFace(r.CW),n.transparent?(e.setBlendingEnabled(!0),n.blendModeOneOne?(e.setBlendFunction(r.ONE,r.ONE),e.setDepthWriteEnabled(!1)):e.setBlendFunctionSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):e.setBlendingEnabled(!1),n.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(2,2)),b(e,n),e.setDepthTestEnabled(!0),n.componentIndices&&n.componentColorBuffer&&(n.componentColorBuffer.updateTexture(),n.componentColorBuffer.bind(i,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:I}))},t.prototype.release=function(e,t){var r=e.gl;e.setPolygonOffsetFillEnabled(!1),_(e,this.params),e.setBlendingEnabled(!1),e.setBlendFunctionSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),e.setDepthWriteEnabled(!0),e.setFrontFace(r.CCW)},t.prototype.bindView=function(e,t){var r=this.program=this.programs[t.shadowMappingEnabled?1:0][t.ssaoEnabled?1:0],n=this.params,i=n.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;m.bindView(i,t.view,r),m.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&m.bindViewOriginDouble(i,r),t.shadowMappingEnabled&&t.shadowMap.bindView(r,i)},t.prototype.bindInstance=function(e,t){var r=this.program;if(r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal),t.instanceParameters&&this.pseudoInstancedColor){var n=t.instanceParameters.color;n&&(E.multiply(n,this.params.externalColor,G),r.setUniform4fv("externalColor",G))}},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(d),M=function(e){function t(t,r,n,i){void 0===i&&(i=!1);var o=e.call(this,t,r,n,t.getParams().textureId)||this;return o.params=m.copyParameters(t.getParams()),o.instanced=C&&!!o.params.instanced,o.texturing=g.hasAttribute(t.getVertexBufferLayout(),"uv0")?(o.params.atlasRegions,"Textured"):"none",o.program=r.getShaderVariationsProgram(k,[o.texturing,o.params.flipV,o.instanced,o.params.instancedDoublePrecision,i,o.params.vvSizeEnabled,null!==o.params.verticalOffset,null!==o.params.screenSizePerspective,o.params.transparent,V]),o.slot=x(o.params.transparent,o.params.writeStencil),o}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.cullFace=e.cullFace,t.inverseWindingOrder=e.inverseWindingOrder,t.flipV=e.flipV,S(t,e),this.updateTexture(e.textureId),t.instancedDoublePrecision=e.instancedDoublePrecision},t.prototype.bind=function(e,t){var r=e.gl,n=this.program,i=this.params;e.bindProgram(n),n.setUniform2fv("nearFar",t.nearFar),i.inverseWindingOrder&&e.setFrontFace(r.CW),m.bindVerticalOffset(i.verticalOffset,t,n),m.bindScreenSizePerspective(i.screenSizePerspective,n),w(n,i),this.bindTexture(e,n),b(e,i),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=e.gl,r=this.params;_(e,r),r.inverseWindingOrder&&e.setFrontFace(t.CCW)},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;m.bindView(i,t.view,r),n.screenSizePerspective&&m.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&m.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(d),L=function(e){function t(t,r,n){return e.call(this,t,r,n,!0)||this}return r(t,e),t}(M),N=function(e){function t(t,r,n,i){void 0===i&&(i=!1);var o=e.call(this,t,r,n,t.getParams().textureId)||this;return o.params=m.copyParameters(t.getParams()),o.instanced=C&&!!o.params.instanced,o.texturing=g.hasAttribute(t.getVertexBufferLayout(),"uv0")?(o.params.atlasRegions,"Textured"):"none",o.program=r.getShaderVariationsProgram(z,[o.texturing,o.params.flipV,o.instanced,o.params.instancedDoublePrecision,o.params.vvSizeEnabled,null!==o.params.verticalOffset,null!==o.params.screenSizePerspective,o.params.compressedNormals,o.params.transparent,V]),o.slot=x(o.params.transparent,o.params.writeStencil),o}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.cullFace=e.cullFace,t.inverseWindingOrder=e.inverseWindingOrder,t.flipV=e.flipV,S(t,e),this.updateTexture(e.textureId),t.instancedDoublePrecision=e.instancedDoublePrecision},t.prototype.bind=function(e,t){var r=e.gl,n=this.program,i=this.params;e.bindProgram(n),this.bindTexture(e,n),m.bindVerticalOffset(i.verticalOffset,t,n),m.bindScreenSizePerspective(i.screenSizePerspective,n),w(n,i),b(e,i),i.inverseWindingOrder&&e.setFrontFace(r.CW),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=e.gl,r=this.params;_(e,r),r.inverseWindingOrder&&e.setFrontFace(t.CCW)},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;m.bindView(i,t.view,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.screenSizePerspective&&m.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&m.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(d),F=function(e){function t(t,r,n,i){void 0===i&&(i=!1);var o=e.call(this,t,r,n,t.getParams().textureId)||this;return o.params=m.copyParameters(t.getParams()),o.instanced=C&&!!o.params.instanced,o.texturing=g.hasAttribute(t.getVertexBufferLayout(),"uv0")?(o.params.atlasRegions,"Textured"):"none",o.program=r.getShaderVariationsProgram(B,[o.texturing,o.params.flipV,o.instanced,o.params.instancedDoublePrecision,o.params.vvSizeEnabled,null!==o.params.verticalOffset,null!==o.params.screenSizePerspective,o.params.transparent,V]),o.slot=x(o.params.transparent,o.params.writeStencil),o}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.cullFace=e.cullFace,t.inverseWindingOrder=e.inverseWindingOrder,t.flipV=e.flipV,S(t,e),this.updateTexture(e.textureId),t.instancedDoublePrecision=e.instancedDoublePrecision},t.prototype.bind=function(e,t){var r=e.gl,n=this.program,i=this.params;e.bindProgram(n),this.bindTexture(e,n),m.bindVerticalOffset(i.verticalOffset,t,n),m.bindScreenSizePerspective(i.screenSizePerspective,n),w(n,i),b(e,i),i.inverseWindingOrder&&e.setFrontFace(r.CW),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=e.gl,r=this.params;_(e,r),r.inverseWindingOrder&&e.setFrontFace(t.CW)},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;m.bindView(i,t.view,r),n.screenSizePerspective&&m.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&m.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(d),U={textureId:void 0,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,polygonOffset:!1,atlasRegions:!1},V=!!n("enable-feature:skallweit/lod-rendering"),j="material",k="material-depth",z="material-normal",B="material-highlight",G=E.create(),H=A.create(),W=T.create(),q=D.create(),$=D.create(),Y=D.createFrom(0,0,1),Q=D.create(),X=D.create(),Z=D.create(),K=D.create();return R}.apply(null,n))||(e.exports=i)},1307:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1300),r(1278),r(1277)],void 0===(i=function(e,t,r,n,i){function o(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function a(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function s(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var l=function(){function e(e,t,i){this._viewUp=n.vec3d.create(),this._viewForward=n.vec3d.create(),this._viewRight=n.vec3d.create(),this._viewport=n.vec4d.create(),this._padding=n.vec4d.create(),this._fov=55/180*Math.PI,this._near=0,this._far=1e3,this._viewDirty=!0,this._viewMatrix=n.mat4d.create(),this._projectionDirty=!0,this._projectionMatrix=n.mat4d.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=n.mat4d.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=n.mat4d.create(),this._frustumPlanesDirty=!0,this._frustumPlanes=[r.plane.create(),r.plane.create(),r.plane.create(),r.plane.create(),r.plane.create(),r.plane.create()],this._fullViewport=null,this.relativeElevation=0,this._eye=n.vec3d.create(e),this._center=n.vec3d.create(t),this._up=void 0!==i?n.vec3d.create(i):n.vec3d.create([0,0,1]),this._padding=n.vec4d.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){n.mat4d.set(e,this._viewMatrix),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=n.vec4d.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),n.vec4d.set(e,this._padding),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(n.mat4d.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this.aspect;n.mat4d.frustum(-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-r*(1+2*this._padding[2]/t),r*(1+2*this._padding[0]/t),this.near,this.far,this._projectionMatrix),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){n.mat4d.set(e,this._projectionMatrix),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return i.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=i.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return i.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=i.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return n.vec3d.dist(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumPlanes",{get:function(){return this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),this._frustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=n.mat4d.create()),n.mat4d.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),n.mat4d.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){return n.vec3d.set(e._eye,this._eye),n.vec3d.set(e._center,this._center),n.vec3d.set(e._up,this._up),n.vec4d.set(e._viewport,this._viewport),n.vec4d.set(e._padding,this._padding),this._near=e._near,this._far=e._far,this._fov=e._fov,this.relativeElevation=e.relativeElevation,e._viewDirty?this._viewDirty=!0:(n.mat4d.set(e._viewMatrix,this._viewMatrix),n.vec3d.set(e._viewRight,this._viewRight),n.vec3d.set(e._viewUp,this._viewUp),n.vec3d.set(e._viewForward,this._viewForward),this._viewDirty=!1),e._projectionDirty?this._projectionDirty=!0:(n.mat4d.set(e._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,e._frustumPlanesDirty?this._frustumPlanesDirty=!0:(e.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?n.mat4d.set(e._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=n.mat4d.create(e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),e._fullViewport?this._fullViewport?n.vec4d.set(e._fullViewport,this._fullViewport):this._fullViewport=n.vec4d.create(e._fullViewport):this._fullViewport=null,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.copy=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equivalent=function(e){return a(this._eye,e._eye)&&a(this._center,e._center)&&a(this._up,e._up)&&s(this._viewport,e._viewport)&&s(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov},e.prototype.almostEquals=function(e,t,r){void 0===r&&(r=!1);var i,a=n.vec3d.dist(this._eye,this._center)*(t||5e-4),s=a*a;return r?(n.vec3d.direction(e._center,e._eye,c),n.vec3d.direction(this._center,this._eye,p),i=1e-10):(n.vec3d.set(e._center,c),n.vec3d.set(this._center,p),i=s),n.vec3d.dist2(e._eye,this._eye)<s&&n.vec3d.dist2(c,p)<i&&Math.abs(e._fov-this._fov)<.001&&o(e._padding,this._padding)<.5&&o(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumPlanesDirty=!0,this._viewProjectionDirty=!0},e.prototype.computePixelSizeAt=function(e){return this.computePixelSizeAtDist(n.vec3d.dist(e,this._eye))},e.prototype.computePixelSizeAtDist=function(e){return 2*e*Math.tan(this.fovX/2)/this.width},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.copyFrustumPlanes=function(e){if(!e){e=new Array(6);for(var t=0;t<6;++t)e[t]=n.vec4d.create()}var r=this.frustumPlanes;for(t=0;t<6;t++)n.vec4d.set(r[t],e[t]);return e},e.prototype.computeFrustumPoints=function(e){if(!e){e=new Array(8);for(var t=0;t<8;++t)e[t]=n.vec3d.create()}return i.matrixToFrustumPoints(this.viewMatrix,this.projectionMatrix,e),e},e.prototype.setGLViewport=function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])},e.prototype.applyProjection=function(e,t,r){void 0===r&&(r=!1),e!==u&&n.vec3d.set(e,u),u[3]=1,r&&(t[2]=-u[2]),n.mat4d.multiplyVec4(this.projectionMatrix,u),n.vec3d.scale(u,1/Math.abs(u[3]));var o=this.fullViewport;return t[0]=i.lerp(0,o[0]+o[2],.5+.5*u[0]),t[1]=i.lerp(0,o[1]+o[3],.5+.5*u[1]),r||(t[2]=.5*(u[2]+1)),t},e.prototype.projectPoint=function(e,t){u[0]=e[0],u[1]=e[1],u[2]=e[2],u[3]=1,n.mat4d.multiplyVec4(this.viewProjectionMatrix,u),n.vec3d.scale(u,1/Math.abs(u[3]));var r=this.fullViewport;return t[0]=i.lerp(0,r[0]+r[2],.5+.5*u[0]),t[1]=i.lerp(0,r[1]+r[3],.5+.5*u[1]),t[2]=.5*(u[2]+1),t},e.prototype.unprojectPoint=function(e,t,r){if(void 0===r&&(r=!1),r)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;if(n.mat4d.multiply(this.projectionMatrix,this.viewMatrix,d),!n.mat4d.inverse(d))return null;var i=this.fullViewport;return u[0]=2*(e[0]-i[0])/i[2]-1,u[1]=2*(e[1]-i[1])/i[3]-1,u[2]=2*e[2]-1,u[3]=1,n.mat4d.multiplyVec4(d,u),0===u[3]?null:(t[0]=u[0]/u[3],t[1]=u[1]/u[3],t[2]=u[2]/u[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.computeUpGlobal=function(){n.vec3d.subtract(this.center,this.eye,c);var e=n.vec3d.length(this.center);e<1?(n.vec3d.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(n.vec3d.dot(c,this.center))>.9999*n.vec3d.length(c)*e||(n.vec3d.cross(c,this.center,this.up),n.vec3d.cross(this.up,c,this.up),n.vec3d.normalize(this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){n.vec3d.direction(this.center,this.eye,c),Math.abs(c[2])<=.9999&&(n.vec3d.scale(c,c[2]),n.vec3d.set3(-c[0],-c[1],1-c[2],this.up),n.vec3d.normalize(this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){a(e,t)||(n.vec3d.set(e,t),this._viewDirty=!0,this._frustumPlanesDirty=!0,this._viewProjectionDirty=!0)},e.prototype._computeFrustumPlanes=function(e){if(!e){e=new Array(6);for(var t=0;t<6;++t)e[t]=r.plane.create()}return i.matrixToFrustumPlanes(this.viewMatrix,this.projectionMatrix,e),e},e.prototype._ensureViewClean=function(){this._viewDirty&&(n.mat4d.lookAt(this._eye,this._center,this._up,this._viewMatrix),n.vec3d.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),n.vec3d.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),n.vec3d.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}(),u=n.vec4d.create(),d=n.mat4d.create(),c=n.vec3d.create(),p=n.vec3d.create();return l}.apply(null,n))||(e.exports=i)},1308:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1467),r(1290),r(1443),r(1294),r(1277),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(){function e(t,r,n){this.singleUse=!1,this.componentAABB=null,this.id=e.__idGen.gen(r),this.data=t,this._boundingInfo=n}return e.prototype.getData=function(){return this.data},e.prototype.getComponentCount=function(){return n.componentCount(this.data.componentOffsets)},e.prototype.getComponentAABB=function(e,t){null==this.componentAABB&&(this.componentAABB=this._computeComponentAABB());for(var r=0;r<6;r++)t[r]=this.componentAABB[6*e+r];return t},e.prototype._computeComponentAABB=function(){for(var e=this.getComponentCount(),t=new Float32Array(6*e),r=0;r<e;r++)this._calculateAABB(r,t,6*r);return t},e.prototype._calculateAABB=function(e,t,r){void 0===r&&(r=0);for(var n=this.data.getIndices(s.VertexAttrConstants.POSITION),i=this.data.getAttribute(s.VertexAttrConstants.POSITION),o=this.data.componentOffsets,a=o.length?o[e]:0,l=o.length?o[e+1]:n.length,u=1/0,d=1/0,c=1/0,p=-1/0,f=-1/0,h=-1/0,m=i.offsetIdx,v=i.strideIdx,g=a;g<l;g++){var y=m+v*n[g],b=i.data[y],_=i.data[y+1],x=i.data[y+2];u=Math.min(u,b),d=Math.min(d,_),c=Math.min(c,x),p=Math.max(p,b),f=Math.max(f,_),h=Math.max(h,x)}return t?(t[r]=u,t[r+1]=d,t[r+2]=c,t[r+3]=p,t[r+4]=f,t[r+5]=h):t=[u,d,c,p,f,h],t},e.prototype.calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),n="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(n);for(var o=0;o<n;++o)e[o]=o}var l=e.length;a.assert(l%n==0);var u=i.generateDefaultIndexArray(l/n);return new r(u,n,e,t)},e.prototype.getBoundingInfo=function(){return null==this._boundingInfo&&(this._boundingInfo=this.calculateBoundingInfo()),this._boundingInfo},e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.__idGen=new o,e}()}.apply(null,n))||(e.exports=i)},1309:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(407),r(1358)],void 0===(i=function(e,t,r,n){var i=2;return function(){function e(e){var t=this;if(this.data=[],this._length=0,this._allocator=null,this._deallocator=null,this._shrink=function(){},this._hint=new r.RemoveHint,e){if(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator){if(this._allocator=e.allocator,e.deallocator&&(this._deallocator=e.deallocator),e.initialSize)for(var n=0;n<e.initialSize;++n)this.data[n]=this._allocator(n)}else this._deallocator=function(e,r){return t.data[r]=void 0};e.shrink&&(this._shrink=function(){t.data.length>i*t.length&&(t.data.length=t.length)})}}return e.prototype.toArray=function(){return this.data.slice(0,this.length)},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(e){if(this._allocator)for(;this.data.length<e;)this.data.push(this._allocator(this.data.length));if(this._deallocator)for(var t=e;t<this._length;++t)this._deallocator(this.data[t],t);this._length=e,this._shrink()},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.length=0},e.prototype.equal=function(e){return r.equals(this.data,e.data)},e.prototype.push=function(e){return this.data.length===this.length&&this._grow((this.length+1)*i),this.data[this.length++]=e,e},e.prototype.pushArray=function(e){var t=this.length+e.length;t>=this.data.length&&this._grow(Math.max(this.length*i,t));for(var r=0;r<e.length;r++)this.data[this._length++]=e[r];return this.back()},e.prototype.pushNew=function(){return this.data.length===this.length&&this._grow((this.length+1)*i),++this._length,this.back()},e.prototype.pushAny=function(e){return void 0===e?this.pushNew():Array.isArray(e)?this.pushArray(e):this.push(e)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}},e.prototype.removeMany=function(e){var t=this,r=[];return this.data=this.data.filter(function(n,i){return!(i>=t.length)&&(e.indexOf(n)<0||(r.push(n),!1))}),this._length=this.data.length,r},e.prototype.removeUnordered=function(e){var t=r.removeUnordered(this.data,e,this.length,this._hint);return void 0!==t&&(this.length=this.length-1),t},e.prototype.removeUnorderedMany=function(e){var t=r.removeUnorderedMany(this.data,e,this.length,this._hint);return this.length=this.length-t.length,t},e.prototype.front=function(){if(0!==this.length)return this.data[0]},e.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]},e.prototype.swapElements=function(e,t){var r;e>=this.length||t>=this.length||(r=[this.data[t],this.data[e]],this.data[e]=r[0],this.data[t]=r[1])},e.prototype.sort=function(e){n.sort(this.data,0,this.length,e)},e.prototype.some=function(e,t){for(var r=0;r<this.length;++r)if(e.call(t,this.data[r],r,this.data))return!0;return!1},e.prototype.find=function(e,t){for(var r=0;r<this.length;++r){var n=this.data[r];if(e.call(t,n,r,this.data))return n}},e.prototype.filter=function(t,r,n){n=n||new e;for(var i=0;i<this.length;++i)t.call(r,this.data[i],i,this.data)&&n.push(this.data[i]);return n},e.prototype.forEach=function(e,t){for(var r=0;r<this.length;++r)e.call(t,this.data[r],r,this.data)},e.prototype.map=function(e,t){for(var r=new Array(this.length),n=0;n<this.length;++n)r[n]=e.call(t,this.data[n],n,this.data);return r},e.prototype._grow=function(e){if(this._allocator)for(;this.data.length<e;)this.data.push(this._allocator(this.data.length))},e}()}.apply(null,n))||(e.exports=i)},1310:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(154),r(444),r(408),r(206),r(1291),r(40),r(74),r(1311)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){function d(e,t,r,n,i){var o=t.z||0,a=r.featureExpressionInfoContext;switch(r.mode){case"on-the-ground":var s=e.getElevation(t,"ground")||0;return i&&(i.verticalDistanceToGround=0,i.terrainElevation=s),s;case"relative-to-ground":var l=e.getElevation(t,"ground")||0;s=r.calculateOffsetRenderUnits(n);return null==a&&(s+=o),i&&(i.verticalDistanceToGround=s,i.terrainElevation=l),s+l;case"relative-to-scene":l=e.getElevation(t,"scene")||0,s=r.calculateOffsetRenderUnits(n);return i&&(i.verticalDistanceToGround=s,i.terrainElevation=l),s+l;case"absolute-height":s=r.calculateOffsetRenderUnits(n);if(null==a&&(s+=o),i){l=e.getElevation(t,"ground")||0;i.verticalDistanceToGround=s-l,i.terrainElevation=l}return s;default:r.mode}return 0}function c(e,t,r,n,i,o){var s,u=0;if(e.metadata.usesVerticalDistanceToGround)u=d(i,t,r,o,w),a.updateVertexAttributeAuxpos1w(e,w.verticalDistanceToGround),s=w.terrainElevation;else{var c="absolute-height"!==r.mode;u=d(i,t,r,o,c?w:null),c&&(s=w.terrainElevation)}var p=e.getObjectTransformation();return b[0]=t.x,b[1]=t.y,b[2]=u,l.computeLinearTransformation(t.spatialReference,b,p,n)?e.setObjectTransformation(p):console.warn("Could not locate symbol object properly, it might be misplaced"),{terrainElevation:s}}function p(e,t){var r=n.pathsToTriangulationInfo(e,t);return{vertexData:r.position,polygons:r.polygons,outlines:r.outlines}}function f(e,t,r,n,i){t*=3,n*=3;for(var o=0;o<i;++o)r[n++]=e[t++],r[n++]=e[t++],r[n++]=e[t++]}function h(e,t,r,n,i,o,a){return l.bufferToBuffer(e,r,t,n,o,i,a)}function m(e,t,r){l.pointToVector(e,t,r)}function v(e,t){return!(e[0]>t[3]||e[0]<t[0]||e[1]>t[4]||e[1]<t[1])}function g(e,t){return!(t[0]>e[3]||t[3]<e[0]||t[1]>e[4]||t[4]<e[1])}Object.defineProperty(t,"__esModule",{value:!0});var y=s.mat4d,b=s.vec3d.create(),_=y.identity(),x=i.makeDehydratedPoint(0,0,0,null);t.createStageObjectForPoint=function(e,t,r,n,i,o,a,s,l,d,p){var f=t?t.length:0,h=this._context.clippingExtent;if(m(e,b,this._context.elevationProvider.spatialReference),h&&!v(b,h))return null;m(e,b,this._context.renderSpatialReference);for(var g=this._context.localOriginFactory.getOrigin(b),y=new u({castShadow:!1,metadata:{layerUid:s,graphicUid:l,usesVerticalDistanceToGround:!!d},idHint:a}),x=0;x<f;x++){var w=n?n[x]:_;y.addGeometry(t[x],r[x],w,i,g,p)}return{object:y,terrainElevation:c(y,e,o,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper).terrainElevation}},t.extendPointGraphicElevationContext=function(e,t,r){var n=e.elevationContext,o=r.spatialReference;m(t,b,o),n.centerPointInElevationSR=i.makeDehydratedPoint(b[0],b[1],i.hasZ(t)?b[2]:0,o)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return a.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var n=r.getPointOnPath(t,r.getPathLength(t)/2);return i.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.computeElevation=d,t.getSingleSizeDriver=function(e,t){return void 0===t&&(t=0),isFinite(e[t])?e[t]:null},t.copyPathData=p,t.copyVertices=f,t.chooseOrigin=function(e,t,r,n){var i=Math.floor(t+(r-1)/2);n[0]=e[3*i+0],n[1]=e[3*i+1],n[2]=e[3*i+2]},t.subtractCoordinates=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t++]-=n[0],e[t++]-=n[1],e[t++]-=n[2]},t.setZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]=n,t+=3},t.offsetZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]+=n,t+=3},t.scaleZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]*=n,t+=3},t.flatArrayToArrayOfArrays=function(e,t,r){var n=[];t*=3;for(var i=0;i<r;++i)n.push([e[t++],e[t++],e[t++]]);return n},t.reproject=h,t.reprojectPoint=m,t.getGeometryVertexData3D=function(e,t,r,n,i,o,a){var s=i.spatialReference,l=p(e,t),u=l.vertexData,d=u.length/3,c=new Float64Array(u.length),m=!0;r.equals(s)?f(u,0,c,0,u.length):m=h(u,0,r,c,0,s,d);var v=function(e,t,r,n,i,o,a,s){var l=s.mode,u=0,d=0,c=0,p=s.calculateOffsetRenderUnits(a),f=s.featureExpressionInfoContext;x.spatialReference=e.spatialReference,r*=3,i*=3;for(var h=0;h<o;++h)x.x=t[r+0],x.y=t[r+1],x.z=t[r+2],"on-the-ground"===l?(d=u=e.getElevation(x)||0,c+=u):"relative-to-ground"===l?(d=(u=e.getElevation(x)||0)+p,null==f&&(d+=x.z),c+=u):"relative-to-scene"===l?(d=(u=e.getElevation(x,"scene")||0)+p,c+=u):"absolute-height"===l&&(d=p,null==f&&(d+=x.z)),n[i+0]=t[r+0],n[i+1]=t[r+1],n[i+2]=d,r+=3,i+=3;return{terrainElevation:c/=o}}(i,c,0,u,0,d,o,a);return s.equals(n)||h(u,0,s,u,0,n,d),{geometryData:l,vertexData:u,eleVertexData:c,terrainElevation:v.terrainElevation,projectionSuccess:m}},t.getGeometryVertexDataDraped=function(e,t,r){var n=p(e,!1),i=n.vertexData,o=i.length/3,a=!0;return t.equals(r)||(a=l.bufferToBuffer(i,t,0,i,r,0,o)),{geometryData:n,vertexData:i,projectionSuccess:a}},t.computeBoundingBox=function(e,t,r,n){n[0]=Number.MAX_VALUE,n[1]=Number.MAX_VALUE,n[2]=Number.MAX_VALUE,n[3]=-Number.MAX_VALUE,n[4]=-Number.MAX_VALUE,n[5]=-Number.MAX_VALUE,t*=3;for(var i=0;i<r;++i){var o=e[t++],a=e[t++],s=e[t++];o<n[0]&&(n[0]=o),a<n[1]&&(n[1]=a),s<n[2]&&(n[2]=s),o>n[3]&&(n[3]=o),a>n[4]&&(n[4]=a),s>n[5]&&(n[5]=s)}return n},t.pointInBox2D=v,t.boxesIntersect2D=g,t.boundingBoxClipped=function(e,t){return!!t&&!g(e,t)},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.needsOffsetAdjustment=function(e,t,r,n){if(!1===t.needsOffsetAdjustment||!1===t.supportsOffsetAdjustment)return!1;if("on-the-ground"===e.mode)return!1;if(0===e.meterUnitOffset){if(!0===t.needsOffsetAdjustment)return!0;if(o.isCalloutSupport(n)&&n.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===e.mode&&(!i.hasZ(r)||e.featureExpressionInfoContext))return!0;if("relative-to-scene"===e.mode)return!0}return!1};var w={verticalDistanceToGround:0,terrainElevation:0}}.apply(null,n))||(e.exports=i)},1311:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1290),r(1360),r(1278),r(1320),r(1294),r(1296),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=l.assert,d=i.mat4d,c=i.vec3d,p=d.identity(),f=function(){function e(t){void 0===t&&(t={}),this._bvObjectSpace=new h,this._bvWorldSpace=new h,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this.id=e._idGen.gen(t.idHint),this.name=t.name,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.objectTransformation=d.identity(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations)}return e.prototype._initializeGeometryRecords=function(e,t,r){if(!Array.isArray(e))return this.geometryRecords=[],void(this.geometries=[]);u(t.length===e.length,"Object3D: materials don't match geometries"),u(r.length===e.length,"Object3D: transformations don't match geometries"),this.geometryRecords=new Array(e.length),this.geometries=e.slice();for(var i=0;i<e.length;i++){u(Array.isArray(t[i]),"Object3D: materials parameter must be array of array");this.geometryRecords[i]=new n(e[i],t[i].slice(),d.create(r[i]),{})}this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){u(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getParentLayer=function(){return this.parentLayer},e.prototype.addParentLayer=function(e){this.parentLayer=e},e.prototype.removeParentLayer=function(e){this.parentLayer=null},e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},e.prototype.getFirstGeometryIndex=function(e){var t=this.geometries.indexOf(e);return u(t>-1,"Object3D.getFirstGeometryIndex: geometry not found"),t},e.prototype.findGeometryRecords=function(e){for(var t=[],r=0;r<this.geometries.length;r++)this.geometries[r]===e&&t.push(this.geometryRecords[r]);return t},e.prototype.getGeometryRecord=function(e){return u(e>=0&&e<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[e]},e.prototype.getGeometryRecords=function(){return this.geometryRecords},e.prototype.addGeometry=function(e,t,r,i,o,a){void 0===r&&(r=p),u(Array.isArray(t),"Object3D.addGeometry: materials must be array"),this.geometries.push(e);var s=new n(e,t.slice(),d.create(r),i||{},o,a);return this.geometryRecords.push(s),this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.customTransformation}),this._notifyDirty("objGeometryAdded",s),this._invalidateBoundingVolume(),s},e.prototype.hasGeometry=function(e){return this.geometries.indexOf(e)>-1},e.prototype.removeGeometry=function(e){var t=this.geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.customTransformation}),this.geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var n=t[e],i=n.instanceParameters.componentVisibilities,o=n.geometry.getData().componentOffsets;if(!r.isAllHidden(i,o)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.areAllComponentsVisible=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var n=t[e],i=n.instanceParameters.componentVisibilities,o=n.geometry.getData().componentOffsets;if(!r.isAllVisible(i,o))return!1}return!0},e.prototype.hasComponents=function(){for(var e=!1,t=0;t<this.geometries.length;t++){var n=this.geometries[t].getData();if(e=r.hasComponents(n.componentOffsets))break}return e},e.prototype.setComponentVisibility=function(e,t,n){var i=e.geometry,o=e.instanceParameters.componentVisibilities,a=i.getData().componentOffsets,s=r.updateVisibility(o,a,t,n);e.instanceParameters.componentVisibilities=s,this._notifyDirty("visibilityChanged",e),this._allComponentsHiddenDirty=!0},e.prototype.setHidden=function(e,t){e.instanceParameters.hidden=!!t,this._notifyDirty("visibilityChanged",e)},e.prototype.isHidden=function(e){return!!e.instanceParameters.hidden},e.prototype.getComponentVisibility=function(e,t){var n=e.instanceParameters.componentVisibilities;return r.getVisibility(n,t)},e.prototype.hideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var n=t[e],i=n.instanceParameters.componentVisibilities,o=r.hideAllComponents(i);n.instanceParameters.componentVisibilities=o}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype.unhideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var n=t[e],i=n.instanceParameters.componentVisibilities,o=r.unhideAllComponents(i);n.instanceParameters.componentVisibilities=o}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype._setComponentHighlight=function(e,t,n,i){var o=e.instanceParameters.componentHighlights,a=r.addHighlight(o,t,n,i);e.instanceParameters.componentHighlights=a},e.prototype.setComponentHighlight=function(e,t,r){var n=o.generateHighlightId();return this._setComponentHighlight(e,t,r,n),this._notifyDirty("componentHighlightChanged"),n},e.prototype.highlightAllComponents=function(e){for(var t=o.generateHighlightId(),r=0,n=this.geometryRecords;r<n.length;r++){var i=n[r];this._setComponentHighlight(i,null,e,t)}return this._notifyDirty("componentHighlightChanged"),t},e.prototype.removeHighlights=function(e){for(var t=0,n=this.geometryRecords;t<n.length;t++){var i=n[t].instanceParameters,o=i.componentHighlights,a=r.removeHighlight(o,e);i.componentHighlights=a}this._notifyDirty("componentHighlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){u(e>=0&&e<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");var n=this.geometryRecords[e].geometry.getData().componentOffsets;return r.componentFind(n,3*t)},e.prototype.setGeometryTransformation=function(e,t){u(e>=0&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var r=this.geometryRecords[e],i=new n(r.geometry,r.materials,d.create(t),r.instanceParameters);this.geometryRecords[e]=i,this._notifyDirty("objGeometryReplaced",[r,i]),this._invalidateBoundingVolume()},e.prototype.getObjectTransformation=function(){return d.create(this.objectTransformation)},e.prototype.setObjectTransformation=function(e){d.set(e,this.objectTransformation),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},e.prototype.getCombinedStaticTransformation=function(e,t){return t=t||d.create(),d.multiply(this.objectTransformation,e.getStaticTransformation(),t),t},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||d.create(),d.multiply(this.objectTransformation,e.getShaderTransformation(),t),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getCastShadow=function(){return this.castShadow},e.prototype.setCastShadow=function(e){this.castShadow=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.getName=function(){return this.name},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this.geometryRecords.length;++e){var t=this.geometries[e],r=this.geometryRecords[e],n=t.getBoundingInfo();this._calculateTransformedBoundingVolume(n,this._bvObjectSpace,r.getShaderTransformation()),this._calculateTransformedBoundingVolume(n,this._bvWorldSpace,this.getCombinedShaderTransformation(r))}c.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center),c.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);var i=c.create(),o=c.create(),a=d.maxScale(this.objectTransformation);for(e=0;e<this.geometryRecords.length;++e){t=this.geometries[e];var s=this.geometryRecords[e].getShaderTransformation(),l=d.maxScale(s);n=t.getBoundingInfo();d.multiplyVec3(s,n.getCenter(),i);var u=c.dist(i,this._bvObjectSpace.center),p=n.getBSRadius()*l;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,u+p),d.multiplyVec3(this.objectTransformation,i,o);var f=c.dist(o,this._bvWorldSpace.center),h=p*a;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,f+h)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,r){var n=e.getBBMin(),i=e.getBBMax(),o=c.create(n),a=c.create(i);d.multiplyVec3(r,o),d.multiplyVec3(r,a);for(var s=0;s<3;++s)t.bbMin[s]=Math.min(t.bbMin[s],o[s],a[s]),t.bbMax[s]=Math.max(t.bbMax[s],o[s],a[s]);for(s=0;s<3;++s){c.set(n,o),c.set(i,a),o[s]=i[s],a[s]=n[s],d.multiplyVec3(r,o),d.multiplyVec3(r,a);for(var l=0;l<3;++l)t.bbMin[l]=Math.min(t.bbMin[l],o[l],a[l]),t.bbMax[l]=Math.max(t.bbMax[l],o[l],a[l])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,r,n){if(this._parentLayer){r=r||s.OBJECT;var i=n||this;this._parentLayer.notifyDirty(e,t,r,i)}},e._idGen=new a,e}(),h=function(){function e(){this.bbMin=c.create(),this.bbMax=c.create(),this.center=c.create(),this.bsRadius=0}return e.prototype.init=function(){c.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin),c.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax),c.set3(0,0,0,this.center),this.bsRadius=0},e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e}();return f}.apply(null,n))||(e.exports=i)},1312:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(27)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),i=new Uint8Array(n),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([n],{type:r})},t.requestImage=function(e){return r(e,{responseType:"image",allowImageDataAccess:!0}).then(function(e){return e.data})}}.apply(null,n))||(e.exports=i)},1313:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return{near:e,far:t}}function n(e,t,r){return e.near=t,e.far=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.empty=function(e){return e?n(e,1/0,-1/0):r(1/0,-1/0)},t.set=n,t.union=function(e,t,r){return void 0===r&&(r=e),r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}}.apply(null,n))||(e.exports=i)},1316:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(1390),r(54),r(1290),r(1278),r(1334),r(1292),r(1297),r(1281),r(1335),r(1289),r(1277),r(1284),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m){function v(e,t){return void 0===t&&(t=O),e.textureIsSignedDistanceField?function(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):g.set(e.anchorPos,t),t}var g=a.vec2d,y=a.vec3d,b=a.mat3d,_=a.mat4d,x={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},w=[{name:"position",count:3,type:5126,offset:0,stride:76,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:76,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:76,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:76,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:76,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:76,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:76,normalized:!1}],S={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:x.center,shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},C=function(e){function t(t,r){var n=e.call(this,r)||this;return n._textureDirty=!1,n.params=h.copyParameters(t,S),"string"==typeof n.params.anchorPos&&(n.params.anchorPos=x[n.params.anchorPos]),n}return r(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){var e=this.params;return{color:e.color,texCoordScale:e.texCoordScale,polygonOffset:e.polygonOffset,anchorPos:e.anchorPos,screenOffset:e.screenOffset,verticalOffset:e.verticalOffset,screenSizePerspective:e.screenSizePerspective,screenSizePerspectiveAlignment:e.screenSizePerspectiveAlignment,shaderPolygonOffset:e.shaderPolygonOffset,textureIsSignedDistanceField:e.textureIsSignedDistanceField,outlineColor:e.outlineColor,outlineSize:e.outlineSize,distanceFieldBoundingBox:e.distanceFieldBoundingBox,vvSizeEnabled:e.vvSizeEnabled,vvSizeMinSize:e.vvSizeMinSize,vvSizeMaxSize:e.vvSizeMaxSize,vvSizeOffset:e.vvSizeOffset,vvSizeFactor:e.vvSizeFactor,vvColorEnabled:e.vvColorEnabled,vvColorValues:e.vvColorValues,vvColorColors:e.vvColorColors,textureId:e.textureId,occlusionTest:e.occlusionTest,binaryHighlightOcclusion:e.binaryHighlightOcclusion,centerOffsetUnits:e.centerOffsetUnits,debugDrawBorder:e.debugDrawBorder,drawInSecondSlot:e.drawInSecondSlot}},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&f.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.getOutputAmount=function(e){return 19*e*6},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return w},t.prototype.fillInterleaved=function(e,t,r,n,i,o){for(var a=4*o,s=e.indices[f.VertexAttrConstants.POSITION],l=e.vertexAttr[f.VertexAttrConstants.POSITION].data,u=o+m.findAttribute(w,f.VertexAttrConstants.POSITION).offset/4,d=0;d<s.length;++d){var c=3*s[d];h.fill(l,c,i,u,t,3),u+=19,h.fill(l,c,i,u,t,3),u+=19,h.fill(l,c,i,u,t,3),u+=19,h.fill(l,c,i,u,t,3),u+=19,h.fill(l,c,i,u,t,3),u+=19,h.fill(l,c,i,u,t,3),u+=19}var p=e.indices[f.VertexAttrConstants.NORMAL],v=e.vertexAttr[f.VertexAttrConstants.NORMAL].data,g=o+m.findAttribute(w,f.VertexAttrConstants.NORMAL).offset/4;for(d=0;d<p.length;++d){c=3*p[d];h.fill(v,c,i,g,r,3),g+=19,h.fill(v,c,i,g,r,3),g+=19,h.fill(v,c,i,g,r,3),g+=19,h.fill(v,c,i,g,r,3),g+=19,h.fill(v,c,i,g,r,3),g+=19,h.fill(v,c,i,g,r,3),g+=19}var y,b,_,x,S=e.vertexAttr[f.VertexAttrConstants.UV0].data;null==S||S.length<=3?(y=0,b=0,_=this.params.texCoordScale[0],x=this.params.texCoordScale[1]):(y=e.vertexAttr[f.VertexAttrConstants.UV0].data[0],b=e.vertexAttr[f.VertexAttrConstants.UV0].data[1],_=e.vertexAttr[f.VertexAttrConstants.UV0].data[2],x=e.vertexAttr[f.VertexAttrConstants.UV0].data[3]),_=Math.min(1.99999,_+1),x=Math.min(1.99999,x+1);var C=o+m.findAttribute(w,f.VertexAttrConstants.UV0).offset/4;for(d=0;d<s.length;++d)i[C]=y,i[C+1]=b,i[C+=19]=_,i[C+1]=b,i[C+=19]=_,i[C+1]=x,i[C+=19]=_,i[C+1]=x,i[C+=19]=y,i[C+1]=x,i[C+=19]=y,i[C+1]=b,C+=19;var D=e.indices[f.VertexAttrConstants.COLOR],E=e.vertexAttr[f.VertexAttrConstants.COLOR].data,A=a+m.findAttribute(w,f.VertexAttrConstants.COLOR).offset,T=new Uint8Array(i.buffer);for(d=0;d<D.length;++d){c=4*D[d];h.fillColor(E,c,T,A,4),A+=76,h.fillColor(E,c,T,A,4),A+=76,h.fillColor(E,c,T,A,4),A+=76,h.fillColor(E,c,T,A,4),A+=76,h.fillColor(E,c,T,A,4),A+=76,h.fillColor(E,c,T,A,4),A+=76}var O=e.indices[f.VertexAttrConstants.SIZE],I=e.vertexAttr[f.VertexAttrConstants.SIZE].data,R=o+m.findAttribute(w,f.VertexAttrConstants.SIZE).offset/4;for(d=0;d<O.length;++d){var P=I[2*O[d]],M=I[2*O[d]+1];i[R]=P,i[R+1]=M,i[R+=19]=P,i[R+1]=M,i[R+=19]=P,i[R+1]=M,i[R+=19]=P,i[R+1]=M,i[R+=19]=P,i[R+1]=M,i[R+=19]=P,i[R+1]=M,R+=19}if(null!=e.indices[f.VertexAttrConstants.AUXPOS1]&&null!=e.vertexAttr[f.VertexAttrConstants.AUXPOS1]){var L=e.indices[f.VertexAttrConstants.AUXPOS1],N=e.vertexAttr[f.VertexAttrConstants.AUXPOS1].data,F=o+m.findAttribute(w,"auxpos1").offset/4;for(d=0;d<L.length;++d){c=4*L[d];h.fill(N,c,i,F,null,4),F+=19,h.fill(N,c,i,F,null,4),F+=19,h.fill(N,c,i,F,null,4),F+=19,h.fill(N,c,i,F,null,4),F+=19,h.fill(N,c,i,F,null,4),F+=19,h.fill(N,c,i,F,null,4),F+=19}}if(null!=e.indices[f.VertexAttrConstants.AUXPOS2]&&null!=e.vertexAttr[f.VertexAttrConstants.AUXPOS2]){var U=e.indices[f.VertexAttrConstants.AUXPOS2],V=e.vertexAttr[f.VertexAttrConstants.AUXPOS2].data,j=o+m.findAttribute(w,"auxpos2").offset/4;for(d=0;d<U.length;++d){c=4*U[d];h.fill(V,c,i,j,null,4),j+=19,h.fill(V,c,i,j,null,4),j+=19,h.fill(V,c,i,j,null,4),j+=19,h.fill(V,c,i,j,null,4),j+=19,h.fill(V,c,i,j,null,4),j+=19,h.fill(V,c,i,j,null,4),j+=19}}},t.prototype.intersect=function(e,t,r,n,i,a,s,l){if(n.isSelection&&n.enableHUDSelection&&!o.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){var u=e.getData(),d=this.params,p=1,h=1;if(_.toMat3(r,N),l){var m=l(V);p=m[0],h=m[5],function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],d=1/Math.sqrt(t*t+r*r+n*n),c=1/Math.sqrt(i*i+o*o+a*a),p=1/Math.sqrt(s*s+l*l+u*u);e[0]=t*d,e[1]=r*d,e[2]=n*d,e[3]=i*c,e[4]=o*c,e[5]=a*c,e[6]=s*p,e[7]=l*p,e[8]=u*p}(N)}var g=u.getVertexAttr()[f.VertexAttrConstants.POSITION],b=u.getVertexAttr()[f.VertexAttrConstants.SIZE],x=u.getVertexAttr()[f.VertexAttrConstants.NORMAL];f.assert(g.size>=3);for(var w=n.point,S=n.camera,C=v(d),D=0;D<g.data.length/g.size;D++){var E=D*g.size;y.set3(g.data[E],g.data[E+1],g.data[E+2],I),_.multiplyVec3(r,I,I);var A=D*b.size;k[0]=b.data[A]*p,k[1]=b.data[A+1]*h,_.multiplyVec3(S.viewMatrix,I);var O=D*x.size;if(y.set3(x.data[O],x.data[O+1],x.data[O+2],R),this.applyVerticalOffsetTransformation(I,R,N,S,T),S.applyProjection(I,P),P[0]>-1){var M=Math.floor(P[0]),U=Math.floor(P[1]);c.applyPrecomputedScaleFactorVec2(k,T.factor,k);var z=M-j-(C[0]>0?k[0]*C[0]:0),B=z+k[0]+2*j,G=U-j-(C[1]>0?k[1]*C[1]:0),H=G+k[1]+2*j;if(d.textureIsSignedDistanceField){var W=d.outlineSize/2,q=d.distanceFieldBoundingBox;z+=k[0]*q[0],G+=k[1]*q[1],B-=k[0]*(1-q[2]),H-=k[1]*(1-q[3]),z-=W,B+=W,G-=W,H+=W}if(w[0]>z&&w[0]<B&&w[1]>G&&w[1]<H){var $=n.p0,Y=n.p1;_.multiplyVec3(_.inverse(S.viewMatrix,F),I,L),P[0]=w[0],P[1]=w[1],S.unprojectPoint(P,I);var Q=y.negate(n.getDirection(),y.create());s(y.dist($,I)/y.dist($,Y),Q,-1,1,!0,L)}}}}},t.prototype.normalAndViewAngle=function(e,t,r,n){return void 0===n&&(n=U),b.multiplyVec3(t,e,n.normal),_.multiplyVec3(r.viewInverseTransposeMatrix,n.normal),n.cosAngle=y.dot(M,z),n},t.prototype.updateScaleInfo=function(e,t,r){var n=this.params;n.screenSizePerspective?e.factor=c.precomputeScaleFactor(U.cosAngle,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?(e.scaleAlignment=c.precomputeScale(U.cosAngle,r,n.screenSizePerspectiveAlignment),e.minPixelSizeAlignment=n.screenSizePerspectiveAlignment.parameters.minPixelSize):(e.scaleAlignment=e.factor.scale,e.minPixelSizeAlignment=e.factor.minPixelSize)},t.prototype.applyVerticalOffsetTransformation=function(e,t,r,n,i,o){var a=this.params;if(16===r.length&&(r=_.toMat3(r,N)),!a.verticalOffset||!a.verticalOffset.screenLength){if(i&&(a.screenSizePerspective||a.screenSizePerspectiveAlignment)){var s=this.normalAndViewAngle(t,r,n),l=y.length(e);this.updateScaleInfo(i,s.cosAngle,l)}else i&&(i.factor.scale=1,i.scaleAlignment=1);return o?y.set(e,o):e}var u=this.normalAndViewAngle(t,r,n),d=y.length(e),c=a.screenSizePerspectiveAlignment||a.screenSizePerspective,p=h.verticalOffsetAtDistance(n,d,a.verticalOffset,u.cosAngle,c);return i&&this.updateScaleInfo(i,u.cosAngle,d),y.add(e,y.scale(u.normal,p),o)},t.prototype.getGLMaterials=function(){return{color:E,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:A}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.setTextureDirty=function(){this._textureDirty=!0},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=i.create()),function(e,t,r,n){void 0===n&&(n=O),g.set(e.anchorPos,n),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*r,n[1]+=e.screenOffset[1]*r}(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t.prototype.calculateAnchorPosForRendering=function(e){return v(this.params,e)},t.loadShaders=function(e,t,r){e._parse(n);var i=function(e){e.addDefine("OcclTest","OCCL_TEST"),e.addDefine("SDF","SIGNED_DISTANCE_FIELD"),e.addDefine("vvSize","VV_SIZE"),e.addDefine("vvColor","VV_COLOR"),e.addDefine("verticalOffset","VERTICAL_OFFSET"),e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),e.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},o=new p("hud",["vertexShaderHUD","fragmentShaderHUD"],null,t,e,r);i(o),o.addDefine("debugDrawBorder","DEBUG_DRAW_BORDER"),t.addShaderVariations("hud-material-shader-variations",o);var a=new p("hudHighlight",["vertexShaderHUD","fragmentShaderHUDHighlight"],null,t,e,r);i(a),a.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION"),t.addShaderVariations("hud-material-highlight-shader-variations",a);var s=new p("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,t,e,r);s.addDefine("verticalOffset","VERTICAL_OFFSET"),s.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),s.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN"),t.addShaderVariations("hud-material-occlusion-test-pixel-shader-variations",s)},t.shouldRenderVisibilityDuringRenderPass=function(e){return e===u.MATERIAL||u.MATERIAL_HIGHLIGHT},t}(l),D=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParams().textureId)||this;return i.params=h.copyParameters(t.getParams()),i.selectProgram(),i.selectSlot(),i}return r(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?d.HUDMATERIAL2:d.HUDMATERIAL1},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.color=e.color,t.texCoordScale=e.texCoordScale,t.polygonOffset=e.polygonOffset,t.anchorPos=e.anchorPos,t.screenOffset=e.screenOffset,t.verticalOffset=e.verticalOffset,t.screenSizePerspective=e.screenSizePerspective,t.screenSizePerspectiveAlignment=e.screenSizePerspectiveAlignment,t.shaderPolygonOffset=e.shaderPolygonOffset,t.textureIsSignedDistanceField=e.textureIsSignedDistanceField,t.outlineColor=e.outlineColor,t.outlineSize=e.outlineSize,t.vvSizeEnabled=e.vvSizeEnabled,t.vvSizeMinSize=e.vvSizeMinSize,t.vvSizeMaxSize=e.vvSizeMaxSize,t.vvSizeOffset=e.vvSizeOffset,t.vvSizeFactor=e.vvSizeFactor,t.vvColorEnabled=e.vvColorEnabled,t.vvColorValues=e.vvColorValues,t.vvColorColors=e.vvColorColors,this.updateTexture(e.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bindRender=function(e,t){var r=this.params,n=this.getProgram();this.bindTexture(e,n),n.setUniform1i("hudVisibilityTexture",1),e.bindTexture(t.hudVisibilityTexture,1),e.setActiveTexture(0),n.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===t.renderTransparentlyOccludedHUD?1:"notOccluded"===t.renderTransparentlyOccludedHUD?0:.75),n.setUniform4fv("overrideColor",r.color),n.setUniform1f("pixelRatio",t.pixelRatio),r.textureIsSignedDistanceField&&(n.setUniform4fv("outlineColor",r.outlineColor),n.setUniform1f("outlineSize",r.outlineSize)),r.vvSizeEnabled&&(n.setUniform3fv("vvSizeMinSize",r.vvSizeMinSize),n.setUniform3fv("vvSizeMaxSize",r.vvSizeMaxSize),n.setUniform3fv("vvSizeOffset",r.vvSizeOffset),n.setUniform3fv("vvSizeFactor",r.vvSizeFactor)),r.vvColorEnabled&&(n.setUniform1fv("vvColorValues",r.vvColorValues),n.setUniform4fv("vvColorColors",r.vvColorColors)),n.setUniform2fv("texScale",r.texCoordScale),n.setUniform2f("screenOffset",2*r.screenOffset[0],2*r.screenOffset[1]),n.setUniform2fv("anchorPos",v(r)),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setBlendingEnabled(!0),e.setBlendFunction(1,771)},t.prototype.bindProjection=function(e,t){this.material._textureDirty&&(this.renderTexture(e),this.material._textureDirty=!1);var r=t.cameraAboveGround?1:-1,n=this.getProgram(),i=this.params;e.bindProgram(n),n.setUniform1f("cameraGroundRelative",r),n.setUniform1f("polygonOffset",i.shaderPolygonOffset),n.setUniform4fv("viewport",t.viewport),h.bindVerticalOffset(i.verticalOffset,t,n),n.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.screenSizePerspective&&(h.bindScreenSizePerspective(i.screenSizePerspective,n,"screenSizePerspective"),h.bindScreenSizePerspective(i.screenSizePerspectiveAlignment||i.screenSizePerspective,n,"screenSizePerspectiveAlignment"))},t.prototype.releaseRender=function(e){e.setPolygonOffsetFillEnabled(!1),e.setBlendFunction(770,771),e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){var r=t.origin,n=this.getProgram();h.bindView(r,t.view,n),h.bindCamPos(r,t.viewInvTransp,n)},t.prototype.bindInstance=function(e,t){var r=this.getProgram();r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(s),E=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this;return i.isOcclusionSlot=!1,i}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram("hud-material-occlusion-test-pixel-shader-variations",[!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits]),this.program=this.programRep.getShaderVariationsProgram("hud-material-shader-variations",[e.occlusionTest,e.textureIsSignedDistanceField,!!e.vvSizeEnabled,!!e.vvColorEnabled,!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits,!!e.debugDrawBorder])},t.prototype.getDrawMode=function(e){var t=e.gl;return this.isOcclusionSlot?t.POINTS:t.TRIANGLES},t.prototype.release=function(e){var t=e.gl;e.setDepthFunction(t.LESS),this.isOcclusionSlot||this.releaseRender(e)},t.prototype.bind=function(e,t){var r=e.gl;this.bindProjection(e,t);var n=this.getProgram();e.setDepthTestEnabled(!0),e.setDepthFunction(r.LEQUAL),this.isOcclusionSlot?n.setUniform4f("color",1,1,1,1):(this.bindRender(e,t),this.bindTexture(e,n))},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program},t.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=e===d.OCCLUSION_PIXELS,e===d.OCCLUSION_PIXELS||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t}(D),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getShaderVariationsProgram("hud-material-highlight-shader-variations",[e.occlusionTest,e.textureIsSignedDistanceField,!!e.vvSizeEnabled,!!e.vvColorEnabled,!!e.verticalOffset,!!e.screenSizePerspective,"screen"===e.centerOffsetUnits,e.binaryHighlightOcclusion])},t.prototype.bind=function(e,t){this.bindProjection(e,t),this.bindRender(e,t)},t.prototype.release=function(e){this.releaseRender(e)},t}(D),T={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},O=[0,0],I=y.create(),R=y.create(),P=y.create(),M=y.create(),L=y.create(),N=b.create(),F=_.create(),U={normal:M,cosAngle:0},V=_.create();_.identity(V);var j=1,k=[0,0],z=[0,0,1];return C}.apply(null,n))||(e.exports=i)},1319:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=!!Map.prototype.entries;t.forEachUntilMap=r?function(e,t){for(var r=e.entries();;){var n=r.next();if(n.done)break;if(!1===t(n.value[1],n.value[0]))return!1}return!0}:function(e,t){var r=!0;return e.forEach(function(e,n){r&&(r=!1!==t(e,n))}),r}}.apply(null,n))||(e.exports=i)},1320:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1294)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new r;t.generateHighlightId=function(){return n.gen("highlight")}}.apply(null,n))||(e.exports=i)},1322:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1278)],void 0===(i=function(e,t,r){var n=r.vec3d,i=r.mat4d;return function(){function e(e,t,r,i,o,a,s,l,u,d,c){this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=r,this.origin=null,this.center=n.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=o,i&&this.updateTransformation(i,a),this.castShadow=s,this.singleUse=l,this.name=u,this.uniqueName=d,this.idx=c,this.canBeMerged=!0,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,r){return t=t||i.maxScale(e),i.multiplyVec3(e,this.boundingInfo.getCenter(),r),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=i.create()),i.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation},e}()}.apply(null,n))||(e.exports=i)},1323:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(23)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.when=function e(t,n){if(Array.isArray(n)){var i=new r;return t(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.resolve(e)}),i.promise}return e(t,[n]).then(function(e){return e[0]})},t.getAbsMid=function(e,t,r){return t.toAbsMid?t.toAbsMid(e):r.id.replace(/\/[^\/]*$/gi,"/")+e}}.apply(null,n))||(e.exports=i)},1325:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(6),r(15),r(1),r(412),r(1299)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return i.create(function(t,r){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var n=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);n?r(n):t()})})},n([a.property()],t.prototype,"view",void 0),n([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(l))}.apply(null,n))||(e.exports=i)},1328:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1354)],void 0===(i=function(e,t,r){return function(){function e(e){this._filterSampleIndex=0,this._lastTime=NaN,this._totalTime=0,this._numMeasurements=0,this._filterSamples=new Array(e),this.reset(),this._filterSize=e}return e.prototype.reset=function(){this._filterSampleIndex=0;for(var e=0;e<this._filterSize;e++)this._filterSamples[e]=NaN},e.prototype.start=function(){this._tsStart=r.now()},e.prototype.stop=function(){var e=r.now();return this._lastTime=e-this._tsStart,this._totalTime+=this._lastTime,this._numMeasurements++,this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize),this._lastTime},e.prototype.getLast=function(){return this._lastTime},e.prototype.getLastFiltered=function(){for(var e=0,t=0;t<this._filterSamples.length;t++)e+=this._filterSamples[t];return e/this._filterSamples.length},e.prototype.getAverage=function(){return this._totalTime/this._numMeasurements},e.prototype.getTotal=function(){return this._totalTime},e.prototype.getNumMeasurements=function(){return this._numMeasurements},e}()}.apply(null,n))||(e.exports=i)},1329:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(153),r(1278),r(1296),r(1361),r(1322),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=s.assert,u=n.vec3d,d=n.mat4d,c=s.logWithBase;return function(){function e(){for(var e in this.dirtySet=new o(this),this._uniqueIdx=0,this._id2origin={},this.content={},i)this.content[i[e]]={}}return e.prototype.getAll=function(e){var t=this.content[e];return l(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e)[t]},e.prototype.add=function(e,t){var r=this.content[e];l(void 0!==r);var n=t.id;l(null==r[n],"Model/Stage already contains object to be added"),r[n]=t,e===i.LAYER&&this.notifyDirty(e,t,"layerAdded")},e.prototype.remove=function(e,t){var r=this.content[e];l(void 0!==r);var n=r[t];return l(void 0!==n,"Model/Stage doesn't contain object to be removed"),delete r[t],e===i.TEXTURE&&n.unload(),e===i.LAYER&&this.notifyDirty(e,n,"layerRemoved"),n},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,r,n){this.dirtySet.handleUpdate(t,r,n)},e.prototype.getOrigin=function(e,t,r){void 0===r&&(r=10);var n=0,i=t*r/1e4;i>1&&(n=Math.ceil(c(i,2)));var o=1e4*Math.pow(2,n),a=Math.round(e[0]/o),s=Math.round(e[1]/o),l=Math.round(e[2]/o),d=n+"_"+a+"_"+s+"_"+l,p=this._id2origin[d];return null==p&&(p={vec3:u.createFrom(a*o,s*o,l*o),id:d},this._id2origin[d]=p),p},e.prototype.getGeometryRenderGeometries=function(e,t,r){var n=e.id,i=t.geometry,o=i.getData(),s=!!i.singleUse,l=t.materials,u=t.instanceParameters,c=e.getCombinedStaticTransformation(t),p=d.maxScale(c),f=t.origin,h=i.getBoundingInfo(),m=t.id,v=this._uniqueIdx++,g=new a(o,h,l[0],c,t.customTransformation,p,e.getCastShadow(),s,n,m,v);g.origin=f||this.getOrigin(g.center,g.bsRadius),g.instanceParameters=u,r.push(g)},e.prototype.updateRenderGeometryTransformation=function(e,t,r){e.getCombinedStaticTransformation(t,r.transformation),r.updateTransformation(r.transformation)},e.prototype.formatDebugInfo=function(e){var t=[];if(e){for(var n in t[0]="<table>",i){var o=i[n];t[0]+="<tr><td>"+o+'</td><td style="text-align: right">'+Object.keys(this.getAll(o)).length+"</td></tr>"}t[0]+="</table>",t[1]=this.dirtySet.formatDebugInfo(!0)}else{for(var n in t[0]="",i){o=i[n];t[0]+=r.pad(String(Object.keys(this.getAll(o)).length),6," ")+" "+o+", "}t[1]=this.dirtySet.formatDebugInfo(!1)}return t},e.prototype.validateContent=function(){var e=this.getAll(i.OBJECT);for(var t in e)this.validateObject(e[t]);var r=this.getAll(i.LAYER);for(var n in r)this.validateLayer(r[n]);var o=this.getAll(i.MATERIAL);for(var a in o)this.validateMaterial(o[a])},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,r=0;r<t.length;++r){var n=t[r];l(null!=this.get(i.GEOMETRY,n.geometry.id)),l(1===n.materials.length,"object materials do not match geometry groups"),l(null!=this.get(i.MATERIAL,n.materials[0].id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),r=0;r<t.length;++r){var n=this.get(i.OBJECT,t[r].id);l(null!=n)}},e.prototype.validateMaterial=function(e){for(var t=e.getAllTextureIds(),r=0;r<t.length;++r){var n=this.get(i.TEXTURE,t[r]);l(null!=n)}},e.ContentType=i,e}()}.apply(null,n))||(e.exports=i)},1330:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1363),r(1282),r(1278),r(1293),r(1277),r(1285),r(1283),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){return function(){function e(e,t,r){this._quadVAO=null,this._rctx=r,this._colorFBO=void 0,this._viewportToRestore=i.vec4d.create(),this.programRep=e}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){a.assert(this.enabled);var t=e.fullViewport;this._viewportToRestore=t,this._width=t[2],this._height=t[3],this._rctx.setViewport(0,0,this._width,this._height)},e.prototype.prepareColorPass=function(){a.assert(this.enabled);var e=this._rctx,t=e.gl;this._colorFBO.resize(this._width,this._height),e.bindFramebuffer(this._colorFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])},e.prototype.apply=function(){var e=this._rctx,t=this.programRep.get("render-occluded-apply");e.bindProgram(t),e.bindVAO(this._quadVAO),e.bindTexture(this._colorFBO.colorTexture,0),t.setUniform1i("occludedColorMap",0),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunction(770,771),e.drawArrays(5,0,u.vertexCount(this._quadVAO,"geometry")),e.bindVAO(null),e.setDepthWriteEnabled(!0),e.setDepthTestEnabled(!0),e.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._quadVAO=o.createQuadVAO(this._rctx),this._colorFBO=s.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)},e.loadShaders=function(e,t,i){e._parse(r),t.add("render-occluded-apply",new l(i,e.vsRenderOccludedApply,e.fsRenderOccludedApply,n.Default3D))},e}()}.apply(null,n))||(e.exports=i)},1331:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1319),r(1290),r(1282),r(1366),r(1367),r(1368),r(1278),r(1369),r(1370),r(1371),r(1372),r(1373),r(1365),r(1297),r(1281),r(1374),r(1375),r(1277),r(1332),r(1387),r(1316),r(1287),r(1391),r(1280),r(1279),r(1286)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g,y,b,_,x,w,S,C,D,E,A){function T(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,r=e.componentOffsets;return n.generateVisibleIndexRanges(t,r)}function O(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,r=e.instanceParameters.componentHighlights,i=e.componentOffsets;return n.generateHighlightedIndexRanges(t,r,i)}function I(e,t,r){var n=e.origin.vec3;b.setMatrixTranslation3(H,-n[0],-n[1],-n[2]),F.multiply(H,e.transformation,t),F.inverse(t,r),F.transpose(r)}function R(e,t,r){for(var n in e){var i=e[n];t(n,i),i.origin2data.forEach(function(e,t){r(t,e)})}}function P(e){return M(e.data)>=1}function M(e){return!1===e.preinterleaved?b.getFirstObjectValue(e.indices).length:e.indexCount}var L,N=l.vec2d,F=l.mat4d,U=F.identity(),V=1535,j=function(){function e(e,t,r,n,i){this._lighting=new x.SceneLighting,this._mat2DataMerged={},this._mat2DataInstanced={},this._mat2DataPreinterleaved={},this._renderOrder=[],this._externalRenderers=new o,this._renderContext=new h,this._isRendering=!1,this._highlights=[],this._pixelRatio=1,this._threshold=V,this._needsRender=!0,this._fallbackDepthStencilTexture=null,this._stats=new k,this._edgeView=null,this._edgeViewLoaded=!1,this.ssaoEnabled=!1,this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1},this._programRep=e,this._materialRep=t,this._orderedRendering=i,this._rctx=n,this._fxaaPass=new s(n),this._smaaPass=new g(n),this._renderContext.rctx=n,this._renderContext.lightingData=this._lighting.getOld(),n.setDepthTestEnabled(!0),n.setFaceCullingEnabled(!0),n.setBlendingEnabled(!1),n.setBlendFunctionSeparate(770,771,1,771),this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null},this._linearDepthTextureHelper=new p(n),this._normalTextureHelper=new f(n),this._highlightTextureHelper=new u(n),this._stencilRenderingHelper=new y(n),this._initializeFramebufferTexture()}return e.prototype._initializeFramebufferTexture=function(){var e=this._rctx.gl,t=this._rctx.contextAttributes.alpha?e.RGBA:e.RGB,r=new D(this._rctx,{target:3553,pixelFormat:t,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:t,texture:r}},e.prototype.dispose=function(){var e=this,t=function(t){e._releaseMaterials(t)},r=function(e,t){if(t.type===L.Preinterleaved)for(var r in t.instances)t.instances[r].vao.dispose(!0);else t.vao.dispose(!0)};R(this._mat2DataMerged,t,r),R(this._mat2DataInstanced,t,r),R(this._mat2DataPreinterleaved,t,r),this._mat2DataMerged=null,this._mat2DataInstanced=null,this._mat2DataPreinterleaved=null,this._framebuffer.texture.dispose(),this._framebuffer.texture=null,this._linearDepthTextureHelper.enabled=!1,this._normalTextureHelper.enabled=!1,this._highlightTextureHelper.enabled=!1,this._stencilRenderingHelper.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeView",{get:function(){var e=this;return this._edgeViewLoaded||(this._edgeViewLoaded=!0,_.EdgeView.isSupported(this._rctx)&&(this._edgeView=new _.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){e._needsRender=!0}}),this._edgeView.initialize())),this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},e.prototype.setPixelRatio=function(e){this._pixelRatio=e,this._needsRender=!0},e.prototype.getPixelRatio=function(){return this._pixelRatio},e.prototype.addExternalRenderer=function(e,t){return this._externalRenderers.addRenderer(e,t),!0},e.prototype.removeExternalRenderer=function(e){return this._externalRenderers.removeRenderer(e),!0},e.prototype.getExternalRenderers=function(){return this._externalRenderers},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._externalRenderers.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._externalRenderers.needsRender()},e.prototype.getCombinedStats=function(){var e=this;this._stats.VBOallocatedSize=0,this._stats.VBOoptimalSize=0,this._stats.VBOusedSize=0;var t=function(){},r=function(t,r){if(r.type===L.Preinterleaved)for(var n in r.instances){var i=r.instances[n].vao.size;e._stats.VBOallocatedSize+=i/4,e._stats.VBOusedSize+=i/4,e._stats.VBOoptimalSize+=i/4}else e._stats.VBOallocatedSize+=r.buffer.getArray().length,e._stats.VBOusedSize+=r.buffer.getSize(),e._stats.VBOoptimalSize+=r.optimalCount};return R(this._mat2DataMerged,t,r),R(this._mat2DataInstanced,t,r),R(this._mat2DataPreinterleaved,t,r),this._stats.VBOallocatedSize*=4/1024,this._stats.VBOusedSize*=4/1024,this._stats.VBOoptimalSize*=4/1024,this._stats},e.prototype._addHighlight=function(e){var t=this._getInstance(e);null!==t?(this._highlights.push(t),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)):console.error("No instance found for RenderGeometry {name: '"+e.name+"', uniqueName: '"+e.uniqueName+"'}")},e.prototype._removeHighlight=function(e){var t=this._highlights.length;this._highlights=this._highlights.filter(function(t){return t.uniqueName!==e.uniqueName}),t!==this._highlights.length&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights),this._needsRender=!0)},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlights.length>0},enumerable:!0,configurable:!0}),e.prototype._renderHUDVisibility=function(e){var t=this,r=w.shouldRenderVisibilityDuringRenderPass(e.pass),n=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,i=!1;return r&&n&&e.offscreenRenderingHelper.renderHUDVisibility(function(){i=t._renderInternalSlot(v.OCCLUSION_PIXELS,e)}),i},e.prototype.renderGeometrySlotsPt1=function(e){this._externalRenderers.render(v.INTERNAL_MATERIAL,e),this._renderInternalSlot(v.STENCIL_MATERIAL,e),this._externalRenderers.render(v.OPAQUE_TERRAIN,e),this._renderInternalSlot(v.OPAQUE_MATERIAL,e),this._externalRenderers.render(v.OPAQUE_EXTERNAL,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep),this._externalRenderers.render(v.POSTPROCESSING_ATMOSPHERE_OPAQUE,this._renderContext),this._renderInternalSlot(v.TRANSPARENT_MATERIAL,e),this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(e),this._renderInternalSlot(v.LINE_CALLOUTS,this._renderContext)),this._externalRenderers.render(v.TRANSPARENT_EXTERNAL,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep)},e.prototype.renderTransparentTerrain=function(e){return this._externalRenderers.render(v.TRANSPARENT_TERRAIN,e)},e.prototype.renderGeometrySlots=function(e){this.renderGeometrySlotsPt1(e),this.renderTransparentTerrain(e)},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(v.LINE_CALLOUTS_HUD_DEPTH,this._renderContext),this._renderInternalSlot(v.HUDMATERIAL1,this._renderContext),this._renderInternalSlot(v.HUDMATERIAL2,this._renderContext)},e.prototype._renderHighlights=function(e,t,r){var n=!!r&&r.enabled&&(this.hasHighlights||this._externalRenderers.needsHighlight());if(this._highlightTextureHelper.enabled=n,n){var i=null;r.profilingCallback&&(i=C.startMeasurement(this._renderContext.rctx)),this._highlightTextureHelper.setupFBOs(e),this._highlightTextureHelper.prepareHighlightPass(),this.renderGeometryPass(m.MATERIAL_HIGHLIGHT,e,null,null);var o=this._rctx.gl;this._rctx.clear(o.DEPTH_BUFFER_BIT),this.renderHUD("both"),this._highlightTextureHelper.finish(t);var a=this._highlightTextureHelper.framebuffer;r.render(e,t,a),null!==i&&r.profilingCallback&&i.stop(function(e){r.profilingCallback&&r.profilingCallback(e)})}},e.prototype._needsRenderOccluded=function(e){for(var t in this._mat2DataInstanced){var r=this._mat2DataInstanced[t][0];if(r&&r.renderOccluded&&r.beginSlot(e)&&r.isVisible())return!0}return!1},e.prototype._renderOccluded=function(e,t,r){if(t&&r&&r.enabled){var n=this._needsRenderOccluded(v.OPAQUE_MATERIAL)||this._needsRenderOccluded(v.TRANSPARENT_MATERIAL);if(t.enabled=n,n){var i=this._renderContext;t.setupFBOs(e),t.prepareColorPass(),i.pass=m.MATERIAL,i.renderOccludedOnly=!0,this._renderInternalSlot(v.OPAQUE_MATERIAL,i),this._renderInternalSlot(v.TRANSPARENT_MATERIAL,i),i.renderOccludedOnly=!1,t.finish(r.framebuffer),t.apply()}}},e.prototype._renderUnordered=function(e,t,r,n){var i=this,o=this._rctx;this._isRendering=!0,this._stats.reset(),this._updateGlobalUniforms(e.projectionMatrix),this._renderContext.pass=m.MATERIAL,this._renderContext.camera=e,this._renderContext.pixelRatio=this._pixelRatio,this._renderContext.shadowMap=t,this._renderContext.ssaoHelper=n.ssao,this._renderContext.offscreenRenderingHelper=n.offscreenRendering,this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.highlight=this._highlightTextureHelper.framebuffer,this._renderContext.options=this.renderOptions,n.offscreenRendering.enabled=!0,n.offscreenRendering.initializeFrame(e),this._externalRenderers.render(v.BACKGROUND,this._renderContext),this.renderGeometrySlotsPt1(this._renderContext),this._edgeView&&this.edgeView.shouldRender()&&n.offscreenRendering.renderSeparateAndComposite(function(){i._edgeView.render(i._bindParameters)},void 0,"alpha");var a={hudVisibility:!1,transparentTerrain:!1};this.renderOptions.earlyOcclusionPixelDraw||(a.hudVisibility=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(v.LINE_CALLOUTS,this._renderContext)),a.transparentTerrain=this.renderTransparentTerrain(this._renderContext),a.transparentTerrain&&a.hudVisibility&&(n.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),n.offscreenRendering.renderToTargets(function(){return i.renderHUD("occluded")},n.offscreenRendering.mainColor,n.offscreenRendering.tmpDepth,void 0,!0)),a.transparentTerrain&&n.offscreenRendering.compositeTransparentTerrainOntoMain(),n.offscreenRendering.renderToTargets(function(){i._externalRenderers.render(v.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,i._renderContext),i._externalRenderers.render(v.POSTPROCESSING_EXTERNAL,i._renderContext),i._renderOccluded(e,n.renderOccluded,n.offscreenRendering)},n.offscreenRendering.mainColor,n.offscreenRendering.mainDepth);var s=this.renderOptions.antialiasing;"smaa"===s&&this._smaaPass.loadResources(function(){i._needsRender=!0}),"smaa"===s&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:n.offscreenRendering.colorTexture},null)):"fxaa"===s&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:n.offscreenRendering.colorTexture},null)):(n.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()),o.bindFramebuffer(null),this._renderContext.framebufferTex=n.offscreenRendering.colorTexture,this.renderHUD("notOccluded"),this._renderHighlights(e,r,n.highlight),this._isRendering=!1},e.prototype._renderGeometryPassOrderedHighlight=function(e){this._renderInternalHighlights(this._highlights)},e.prototype._renderGeometryPassOrderedMaterial=function(e){for(var t=null,r=0;r<this._renderOrder.length;r++){var n,i,o=this._renderOrder[r][1];if(o.instanced)(i=(n=o.instanced||o.merged)[e.pass])&&i.isVisible()&&(this._renderInternalInstanced(n,i,this._bindParameters,1/0),t=null);if(o.merged)if((i=(n=o.merged)[e.pass])&&i.isVisible()){var a=i.getProgram();a!==t&&(a.setUniformMatrix4fv("model",U),a.hasUniform("modelNormal")&&a.setUniformMatrix4fv("modelNormal",U)),t=a,this._renderInternalMerged(n,i,this._bindParameters,1/0)}}},e.prototype._renderGeometryPassOrdered=function(e){var t=e.camera;this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,G[0]=t.near,G[1]=t.far,this._bindParameters.nearFar=G,this._bindParameters.lightingData=e.lightingData,this._bindParameters.viewport=t.fullViewport,this._bindParameters.framebufferTex=this._framebuffer.texture,this._bindParameters.pixelRatio=e.pixelRatio,e.isHighlightPass?this._renderGeometryPassOrderedHighlight(e):this._renderGeometryPassOrderedMaterial(e)},e.prototype._renderOrdered=function(e,t){this._stats.reset(),this.renderGeometryPass(e,t)},e.prototype.prepareRender=function(e){this._externalRenderers.prepareRender(e),this._renderContext.rctx.setDepthFunction(513)},e.prototype.render=function(e,t,r){this._orderedRendering?this._renderOrdered(m.MATERIAL,e):this._renderUnordered(e,r.shadowMap,t,r)},e.prototype.renderAuxiliaryBuffers=function(e,t,r){var n=r.ssao,i=r.shadowMap,o=this.ssaoEnabled||this._externalRenderers.needsLinearDepth();this._linearDepthTextureHelper.enabled=o,o&&(this._linearDepthTextureHelper.setupFBOs(e),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(m.MATERIAL_DEPTH,e,i,n),this._linearDepthTextureHelper.finish(t)),this._normalTextureHelper.enabled=this.ssaoEnabled,this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(e),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(m.MATERIAL_NORMAL,e,i,n),this._normalTextureHelper.finish(t)),this.ssaoEnabled&&n.computeSSAO(e,t,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer),n.bindAll(this._programRep)},e.prototype.renderGeometryPass=function(e,t,r,n){this._isRendering=!0,this._updateGlobalUniforms(t.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=t,this._renderContext.pixelRatio=this._pixelRatio,this._renderContext.shadowMap=r,this._renderContext.ssaoHelper=n,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext),this._isRendering=!1},e.prototype._renderGeometryPassUnordered=function(e){this.renderGeometrySlots(e)},e.prototype._renderInternalHighlights=function(e,t){void 0===t&&(t=null);for(var r=!1,n=0;n<e.length;++n){var i=e[n],o=i.matData[m.MATERIAL_HIGHLIGHT];o&&(null===t||o.beginSlot(t))&&o.isVisible()&&(r=this._renderInternalHighlight(i,this._bindParameters,m.MATERIAL_HIGHLIGHT)||r)}return r},e.prototype._renderInternalSlotOccluded=function(e,t){var r=!1;for(var n in this._mat2DataInstanced){var i=this._mat2DataInstanced[n],o=i[t.pass];o&&o.renderOccluded&&o.beginSlot(e)&&o.isVisible()&&(r=this._renderInternalInstanced(i,o,this._bindParameters,e)||r)}return r},e.prototype._renderInternalSlotMaterial=function(e,t){var r=!1;for(var n in this._mat2DataInstanced){(u=(l=this._mat2DataInstanced[n])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalInstanced(l,u,this._bindParameters,e)||r)}for(var i=this._programRep.getProgramsUsingUniform("model"),o=this._programRep.getProgramsUsingUniform("modelNormal"),a=0;a<i.length;a++){var s=i[a];s.setUniformMatrix4fv("model",U),o.indexOf(s)>-1&&s.setUniformMatrix4fv("modelNormal",U)}for(var n in this._mat2DataMerged){(u=(l=this._mat2DataMerged[n])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalMerged(l,u,this._bindParameters,e)||r)}for(var n in this._mat2DataPreinterleaved){var l,u;(u=(l=this._mat2DataPreinterleaved[n])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalPreinterleaved(l,u,this._bindParameters,e)||r)}return e===v.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish(),r},e.prototype._renderInternalSlotHighlights=function(e,t){return this._renderInternalHighlights(this._highlights,e)},e.prototype._renderInternalSlot=function(e,t){this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,G[0]=t.camera.near,G[1]=t.camera.far;var r=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=G,this._bindParameters.lightingData=t.lightingData,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.framebufferTex=r?r.colorTexture:null,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.pixelRatio,this._bindParameters.hudVisibilityTexture=r?r.hudVisibilityTexture:null,t.isHighlightPass?this._renderInternalSlotHighlights(e,t):t.renderOccludedOnly?this._renderInternalSlotOccluded(e,t):this._renderInternalSlotMaterial(e,t)},e.prototype._renderInternalInstanced=function(e,t,r,n){var i=this,o=this._rctx,a=o.gl,s=!1,l=t.getDrawMode(o),u=o.capabilities.instancing,d=!1;return e.origin2data.forEach(function(e){r.origin=e.origin,n===v.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass());var c=!1;if(t.instanced)for(var p in e.perGeometryDataInfo){var f=e.perGeometryDataInfo[p];s||(t.bind(o,r),s=!0),o.bindVAO(f.vao);var h=t.getProgram();E.assertCompatibleVertexAttributeLocations(f.vao,h),c||(t.bindView(o,r),c=!0);var m=f.to-f.from,g=f.refCount;l===a.TRIANGLES&&(i._stats.trianglesRendered+=g*m/3),u.drawArraysInstanced(l,f.from,m,g),d=!0,i._stats.drawCallsAngleInstanced++,i._stats.instancesDrawnAngle+=g}else{var y=e.instances;for(var b in y){var _=y[b],x=_.displayedIndexRange;x&&0===x.length||(s||(t.bind(o,r),s=!0),c||(o.bindVAO(e.vao),t.bindView(o,r),c=!0),t.bindInstance(o,_),i._stats.drawCallsInstanced++,l===a.TRIANGLES&&(i._stats.trianglesRendered+=(_.to-_.from)/3),x?i._drawArraysFaceRange(x,_.from,l):o.drawArrays(l,_.from,_.to-_.from),d=!0)}}}),o.bindVAO(null),s&&t.release(o,r),d},e.prototype._renderInternalHighlight=function(e,t,r){var n=this._rctx,i=n.gl,o=e.matData[r],a=o.getDrawMode(n),s=e.instance,l=s.highlightedIndexRange,u=this._renderContext.offscreenRenderingHelper,d=(u?u.depthTexture:null)||this._getFallbackDepthTexture(),c=o.getProgram(),p=n.capabilities.instancing;t.origin=e.originData.origin;var f=!1;if(o.instanced&&e.type===L.Instanced){var h=e.instancedVAO;o.bind(n,t),n.bindVAO(h),E.assertCompatibleVertexAttributeLocations(h,c),o.bindView(n,t);for(var m=0;m<l.length;m++){var v=(_=l[m]).range?_.range[0]+s.from:s.from,g=_.range?_.range[1]-_.range[0]+1:s.to-s.from;n.bindTexture(d,5),c.setUniform1i("depthTex",5),c.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),p.drawArraysInstanced(a,v,g,1),a===i.TRIANGLES&&(this._stats.trianglesRendered+=1*g/3),this._stats.drawCallsHighlight++,f=!0}}else if(e.type===L.Instanced&&o.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{o.bind(n,t),o.bindView(n,t);var y=null;switch(e.type){case L.Merged:var b=e.originData;n.bindVAO(b.vao),c.setUniformMatrix4fv("model",U);break;case L.Instanced:b=e.originData;n.bindVAO(b.vao),o.bindInstance(n,s);break;case L.Preinterleaved:h=(b=e.originData).instances[e.uniqueName].vao;n.bindVAO(h),o.bindInstance(n,s),y=h.indexBuffer&&h.indexBuffer.indexType}for(m=0;m<l.length;m++){var _;v=(_=l[m]).range?_.range[0]+s.from:s.from,g=_.range?_.range[1]-_.range[0]+1:s.to-s.from;if(n.bindTexture(d,5),o.getProgram().setUniform1i("depthTex",5),c.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),y){var x=E.getBytesPerElement(y);n.drawElements(a,g,y,v*x)}else n.drawArrays(a,v,g);a===i.TRIANGLES&&(this._stats.trianglesRendered+=g/3),this._stats.drawCallsHighlight++,f=!0}}return n.bindVAO(null),o.release(n,t),f},e.prototype._drawArraysFaceRange=function(e,t,r){for(var n=this._rctx,i=0,o=e;i<o.length;i++){var a=o[i];n.drawArrays(r,a[0]+t,a[1]-a[0]+1)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._drawElementsFaceRange=function(e,t,r,n){for(var i=this._rctx,o=E.getBytesPerElement(n),a=0,s=e;a<s.length;a++){var l=s[a],u=l[1]-l[0]+1,d=l[0]+t;i.drawElements(r,u,n,d*o)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._renderInternalMerged=function(e,t,r,n){var i=this,o=this._rctx,a=o.gl,s=!1,l=!1;return e.origin2data.forEach(function(e){if(r.origin=e.origin,n===v.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass()),!e.displayedIndexRange||0!==e.displayedIndexRange.length){l||(t.bind(o,r),l=!0);var u=t.getProgram();o.bindVAO(e.vao),E.assertCompatibleVertexAttributeLocations(e.vao,u),t.bindView(o,r),i._stats.drawCallsMerged++;var d=t.getDrawMode(o);d===a.TRIANGLES&&(i._stats.trianglesRendered+=e.vao.vertexBuffers.geometry.size/3),e.displayedIndexRange?i._drawArraysFaceRange(e.displayedIndexRange,0,d):o.drawArrays(d,0,E.vertexCount(e.vao,"geometry")),s=!0}}),l&&t.release(o,r),s},e.prototype._renderInternalPreinterleaved=function(e,t,r,n){var i=this,o=this._rctx,a=o.gl,s=!1,l=!1,u=t.getDrawMode(o);return e.origin2data.forEach(function(e){r.origin=e.origin;var d=!1;for(var c in n===v.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass()),e.instances){var p=e.instances[c],f=p.instance,h=p.vao,m=f.displayedIndexRange;if(!m||0!==m.length){l||(t.bind(o,r),l=!0);var g=t.getProgram();E.assertCompatibleVertexAttributeLocations(h,g),o.bindVAO(h),d||(t.bindView(o,r),d=!0),t.bindInstance(o,f),i._stats.drawCallsPreinterleaved++,u===a.TRIANGLES&&(i._stats.trianglesRendered+=(f.to-f.from)/3);var y=h.indexBuffer&&h.indexBuffer.indexType;if(m)y?i._drawElementsFaceRange(m,f.from,u,y):i._drawArraysFaceRange(m,f.from,u);else if(y){var b=E.getBytesPerElement(y);o.drawElements(u,f.to-f.from,y,f.from*b)}else o.drawArrays(u,f.from,f.to-f.from);s=!0}}}),o.bindVAO(null),l&&t.release(o,r),s},e.prototype._updateGlobalUniforms=function(e){for(var t=this._programRep.getProgramsUsingUniform("proj"),r=0;r<t.length;r++)t[r].setUniformMatrix4fv("proj",e);if(this._lighting){t=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r]);t=this._programRep.getProgramsUsingUniform("lightDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r])}},e.prototype.print=function(){var e=Object.keys(this._mat2DataMerged).length,t=Object.keys(this._mat2DataInstanced).length,r=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+e+"/"+t+"/"+r);var n=0;R(this._mat2DataMerged,function(){},function(e,t){n+=Object.keys(t.instances).length});var i=0;R(this._mat2DataInstanced,function(){},function(e,t){i+=Object.keys(t.instances).length});var o=0;R(this._mat2DataPreinterleaved,function(){},function(e,t){o+=Object.keys(t.instances).length}),console.log("number of instances (merged/instanced/preinterleaved): "+n+"/"+i+"/"+o)},e.prototype.isEmpty=function(){for(var e in this._mat2DataInstanced){var t=this._mat2DataInstanced[e];if(!r.forEachUntilMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}for(var e in this._mat2DataMerged){t=this._mat2DataMerged[e];if(!r.forEachUntilMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}for(var e in this._mat2DataPreinterleaved){t=this._mat2DataPreinterleaved[e];if(!r.forEachUntilMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}return!0},e.prototype.modify=function(e,t,r,n){this._isRendering&&console.warn("Renderer.modify called while rendering");var i=[],o=[],a=[];this._classifyRenderGeometry(e,i,o,a);var s=[],l=[],u=[];this._classifyRenderGeometry(t,s,l,u);var d={};r&&this._performUpdates(r,d);var c=[];this._modifyMerged(i,s,c,d),this._modifyInstanced(o,l,c),this._modifyPreinterleaved(a,u,c),this._updateMergedFaceranges(d),this._releaseMaterials(c);var p=this._highlights.length;t&&t.length>0&&p>0&&(this._highlights=this._highlights.filter(function(e){return!t.some(function(t){return t.uniqueName===e.uniqueName})}),p!==this._highlights.length&&this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)),this._updateHighlightVAOs(),n&&this._modifyMaterials(n),this._needsRender=!0},e.prototype._classifyRenderGeometry=function(e,t,r,n){for(var i=0,o=e;i<o.length;i++){var a=o[i];if(P(a))switch(this._getType(a)){case L.Merged:t.push(a);break;case L.Instanced:r.push(a);break;case L.Preinterleaved:n.push(a)}}},e.prototype._performUpdates=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r],o=i.updateType,a=i.renderGeometry,s=this._getType(a)===L.Merged;if(P(a)){if(2&o&&this._updateFaceranges(a,t),32&o){var l=this._getInstance(a);l&&this._updateHighlightFaceranges(a,l.instance)}4&o||s&&16&o?this._updateVertexAttributes(a,!s):!s&&16&o&&this._updateInstanceTransformation(a)}}},e.prototype._updateFaceranges=function(e,t){var r,n,i=e.material.id,o=e.origin.id,a=this._getType(e);a===L.Preinterleaved?r=(n=this._getOriginData(a,i,o)).instances[e.uniqueName].instance:(r=(n=this._getOriginData(a,i,o)).instances[e.uniqueName])&&a===L.Merged&&(t[this._modifiedMergedFacerangesKey(i,o)]=n);r&&(r.displayedIndexRange=T(e),this._updateHighlightFaceranges(e,r))},e.prototype._updateHighlightFaceranges=function(e,t){if(t){var r=t.highlightedIndexRange,n=O(e);t.highlightedIndexRange=n,n&&!r?this._addHighlight(e):!n&&r&&this._removeHighlight(e)}},e.prototype._updateMergedFaceranges=function(e){for(var t in e){var r=e[t];r.displayedIndexRange=[];var n=r.instances,i=!0;for(var o in n){var a=n[o];a.displayedIndexRange?(r.displayedIndexRange.push.apply(r.displayedIndexRange,c.offsetIntervals(a.displayedIndexRange,a.from)),i=!1):r.displayedIndexRange.push([a.from,a.to-1])}r.displayedIndexRange=i?null:c.mergeIntervals(r.displayedIndexRange)}},e.prototype._updateVertexAttributes=function(e,t){var r=e.material,n=r.id,i=e.origin.id,o=E.getStride(r.getVertexBufferLayout())/4,a=this._getType(e);if(a!==L.Preinterleaved){var s,l,u=this._getOriginData(a,n,i),d=u.instances[e.uniqueName],c=u.buffer.getArray(),p=u.vao;t||(I(e,W,q),s=W,l=q),r.fillInterleaved(e.data,s,l,e.instanceParameters,c,d.from*o),b.assert(d.from+r.getOutputAmount(M(e.data))/o===d.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(c,d.from*o*4,d.from*o*4,d.to*o*4)}else console.error("Updating Preinterleaved geometry not supported")},e.prototype._updateInstanceTransformation=function(e){var t=this._getType(e),r=e.material.id,n=e.origin.id;if(t===L.Preinterleaved){I(e,(o=(i=this._getOriginData(t,r,n)).instances[e.uniqueName].instance).transformation,o.transformationNormal)}else{var i,o=(i=this._getOriginData(t,r,n)).instances[e.uniqueName],a=i.perGeometryDataInfo[e.data.id],s=a.instanceBufferData;if(I(e,o.transformation,o.transformationNormal),s){var l=s.getSlot(e.idx);s.fill(l,0,o.transformation),s.fill(l,16,o.transformationNormal);var u=4*s.getOffset(l),d=E.getStride(a.vao.layout.instance);a.vao.vertexBuffers.instance.setSubData(s.getArray(),u,u,u+d)}}},e.prototype._modifyMerged=function(e,t,r,n){var i=this._compMatToDelta(e,t,L.Merged),o=this._mat2DataMerged;for(var a in i){var s=i[a];for(var l in s){var u=s[l],d=u.optimalCount,c=u.sparseCount,p=u.material,f=p.getVertexBufferLayout(),h=E.getStride(f)/4,m=o[a];null==m&&(b.assert(d>0),m=this._initializeMatData(p),o[a]=m,this._orderedRendering&&this._insertIntoRenderOrder(m,p.renderPriority,"merged"));var v=m.origin2data.get(l);if(null==v&&(b.assert(d>0),v=this._createMergedData(f,d,u.origin),m.origin2data.set(l,v)),0===d)v.vao.dispose(!0),v.vao=null,m.origin2data.delete(l),0===m.origin2data.size&&(r.push(a),delete o[a],this._orderedRendering&&this._removeFromRenderOrder(m,"merged"));else{var g=d<u.sparseCount/2,y=g?d:c,_=B,x=v.buffer.getSize(),w=v.buffer.getArray(),S=v.buffer.resize(y);g||S?this._rebuildMerged(v,u.toRemove,h,w,_):u.toRemove.length>0?(this._removeMergedByErasing(v,u.toRemove,h,_),u.toAdd.length>0&&(_.end=x)):(_.begin=x,_.end=x);var C=H;b.setMatrixTranslation3(C,-u.origin[0],-u.origin[1],-u.origin[2]),this._appendMerged(v,p,u.toAdd,h,C,_);var D=v.vao.vertexBuffers.geometry;if(D.byteSize!==v.buffer.getArray().buffer.byteLength)D.setData(v.buffer.getArray());else{var A=_.begin,T=_.end;if(A<T){var O=v.buffer.getArray(),I=4*A,R=4*T;D.setSubData(O,I,I,R)}}(_.updatedDisplayedIndexRange||v.displayedIndexRange)&&(n[this._modifiedMergedFacerangesKey(a,l)]=v)}}}},e.prototype._createMergedData=function(e,t,r){return{type:L.Merged,instances:{},vao:new A(this._rctx,i.Default3D,{geometry:e},{geometry:S.createVertex(this._rctx,35044)}),buffer:new a(t),optimalCount:0,origin:r}},e.prototype._rebuildMerged=function(e,t,r,n,i){for(var o=0;o<t.length;++o){var a=e.instances[t[o].uniqueName];e.optimalCount-=(a.to-a.from)*r,delete e.instances[t[o].uniqueName]}var s=0,l=e.buffer.getArray();i.begin=0,i.end=0;var u=-1,d=-1,c=0;for(var p in e.instances){var f=(a=e.instances[p]).from*r,h=a.to*r,m=h-f;u!==d&&d!==f?(l.set(n.subarray(u,d),c),c+=d-u,u=f):-1===u&&(u=f),d=h,a.from=s/r,s+=m,a.to=s/r}u!==d&&l.set(n.subarray(u,d),c),i.end=s},e.prototype._removeMergedByErasing=function(e,t,r,n){if(0!==t.length){n.begin=1/0,n.end=-1/0;for(var i=-1,o=-1,a=0,s=t;a<s.length;a++){var l=s[a].uniqueName,u=e.instances[l].from*r,d=e.instances[l].to*r;i!==o&&o!==u?(e.buffer.erase(i,o),i=u):-1===i&&(i=u),o=d,delete e.instances[l],e.optimalCount-=d-u,u<n.begin&&(n.begin=u),d>n.end&&(n.end=d)}i!==o&&e.buffer.erase(i,o)}},e.prototype._appendMerged=function(e,t,r,n,i,o){o.updatedDisplayedIndexRange=!1;for(var a=0,s=r;a<s.length;a++){var l=s[a],u=l.data;F.multiply(i,l.transformation,W),F.inverse(W,q),F.transpose(q);var d=o.end;t.fillInterleaved(u,W,q,l.instanceParameters,e.buffer.getArray(),o.end);var c=t.getOutputAmount(M(u)),p=d+c;b.assert(null==e.instances[l.uniqueName]);var f=T(l),h=new z(l.name,d/n,p/n,f,void 0,void 0,l.idx);e.instances[l.uniqueName]=h,this._updateHighlightFaceranges(l,h),f&&(o.updatedDisplayedIndexRange=!0),e.optimalCount+=c,o.end+=c}},e.prototype._modifyInstanced=function(e,t,r){var n=this._rctx,o=L.Instanced,s=this._compMatToDelta(e,t,o),l=this._mat2DataInstanced;for(var u in s){var c=s[u];for(var p in c){var f=c[p];if(0!==f.optimalCount){var h=f.material,v=l[u];if(null==v){var g=h.renderPriority;v=this._initializeMatData(h),l[u]=v,this._orderedRendering&&this._insertIntoRenderOrder(v,g,"instanced")}var y=h.getVertexBufferLayout(),_=v[m.MATERIAL].instanced?h.getInstanceBufferLayout():void 0,x=_&&E.findAttribute(_,"instanceColor"),w=_&&E.findAttribute(_,"instanceFeatureAttribute"),C=E.getStride(y)/4,D=v.origin2data.get(p);null==D&&(D={type:o,instances:{},vao:new A(n,i.Default3D,{geometry:y},{geometry:S.createVertex(n,35044)}),buffer:new a(f.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:f.origin},v.origin2data.set(p,D));var O=D.buffer.getSize(),I=D.buffer.getArray(),R=f.optimalCount<f.sparseCount/2,P=D.buffer.resize(R?f.optimalCount:f.sparseCount);for(var N in f.perGeometryDelta){if((J=D.perGeometryDataInfo[N])&&J.instanceBufferData){var U=f.perGeometryDelta[N].removeCount;U>0&&J.instanceBufferData.prepareFree(U)}}var V=f.toRemove;if(R||P){for(var j=0;j<V.length;++j){var k=V[j];delete D.instances[k.uniqueName];N=k.data.id;0==--(q=J=D.perGeometryDataInfo[N]).refCount&&null==f.dataId2refCount[N]?(D.optimalCount-=(q.to-q.from)*C,delete D.perGeometryDataInfo[N]):J.instanceBufferData&&J.instanceBufferData.free(k.idx)}O=0;var B=D.buffer.getArray(),G={};for(var W in D.perGeometryDataInfo){var q=D.perGeometryDataInfo[W];b.assert(null==G[q.from]),G[q.from]=q}for(var $ in G){var Y=(q=G[$]).from*C,Q=q.to*C;B.set(I.subarray(Y,Q),O),q.from=O/C,O+=Q-Y,q.to=O/C}for(var X in D.instances){(oe=D.instances[X]).from=D.perGeometryDataInfo[oe.dataId].from,oe.to=D.perGeometryDataInfo[oe.dataId].to}}else for(j=0;j<V.length;++j){k=V[j];delete D.instances[k.uniqueName];N=k.data.id;if(0==--(J=D.perGeometryDataInfo[N]).refCount&&null==f.dataId2refCount[N]){Y=J.from*C,Q=J.to*C;D.buffer.erase(Y,Q),D.optimalCount-=Q-Y,delete D.perGeometryDataInfo[N]}else J.instanceBufferData&&J.instanceBufferData.free(k.idx)}for(var N in b.setMatrixTranslation3(H,-f.origin[0],-f.origin[1],-f.origin[2]),f.perGeometryDelta){if((J=D.perGeometryDataInfo[N])&&J.instanceBufferData){var Z=f.perGeometryDelta[N].addCount;Z>0&&J.instanceBufferData.prepareAllocate(Z)}}var K=f.toAdd;for(j=0;j<K.length;++j){var J,ee=(k=K[j]).data;N=ee.id;if(null==(J=D.perGeometryDataInfo[N])){h.fillInterleaved(ee,void 0,void 0,void 0,D.buffer.getArray(),O);var te=h.getOutputAmount(M(ee));Y=O/C,Q=(O+=te)/C;if(D.optimalCount+=te,J={refCount:1,from:Y,to:Q,vao:null,instanceBufferData:null},_){var re=E.getStride(_)/4;J.vao=new A(n,i.Default3D,{geometry:y,instance:_},{geometry:D.vao.vertexBuffers.geometry,instance:S.createVertex(n,35044)}),J.instanceBufferData=new d(re,f.perGeometryDelta[N].addCount)}D.perGeometryDataInfo[N]=J}else++J.refCount;b.assert(J.from*C<=D.buffer.getSize()&&J.to*C<=D.buffer.getSize());var ne=F.create();F.multiply(H,k.transformation,ne);var ie=T(k),oe=new z(k.name,J.from,J.to,ie,ne,k.instanceParameters,k.idx,N);D.instances[k.uniqueName]=oe,this._updateHighlightFaceranges(k,oe);var ae=J.instanceBufferData;if(ae){var se=ae.allocate(k.idx);ae.fill(se,0,oe.transformation),ae.fill(se,16,oe.transformationNormal),x&&ae.fill(se,x.offset/4,k.instanceParameters.color),w&&ae.fill(se,w.offset/4,k.instanceParameters.featureAttribute)}}b.assert(D.optimalCount===f.optimalCount);var le=new Float32Array(D.buffer.getArray().buffer,0,D.buffer.getSize());for(var N in D.vao.vertexBuffers.geometry.setData(le),D.perGeometryDataInfo){var ue=D.perGeometryDataInfo[N];if(ue.vao){var de=ue.vao.vertexBuffers.instance;if(de){var ce=f.perGeometryDelta[N];if(ce.addCount+ce.removeCount>0){var pe=ue.instanceBufferData.compact();de.setData(pe)}}}}}else{var fe=l[u];fe.origin2data.get(p).vao.dispose(!0),fe.origin2data.delete(p),0===fe.origin2data.size&&(r.push(u),delete l[u],this._orderedRendering&&this._removeFromRenderOrder(fe,"instanced"))}}}},e.prototype._modifyPreinterleaved=function(e,t,r){for(var n=this._rctx,o=L.Preinterleaved,a=this._mat2DataPreinterleaved,s=0,l=e;s<l.length;s++){var u=(O=(E=l[s]).material).id,d=E.origin.id,c=E.origin.vec3;null==(I=a[u])&&(I=this._initializeMatData(O),a[u]=I);var p=I.origin2data.get(d);null==p&&(p={type:o,origin:c,count:0,instances:{}},I.origin2data.set(d,p)),b.setMatrixTranslation3(H,-c[0],-c[1],-c[2]);var f=F.create();F.multiply(H,E.transformation,f);var h=T(E),m=E.data;if(m.preinterleaved)if(null!=m.vertexData){var v=m.indexCount,g=m.id,y=new z(E.name,0,v,h,f,E.instanceParameters,E.idx,g),_=m.indexData?S.createIndex(n,35044,m.indexData):null,x=O.getVertexBufferLayout(),w=new A(n,i.Default3D,{geometry:x},{geometry:S.createVertex(n,35044)},_);w.vertexBuffers.geometry.setData(m.vertexData),m.vertexData=null,p.count+=1,p.instances[E.uniqueName]={instance:y,vao:w},this._updateHighlightFaceranges(E,y)}else b.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else b.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(var C=0,D=t;C<D.length;C++){c=(E=D[C]).origin,u=(O=E.material).id,d=c.id;var E,O,I,R=E.uniqueName,P=(I=a[u]).origin2data.get(d);P.instances[R].vao.dispose(),delete P.instances[R],P.count-=1,0===P.count&&I.origin2data.delete(d),0===I.origin2data.size&&(r.push(u),delete a[u])}},e.prototype._compMatToDelta=function(e,t,r){var n={};return this._updateMatToDelta(e,!0,r,n),this._updateMatToDelta(t,!1,r,n),n},e.prototype._updateMatToDelta=function(e,t,r,n){for(var i=r===L.Instanced,o=0,a=e;o<a.length;o++){var s=a[o],l=s.origin,u=s.material,d=u.id,c=i?this._mat2DataInstanced[d]:this._mat2DataMerged[d],p=c&&c.origin2data.get(l.id),f=n[d];null==f&&(f={},n[d]=f);var h=f[l.id];if(null==h){if(h={optimalCount:null==p?0:p.optimalCount,sparseCount:null==p?0:p.buffer.getSize(),material:u,toAdd:[],toRemove:[],perGeometryDelta:null,origin:l.vec3},i){var m={};if(void 0!==p)for(var v in p.perGeometryDataInfo)m[v]=p.perGeometryDataInfo[v].refCount;h.dataId2refCount=m,h.perGeometryDelta={}}f[l.id]=h}var g=u.getOutputAmount(M(s.data));if(i){var y=s.data.id,b=h.perGeometryDelta[y];b||(b={addCount:0,removeCount:0},h.perGeometryDelta[y]=b),t?(b.addCount++,null==h.dataId2refCount[y]&&(h.dataId2refCount[y]=0),1==++h.dataId2refCount[y]&&(h.optimalCount+=g,h.sparseCount+=g),h.toAdd.push(s)):(b.removeCount++,0==--h.dataId2refCount[y]&&(delete h.dataId2refCount[y],h.optimalCount-=g),h.toRemove.push(s))}else t?(h.optimalCount+=g,h.sparseCount+=g,h.toAdd.push(s)):(h.optimalCount-=g,h.toRemove.push(s))}},e.prototype._getType=function(e){if(e.data.preinterleaved)return L.Preinterleaved;var t=!1,r=M(e.data);return t=(t=(t=t||!1===e.material.canBeMerged)||e.material.instanced)||!0===e.material.renderOccluded,e.singleUse||(t=t||r>this._threshold),t?L.Instanced:L.Merged},e.prototype._getTargetMat2Data=function(e){switch(e){case L.Merged:return this._mat2DataMerged;case L.Instanced:return this._mat2DataInstanced;case L.Preinterleaved:return this._mat2DataPreinterleaved}},e.prototype._getOriginData=function(e,t,r){return this._getTargetMat2Data(e)[t].origin2data.get(r)},e.prototype._modifiedMergedFacerangesKey=function(e,t){return e+"_"+t},e.prototype._insertIntoRenderOrder=function(e,t,r){for(var n=e[m.MATERIAL].materialId,i=this._renderOrder.length,o=0;o<i&&this._renderOrder[o][0]>=t;){var a=this._renderOrder[o][1];if(a.id===n)return b.assert(!a[r],"matData for type already exists"),void(a[r]=e);o++}var s={id:n,instanced:null,merged:null};s[r]=e,this._renderOrder.splice(o,0,[t,s])},e.prototype._removeFromRenderOrder=function(e,t){for(var r=e[m.MATERIAL].materialId,n=0;this._renderOrder[n][1].id!==r;)n++;var i=this._renderOrder[n][1];i[t]=null,i.instanced||i.merged||this._renderOrder.splice(n,1)},e.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(e,t){var r=e.matData[m.MATERIAL].renderPriority,n=t.matData[m.MATERIAL].renderPriority;return r>n?-1:n>r?1:0})},e.prototype._updateRenderOrder=function(e,t){for(var r=t.length,n=0;n<r&&t[n][1].id!==e;)n++;if(n<r){var i=t[n][1],o=(i.merged||i.instanced)[m.MATERIAL].renderPriority,a=t[n][0];if(o!==t[n][0]){t[n][0]=o;var s=o>a?-1:1;for(n+=s;n>-1&&n<r&&s*t[n][0]>s*o;){var l=t[n];t[n]=t[n-s],t[n-s]=l,n+=s}}}},e.prototype._modifyMaterials=function(e){var t=this;e.forEach(function(e){t._materialRep.updateMaterialParameters(e)})},e.prototype.modifyRenderOrder=function(e){var t=this;this._orderedRendering&&(e.forEach(function(e){t._updateRenderOrder(e,t._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)},e.prototype._initializeMatData=function(e){var t={origin2data:new Map};return t[m.MATERIAL]=this._materialRep.aquire(e),t[m.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(e),t[m.MATERIAL_NORMAL]=this._materialRep.aquireNormal(e),t[m.MATERIAL_DEPTH]=this._materialRep.aquireDepth(e),t[m.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(e),t},e.prototype._releaseMaterials=function(e){if(Array.isArray(e))for(var t=e,r=0;r<t.length;r++)this._materialRep.release(t[r]),this._materialRep.releaseDepthShadowMap(t[r]),this._materialRep.releaseNormal(t[r]),this._materialRep.releaseDepth(t[r]),this._materialRep.releaseHighlight(t[r]);else this._materialRep.release(e),this._materialRep.releaseDepthShadowMap(e),this._materialRep.releaseNormal(e),this._materialRep.releaseDepth(e),this._materialRep.releaseHighlight(e)},e.prototype._getInstance=function(e){var t=e.material,r=e.uniqueName,n=t.id,i=this._getType(e),o=this._getTargetMat2Data(i),a=e.origin.id,s=o[n];if(!s)return null;var l,u=s.origin2data.get(a);return u?(l=u.type===L.Preinterleaved?u.instances[r].instance:u.instances[r])?{type:i,uniqueName:r,instance:l,matData:s,originData:u,instancedVAO:null,instancedVAOBaseInstance:null}:null:null},e.prototype._createBaseInstanceVAO=function(e){var t=this._rctx,r=e.instance,n=e.originData;if(e.type===L.Instanced&&n.perGeometryDataInfo){var i=n.perGeometryDataInfo[r.dataId],o=i.instanceBufferData;if(o){var a=i.vao,s=o.getSlot(r.idx);if(e.instancedVAOBaseInstance!==s){var l=E.setBaseInstanceOffset(a.layout,s);e.instancedVAO=new A(t,a.locations,l,a.vertexBuffers,a.indexBuffer),e.instancedVAOBaseInstance=s}}}},e.prototype._updateHighlightVAOs=function(){for(var e=0;e<this._highlights.length;++e){var t=this._highlights[e];this._createBaseInstanceVAO(t)}},e.prototype._getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new D(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},e}(),k=function(){function e(){this.reset()}return e.prototype.reset=function(){this.trianglesRendered=0,this.drawCallsInstanced=0,this.drawCallsAngleInstanced=0,this.drawCallsMerged=0,this.drawCallsPreinterleaved=0,this.drawCallsFragmented=0,this.drawCallsHighlight=0,this.instancesDrawnAngle=0,this.VBOallocatedSize=0,this.VBOoptimalSize=0,this.VBOusedSize=0},e}(),z=function(){return function(e,t,r,n,i,o,a,s){this.name=e,this.from=t,this.to=r,this.displayedIndexRange=n,this.transformation=i,this.instanceParameters=o,this.idx=a,this.dataId=s,null!=i&&(this.transformationNormal=F.create(),F.set(i,this.transformationNormal),F.inverse(this.transformationNormal,this.transformationNormal),F.transpose(this.transformationNormal,this.transformationNormal))}}();!function(e){e[e.Merged=0]="Merged",e[e.Instanced=1]="Instanced",e[e.Preinterleaved=2]="Preinterleaved"}(L||(L={}));var B={updatedDisplayedIndexRange:!1,begin:0,end:0},G=N.create(),H=F.identity(),W=F.create(),q=F.create();return j}.apply(null,n))||(e.exports=i)},1332:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(1306),r(1303),r(407),r(6),r(1323),r(410),r(40),r(1326),r(1376),r(1333),r(1377),r(1425),r(1378),r(1277),r(1345),r(1343),r(1479),r(1251),r(1382),r(1385),r(1386),r(1287),r(1286),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g,y,b,_,x,w,S,C,D,E){Object.defineProperty(t,"__esModule",{value:!0});var A=function(){function t(e,t,r){this.rctx=e,this.programRepository=t,this.callbacks=r,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new f.LocalOriginManager(new m(1e4)),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new _,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=u.vec3d.create(),this.tmpCameraPosition=u.vec3d.create(),this.componentColorManager=new g.BufferManager(this.rctx,2)}return t.isSupported=function(e){return!!e.capabilities.instancing},t.loadShaders=function(e,t,r){x.EdgeRenderer.loadShaders(e,t,r)},t.prototype.initialize=function(){var t=this;l.open(s.getAbsMid("./EdgeProcessingWorker",e,E),{client:this}).then(function(e){t.destroyed?e.close():t.workerThread=e});for(var r=y.VertexLayout.createBuffer(4),n=0;n<4;n++)r.sideness.set(n,0,0===n||3===n?0:1),r.sideness.set(n,1,0===n||1===n?0:1);this.verticesBufferObject=C.createVertex(this.rctx,35044,r.buffer)},t.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)},t.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage/1048576},Object.defineProperty(t.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),t.prototype.shouldRender=function(){return this.renderers.size>0},t.prototype.addObject=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,s,l,u,d;return i(this,function(i){switch(i.label){case 0:if(this.hasObject(e))return[2];if(n=new Array,s={loaded:a.create(function(e){o=e}),renderables:[]},this.perObjectData.set(e,s),r&&r.mergeGeometries&&e.geometries.length>1&&this.canMergeGeometries(e))n.push(this.addObjectMergedGeometries(e,s,t));else for(l=0;l<e.geometries.length;l++)u=e.geometries[l],d=e.geometryRecords[l],d.materials[0].supportsEdges&&(u.data instanceof h?n.push(this.addGeometryPreinterleaved(e,s,u,u.data,d,t)):n.push(this.addGeometryNonPreinterleaved(e,s,u,u.data,d,t[0])));return[4,a.all(n)];case 1:return i.sent(),this.callbacks.setNeedsRender(),o(),[2]}})})},t.prototype.hasObject=function(e){return this.perObjectData.has(e)},t.prototype.updateAllComponentOpacities=function(e,t){return n(this,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return i.sent(),n=t instanceof Array?function(e){return t[e]}:function(e){return t},r.renderables.forEach(function(e){for(var t=e.components.meta.length,r=0;r<t;r++){var i=n(r),o=e.components.meta[r],a=o.index;o.material.opacity=i,e.components.buffer.textureBuffer.setDataElement(a,1,3,255*i)}e.allTransparent=S.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateAllComponentMaterials=function(e,t){return n(this,void 0,void 0,function(){var r,n=this;return i(this,function(i){switch(i.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return i.sent(),r.renderables.forEach(function(e){var r=S.determineRequiresUberRenderer(t),i=x.EdgeRenderer.getKey(r,t[0].type);if(i!==e.rendererKey){var o=n.renderers.get(e.rendererKey),a=n.aquireRenderer(r,t[0].type);o.removeRenderable(e),o.refCount.decrement(),e.rendererKey=i,a.addRenderable(e)}for(var s=0;s<t.length;s++)e.components.meta[s].material=t[s];n.updateComponentBuffer(e.components),e.allTransparent=S.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateObjectVisibility=function(e,t){return n(this,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return n.sent(),r.renderables.forEach(function(e){e.visible=t}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.removeObject=function(e){var t=this,r=this.perObjectData.get(e);r&&(this.perObjectData.delete(e),r.loaded.then(function(){r.renderables.forEach(function(e){t.removeRenderable(e)}),t.callbacks.setNeedsRender()}))},t.prototype.removeAll=function(){var e=this;this.perObjectData.forEach(function(t,r){e.removeObject(r)})},t.prototype.createSolidEdgeMaterial=function(e){return r({},T,e,{type:"solid"})},t.prototype.createSketchEdgeMaterial=function(e){return r({},O,e,{type:"sketch"})},t.prototype.render=function(e){var t=this;this.localOrigins.updateViewMatrices(e.view),this.renderers.forEach(function(e){0===e.refCount.value&&(t.renderers.delete(e.key),e.dispose())}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var r=e.view,n=0,i=0;this.renderers.forEach(function(e){e.forEachRenderable(function(e){n+=e.statistics.averageEdgeLength,i++})});var o={distanceFalloffFactor:40*(n/i),minimumEdgeLength:S.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5)},a=this.rctx.capabilities.blendMinMax;a?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,a.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1)),this.rctx.setDepthTestEnabled(!0),this.rctx.setDepthFunction(515),this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(function(r){t.renderRegularEdges(r,e,o),t.renderSilhouetteEdges(r,e,o)}),this.rctx.setDepthWriteEnabled(!0),this.rctx.setDepthFunction(513),this.rctx.setBlendEquationSeparate(32774,32774),this.rctx.setBlendFunctionSeparate(1,0,1,1),e.view=r},t.prototype.computeModelTransformWithLocalOrigin=function(e,t,r){if(e.getCombinedStaticTransformation(t,r),t.origin)this.localOrigins.register(t.origin);else{var n=u.vec3d.set3(r[12],r[13],r[14],this.tmpModelPosition);t.origin=this.localOrigins.aquire(n)}return p.applyToModelMatrix(t.origin.vec3,r),r},t.prototype.updateComponentBuffer=function(e){for(var t=e.meta,r=e.buffer,n=0;n<t.length;n++){var i=t[n].material,o=t[n].index,a=v.clamp(Math.round(i.size*x.LINE_WIDTH_FRACTION_FACTOR),0,255),s=v.clamp(i.extensionLength,-x.EXTENSION_LENGTH_OFFSET,255-x.EXTENSION_LENGTH_OFFSET)+x.EXTENSION_LENGTH_OFFSET,l="solid"===i.type?0:1,u=255*i.opacity,d=i.color,c=255*d[0],p=255*d[1],f=255*d[2],h=255*d[3];r.textureBuffer.setData(o,0,c,p,f,h),r.textureBuffer.setData(o,1,a,s,l,u)}},t.prototype.createComponentBuffers=function(e){for(var t=[],r=this.componentColorManager.getBuffer(e.length),n=0;n<e.length;n++){var i=e[n],o=r.aquireIndex();t.push({index:o,material:i})}var a={meta:t,buffer:r};return this.updateComponentBuffer(a),a},t.prototype.extractEdges=function(e,t,r,n){return this.worker.process({data:t,originalIndices:n,writerSettings:e,skipDeduplicate:r},this.workerThread)},t.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var r=new D(this.rctx,y.EdgeShaderAttributeLocations,{vertices:y.glVertexLayout,instances:b.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:C.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){r=new D(this.rctx,y.EdgeShaderAttributeLocations,{vertices:y.glVertexLayout,instances:b.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:C.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t},t.prototype.disposeEdgeResources=function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)},t.prototype.addGeometryNonPreinterleaved=function(e,t,r,o,a,s){return n(this,void 0,void 0,function(){var r,n,l,d;return i(this,function(i){switch(i.label){case 0:return r=o.getAttribute("position"),n=this.computeModelTransformWithLocalOrigin(e,a,u.mat4d.create()),l=a.origin,d={position:r,indices:o.getIndices("position"),modelTransform:n,origin:l},[4,this.addNonPreinterleaved(e,t,d,s)];case 1:return i.sent(),[2]}})})},t.prototype.addNonPreinterleaved=function(e,t,r,o){return n(this,void 0,void 0,function(){var e,n,a,s,l,u,d,c,p,f,h,m,v,g,b;return i(this,function(i){switch(i.label){case 0:for(e=this.aquireRenderer(!1,o.type),n=r.modelTransform,a=r.origin,s=r.indices,l=r.position,u=l.data.length/l.strideIdx,d=y.EdgeInputBufferLayout.createBuffer(u),c=0;c<u;c++)d.position.set(c,0,l.data[l.offsetIdx+c*l.strideIdx+0]),d.position.set(c,1,l.data[l.offsetIdx+c*l.strideIdx+1]),d.position.set(c,2,l.data[l.offsetIdx+c*l.strideIdx+2]);return p=this.createComponentBuffers([o]),S.fillComponenBufferIndices(p.meta,[0,d.componentIndex.count],d.componentIndex),[4,this.extractEdges(e.writerSettings,d,!1,s)];case 1:return f=i.sent(),h=this.createEdgeResources(f),m=h.regular,v=h.silhouette,g=(m?m.vao.size:0)+(v?v.vao.size:0),b={regular:m,silhouette:v,transform:{modelMatrix:n,origin:a},statistics:{gpuMemoryUsage:g,averageEdgeLength:f.averageEdgeLength},components:p,visible:!0,allTransparent:S.determineAllTransparent(p.meta),distanceToCamera:0,rendererKey:e.key},t.renderables.push(b),e.addRenderable(b),this.gpuMemoryUsage+=g,[2]}})})},t.prototype.addGeometryPreinterleaved=function(e,t,r,o,a,s){return n(this,void 0,void 0,function(){var r,n,l,p,f,h,m,v,g,b,_,x,w,C,D,E,A;return i(this,function(i){switch(i.label){case 0:return(r=o.getAttribute("position"))&&r.data instanceof Float32Array?(n=s[0],l=S.determineRequiresUberRenderer(s),p=this.aquireRenderer(l,n.type),f=this.computeModelTransformWithLocalOrigin(e,a,u.mat4d.create()),h=a.origin,m=o.getIndices("position"),v=new d.BufferViewVec3f(r.data.buffer,4*r.offsetIdx,4*r.strideIdx),g=y.EdgeInputBufferLayout.createBuffer(v.count),c.unrolledCopyVec3(g.position,v),b=this.createComponentBuffers(s),S.fillComponenBufferIndices(b.meta,o.componentOffsets,g.componentIndex,m),_=o.hasPositionData,[4,this.extractEdges(p.writerSettings,g,_,m)]):(console.warn("Geometry has no float32 `position` attribute, skipping it."),[2]);case 1:return x=i.sent(),w=this.createEdgeResources(x),C=w.regular,D=w.silhouette,E=(C?C.vao.size:0)+(D?D.vao.size:0),A={regular:C,silhouette:D,transform:{modelMatrix:f,origin:h},statistics:{gpuMemoryUsage:E,averageEdgeLength:x.averageEdgeLength},components:b,visible:!e.isHidden(a),allTransparent:S.determineAllTransparent(b.meta),distanceToCamera:0,rendererKey:p.key},t.renderables.push(A),p.addRenderable(A),this.gpuMemoryUsage+=E,[2]}})})},t.prototype.canMergeGeometries=function(e){for(var t=null,r=null,n=0;n<e.geometries.length;n++){var i=e.geometries[n],a=e.geometryRecords[n];if(a.materials[0].supportsEdges){if(i.data instanceof h)return!1;if(t){if(!o.equals(t,a.transformation))return!1}else t=a.transformation;if(!r&&a.origin)r=a;else if(r&&a.origin&&r.origin.id!==a.origin.id)return!1}}return!0},t.prototype.addObjectMergedGeometries=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,a,s,l,d,c,p,f,h,m,v,g,y,b,_,x,w,S,C;return i(this,function(i){switch(i.label){case 0:for(n=new Map,o=0,a=null,s=null,S=0;S<e.geometries.length;S++)f=e.geometries[S],l=e.geometryRecords[S],l.materials[0].supportsEdges&&(!s&&l.origin&&(s=l),v=f.data.getIndices("position"),o+=v?v.length:0,(v&&null==a||a===Uint16Array)&&(a=v instanceof Uint16Array?Uint16Array:Uint32Array));for(d=o?new a(o):null,c=[],p=0,S=0;S<e.geometries.length;S++)if(f=e.geometries[S],h=e.geometryRecords[S],h.materials[0].supportsEdges){if(m=f.data.getAttribute("position"),v=f.data.getIndices("position"),null==(g=n.get(m.data))){for(g=c.length/3,y=m.offsetIdx;y<m.data.length;y+=m.strideIdx)c.push(m.data[y+0]),c.push(m.data[y+1]),c.push(m.data[y+2]);n.set(m.data,g)}if(v)for(b=0;b<v.length;b++)d[p++]=g+v[b]}for(_=s||e.geometryRecords[0],x=this.computeModelTransformWithLocalOrigin(e,_,u.mat4d.create()),w=_.origin,S=0;S<e.geometryRecords.length;S++)e.geometryRecords[S].origin=w;return C={position:{data:c,offsetIdx:0,strideIdx:3},indices:d,modelTransform:x,origin:w},[4,this.addNonPreinterleaved(e,t,C,r[0])];case 1:return i.sent(),[2]}})})},t.prototype.aquireRenderer=function(e,t){var r=x.EdgeRenderer.getKey(e,t),n=this.renderers.get(r);return this.strokesTexture||(this.strokesTexture=w.generateStrokesTexture(this.rctx)),n||(n=new x.EdgeRenderer(this.rctx,this.programRepository,{type:t,strokesTexture:this.strokesTexture,uber:e}),this.renderers.set(r,n)),n.refCount.increment(),n},t.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);t.removeRenderable(e),t.refCount.decrement(),this.disposeEdgeResources(e),this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var r=0,n=e.components.meta;r<n.length;r++){var i=n[r];e.components.buffer.releaseIndex(i.index)}},t.prototype.updateObjectCameraDistances=function(e){var t=this,r=e.viewInvTransp;u.vec3d.set3(r[3],r[7],r[11],this.tmpCameraPosition),this.perObjectData.forEach(function(e,r){var n=u.vec3d.dist(r.getCenter(),t.tmpCameraPosition);e.renderables.forEach(function(e){return e.distanceToCamera=n})})},t.prototype.renderRegularEdges=function(e,t,r){var n=this;e.bindRegularEdges(t,r),e.forEachRenderable(function(i){if(i.visible&&i.regular&&!i.allTransparent){var o=S.computeEdgeCount(i.regular.lod.lengths,i.distanceToCamera,r);t.view=n.localOrigins.getViewMatrix(i.transform.origin),e.renderRegularEdges(i,t,o),n.numberOfRenderedEdges+=o}})},t.prototype.renderSilhouetteEdges=function(e,t,r){var n=this;e.bindSilhouetteEdges(t,r),e.forEachRenderable(function(i){if(i.visible&&i.silhouette&&!i.allTransparent){var o=S.computeEdgeCount(i.silhouette.lod.lengths,i.distanceToCamera,r);t.view=n.localOrigins.getViewMatrix(i.transform.origin),e.renderSilhouetteEdges(i,t,o),n.numberOfRenderedEdges+=o}})},t}();t.EdgeView=A;var T={color:u.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1},O={color:u.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1}}.apply(null,n))||(e.exports=i)},1333:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var r=t,n=-e[0],i=-e[1],o=-e[2],a=r[3],s=r[7],l=r[11],u=r[15];r[0]+=a*n,r[1]+=a*i,r[2]+=a*o,r[4]+=s*n,r[5]+=s*i,r[6]+=s*o,r[8]+=l*n,r[9]+=l*i,r[10]+=l*o,r[12]+=u*n,r[13]+=u*i,r[14]+=u*o},t.applyToViewMatrix=function(e,t){var r=t,n=e[0],i=e[1],o=e[2];r[12]+=n*r[0]+i*r[4]+o*r[8],r[13]+=n*r[1]+i*r[5]+o*r[9],r[14]+=n*r[2]+i*r[6]+o*r[10],r[14]+=n*r[3]+i*r[7]+o*r[11]}}.apply(null,n))||(e.exports=i)},1334:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(1295),r(1284)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t,r,n,o,a){void 0===a&&(a=!1);var s=e.call(this,t,r)||this;return s.textureRep=n,s.textureId=o,s.initTransparent=a,s.glTextureRef=i.aquireIfNotUndefined(s.textureId,n,s.initTransparent),s}return r(t,e),t.prototype.dispose=function(){i.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(i.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=i.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.renderTexture=function(e){var t=this.textureRep.getTexture(this.textureId);t&&t.dirty&&t.redraw&&t.redraw()},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",0),e.bindTexture(this.glTextureRef.getGLTexture()))},t.prototype.bindTextureSize=function(e,t){if(null!=this.glTextureRef){var r=this.glTextureRef.getGLTexture();t.setUniform2f("texSize",r.descriptor.width,r.descriptor.height)}},t}(n)}.apply(null,n))||(e.exports=i)},1335:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277)],void 0===(i=function(e,t,r){function n(e){return Math.abs(e*e*e)}function i(e,t,r,i){void 0===i&&(i=d);var o=r.parameters,a=r.paddingPixelsOverride;return i.scale=Math.min(o.divisor/(t-o.offset),1),i.factor=n(e),i.minPixelSize=o.minPixelSize,i.paddingPixels=a,i}function o(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function a(e,t){return Math.max(r.lerp(e*t.scale,e,t.factor),o(e,t))}function s(e,t,r){var n=i(e,t,r);return n.minPixelSize=0,n.paddingPixels=0,a(1,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(e){return new l(e,t.defaultDescription)},t.getLabelSettings=function(e){var r=t.defaultDescription.curvatureDependent,n=t.defaultDescription.scaleStart,i=t.defaultDescription.scaleFallOffRange;return new l(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:u.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:u.curvatureDependent.max.scaleFallOffFactor}},scaleStart:n,scaleFallOffRange:i,minPixelSize:u.minPixelSize})},t.perspectiveFactor=n,t.scaleFactor=i,t.applyScaleFactor=a,t.applyScaleFactorVec2=function(e,t,n){void 0===n&&(n=[0,0]);var i=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return n[0]=r.lerp(e[0]*i,e[0],t.factor),n[1]=r.lerp(e[1]*i,e[1],t.factor),n},t.precomputeScale=s,t.precomputeScaleFactor=function(e,t,r,n){return n.scale=s(e,t,r),n.factor=0,n.minPixelSize=r.parameters.minPixelSize,n.paddingPixels=r.paddingPixelsOverride,n},t.applyPrecomputedScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var n=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return r[0]=e[0]*n,r[1]=e[1]*n,r},t.scale=function(e,t,r,n){return a(e,i(t,r,n))};var l=function(){function e(e,t,r,n){void 0===r&&(r={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=r,this._paddingPixelsOverride=n,"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var r=this.description,n=r.scaleStart,i=r.scaleFallOffRange,o=r.minPixelSize,a=e.fovY,s=e.distance,l=this.calculateCurvatureDependentParameters(e),u=this.coverageCompensation(e,l),d=l.tiltAngle,c=l.scaleFallOffFactor,p=Math.sin(d)*s,f=.5*Math.PI-d-a*(.5-n*u),h=p/Math.cos(f),m=f+a*i*u,v=(h-c*(p/Math.cos(m)))/(1-c);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=v,t.divisor=h-v,t.minPixelSize=o,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=c),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=c);var n=this.description.curvatureDependent,i=1+e.distance/p,o=Math.sqrt(i*i-1),a=[n.min.curvature,n.max.curvature],s=a[0],l=a[1],u=r.clamp((o-s)/(l-s),0,1),d=[n.min,n.max],f=d[0],h=d[1];return t.tiltAngle=r.lerp(f.tiltAngle,h.tiltAngle,u),t.scaleFallOffFactor=r.lerp(f.scaleFallOffFactor,h.scaleFallOffFactor,u),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var r=p*p,n=t.tiltAngle+.5*Math.PI,i=e.fovY,o=e.distance,a=o*o+r-2*Math.cos(n)*o*p,s=Math.sqrt(a),l=Math.sqrt(a-r);return(Math.acos(l/s)-Math.asin(p/(s/Math.sin(n)))+.5*i)/i},e}();t.defaultDescription={curvatureDependent:{min:{curvature:r.deg2rad(10),tiltAngle:r.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:r.deg2rad(70),tiltAngle:r.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var u={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};t.copyParameters=function(e,t){return t.camera.distance=e.camera.distance,t.camera.fovY=e.camera.fovY,t.divisor=e.divisor,t.offset=e.offset,t.minPixelSize=e.minPixelSize,t};var d={scale:0,factor:0,minPixelSize:0,paddingPixels:0},c={tiltAngle:0,scaleFallOffFactor:0},p=6378137}.apply(null,n))||(e.exports=i)},1336:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1392),r(1282),r(1278),r(1281),r(1284),r(1283)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=i.vec4d.createFrom(1,1,1,1);return function(){function e(e,t,r,n,i){this.program=e.get("texOnly"),this.color=r,this.depthFunc=i,this.blend=n,this.texGLName=t}return e.prototype.beginSlot=function(e){return e===o.INTERNAL_MATERIAL},e.prototype.getProgram=function(){return this.program},e.prototype.setColor=function(e){this.color=e},e.prototype.bind=function(e,t){e.bindProgram(this.program),this.program.setUniformMatrix4fv("model",a.IDENTITY),this.program.setUniformMatrix4fv("proj",t.proj),this.program.setUniform4fv("color",void 0!==this.color?this.color:l),this.program.setUniform1i("tex",0),e.bindTexture(this.texGLName,0),this.blend&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),e.setDepthTestEnabled(!0),void 0!==this.depthFunc&&e.setDepthFunction(this.depthFunc)},e.prototype.release=function(e){void 0!==this.depthFunc&&e.setDepthFunction(513),this.blend&&e.setBlendingEnabled(!1)},e.prototype.bindView=function(e,t){a.bindView(t.origin,t.view,this.program)},e.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},e.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},e.loadShaders=function(e,t,i){e._parse(r);var o=new s(i,e.vertexShaderTexOnly,e.fragmentShaderTexOnly,n.Default3D);t.add("texOnly",o)},e}()}.apply(null,n))||(e.exports=i)},1337:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1395),r(1302),r(1282),r(1288),r(1278),r(1293),r(1277),r(1287),r(1285),r(1283),r(1279),r(1286)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f){return function(){function e(e,t,r){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=r,this.viewportToRestore=a.vec4d.create(),this.programRep=e,this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05}}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return n.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){return console.log(e)}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t,r){var i=!n.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,o=n.HIGHLIGHTS_VISUALIZE_BLOCKS,s=this._rctx;l.assert(this.enabled),a.vec4d.set(e.fullViewport,this.viewportToRestore);var u=r.width,d=r.height,c=Math.ceil(u/1),f=Math.ceil(d/1);this.blur0Fbo.resize(c,f),this.blur1Fbo.resize(c,f),s.bindVAO(this.quadVAO),s.setDepthWriteEnabled(!1),s.setDepthTestEnabled(!1),s.setBlendingEnabled(!1);var h=null,m=null,v=null,g=null;if(i){var y=this._grid;this._gridUpdateResources(r,32),this._gridComputeMipmap(),v=y.vao,g=4,h=this.programRep.get("highlight-blur-grid-5"),s.bindProgram(h),s.bindTexture(y.coverageMipmap[y.mipmapLevels].colorTexture,1),h.setUniform1i("coverageTex",1)}else v=this.quadVAO,g=5,h=this.programRep.get("highlight-blur-5"),s.bindProgram(h);if(s.bindVAO(v),s.bindFramebuffer(this.blur0Fbo),s.setViewport(0,0,c,f),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT),h.setUniform1i("tex",0),s.bindTexture(r.colorTexture,0),h.setUniform2f("blurSize",1/c,0),s.drawArrays(g,0,p.vertexCount(v,"geometry")),s.bindFramebuffer(this.blur1Fbo),s.clear(s.gl.COLOR_BUFFER_BIT),s.bindTexture(this.blur0Fbo.colorTexture,0),h.setUniform2f("blurSize",0,1/f),s.drawArrays(g,0,p.vertexCount(v,"geometry")),s.bindFramebuffer(t),s.setBlendingEnabled(!0),s.setBlendFunctionSeparate(770,771,1,771),s.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),i){m=this.programRep.get(o?"highlight-apply-grid-debug":"highlight-apply-grid"),s.bindProgram(m),m.setUniform1i("coverageTex",2);var b=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;s.bindTexture(b,2)}else m=this.programRep.get("highlight-apply"),s.bindProgram(m);m.setUniform1i("tex",0),s.bindTexture(this.blur1Fbo.colorTexture,0),m.setUniform1i("origin",1),s.bindTexture(r.colorTexture,1),m.setUniform4fv("color",this.defaultOptions.color),m.setUniform1f("outlineSize",8.6),m.setUniform1f("blurSize",.4),m.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded),s.drawArrays(g,0,p.vertexCount(v,"geometry")),s.bindVAO(null),s.setDepthWriteEnabled(!0),s.setDepthTestEnabled(!0),s.setBlendingEnabled(!1)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=s.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=d.createWithAttachments(this._rctx,t,e),this.blur1Fbo=d.createWithAttachments(this._rctx,t,e)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var r=this._rctx,n=this._grid,a=!1;if(null===n.coverageMipmap&&(n.coverageMipmap=[e],a=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(a=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==t&&(n.cellPixelSize=t,a=!0),a){for(var s=1;s<n.coverageMipmap.length;s++)n.coverageMipmap[s].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(s=0;s<n.mipmapLevels;s++){var l=n.coverageMipmap[s],c={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},p={colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},h=d.createWithAttachments(r,c,p);n.coverageMipmap[s+1]=h}}var m=Math.ceil(e.height/n.cellPixelSize),v=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==m||n.horizontalCellCount!==v){n.verticalCellCount=m,n.horizontalCellCount=v;for(var g=m+1,y=v+1,b=1/m,_=1/v,x=new Float32Array(24*g*y),w=0,S=0;S<g;S++)for(var C=0;C<y;C++)x[w+0]=(C-.5)*_*2-1,x[w+1]=(S-.5)*b*2-1,x[w+2]=C*_,x[w+3]=S*b,x[w+4]=(C+.5)*_*2-1,x[w+5]=(S-.5)*b*2-1,x[w+6]=C*_,x[w+7]=S*b,x[w+8]=(C-.5)*_*2-1,x[w+9]=(S+.5)*b*2-1,x[w+10]=C*_,x[w+11]=S*b,x[w+12]=(C-.5)*_*2-1,x[w+13]=(S+.5)*b*2-1,x[w+14]=C*_,x[w+15]=S*b,x[w+16]=(C+.5)*_*2-1,x[w+17]=(S-.5)*b*2-1,x[w+18]=C*_,x[w+19]=S*b,x[w+20]=(C+.5)*_*2-1,x[w+21]=(S+.5)*b*2-1,x[w+22]=C*_,x[w+23]=S*b,w+=24;n.vao&&n.vao.dispose(!0),n.vao=new f(r,i.Default3D,{geometry:o.Pos2Tex},{geometry:u.createVertex(r,35044,x)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,r=this.programRep.get("conservative-downsample");e.bindVAO(this.quadVAO);for(var n=0;n<t.mipmapLevels;n++){e.bindFramebuffer(t.coverageMipmap[n+1]),e.bindTexture(t.coverageMipmap[n].colorTexture,0);var i=t.coverageMipmap[n+1].width,o=t.coverageMipmap[n+1].height;e.bindProgram(r),r.setUniform1i("tex",0),r.setUniform2f("invFramebufferDim",1/i,1/o),e.setViewport(0,0,i,o),e.drawArrays(5,0,p.vertexCount(this.quadVAO,"geometry"))}},e.loadShaders=function(e,t,n){e._parse(r);for(var o=0,a=["3","5","7","9"];o<a.length;o++){var s=a[o];t.add("highlight-blur-"+s,new c(n,e.vsHighlightBlurFastGaussian,e.fsHighlightBlurFastGaussian,i.Default3D,{GAUSSIAN_SAMPLES:s})),t.add("highlight-blur-grid-"+s,new c(n,e.vsHighlightBlurFastGaussian,e.fsHighlightBlurFastGaussian,i.Default3D,{GAUSSIAN_SAMPLES:s,GRID_OPTIMIZATION:"true"}))}t.add("highlight-apply",new c(n,e.vsHighlightApply,e.fsHighlightApply,i.Default3D)),t.add("highlight-apply-grid",new c(n,e.vsHighlightApply,e.fsHighlightApply,i.Default3D,["GRID_OPTIMIZATION"])),t.add("highlight-apply-grid-debug",new c(n,e.vsHighlightApply,e.fsHighlightApply,i.Default3D,["GRID_OPTIMIZATION","GRID_DEBUG"])),t.add("conservative-downsample",new c(n,e.vsConservativeDownsample,e.fsConservativeDownsample,i.Default3D))},e}()}.apply(null,n))||(e.exports=i)},1338:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1396),r(1282),r(1293),r(1397),r(1277),r(1283),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=function(){function e(e,t){this.dimensions={width:4,height:4},this._enabled=!1,this._background={type:"color",color:[0,0,0,1]},this._programRep=e,this._rctx=t,this.renderTargetHelper=new o.RenderTargetHelper(t);var r=this.renderTargetHelper;this.mainColor=r.registerColorTarget({name:"mainColor"}),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"})}return e.loadShaders=function(e,t,i){e._parse(r);var o=new s(i,e.vsOffscreenRenderer,e.fsOffscreenRenderer,n.Default3D);t.add("offscreenProgram",o);var a=new s(i,e.vsOffscreenRenderer,e.fsOffscreenRendererTransparentToHUDVisibility,n.Default3D);t.add("transparentToHUDVisibility",a)},Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),e.prototype.initializeFrame=function(e){a.assert(this.enabled);var t=this._rctx,r=t.gl,n=e.fullViewport;this.dimensions.width=n[2],this.dimensions.height=n[3],this.bindTarget(this.mainColor,this.mainDepth),t.setClearStencil(0);var i=this._background.color;t.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),t.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT)},e.prototype.renderSeparateAndComposite=function(e,t,r){void 0===t&&(t=d),void 0===r&&(r=c),this.renderToTargets(e,this.tmpColor,this.mainDepth,t),this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,r)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,p)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this,t=this._rctx;this.renderToTargets(function(){var r=e._programRep.get("transparentToHUDVisibility");t.bindProgram(r),r.setUniform1i("tex",1),t.bindTexture(e.getColorTexture(e.tmpColor),1),t.setDepthTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!0,!1,!1),t.bindVAO(e.quadVAO),t.drawArrays(5,0,l.vertexCount(e.quadVAO,"geometry")),t.setColorMask(!0,!0,!0,!0),t.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){this.bindTarget(this.mainColor),e(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.composite=function(e,t,r){void 0===e&&(e=this.framebuffer.colorTexture),void 0===t&&(t=null),void 0===r&&(r=c);var n=this._rctx,i=this._programRep.get("offscreenProgram");switch(n.bindFramebuffer(t),n.setDepthTestEnabled(!1),n.bindProgram(i),i.setUniform1i("tex",1),n.bindTexture(e,1),r){case"none":n.setBlendingEnabled(!1);break;case"alpha":n.setBlendFunctionSeparate(770,771,1,771),n.setBlendingEnabled(!0);break;case"premultiplied-alpha":n.setBlendFunction(1,771),n.setBlendingEnabled(!0)}n.bindVAO(this.quadVAO),n.drawArrays(5,0,l.vertexCount(this.quadVAO,"geometry")),n.setDepthTestEnabled(!0),n.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=i.createQuadVAO(this._rctx))},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)},e.prototype.renderToTargets=function(e,t,r,n,i){var o=this._rctx,a=o.gl;this.bindTarget(t,r);var s=0;if(n){var l=Math.max(1e-13,n[3]);o.setClearColor(n[0],n[1],n[2],l),s|=a.COLOR_BUFFER_BIT}i&&(s|=a.DEPTH_BUFFER_BIT),o.clear(s),e(),a.flush(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.bindTarget=function(e,t){var r=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);this._rctx.bindFramebuffer(r)},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e}(),d=[0,0,0,0],c="none",p=[0,1,0,1];return u}.apply(null,n))||(e.exports=i)},1339:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1400),r(7),r(1312),r(1282),r(1288),r(1278),r(1293),r(1277),r(1287),r(1285),r(1283),r(1280),r(1279),r(1286)],void 0===(i=function(e,t,n,i,o,a,s,l,u,d,c,p,f,h,m,v){var g=i.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),y=function(){function e(e,t,r,n){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=l.vec4d.create(),this._rctx=r,this._programRep=e,this._requestRender=n,this._emptyTexture=u.createEmptyTexture(r)}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),r=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return e.capabilities.standardDerivatives&&!(t||r)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,r,n){if(this._noiseTexture){d.assert(this.enabled);var i=this._rctx,o=r.width,a=r.height,s=o/this._BLUR_F,c=a/this._BLUR_F;this._ssaoFBO.resize(o,a),this._blur0FBO.resize(s,c),this._blur1FBO.resize(s,c);var p=1*o,f=1*a;i.bindFramebuffer(this._ssaoFBO),l.vec4d.set(e.fullViewport,this._viewportToRestore),i.setViewport(0,0,o,a);var h=this._programRep.get(this._samples<=8?"ssao8":this._samples<=16?"ssao16":this._samples<=32?"ssao32":"ssao64"),v=this._programRep.get("blur");h.setUniform2f("rnmScale",o/this._noiseTexture.descriptor.width,a/this._noiseTexture.descriptor.height),h.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64),i.bindProgram(h);var g=this._data.minDiscrepancy,y=this._samples<g.length?g[this._samples]:5779;h.setUniform1f("numSpiralTurns",y);var x=_,w=b;d.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,x,w),h.setUniform4fv("projInfo",x),h.setUniform2fv("zScale",w),h.setUniform2f("nearFar",e.near,e.far);var S=1/e.computePixelSizeAtDist(1);h.setUniform1f("projScale",1*S),h.setUniform2f("screenDimensions",p,f);var C=2*this._radius,D=l.vec3d.dist(e.eye,e.center);C=20*e.computePixelSizeAtDist(D),C=Math.max(.1,C),h.setUniform1f("radius",C),h.setUniform1f("intensity",4*this._attenuation/Math.pow(C,6)),h.setUniform1i("rnm",0),h.setUniform1i("normalMap",1),h.setUniform1i("depthMap",2),i.bindTexture(this._noiseTexture,0),i.bindTexture(n.colorTexture,1),i.bindTexture(r.colorTexture,2);var E=u.createQuadVAO(this._rctx);i.bindVAO(E),i.drawArrays(5,0,m.vertexCount(E,"geometry"));i.bindTexture(this._ssaoFBO.colorTexture,0),i.setViewport(0,0,p/this._BLUR_F,f/this._BLUR_F),i.bindFramebuffer(this._blur0FBO),v.setUniform2f("screenDimensions",p,f),v.setUniform1i("tex",0),v.setUniform1i("normalMap",1),v.setUniform1i("depthMap",2),v.setUniform2f("blurSize",0,1*this._BLUR_F/f),v.setUniform1i("radius",4),v.setUniform1f("g_BlurFalloff",.08),v.setUniform2f("nearFar",e.near,e.far),D>5e4&&(S=Math.max(0,S-(D-5e4))),v.setUniform1f("projScale",S),v.setUniform2f("zScale",1,0),i.drawArrays(5,0,m.vertexCount(E,"geometry")),v.setUniform2f("blurSize",1*this._BLUR_F/p,0),i.bindFramebuffer(this._blur1FBO),i.bindTexture(this._blur0FBO.colorTexture,0),i.drawArrays(5,0,m.vertexCount(E,"geometry")),i.bindFramebuffer(t),i.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},e.prototype.setUniforms=function(e){var t=this.enabled&&this._noiseTexture,r=this._rctx;r.bindTexture(t?this._blur1FBO.colorTexture:this._emptyTexture,6),r.setActiveTexture(0),e.setUniform1i("ssaoTex",6),t?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),r=0;r<t.length;r++)this.setUniforms(t[r])},e.prototype.drawQuad=function(e){d.assert(this.enabled);var t=this._programRep.get("showDepth");this._debugQuadVAO||(this._debugQuadVAO=new v(this._rctx,a.Default3D,{geometry:s.Pos2Tex},{geometry:c.createVertex(this._rctx,35044,x)}));var r=this._rctx;r.setDepthTestEnabled(!1),t.setUniformMatrix4fv("proj",new Float32Array(e)),t.setUniform1i("depthTex",0),r.bindTexture(this._ssaoFBO.colorTexture,0),r.bindVAO(this._debugQuadVAO),r.drawArrays(5,0,m.vertexCount(this._debugQuadVAO,"geometry")),r.setDepthTestEnabled(!0)},e.prototype.enable=function(){var e=this;if(!this.enabled){if(!this.isSupported)return void g.warn("SSAO is not supported for this browser or hardware");this._enabled=!0,this.loadResources(function(){e._enabled&&e.initialize()})}},e.prototype.loadResources=function(e){var t=this;this._data?e():r.e(69).then(function(){var n=[r(1491)];(function(r){t._data=r,e()}).apply(null,n)}).catch(r.oe)},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},r={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=p.createWithAttachments(this._rctx,t,r),this._blur0FBO=p.createWithAttachments(this._rctx,t,r),this._blur1FBO=p.createWithAttachments(this._rctx,t,r),o.requestImage(this._data.noiseTexture).then(function(t){e._enabled&&(e._noiseTexture=new h(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())})},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e.loadShaders=function(e,t,r){d.assert(null==e.samples),e._parse(n);var i=new f(r,e.vertexShaderShowDepth,e.fragmentShaderShowDepth,a.Default3D),o=e.createFsSSAOSrcObscurance,s=new f(r,e.vsUVQuad,o,a.Default3D,{NUM_TAP_SAMPLES:"8"}),l=new f(r,e.vsUVQuad,o,a.Default3D,{NUM_TAP_SAMPLES:"16"}),u=new f(r,e.vsUVQuad,o,a.Default3D,{NUM_TAP_SAMPLES:"32"}),c=new f(r,e.vsUVQuad,o,a.Default3D,{NUM_TAP_SAMPLES:"64"}),p=new f(r,e.vsUVQuad,e.fsBlurEdgeAware,a.Default3D,{RADIUS:4..toString()});t.add("showDepth",i),t.add("ssao8",s),t.add("ssao16",l),t.add("ssao32",u),t.add("ssao64",c),t.add("blur",p)},e}(),b=l.vec2d.create(),_=l.vec4d.create(),x=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return y}.apply(null,n))||(e.exports=i)},1340:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(1312),r(1423),r(1288),r(1278),r(1293),r(1294),r(1277),r(1285),r(1280),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p){function f(e,t,r,i,o,a,s){s=!1!==s,n.requestImage(t).then(function(t){if(u.assert(t.width>=1&&t.height>=1),r.samplingMode=s?9987:9729,r.hasMipmap=s,!s&&33071===r.wrapMode||u.isPowerOfTwo(t.width)&&u.isPowerOfTwo(t.height)){r.width=t.width,r.height=t.height;var n=new c(e,r,t);e.bindTexture(n),a(n)}else{n=h(e,t,r,i,o);e.bindTexture(n),a(n)}}).catch(function(e){var r=t.length>200?t.slice(0,100)+"..."+t.slice(t.length-100):t;m.error("Failed to load image from uri",r,e),a(null)})}function h(e,t,r,n,i){var a=u.nextHighestPowerOfTwo(t.width),l=u.nextHighestPowerOfTwo(t.height);u.assert(a!==t.width||l!==t.height),r.width=a,r.height=l;var f=new c(e,r),h=d.createWithAttachments(e,f,{colorTarget:0,depthStencilTarget:0}),m=new c(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t);if(e.bindFramebuffer(h),void 0===i){var g=e.getViewport();i=[g.x,g.y,g.width,g.height]}e.setViewport(0,0,a,l);var y=n.get("texOnly"),b=v.identity();e.bindProgram(y),y.setUniformMatrix4fv("model",b),y.setUniformMatrix4fv("view",b),y.setUniformMatrix4fv("proj",b),y.setUniform4f("color",1,1,1,1),y.setUniform1i("tex",0);var _=s.createQuadVAO(e,o.Pos3Tex);return e.bindTexture(m,0),e.bindVAO(_),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!1),e.drawArrays(5,0,p.vertexCount(_,"geometry")),e.setDepthTestEnabled(!0),e.bindFramebuffer(null),e.setViewport(i[0],i[1],i[2],i[3]),_.dispose(!0),m.dispose(),e.bindFramebuffer(null),h.detachColorTexture(),h.dispose(),r.hasMipmap&&f.generateMipmap(),f}var m=r.getLogger("esri.views.3d.webgl-engine.lib.Texture"),v=a.mat4d;return function(){function e(t,r,n){this.data=t,this.id=e.idGen.gen(r),this.unloadFunc=void 0,this.params=n||{},this.params.wrapClamp=this.params.wrapClamp||!1,this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.estimatedTexMemRequiredMB=e.estimateTexMemRequiredMB(this.data,this.params)}return e.estimateTexMemRequiredMB=function(e,t){return null==e?0:e instanceof ArrayBuffer||e instanceof Uint8Array?e.byteLength/1e6:e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement?(t.mipmap?4/3:1)*e.width*e.height*4/1e6:(t.mipmap?4/3:1)*t.width*t.height*4/1e6||0},e.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB},e.prototype.dispose=function(){this.data=void 0},e.prototype.deferredLoading=function(){return"string"==typeof this.data},e.prototype.getWidth=function(){return this.params.width},e.prototype.getHeight=function(){return this.params.height},e.prototype.initializeThroughUpload=function(t,r,n,o,a){var s=this.data;if(r.flipped=!this.params.noUnpackFlip,r.samplingMode=this.params.mipmap?9987:9729,r.hasMipmap=this.params.mipmap,r.wrapMode=this.params.wrapClamp?33071:10497,r.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof s)f(t,s,r,n,o,a,this.params.mipmap);else if(s instanceof Image||s instanceof ImageData||s instanceof HTMLCanvasElement){if(this.params.width=s.width,this.params.height=s.height,!(this.params.mipmap||!this.params.wrapClamp)||u.isPowerOfTwo(s.width)&&u.isPowerOfTwo(s.height)){r.width=s.width,r.height=s.height;var l=new c(t,r,s);t.bindTexture(l),a(l)}else{l=h(t,s,r,n,o);t.bindTexture(l),a(l)}}else if(s instanceof ArrayBuffer&&this.params.encoding===e.DDS_ENCODING){l=i.createDDSTexture(t,r,s,this.params.mipmap);t.bindTexture(l),a(l)}else if(s instanceof Uint8Array&&this.params.encoding===e.DDS_ENCODING){l=i.createDDSTexture(t,r,s.buffer,this.params.mipmap);t.bindTexture(l),a(l)}else if(s instanceof Uint8Array){u.assert(this.params.width>0&&this.params.height>0),r.pixelFormat=1===this.params.components?6409:6408,r.width=this.params.width,r.height=this.params.height;l=new c(t,r,s);t.bindTexture(l),a(l)}else{if(null!==s)throw console.warn("Unsupported image data"),new Error("Unsupported image data");l=new c(t,r,null);t.bindTexture(l),a(l)}this.data=void 0},e.prototype.setUnloadFunc=function(e){this.unloadFunc=e},e.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},e.createEmpty=function(t){return void 0===t&&(t="emptyTexture"),new e(new Uint8Array([0,0,0,0]),t,{width:1,height:1,wrapClamp:!0})},e.idGen=new l,e.DDS_ENCODING="image/vnd-ms.dds",e}()}.apply(null,n))||(e.exports=i)},1341:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(151)],void 0===(i=function(e,t,r){function n(e){return null!=e.cachedResult}Object.defineProperty(t,"__esModule",{value:!0}),t.createContext=function(e,t,n){var i=null,o=e&&e.expression;if("string"==typeof o){var a=function(e){return"0"===e?0:null}(o);if(null!=a)i={cachedResult:a};else{var s=r.createSyntaxTree(o);r.dependsOnView(s)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),i={cachedResult:0}):i={arcade:{func:r.createFunction(s),context:r.createExecContext(null,{sr:t})}}}}return i},t.createFeature=function(e,t){return r.createFeature(e.attributes,e.geometry,t)},t.setContextFeature=function(e,t){null==e||n(e)||r.updateExecContext(e.arcade.context,t)},t.execute=function(e){if(null!=e){if(n(e))return e.cachedResult;var t=e.arcade,i=r.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var r=e&&e.featureExpressionInfo,n=r&&r.expression;return t||"0"===n||(r=null),r},t.zeroContext={cachedResult:0}}.apply(null,n))||(e.exports=i)},1344:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9),r(1278),r(1311),r(1328)],void 0===(i=function(e,t,r,n,i,o){var a=n.vec3d.create(),s=n.vec3d.create(),l=r("dojo-debug-messages"),u=function(){function e(e,t,r,i,a,s,u,p){void 0===p&&(p=!1),this.dir=n.vec3d.create(),this.normalDir=null,this.minResult=new d,this.maxResult=new d,this.transform=n.mat4d.create(),this._transformInverse=new c({value:this.transform},n.mat4d.inverse,n.mat4d.create),this._transformInverseTranspose=new c(this._transformInverse,n.mat4d.transpose,n.mat4d.create),this._transformTranspose=new c({value:this.transform},n.mat4d.transpose,n.mat4d.create),this._transformInverseRotation=new c({value:this.transform},n.mat4d.toInverseMat3,n.mat3d.create),this.enableHUDSelection=!0,this.enableTerrain=!0,this.enableInvisibleTerrain=!1,this.enableBackfacesTerrain=!0,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.viewingMode=e||"global",this.intersectObject=this.intersectObject.bind(this),l&&(this.timer=new o(1)),this.init(t,r,i,a,s,u,p)}return e.prototype.init=function(e,t,r,i,o,a,s){if(t&&r&&n.vec3d.subtract(r,t,this.dir),this.minResult.init(t,r),this.maxResult.init(t,r),this.numObjectsTested=0,this.point=i,this.camera=o,this.isSelection=s,this.layers=e,this.p0=t,this.p1=r,this.hudResults=[],null==a&&(a=1e-5),this.tolerance=a,this.layers){l&&this.timer.start();for(var u=0;u<this.layers.length;++u){var d=this.layers[u],c=d.getSpatialQueryAccelerator?d.getSpatialQueryAccelerator():void 0;if(c)c.forEachAlongRay(this.p0,this.dir,this.intersectObject),s&&c.forEachDegenerateObject(this.intersectObject);else for(var p=d.getObjects(),f=0;f<p.length;++f)this.intersectObject(p[f])}l&&(this.timer.stop(),this.performanceInfo.queryDuration=this.timer.getLast(),this.performanceInfo.numObjectsTested=this.numObjectsTested)}},Object.defineProperty(e.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.getDirection=function(){return this.normalDir||(this.normalDir=n.vec3d.create(),n.vec3d.normalize(this.dir,this.normalDir)),this.normalDir},e.prototype.intersectObject=function(e){var t=this;this.numObjectsTested++;for(var r,i=e.id,o=e.getGeometryRecords(),l=e.objectTransformation,u=0;u<o.length;u++){var c=o[u],p=c.geometry,f=c.materials,h=c.instanceParameters;h.hidden||(r=p.id,n.mat4d.set(l,this.transform),n.mat4d.multiply(this.transform,c.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),n.mat4d.multiplyVec3(this.transformInverse,this.p0,a),n.mat4d.multiplyVec3(this.transformInverse,this.p1,s),f[0].intersect(p,h,this.transform,this,a,s,function(n,o,a,s,l,u){if(n>=0)if(l){var c=new d;c.init(t.p0,t.p1),c.set(e,i,n,o,s,u,r,a),t.hudResults.push(c)}else(null==t.minResult.priority||s>=t.minResult.priority)&&(null==t.minResult.dist||n<t.minResult.dist)&&t.minResult.set(e,i,n,o,s,null,r,a),(null==t.maxResult.priority||s>=t.maxResult.priority)&&(null==t.maxResult.dist||n>t.maxResult.dist)&&t.maxResult.set(e,i,n,o,s,null,r,a)},c.customTransformation))}},e.prototype.getMinResult=function(){return this.minResult},e.prototype.getMaxResult=function(){return this.maxResult},e.prototype.getHudResults=function(){return this.hudResults},e.DEFAULT_TOLERANCE=1e-5,e}(),d=function(){function e(e,t){this.normal=n.vec3d.create(),this.init(e,t)}return e.prototype.getIntersectionPoint=function(e){return null!=this.dist&&(n.vec3d.lerp(this.p0,this.p1,this.dist,e),!0)},e.prototype.set=function(e,t,r,o,a,s,l,u){e instanceof i&&(e={type:"stage",obj:e}),this.dist=r,n.vec3d.set(o,this.normal),this.target=e,this.name=t,this.priority=a,this.center=s?n.vec3d.create(s):null,this.geometryId=l,this.triangleNr=u},e.prototype.copyFrom=function(e){this.p0=e.p0,this.p1=e.p1,this.dist=e.dist,this.target=e.target,this.name=e.name,this.priority=e.priority,this.center=e.center?n.vec3d.create(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,n.vec3d.set(e.normal,this.normal)},e.prototype.setIntersector=function(e){this.intersector=e},e.prototype.init=function(e,t){this.dist=void 0,this.target=void 0,this.name=void 0,this.priority=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",this.p0=e,this.p1=t},e}(),c=function(){function e(e,t,r){this.original=e,this.update=t,this.dirty=!0,this.transform=r()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}();return u}.apply(null,n))||(e.exports=i)},1345:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1379)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0!==e.activeCount||(e.dispose(),!1)})},e.prototype.getBuffer=function(e){for(var t=0,n=this.buffers;t<n.length;t++){var i=n[t];if(i.availableCount>=e)return i}if(e>r.MAX_INDEX_COUNT)return null;var o=new r.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(o),o},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=n}.apply(null,n))||(e.exports=i)},1346:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r){for(var n=0;n<r;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=r,t.decodeDoubleArray=function(e,t,r){for(var n=0;n<r;++n)t[n]=e[2*n]+e[2*n+1]},t.encodeDoubleArraySplit=function(e,t,o,a){for(var s=0;s<a;++s)n[0]=e[s],r(n,i,1),t[s]=i[0],o[s]=i[1]};var n=new Float64Array(1),i=new Float32Array(2)}.apply(null,n))||(e.exports=i)},1347:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(1408),r(1288),r(1295),r(1292),r(1281),r(1289),r(1277),r(1284),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){var p=i.Pos3Col,f=c.getStride(p)/4,h={color:[1,1,1,1],transparent:!1,vertexColors:!1,polygonOffset:!1},m=function(e){function t(t,r){var n=e.call(this,r)||this;return n.supportsEdges=!0,n.params=d.copyParameters(t,h),n}return r(t,e),t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){return d.copyParameters(this.params)},t.prototype.setColor=function(e){this.params.color=e,this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.setTransparent=function(e){this.params.transparent=e,this.notifyDirty("matChanged")},t.prototype.getTransparent=function(){return this.params.transparent},t.prototype.getOutputAmount=function(e){return e*f*1},t.prototype.getVertexBufferLayout=function(){return p},t.prototype.getInstanceBufferLayout=function(){},t.prototype.fillInterleaved=function(e,t,r,n,i,o,a){d.fillInterleaved(e,t,r,n,p,i,o,a)},t.prototype.intersect=function(e,t,r,n,i,o,a,s){d.intersectTriangleGeometry(e,t,r,n,i,o,a)},t.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:g}},t.prototype.getAllTextureIds=function(){return[]},t.loadShaders=function(e,t,r){e._parse(n);var i=new l("colorMaterial",["vertexShaderColorMaterial","fragmentShaderColorMaterial"],null,t,e,r);i.addDefine("Color","VERTEXCOLORS"),t.addShaderVariations("colorMaterial",i)},t}(a),v=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",[this.params.vertexColors])},t.prototype.beginSlot=function(e){return e===(this.params.color[3]<1?s.TRANSPARENT_MATERIAL:s.OPAQUE_MATERIAL)},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),r.setUniform4fv("eColor",n.color),e.setFaceCullingEnabled(!1),n.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(1,1)),n.transparent&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;e.setPolygonOffsetFillEnabled(!1),t.transparent&&e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){d.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(o),g=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",[this.params.vertexColors])},t.prototype.beginSlot=function(e){return e===s.OPAQUE_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),r.setUniform4fv("eColor",n.color),e.setFaceCullingEnabled(!1),n.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(1,1))},t.prototype.release=function(e){e.setPolygonOffsetFillEnabled(!1)},t.prototype.bindView=function(e,t){d.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t}(o);return m}.apply(null,n))||(e.exports=i)},1348:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(1410),r(1295),r(1292),r(1281),r(1289),r(1277),r(1284),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d){function c(e,t,r){3===r.length?e.setUniform4f(t,r[0],r[1],r[2],1):e.setUniform4fv(t,r)}var p=l.VertexAttrConstants,f=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:32,stride:48,normalized:!1}],h={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world"},m=function(e){function t(r,n){var i=e.call(this,n)||this;return i.params=u.copyParameters(r,h),i._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(i.params),i}return r(t,e),Object.defineProperty(t.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},t.prototype.getAllTextureIds=function(){return[]},t.prototype.fillAttributeData=function(e,t,r,n,i,o){var a=e.indices[t],s=e.vertexAttr[t].data;if(a&&s)for(var l=r+d.findAttribute(f,t).offset/4,c=0;c<a.length;c++)for(var p=n*a[c],h=0;h<6;h++)u.fill(s,p,o,l,i,n),l+=12},t.prototype.fillInterleaved=function(e,t,r,n,i,o,a){this.fillAttributeData(e,p.POSITION,o,3,t,i),this.fillAttributeData(e,p.NORMAL,o,3,r,i),this.fillAttributeData(e,p.AUXPOS1,o,4,null,i);for(var s=o+d.findAttribute(f,p.UV0).offset/4,l=0,u=g;l<u.length;l++){var c=u[l];i[s+0]=c[0],i[s+1]=c[1],s+=12}},t.prototype.getOutputAmount=function(e){return 48*e*6},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return f},t.prototype.intersect=function(e,t,r,n,i,o,a,s){},t.prototype.getParameterValues=function(){var e=this.params;return{verticalOffset:e.verticalOffset,screenSizePerspective:e.screenSizePerspective,screenOffset:e.screenOffset,centerOffsetUnits:e.centerOffsetUnits,color:[e.color[0],e.color[1],e.color[2],e.color[3]],size:e.size,borderColor:e.borderColor,occlusionTest:e.occlusionTest,shaderPolygonOffset:e.shaderPolygonOffset,depthHUDAlignStart:e.depthHUDAlignStart}},t.prototype.setParameterValues=function(e){u.updateParameters(this.params,e)&&(this._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))},t.uniqueMaterialIdentifier=function(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})},t.loadShaders=function(e,t,r){e._parse(n);var i=new s("lineCallout",["vertexShaderLineCallout","fragmentShaderLineCallout"],null,t,e,r);i.addDefine("occlTest","OCCL_TEST"),i.addDefine("verticalOffset","VERTICAL_OFFSET"),i.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE"),i.addDefine("depthHud","DEPTH_HUD"),i.addDefine("depthHudAlignStart","DEPTH_HUD_ALIGN_START"),i.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN"),t.addShaderVariations("line-callout-material-shader-variations",i)},t}(o),v=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.isRenderSlot=!0,i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.renderProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!e.occlusionTest,!!e.verticalOffset,!!e.screenSizePerspective,!1,!!e.depthHUDAlignStart,"screen"===e.centerOffsetUnits]),this.depthProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!e.occlusionTest,!!e.verticalOffset,!!e.screenSizePerspective,!0,!!e.depthHUDAlignStart,"screen"===e.centerOffsetUnits])},t.prototype.beginSlot=function(e){switch(e){case a.LINE_CALLOUTS:return this.isRenderSlot=!0,!0;case a.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,!0}return!1},Object.defineProperty(t.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0}),t.prototype.getProgram=function(){return this.program},t.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t.prototype.bind=function(e,t){var r=t.cameraAboveGround?1:-1,n=this.program,i=this.params;e.bindProgram(n),n.setUniform1f("cameraGroundRelative",r),n.setUniform1f("polygonOffset",i.shaderPolygonOffset),n.setUniform4fv("viewport",t.viewport),n.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.setUniform1i("hudVisibilityTexture",0),e.bindTexture(t.hudVisibilityTexture,0),c(n,"color",i.color),n.setUniform2f("screenOffset",i.screenOffset[0],i.screenOffset[1]),this.bindBorder(e,t),u.bindVerticalOffset(i.verticalOffset,t,n),this.bindSizing(e,t),u.bindScreenSizePerspective(i.screenSizePerspective,n),this.isRenderSlot?this.bindRender(e,t):this.bindHUDDepth(e,t)},t.prototype.bindRender=function(e,t){e.setBlendFunctionSeparate(1,771,770,771),e.setBlendingEnabled(!0),e.setDepthWriteEnabled(!1)},t.prototype.bindHUDDepth=function(e,t){e.setColorMask(!1,!1,!1,!1),e.setDepthWriteEnabled(!0),e.setBlendingEnabled(!1),e.setDepthTestEnabled(!0)},t.prototype.bindView=function(e,t){var r=this.program;u.bindView(t.origin,t.view,r),u.bindCamPos(t.origin,t.viewInvTransp,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.release=function(e,t){this.isRenderSlot?this.releaseRender(e,t):this.releaseHUDDepth(e,t)},t.prototype.releaseRender=function(e,t){e.setBlendingEnabled(!1),e.setBlendFunction(770,771),e.setDepthWriteEnabled(!0)},t.prototype.releaseHUDDepth=function(e,t){e.setColorMask(!0,!0,!0,!0)},t.prototype.bindSizing=function(e,t){var r=this.program,n=this.params;r.setUniform2f("pixelToNDC",2/t.viewport[2],2/t.viewport[3]),r.setUniform1f("lineSize",Math.ceil(n.size))},t.prototype.bindBorder=function(e,t){var r=this.program,n=this.params;null!==n.borderColor?(c(r,"borderColor",n.borderColor),r.setUniform1f("borderSize",1)):(r.setUniform4f("borderColor",0,0,0,0),r.setUniform1f("borderSize",0))},t}(i),g=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]];return m}.apply(null,n))||(e.exports=i)},1349:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(1413),r(7),r(1300),r(1290),r(1288),r(1278),r(1295),r(1292),r(1281),r(1289),r(1277),r(1284),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m){var v=f.VertexAttrConstants,g="ribbon-line-material-shader-variations",y="ribbon-line-material-highlight-shader-variations",b=i.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),_=function(e){function t(t,r){var n=e.call(this,r)||this;return n.params=h.copyParameters(t,k),"miter"!==n.params.join&&(n.params.miterLimit=0),n.numVertsAtJoin="wall"===n.params.type?2:4,n.numVertsAtCap=2,n.canBeMerged="screen"===n.params.type&&null==n.params.stippleLength,n}return r(t,e),t.prototype.setColor=function(e){this.params.color=e,this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.dispose=function(){},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){var e=this.params;return{color:e.color,width:e.width,type:e.type,join:e.join,polygonOffset:e.polygonOffset,miterLimit:e.miterLimit,stippleLength:e.stippleLength}},t.prototype.setParameterValues=function(e){for(var t in e)f.assert("type"!==t,"RibbonLineMaterial: type cannot be changed after creation"),f.assert("stippleLength"!==t||null!=e[t]==(null!=this.params[t]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[t]=e[t];"miter"!==this.params.join&&(this.params.miterLimit=0),this.notifyDirty("matChanged")},t.prototype.getOutputAmount=function(e){var t=(e/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;return this.canBeMerged&&(t+=2),t*m.getStride(B)/4},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return"wall"===this.params.type?z:B},t.prototype.fillInterleaved=function(e,t,r,n,i,o){var a=e.vertexAttr[v.POSITION].data,s=e.vertexAttr[v.COLOR]?e.vertexAttr[v.COLOR].data:S,l=e.vertexAttr[v.SIZE]?e.vertexAttr[v.SIZE].data:C,u=e.indices&&e.indices[v.POSITION];u&&u.length!==2*(a.length/3-1)&&console.warn("RibbonLineMaterial does not support indices"),"wall"===this.params.type?this.fillWithoutAuxpos(a,t,i,o):this.fillWithAuxpos(a,s,l,t,i,o)},t.prototype.intersect=function(e,t,r,n,i,s,u,d){if(n.isSelection&&!a.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){if(!f.isTranslationMatrix(r))return void b.error("intersection assumes a translation-only matrix");var c=e.getData(),p=c.getVertexAttr()[v.POSITION].data,h=c.getVertexAttr()[v.SIZE],m=h&&h.data[0],g=n.camera,y=n.point,_=(m+this.params.width)/2+4;l.vec3d.set3(y[0]-_,y[1]+_,0,L[0]),l.vec3d.set3(y[0]+_,y[1]+_,0,L[1]),l.vec3d.set3(y[0]+_,y[1]-_,0,L[2]),l.vec3d.set3(y[0]-_,y[1]-_,0,L[3]);for(var x=0;x<4;x++)g.unprojectPoint(L[x],N[x]);o.plane.fromPoints(g.eye,N[0],N[1],F),o.plane.fromPoints(g.eye,N[1],N[2],U),o.plane.fromPoints(g.eye,N[2],N[3],V),o.plane.fromPoints(g.eye,N[3],N[0],j);var w=Number.MAX_VALUE;for(x=0;x<p.length-5;x+=3)if(D[0]=p[x]+r[12],D[1]=p[x+1]+r[13],D[2]=p[x+2]+r[14],E[0]=p[x+3]+r[12],E[1]=p[x+4]+r[13],E[2]=p[x+5]+r[14],!(o.plane.distance(F,D)<0&&o.plane.distance(F,E)<0||o.plane.distance(U,D)<0&&o.plane.distance(U,E)<0||o.plane.distance(V,D)<0&&o.plane.distance(V,E)<0||o.plane.distance(j,D)<0&&o.plane.distance(j,E)<0)){if(g.projectPoint(D,O),g.projectPoint(E,I),O[2]<0&&I[2]>0){l.vec3d.subtract(D,E,A);var S=g.frustumPlanes,C=-o.plane.distance(S[4],D)/l.vec3d.dot(A,S[4]);l.vec3d.scale(A,C,A),l.vec3d.add(D,A,D),g.projectPoint(D,O)}else if(O[2]>0&&I[2]<0){l.vec3d.subtract(E,D,A);S=g.frustumPlanes,C=-o.plane.distance(S[4],E)/l.vec3d.dot(A,S[4]);l.vec3d.scale(A,C,A),l.vec3d.add(E,A,E),g.projectPoint(E,I)}else if(O[2]<0&&I[2]<0)continue;var k=f.pointLineSegmentDistanceSquared2D(O,I,y);k<w&&(w=k,l.vec3d.set(D,R),l.vec3d.set(E,P))}var z=n.p0,B=n.p1;if(w<_*_){var G=f.lineLineDistanceSquared3D(R,P,z,B,M),H=Number.MAX_VALUE;if(G.success){l.vec3d.subtract(G.pa,z,T);var W=l.vec3d.length(T);l.vec3d.scale(T,1/W),H=W/l.vec3d.dist(z,B)}u(H,T)}}},t.prototype.getGLMaterials=function(){return{color:x,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:w}},t.prototype.getAllTextureIds=function(){return[]},t.prototype.fillWithAuxpos=function(e,t,r,n,i,o){var a=e.length/3,s=e[0],l=e[1],u=e[2],d=0,c=o,p=m.getStride(this.getVertexBufferLayout())/4;this.canBeMerged&&(o+=p),n&&(s=n[0]*s+n[4]*l+n[8]*u+n[12],l=n[1]*s+n[5]*l+n[9]*u+n[13],u=n[2]*s+n[6]*l+n[10]*u+n[14]);var f=s,h=l,v=u,g=e[3],y=e[4],b=e[5];n&&(g=n[0]*g+n[4]*y+n[8]*b+n[12],y=n[1]*g+n[5]*y+n[9]*b+n[13],b=n[2]*g+n[6]*y+n[10]*b+n[14]);for(var _=0;_<a;_++){var x=3*_;_<a-1&&(g=e[x+3],y=e[x+4],b=e[x+5],n&&(g=n[0]*g+n[4]*y+n[8]*b+n[12],y=n[1]*g+n[5]*y+n[9]*b+n[13],b=n[2]*g+n[6]*y+n[10]*b+n[14])),d+=Math.sqrt((f-s)*(f-s)+(h-l)*(h-l)+(v-u)*(v-u)),i[o++]=f,i[o++]=h,i[o++]=v,i[o++]=d,i[o++]=0===_?-1.2:-1,i[o++]=s,i[o++]=l,i[o++]=u,i[o++]=g,i[o++]=y,i[o++]=b,i[o++]=t[0],i[o++]=t[1],i[o++]=t[2],i[o++]=t[3],i[o++]=r[0],i[o++]=f,i[o++]=h,i[o++]=v,i[o++]=d,i[o++]=0===_?1.2:1,i[o++]=s,i[o++]=l,i[o++]=u,i[o++]=g,i[o++]=y,i[o++]=b,i[o++]=t[0],i[o++]=t[1],i[o++]=t[2],i[o++]=t[3],i[o++]=r[0],_>0&&_<a-1&&(i[o++]=f,i[o++]=h,i[o++]=v,i[o++]=d,i[o++]=-1.2,i[o++]=s,i[o++]=l,i[o++]=u,i[o++]=g,i[o++]=y,i[o++]=b,i[o++]=t[0],i[o++]=t[1],i[o++]=t[2],i[o++]=t[3],i[o++]=r[0],i[o++]=f,i[o++]=h,i[o++]=v,i[o++]=d,i[o++]=1.2,i[o++]=s,i[o++]=l,i[o++]=u,i[o++]=g,i[o++]=y,i[o++]=b,i[o++]=t[0],i[o++]=t[1],i[o++]=t[2],i[o++]=t[3],i[o++]=r[0]),s=f,l=h,u=v,f=g,h=y,v=b}if(this.canBeMerged){for(_=c;_<c+p;_++)i[_]=i[_+p];var w=o-p;for(_=0;_<p;_++)i[o++]=i[w++]}},t.prototype.fillWithoutAuxpos=function(e,t,r,n){for(var i,o,a,s=e.length/3,l=0,u=e[0],d=e[1],c=e[2],p=0;p<s;p++){var f=3*p;i=u,o=d,a=c,u=e[f],d=e[f+1],c=e[f+2],t&&(u=t[0]*u+t[4]*d+t[8]*c+t[12],d=t[1]*u+t[5]*d+t[9]*c+t[13],c=t[2]*u+t[6]*d+t[10]*c+t[14]),l+=Math.sqrt((u-i)*(u-i)+(d-o)*(d-o)+(c-a)*(c-a)),r[n++]=u,r[n++]=d,r[n++]=c,r[n++]=l,r[n++]=-1,r[n++]=u,r[n++]=d,r[n++]=c,r[n++]=l,r[n++]=1}},t.loadShaders=function(e,t,r){e._parse(n);var i=function(e){e.addDefine("Screen","SCREENSCALE"),e.addDefine("Strip","STRIP"),e.addDefine("Wall","WALL"),e.addDefine("Stipple","STIPPLE")},o=new p("ribbon-line",["vsRibbonLine","fsRibbonLine"],null,t,e,r);i(o),t.addShaderVariations(g,o);var a=new p("ribbon-line",["vsRibbonLine","fsRibbonLineHighlight"],null,t,e,r);i(a),t.addShaderVariations(y,a)},t}(d),x=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.params=h.copyParameters(t.getParams()),delete n.params.join,n.program=r.getShaderVariationsProgram(g,["screen"===n.params.type,"strip"===n.params.type,"wall"===n.params.type,null!=n.params.stippleLength]),n}return r(t,e),t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.polygonOffset=e.polygonOffset,t.color=e.color,t.width=e.width,t.miterLimit="miter"===e.join?e.miterLimit:0,t.stippleLength=e.stippleLength},t.prototype.beginSlot=function(e){return e===c.TRANSPARENT_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,n=this.params;if(e.bindProgram(r),r.setUniform4fv("eColor",n.color),r.setUniform1f("miterLimit",n.miterLimit),r.setUniform1f("nearPlane",t.nearFar[0]),"screen"===n.type?(r.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),r.setUniform1f("extLineWidth",n.width*t.pixelRatio)):r.setUniform1f("extLineWidth",n.width),null!=n.stippleLength){var i=n.stippleLength?1/(2*n.stippleLength):0;r.setUniform1f("stippleLengthDoubleInv",i)}n.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setFaceCullingEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(n.color[3]>=1)},t.prototype.release=function(e){this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1),e.setBlendingEnabled(!1),e.setDepthWriteEnabled(!0)},t.prototype.bindView=function(e,t){h.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLE_STRIP},t}(u),w=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.params=h.copyParameters(t.getParams()),delete n.params.join,n.program=r.getShaderVariationsProgram(y,["screen"===n.params.type,"strip"===n.params.type,"wall"===n.params.type,null!=n.params.stippleLength]),n}return r(t,e),t.prototype.updateParameters=function(){var e=this.material.getParams(),t=this.params;t.polygonOffset=e.polygonOffset,t.color=e.color,t.width=e.width,t.miterLimit="miter"===e.join?e.miterLimit:0,t.stippleLength=e.stippleLength},t.prototype.beginSlot=function(e){return e===c.OPAQUE_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,n=this.params;if(e.bindProgram(r),r.setUniform4fv("eColor",n.color),r.setUniform1f("miterLimit",n.miterLimit),r.setUniform1f("nearPlane",t.nearFar[0]),"screen"===n.type?(r.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),r.setUniform1f("extLineWidth",n.width*t.pixelRatio)):r.setUniform1f("extLineWidth",n.width),null!=n.stippleLength){var i=n.stippleLength?1/(2*n.stippleLength):0;r.setUniform1f("stippleLengthDoubleInv",i)}n.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setFaceCullingEnabled(!1),e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(n.color[3]>=1)},t.prototype.release=function(e){this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1),e.setDepthWriteEnabled(!0)},t.prototype.bindView=function(e,t){h.bindView(t.origin,t.view,this.program)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLE_STRIP},t}(u),S=[255,255,255,255],C=[0,0,0,0],D=l.vec3d.create(),E=l.vec3d.create(),A=l.vec3d.create(),T=l.vec3d.create(),O=l.vec3d.create(),I=l.vec3d.create(),R=l.vec3d.create(),P=l.vec3d.create(),M={success:!1,dist2:0,pa:l.vec3d.create(),pb:l.vec3d.create()},L=[l.vec3d.create(),l.vec3d.create(),l.vec3d.create(),l.vec3d.create()],N=[l.vec3d.create(),l.vec3d.create(),l.vec3d.create(),l.vec3d.create()],F=o.plane.create(),U=o.plane.create(),V=o.plane.create(),j=o.plane.create(),k={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,polygonOffset:!1,stippleLength:null},z=s.Pos3Tex,B=[{name:"position",count:3,type:5126,offset:0,stride:64,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:64,normalized:!1},{name:"auxpos1",count:3,type:5126,offset:20,stride:64,normalized:!1},{name:"auxpos2",count:3,type:5126,offset:32,stride:64,normalized:!1},{name:"color",count:4,type:5126,offset:44,stride:64,normalized:!1},{name:"size",count:1,type:5126,offset:60,stride:64,normalized:!1}];return _}.apply(null,n))||(e.exports=i)},1350:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(40)],void 0===(i=function(e,t,r){function n(e,t,n,i){var o=s;return e?(n&&i&&(o.len=r.vec3d.dist(t,n)),r.vec3d.set(e,o.dir)):i?(o.len=r.vec3d.dist(t,n),r.vec3d.scale(r.vec3d.subtract(n,t,o.dir),1/o.len)):r.vec3d.normalize(r.vec3d.subtract(n,t,o.dir)),o}function i(e,t){return-r.vec3d.dot(t,e)-e[3]}function o(e,t,n){var o=r.vec3d.dot(e,n.dir),a=i(e,t);if(a<0&&o>=0)return!1;if(o>-1e-6&&o<1e-6)return a>0;if((a<0||o<0)&&!(a<0&&o<0))return!0;var s=a/o;return o>0?s<n.clip[1]&&(n.clip[1]=s):s>n.clip[0]&&(n.clip[0]=s),n.clip[0]<=n.clip[1]}function a(e,t,r,n){n.clip[0]=0,n.clip[1]=r?n.len:Number.MAX_VALUE;for(var i=0;i<e.length;i++)if(!o(e[i],t,n))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.planeSphere=function(e,t,r){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]<r},t.frustumSphere=function(e,t,r){var n=t[0],i=t[1],o=t[2];return!(e[0][0]*n+e[0][1]*i+e[0][2]*o+e[0][3]>r||e[1][0]*n+e[1][1]*i+e[1][2]*o+e[1][3]>r||e[2][0]*n+e[2][1]*i+e[2][2]*o+e[2][3]>r||e[3][0]*n+e[3][1]*i+e[3][2]*o+e[3][3]>r||e[4][0]*n+e[4][1]*i+e[4][2]*o+e[4][3]>r||e[5][0]*n+e[5][1]*i+e[5][2]*o+e[5][3]>r)},t.frustumRay=function(e,t,r,i){return a(e,t,null,n(i,t,r,!1))},t.frustumPoint=function(e,t){for(var r=0;r<6;r++)if(i(e[r],t)<0)return!1;return!0},t.frustumLineSegment=function(e,t,r,i){return a(e,t,r,n(i,t,r,!0))},t.closestPointOnRay=function(e,t,n,i){var o=r.vec3d.dot(t,r.vec3d.subtract(n,e,i));return r.vec3d.add(e,r.vec3d.scale(t,o,i),i),i};var s={dir:r.vec3d.create(),len:0,clip:r.vec2d.create()}}.apply(null,n))||(e.exports=i)},1352:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(5),r(7),r(1442)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,n){for(var i="",o=0;o<n;){var a=e[t+o];if(a<128)i+=String.fromCharCode(a),o++;else if(a>=192&&a<224){if(o+1>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var s=(31&a)<<6|63&e[t+o+1];i+=String.fromCharCode(s),o+=2}else if(a>=224&&a<240){if(o+2>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");s=(15&a)<<12|(63&e[t+o+1])<<6|63&e[t+o+2];i+=String.fromCharCode(s),o+=3}else{if(!(a>=240&&a<248))throw new r("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");if(o+3>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");if((s=(7&a)<<18|(63&e[t+o+1])<<12|(63&e[t+o+2])<<6|63&e[t+o+3])>=65536){var l=55296+(s-65536>>10),u=56320+(1023&s);i+=String.fromCharCode(l,u)}else i+=String.fromCharCode(s);o+=4}}return i}function s(e,r){for(var n={byteOffset:0,byteCount:0,fields:Object.create(null)},i=0,o=0;o<r.length;o++){var a=r[o],s=a.valueType||a.type,l=t.valueType2ArrayBufferReader[s];n.fields[a.property]=l(e,i),i+=t.valueType2TypedArrayClassMap[s].BYTES_PER_ELEMENT}return n.byteCount=i,n}function l(e,t,n){var i,o,s=[],l=0;for(o=0;o<e;o+=1){if((i=t[o])>0){if(s.push(a(n,l,i-1)),0!==n[l+i-1])throw new r("string-array-error","Invalid string array: missing null termination.")}else s.push(null);l+=i}return s}function u(e,r){return new(0,t.valueType2TypedArrayClassMap[r.valueType])(e,r.byteOffset,r.count*r.valuesPerElement)}function d(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function c(e,t,i){for(var o=null!=t.header?s(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},a={header:o,byteOffset:o.byteCount,byteCount:0,entries:Object.create(null)},l=o.byteCount,u=0;u<t.ordering.length;u++){var d=t.ordering[u],c=n.clone(t[d]);if(c.count=o.fields.count,"String"===c.valueType){if(c.byteOffset=l,c.byteCount=o.fields[d+"ByteCount"],"UTF-8"!==c.encoding)throw new r("unsupported-encoding","Unsupported String encoding.",{encoding:c.encoding})}else{if(!f(c.valueType))throw new r("unsupported-value-type","Unsupported binary valueType",{valueType:c.valueType});var p=h(c.valueType);l+=l%p!=0?p-l%p:0,c.byteOffset=l,c.byteCount=p*c.valuesPerElement*c.count}l+=c.byteCount,a.entries[d]=c}return a.byteCount=l-a.byteOffset,a}function p(e,t,n){if(t!==e&&m.error("Invalid "+n+" buffer size\n expected: "+e+", actual: "+t+")"),t<e)throw new r("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function f(e){return t.valueType2TypedArrayClassMap.hasOwnProperty(e)}function h(e){return f(e)&&t.valueType2TypedArrayClassMap[e].BYTES_PER_ELEMENT}Object.defineProperty(t,"__esModule",{value:!0});var m=i.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");t.readHeader=s,t.readStringArray=l,t.createTypedView=u,t.createRawView=d,t.createAttributeDataIndex=c,t.createGeometryDataIndex=function(e,t,r){var i=s(e,t&&t.header),o=i.byteCount,a={header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:n.clone(t.vertexAttributes)},l=a.vertexAttributes;r||null==l.region||delete l.region;for(var u=i.fields,d=null!=u.vertexCount?u.vertexCount:u.count,c=0;c<t.ordering.length;c++){var f=t.ordering[c];null!=l[f]&&(l[f].byteOffset=o,l[f].count=d,o+=h(l[f].valueType)*l[f].valuesPerElement*d)}var m=u.faceCount;if(t.faces&&m){a.faces=n.clone(t.faces);var v=a.faces;for(c=0;c<t.ordering.length;c++){var g=t.ordering[c];null!=v[g]&&(v[g].byteOffset=o,v[g].count=m,o+=h(v[g].valueType)*v[g].valuesPerElement*m)}}var y=u.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&y){a.featureAttributes=n.clone(t.featureAttributes);var b=a.featureAttributes;for(c=0;c<t.featureAttributeOrder.length;c++){var _=t.featureAttributeOrder[c];b[_].byteOffset=o,b[_].count=y;var x=h(b[_].valueType);"UInt64"===b[_].valueType&&(x=8),o+=x*b[_].valuesPerElement*y}}return p(o,e.byteLength,"geometry"),a.byteCount=o-a.byteOffset,a},t.readBinaryAttribute=function(e,t,n){if("lepcc-rgb"===e.encoding)return o.decodeRGB(t);if("lepcc-intensity"===e.encoding)return o.decodeIntensity(t);if(null!=e.encoding&&""!==e.encoding)throw new r("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(m.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(m.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");var i=c(t,e,n);p(i.byteOffset+i.byteCount,t.byteLength,"attribute");var a=i.entries.attributeValues||i.entries.objectIds;if(a){if("String"===a.valueType){var s=i.entries.attributeByteCounts,f=u(t,s),h=d(t,a);return l(s.count,f,h)}return u(t,a)}throw new r("bad-attribute-storage-info","Bad attributeStorageInfo specification.")},t.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},t.valueType2ArrayBufferReader={Float32:function(e,t){return new DataView(e,0).getFloat32(t,!0)},Float64:function(e,t){return new DataView(e,0).getFloat64(t,!0)},UInt8:function(e,t){return new DataView(e,0).getUint8(t)},Int8:function(e,t){return new DataView(e,0).getInt8(t)},UInt16:function(e,t){return new DataView(e,0).getUint16(t,!0)},Int16:function(e,t){return new DataView(e,0).getInt16(t,!0)},UInt32:function(e,t){return new DataView(e,0).getUint32(t,!0)},Int32:function(e,t){return new DataView(e,0).getInt32(t,!0)}},t.isValueType=f,t.getBytesPerValue=h}.apply(null,n))||(e.exports=i)},1353:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(406),r(40),r(1461),r(1300)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,r){return{center:n.vec3d.createFrom(e[0],e[1],e[2]),halfSize:d.createFrom(t[0],t[1],t[2]),quaternion:u.createFrom(r[0],r[1],r[2],r[3])}}function s(e,t){var r=o.plane.distance(t,e.center),n=l(e,t);return r>n?1:r<-n?-1:0}function l(e,t){u.conjugate(e.quaternion,p),u.multiplyVec3(p,t,f);var r=e.halfSize;return Math.abs(f[0]*r[0])+Math.abs(f[1]*r[1])+Math.abs(f[2]*r[2])}Object.defineProperty(t,"__esModule",{value:!0});var u=n.quat4,d=n.vec3,c=n.mat3d,p=u.create(),f=d.create(),h=d.create(),m=c.create(),v=function(){return function(e){var t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(var r=0;r<e;r++)this.obbs[r]={center:new Float64Array(this.buffer,56*r+0,3),halfSize:new Float32Array(this.buffer,56*r+24,3),quaternion:new Float32Array(this.buffer,56*r+36,4)}}}();t.ObbArray=v,t.create=a,t.clone=function(e){return a(e.center,e.halfSize,e.quaternion)},t.set=function(e,t){n.vec3d.set(e.center,t.center),n.vec3.set(e.halfSize,t.halfSize),n.quat4.set(e.quaternion,t.quaternion)},t.compute=function(e,t){return t||(t=a([0,0,0],[-1,-1,-1],[0,0,0,1])),i.computeOBB(e,t),t},t.intersectPlane=s,t.toAaBoundingBox=function(e,t){t||(t=r.create());var n=u.toMat3(e.quaternion,m),i=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),o=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),a=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-o,t[2]=e.center[2]-a,t[3]=e.center[0]+i,t[4]=e.center[1]+o,t[5]=e.center[2]+a,t},t.minimumDistancePlane=function(e,t){return o.plane.distance(t,e.center)-l(e,t)},t.maximumDistancePlane=function(e,t){return o.plane.distance(t,e.center)+l(e,t)},t.isVisible=function(e,t){return s(e,t[0])<=0&&s(e,t[1])<=0&&s(e,t[2])<=0&&s(e,t[3])<=0&&s(e,t[4])<=0&&s(e,t[5])<=0},t.intersectLine=function(e,t,r,i){void 0===i&&(i=0),u.conjugate(e.quaternion,p),n.vec3.subtract(t,e.center,f);for(var o=u.multiplyVec3(p,f,f),a=u.multiplyVec3(p,r,h),s=-1/0,l=1/0,d=0;d<3;d++)if(Math.abs(a[d])>1e-6){var c=(i+e.halfSize[d]-o[d])/a[d],m=(-i-e.halfSize[d]-o[d])/a[d];s=Math.max(s,Math.min(c,m)),l=Math.min(l,Math.max(c,m))}else if(o[d]>e.halfSize[d]+i||o[d]<-e.halfSize[d]-i)return!1;return s<=l}}.apply(null,n))||(e.exports=i)},1354:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(111)],void 0===(i=function(e,t,r){return{now:r}}.apply(null,n))||(e.exports=i)},1355:function(e,t,r){var n,i;n=[r(442),r(31),r(5),r(1517),r(443)],void 0===(i=function(e,t,r,n,i){function o(e,t,r){var n="";return 0===t?n=s.lt+" ":t===r&&(n=s.gt+" "),n+e}var a={},s={lte:"<=",gte:">=",lt:"<",gt:">",pct:"%",ld:""},l={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},u={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},d={dateOptions:{formatLength:"short",fullYear:!0},timeOptions:{formatLength:"short"}};return r.mixin(a,{meterIn:{inches:1/.0254,feet:1/.3048,"us-feet":3.28084,yards:1/.9144,miles:1/1609.344,"nautical-miles":1/1852,millimeters:1e3,centimeters:100,decimeters:10,meters:1,kilometers:.001,"decimal-degrees":180/20015077},timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(t,n){var o,a=[];null==t||t instanceof Date||(t=new Date(t)),n=n||{};var s=(n=r.mixin({},n)).selector?n.selector.toLowerCase():null,l=!s||s.indexOf("time")>-1,u=!s||s.indexOf("date")>-1;return l&&(n.timeOptions=n.timeOptions||d.timeOptions,n.timeOptions&&(n.timeOptions=r.mixin({},n.timeOptions),n.timeOptions.selector=n.timeOptions.selector||"time",a.push(n.timeOptions))),u&&(n.dateOptions=n.dateOptions||d.dateOptions,n.dateOptions&&(n.dateOptions=r.mixin({},n.dateOptions),n.dateOptions.selector=n.dateOptions.selector||"date",a.push(n.dateOptions))),a&&a.length?o=1==(a=a.map(function(r){return e.format(t,r)})).length?a[0]:i["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(e,t){return a[t]}):o=e.format(t),o},createColorStops:function(e){var t=e.values,r=e.colors,i=e.labelIndexes,s=e.isDate,l=e.dateFormatOptions;return t.map(function(e,u){var d,c=null;(!i||i.indexOf(u)>-1)&&((d=s?a.formatDate(e,l):n.format(e))&&(c=o(d,u,t.length-1)));return{value:e,color:r[u],label:c}})},updateColorStops:function(e){var t,r=e.stops,i=e.changes,s=e.isDate,l=e.dateFormatOptions,u=[],d=r.map(function(e){return e.value});i.forEach(function(e){u.push(e.index),d[e.index]=e.value}),t=n.round(d,{indexes:u}),r.forEach(function(e,i){if(e.value=d[i],null!=e.label){var u,c=null;(u=s?a.formatDate(t[i],l):n.format(t[i]))&&(c=o(u,i,r.length-1)),e.label=c}})},createClassBreakLabel:function(e){var t=e.minValue,r=e.maxValue,i=e.isFirstBreak,o=e.normalizationType,a=i?"":s.gt+" ",l="percent-of-total"===o?s.pct:"";return t=null==t?"":n.format(t),r=null==r?"":n.format(r),a+t+l+" "+s.ld+" "+r+l},setLabelsForClassBreaks:function(e){var t=e.classBreakInfos,r=e.classificationMethod,i=e.normalizationType,o=[];t&&t.length&&("standard-deviation"===r?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):e.round?(o.push(t[0].minValue),t.forEach(function(e){o.push(e.maxValue)}),o=n.round(o),t.forEach(function(e,t){e.label=a.createClassBreakLabel({minValue:0===t?o[0]:o[t],maxValue:o[t+1],isFirstBreak:0===t,normalizationType:i})})):t.forEach(function(e,t){e.label=a.createClassBreakLabel({minValue:e.minValue,maxValue:e.maxValue,isFirstBreak:0===t,normalizationType:i})}))},updateClassBreak:function(e){var t,r=e.classBreaks,n=e.classificationMethod,i=e.normalizationType,o=e.change,s=o.index,l=o.value,u=-1,d=-1,c=r.length;"standard-deviation"!==n?(0===s?u=s:s===c?d=s-1:(d=s-1,u=s),u>-1&&u<c&&((t=r[u]).minValue=l,t.label=a.createClassBreakLabel({minValue:t.minValue,maxValue:t.maxValue,isFirstBreak:0===u,normalizationType:i})),d>-1&&d<c&&((t=r[d]).maxValue=l,t.label=a.createClassBreakLabel({minValue:t.minValue,maxValue:t.maxValue,isFirstBreak:0===d,normalizationType:i}))):console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method.")},calculateDateFormatInterval:function(e){var t,r,n,i,o,a,s,u,d,c,p=e.length,f=1/0;for(e=e.map(function(e){return new Date(e)}),t=0;t<p-1;t++){for(n=e[t],o=[],u=1/0,d="",r=t+1;r<p;r++)i=e[r],a=(n.getFullYear()!==i.getFullYear()?"year":n.getMonth()!==i.getMonth()&&"month")||n.getDate()!==i.getDate()&&"day"||n.getHours()!==i.getHours()&&"hour"||n.getMinutes()!==i.getMinutes()&&"minute"||n.getSeconds()!==i.getSeconds()&&"second"||"millisecond",(s=l[a])<u&&(u=s,d=a),o.push(a);u<f&&(f=u,c=d)}return c},createUniqueValueLabel:function(e){var t=e.value,r=e.fieldInfo,i=e.domain,o=e.dateFormatInterval,s=String(t),l=i&&i.codedValues?i.getName(t):null;return l?s=l:"number"==typeof t&&(s=r&&"date"===r.type?a.formatDate(t,o&&u[o]):n.format(t)),s},cloneColorVariable:function(e){var n;return e&&((n=r.mixin({},e)).colors=function(e){return e&&e.map(function(e){return new t(e)})}(n.colors),n.stops=n.stops&&n.stops.map(function(e){return(e=r.mixin({},e)).color&&(e.color=new t(e.color)),e}),n.legendOptions&&(n.legendOptions=r.mixin({},n.legendOptions))),n},cloneOpacityVariable:function(e){var t;if(e){var n=(t=r.mixin({},e)).opacityValues;n&&(t.opacityValues=n.slice(0)),(n=t.stops)&&(t.stops=n.map(function(e){return r.mixin({},e)})),(n=t.legendOptions)&&(t.legendOptions=r.mixin({},n))}return t},cloneSizeVariable:function(e){var t;if(e){(t=r.mixin({},e)).stops&&(t.stops=t.stops.map(function(e){return r.mixin({},e)}));var n=t.minSize;n&&"object"==typeof n&&(t.minSize=a.cloneSizeVariable(n)),(n=t.maxSize)&&"object"==typeof n&&(t.maxSize=a.cloneSizeVariable(n)),(n=t.legendOptions)&&(t.legendOptions=r.mixin({},n),(n=n.customValues)&&(t.legendOptions.customValues=n.slice(0)))}return t}}),a}.apply(null,n))||(e.exports=i)},1357:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,n))||(e.exports=i)},1358:function(e,t,r){var n;void 0===(n=function(){function e(e,t,r,n){for(var i=t,o=t,a=r>>>1,s=e[i-1];o<=a;){(o=i<<1)<r&&n(e[o-1],e[o])<0&&++o;var l=e[o-1];if(n(l,s)<=0)break;e[i-1]=l,i=o}e[i-1]=s}function t(e,t){return e<t?-1:e>t?1:0}return{sort:function(r,n,i,o){void 0===n&&(n=0),void 0===i&&(i=r.length),void 0===o&&(o=t);for(var a=i>>>1;a>n;a--)e(r,a,i,o);var s=n+1;for(a=i-1;a>n;a--){var l=r[n];r[n]=r[a],r[a]=l,e(r,s,a,o)}return r}}}.apply(null,[]))||(e.exports=n)},1359:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1355)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.supportsUnit=function(e){return null!=r.meterIn[e]},t.getMetersPerUnit=function(e){return 1/(r.meterIn[e]||1)}}.apply(null,n))||(e.exports=i)},1360:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1294)],void 0===(i=function(e,t,r){return function(){function e(t,r,n,i,o,a){this.id=e._idGen.gen(t.id),this.geometry=t,this.materials=r,this.transformation=n,this.instanceParameters=i,this.origin=o,this.customTransformation=a}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation},e._idGen=new r,e}()}.apply(null,n))||(e.exports=i)},1361:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(407),r(1319),r(1296),r(1277)],void 0===(i=function(e,t,r,n,i,o){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyMaterials=new Set,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach(function(t){e+=t.size}),e},enumerable:!0,configurable:!0}),e.prototype.getDirtyMaterials=function(){return this._dirtyMaterials.size>0?this._dirtyMaterials:null},e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()},e.prototype.hasDirtyGeometryRecords=function(){var e=!1;return n.forEachUntilMap(this._dirtyGeomRecords,function(t){if(e)return!1;n.forEachUntilMap(t,function(t){if(!e&&t&&t.size>0)return e=!0,!1})}),e},e.prototype.handleUpdate=function(e,t,r){return o.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,r)},e.prototype.shaderTransformationChanged=function(e){var t=this,r=this._residentGeomRecords.get(e.id);r&&r.forEach(function(e,r){var n=t._model.content[i.OBJECT][r];n&&n.hasVolativeTransformation()&&e.forEach(function(e){for(var t=0,r=e[1];t<r.length;t++)r[t].shaderTransformationChanged()})})},e.prototype.commit=function(){return this.commitLayers(r.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,r=[],n=[],a=[],s=this,l=0;l<e.length;l++)!function(l){var u=e[l],d=s._dirtyGeomRecords.get(u);if(!d)return"continue";d.forEach(function(e,s){var l=t._ensureGeomRecord(u,s);e.forEach(function(e,u){var d,c=e[0],p=e[1],f=e[2],h=2&p&&1&f;(4&p||h)&&((d=l.get(u))?n.push.apply(n,d[1]):4===p&&o.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),d&&l.delete(u));if(1&p||h){var m=[c,[]],v=t._model.get(i.OBJECT,s);t._model.getGeometryRenderGeometries(v,c,m[1]),r.push.apply(r,m[1]),l.set(u,m)}if(2&p&&!h)if(d=l.get(u)){var g=d[1],y=g.length;if(16&f){v=t._model.get(i.OBJECT,s);for(var b=0;b<y;b++){var _=g[b];t._model.updateRenderGeometryTransformation(v,c,_)}}for(b=0;b<y;b++){_=g[b];a.push({renderGeometry:_,updateType:f})}}else o.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}),0===l.size&&t._residentGeomRecords.get(u).delete(s)}),0===s._residentGeomRecords.get(u).size&&s._residentGeomRecords.delete(u),s._dirtyGeomRecords.delete(u)}(l);return[r,n,a]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(r.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=this._residentGeomRecords.get(n);i&&i.forEach(function(e){e.forEach(function(e){t.push.apply(t,e[1])})})}return t},e.prototype.visibilityChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,2);else for(var n=0,i=e.getGeometryRecords();n<i.length;n++){var o=i[n];this._componentPropertyChanged(e,o,r,2)}},e.prototype.componentHighlightChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,32);else for(var n=0,i=e.getGeometryRecords();n<i.length;n++){var o=i[n];this._componentPropertyChanged(e,o,r,32)}},e.prototype.vertexAttrsUpdated=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,4)},e.prototype.matChanged=function(e){this._dirtyMaterials.add(e.id),this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectAdded(e,t[r])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectRemoved(e,t[r])},e.prototype.layObjectAdded=function(e,t){for(var r=e.id,n=t.getGeometryRecords(),i=0;i<n.length;i++)this.objGeometryAdded(t,n[i],r)},e.prototype.layObjectRemoved=function(e,t){for(var r=e.id,n=t.getGeometryRecords(),i=0;i<n.length;i++)this.objGeometryRemoved(t,n[i],r)},e.prototype.layObjectReplaced=function(e,t){this.layObjectRemoved(e,t[0]),this.layObjectAdded(e,t[1])},e.prototype.objDirty=function(e,t){var r=this;t=t||this._getParentLayerId(e);var n=e.id;this._ensureGeomRecord(t,n).forEach(function(n){r._updateOrCreateDirtyRecord(e,n[0],t,2,0,2,0,5,1)})},e.prototype.objTransformation=function(e,t){var r=this;t=t||this._getParentLayerId(e);var n=e.id;this._ensureGeomRecord(t,n).forEach(function(n){r._updateOrCreateDirtyRecord(e,n[0],t,2,0,0,2,5,16)})},e.prototype.objGeometryAdded=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,r,n){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,n)},e.prototype._updateOrCreateDirtyRecord=function(e,t,r,n,i,a,s,l,u){r=r||this._getParentLayerId(e);var d=e.id,c=t.id,p=this._ensureDirtyRecord(r,d),f=p.get(c);if(f){var h=f[1];h&i?p.delete(c):h&a?(f[1]=n,f[2]=u):h&s?f[2]|=u:h&l||o.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else p.set(c,[t,n,u])},e.prototype._ensureGeomRecord=function(e,t){var r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));var n=r.get(t);return n||(n=new Map,r.set(t,n)),n},e.prototype._ensureDirtyRecord=function(e,t){var r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));var n=r.get(t);return n||(n=new Map,r.set(t,n)),n},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(e){if(e)return"";var t=["ADD","UPD",void 0,"REM"],r="";return this._dirtyGeomRecords.forEach(function(e,n){e.forEach(function(e,i){r.length>0&&(r+="\n"),r+=n+"."+i;var o=[];e.forEach(function(e){var t=e[1];o[t]||(o[t]=[]),o[t].push(e[0].geometry.id)});for(var a=0;a<o.length;a++)if(o[a]){r+=" "+t[a-1]+": ";for(var s=0;s<o[a].length;s++)r+=o[a][s]+", "}})}),r},e}()}.apply(null,n))||(e.exports=i)},1362:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(77),r(1364),r(1278),r(1393),r(1394),r(1337),r(1338),r(1398),r(1330),r(1399),r(1339),r(1401),r(1304),r(1403),r(1329),r(1418),r(409),r(418),r(1466)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g,y,b,_,x){var w=o.vec3d,S=o.vec4d,C=r.getLogger("esri.views.3d.webgl-engine.parts.View");return function(){function e(e,t,r,n){var o=this;this._backgroundColor=S.createFrom(1,1,1,1),this._lightDirection=w.createFrom(0,1,0),this._didRender=!1,this._needsRender=!0,this._idleSuspend=!0,this._shouldRender=!1,this._screenCaptureQueue=[],this._container=e,this._stage=t,this._initializeContext(n),this._initializeShaders(n);this._textureRep=new s(t.getAll(g.ContentType.TEXTURE),this._programRepository,function(){return o._viewport.getCamera().viewport},this._rctx),this._materialRep=new a(this._textureRep,this._programRepository),this._viewport=new y(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx),this._initializeViewportCamera(),this._drapedRenderer=new i(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,r),this._initializeFrameTask()}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype._initializeFrameTask=function(){var e=this;this._frameTask={preRender:function(){h.begin(),e._stage.processDirty(),e.needsRender()?(e._shouldRender=!0,e._viewport.getCamera().setGLViewport(e._rctx),e._rctx.setClearColor.apply(e._rctx,e._backgroundColor),e._rctx.clear(16640)):e._shouldRender=!1},render:function(){e._shouldRender&&(e._didRender=!0,e._viewport.render(e._lightDirection,null))},postRender:function(){h.end()},update:function(){e._performScreenCaptures(),e.resetNeedsRender()}}},e.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this._viewport.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this._viewport.setCamera(t)},e.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil},r=_.createContextOrErrorHTML(this._canvas,t,e.renderContext);this._gl=h.instrumentContext(r);var i={disabledExtensions:e.deactivatedWebGLExtensions||{}};this._rctx=new x(this._gl,i),!e.alpha&&this._rctx.contextAttributes.alpha&&C.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&n("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)},e.prototype._initializeShaders=function(e){var t="global"===e.viewingMode?"#define VIEWING_MODE_GLOBAL 1 \n":" #define VIEWING_MODE_LOCAL 1 \n";this._shaderSnippets=new p({enableRequiredExtensions:"\n#extension GL_OES_standard_derivatives : enable\n",fsprecisionf:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n",vsprecisionf:"\nprecision highp float;\nprecision highp sampler2D;\n",viewingMode:t}),this._programRepository=new d,v.initializeShaders(this._shaderSnippets,this._programRepository,this._rctx),l.loadShaders(this._shaderSnippets,this._programRepository,this._rctx),c.loadShaders(this._shaderSnippets,this._programRepository,this._rctx),f.loadShaders(this._shaderSnippets,this._programRepository,this._rctx),u.loadShaders(this._shaderSnippets,this._programRepository,this._rctx)},e.prototype.dispose=function(){this._viewport.dispose(),this._viewport=null,this._drapedRenderer.dispose(),this._drapedRenderer=null,this._programRepository.dispose(),this._programRepository=null,this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._container=null,this._canvas=null,this._gl=null},e.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},e.prototype.setNeedsRender=function(){this._didRender=!1,this._needsRender=!0},e.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1),this._viewport.resetNeedsRender(),this._textureRep.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()},e.prototype.getFrameTask=function(){return this._frameTask},e.prototype.setLighting=function(e){w.set3(0,0,0,this._lightDirection);for(var t=0,r=e.lights;t<r.length;t++){var n=r[t];if(n instanceof m.MainLight){w.negate(n.direction,this._lightDirection);break}}this._viewport.setLighting(e),this._needsRender=!0},e.prototype.getEdgeView=function(){return this._viewport.getEdgeView()},e.prototype.getMainLightDirection=function(){return this._lightDirection},e.prototype.getViewParams=function(e){var t=this._viewport.getViewParams(e);return e&&!e.backgroundColor||(t.backgroundColor=this._backgroundColor),t},e.prototype.setViewParams=function(e){this._needsRender=!0,e.backgroundColor&&(this._backgroundColor=e.backgroundColor),this._viewport.setViewParams(e)},e.prototype.setRenderParams=function(e){this._needsRender=!0,void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),this._viewport.setRenderParams(e)},e.prototype.getRenderParams=function(){var e=this._viewport.getRenderParams();return e.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),e.idleSuspend=this._idleSuspend,e},Object.defineProperty(e.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"standardDerivatives"===e?!!this._rctx.capabilities.standardDerivatives:"shaderTextureLOD"===e?!!this._rctx.capabilities.shaderTextureLOD:"instancedRendering"===e&&!!this._rctx.capabilities.instancing},e.prototype.modify=function(e,t,r,n){this._viewport.modify(e,t,r,n)},e.prototype.setCamera=function(e){this._viewport.setCamera(e)},e.prototype.getCamera=function(){return this._viewport.getCamera()},e.prototype.getPickRay=function(e,t,r){this._viewport.getPickRay(e,t,r)},e.prototype.pickRayWithBeginPoint=function(e,t,r,n,i){this._viewport.pickRayWithBeginPoint(e,t,r,n,i)},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer},e.prototype.requestScreenCapture=function(e,t){this._screenCaptureQueue.push({settings:e||{},callback:t}),this._needsRender=!0},e.prototype.getAllTexturesLoaded=function(){return 0===this._textureRep.getLoadingCount()},e.prototype.getTextureLoaded=function(e){return this._textureRep.getIsLoaded(e)},e.prototype.addTextureListener=function(e){this._textureRep.addTextureListener(e)},e.prototype.removeTextureListener=function(e){this._textureRep.removeTextureListener(e)},e.prototype.addExternalRenderer=function(e,t){return!!this._viewport.addExternalRenderer(e,t)&&(t.initializeRenderContext({rctx:this._rctx,gl:this._rctx.gl,shaderSnippets:this._shaderSnippets,programRep:this._programRepository,textureRep:this._textureRep,materialRep:this._materialRep}),!0)},e.prototype.removeExternalRenderer=function(e){return!!this._viewport.removeExternalRenderer(e)&&(e.uninitializeRenderContext({rctx:this._rctx,gl:this._rctx.gl}),!0)},e.prototype._performScreenCaptures=function(){if(0!==this._screenCaptureQueue.length){for(var e=0;e<this._screenCaptureQueue.length;e++){var t=this._screenCaptureQueue[e],r={x:0,y:0,width:this._canvas.width,height:this._canvas.height},n={x:0,y:0,width:this._canvas.width,height:this._canvas.height},i=t.settings.area;if(i&&(r.x=i.x,r.y=i.y,r.width=i.width,r.height=i.height),void 0!==t.settings.width&&void 0!==t.settings.height){var o=t.settings.width/t.settings.height;if(r.height*o<r.width){var a=r.height*o;r.x+=Math.floor((r.width-a)/2),r.width=Math.floor(a)}else{var s=r.width/o;r.y+=Math.floor((r.height-s)/2),r.height=Math.floor(s)}n.width=t.settings.width,n.height=t.settings.height}else n.width=r.width,n.height=r.height;var l=this._canvas,u=null;if(0!==r.x||0!==r.y||r.width!==this._canvas.width||r.height!==this._canvas.height||0!==n.x||0!==n.y||n.width!==this._canvas.width||n.height!==this._canvas.height){this._resizeCanvas||(this._resizeCanvas=document.createElement("canvas")),this._resizeCanvas.width=n.width,this._resizeCanvas.height=n.height;var d=this._resizeCanvas.getContext("2d");u=new Uint8Array(r.width*r.height*4),this._gl.readPixels(r.x,this._canvas.height-(r.y+r.height),r.width,r.height,6408,5121,u);var c=d.getImageData(n.x,n.y,n.width,n.height);b.resampleHermite(u,r.width,r.height,c.data,n.width,n.height,!0),d.putImageData(c,n.x,n.y),l=this._resizeCanvas,d=null}var p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"}[t.settings.format?t.settings.format.toLowerCase():"png"],f=1;void 0!==t.settings.quality&&(f=t.settings.quality/100);var h={dataURL:l.toDataURL(p,f),x:n.x,y:n.y,width:n.width,height:n.height};t.settings.returnByteBuffer&&(h.data=u),t.callback(h)}this._screenCaptureQueue=[]}},e}()}.apply(null,n))||(e.exports=i)},1363:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsRenderOccludedApply"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  void main(void) {\n    gl_Position = vec4($position, 0.0, 1.0);\n    uv = $position.xy * 0.5 + vec2(0.5);\n  }\n]]></snippet>\n\n<snippet name="fsRenderOccludedApply"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D occludedColorMap;\n\n  varying vec2 uv;\n\n  void main() {\n    vec4 occludedColor = texture2D(occludedColorMap, uv);\n    gl_FragColor = occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\n  }\n\n]]></snippet>\n\n</snippets>\n'},1364:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1302),r(1307),r(1290),r(1288),r(1278),r(1293),r(1320),r(1331),r(1297),r(1277),r(1304),r(1336),r(1285),r(1280),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m,v){var g=a.vec3d,y=a.vec4d,b=a.mat4d,_=function(){function e(e,t,r,n,i,o){var a=this;this._renderTargets={},this._clearColor=y.createFrom(0,0,0,0),this._id2origin={},this._uniqueIdx=0,this._rctx=e,this._canvas=t,this._programRep=r,this._modelDirtySet=o,this._modelDirtySet.onMaterialChanged=function(e){return a.materialChanged(e)},this._renderer=new u(r,n,i,this._rctx,!0),this._renderer.onHasHighlightsChanged=function(e){a.onHasHighlightsChanged&&a.onHasHighlightsChanged(e)},this._renderer.setLighting({lights:[new p.AmbientLight(g.createFrom(1,1,1))],groundLightingFactor:1,globalFactor:0})}return e.prototype.dispose=function(){for(var e in this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._renderer.dispose(),this._renderer=null},e.prototype.createRenderTarget=function(e){return this.createRenderTargetInternal(e,!0)},e.prototype.createHighlightRenderTarget=function(e){return this.createRenderTargetInternal(e,!1)},e.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},e.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},e.prototype.addRenderGeometries=function(e){var t=this;e.forEach(function(e){null==e.origin&&(e.origin=t.getOrigin(e.center,e.bsRadius)),e.idx=t._uniqueIdx++}),this._renderer.modify(e,[]),this.onContentChanged&&this.onContentChanged()},e.prototype.removeRenderGeometries=function(e){this._renderer.modify([],e),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderGeometries=function(e,t){var r=e.map(function(e){return{renderGeometry:e,updateType:t}});this._renderer.modify([],[],r),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderOrder=function(e){e.size>0&&(this._renderer.modifyRenderOrder(e),this.onContentChanged&&this.onContentChanged())},e.prototype.setBackgroundColor=function(e){this._clearColor=e,this.onContentChanged&&this.onContentChanged()},e.prototype.addRenderGeometryHighlight=function(e,t){var r=e.instanceParameters,n=l.generateHighlightId();return r.componentHighlights=i.addHighlight(r.componentHighlights,null,t,n),this.updateRenderGeometries([e],32),n},e.prototype.removeRenderGeometryHighlight=function(e,t){var r=e.instanceParameters;r.componentHighlights=i.removeHighlight(r.componentHighlights,t),this.updateRenderGeometries([e],32)},e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!r.OVERLAY_DRAW_TEST_TEXTURE},e.prototype.processDirtyMaterials=function(){var e=this._modelDirtySet.getDirtyMaterials();e&&this._renderer.modify([],[],[],e),this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return this.drawPass(d.MATERIAL,e,t)},e.prototype.drawHighlights=function(e,t){return this.drawPass(d.MATERIAL_HIGHLIGHT,e,t)},e.prototype.drawPass=function(e,t,n){if(this.isEmpty()||e===d.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;if(this.processDirtyMaterials(),!n.views.some(function(e){return e.extent[0]!==e.extent[2]&&e.extent[1]!==e.extent[3]}))return!1;var i=this._renderTargets[t];if(!i)return!1;var o=this._rctx,a=o.gl,s=n.width,l=n.height;i.width===s&&i.height===l||(i.resize(s,l),i.colorTexture.setSamplingMode(9729)),w.near=1,w.far=1e4,o.bindFramebuffer(i),o.setDepthTestEnabled(!1),o.setBlendFunctionSeparate(770,771,1,771),o.setClearColor.apply(o,this._clearColor),o.clear(a.COLOR_BUFFER_BIT),this._renderer.setPixelRatio(n.pixelRatio||1);for(var u=0;u<n.views.length;u++){var c=n.views[u];w.viewport=c.viewport,b.ortho(0,c.extent[2]-c.extent[0],0,c.extent[3]-c.extent[1],w.near,w.far,w.projectionMatrix),b.identity(w.viewMatrix),b.translate(w.viewMatrix,[-c.extent[0],-c.extent[1],0]),w.setGLViewport(this._rctx),r.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(s,l,x[n.index%x.length]),this._renderer.renderGeometryPass(e,w)}return o.setDepthTestEnabled(!0),o.setBlendFunctionSeparate(770,771,1,771),o.bindFramebuffer(null),o.setViewport(0,0,this._canvas.width,this._canvas.height),i.colorTexture.descriptor.hasMipmap&&i.colorTexture.generateMipmap(),!0},e.prototype._drawTestTexture=function(e,t,r){var n=this._rctx,i=n.gl;if(!this._testPatternMat){for(var a=new Uint8Array(e*t*4),l=0,u=0;u<t;u++)for(var d=0;d<e;d++){var c=Math.floor(d/10),p=Math.floor(u/10);c<2||p<2||10*c>e-20||10*p>t-20?(a[l++]=255,a[l++]=255,a[l++]=255,a[l++]=255):(a[l++]=255,a[l++]=255,a[l++]=255,a[l++]=1&c&&1&p?1&d^1&u?0:255:1&c^1&p?0:128)}var h=new m(n,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},a);this._testPatternMat=new f(this._programRep,h,[1,1,1,1],!0,i.ALWAYS),this._testPatternBindParams={proj:b.identity(),view:b.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0},this._quadVAO=s.createQuadVAO(n,o.Pos3Tex)}this._testPatternMat.setColor([r[0],r[1],r[2],1]),this._testPatternMat.bind(n,this._testPatternBindParams),this._testPatternMat.bindView(n,this._testPatternBindParams),n.bindVAO(this._quadVAO),n.drawArrays(5,0,v.vertexCount(this._quadVAO,"geometry")),this._testPatternMat.release(n)},e.prototype.getOrigin=function(e,t){var r=0,n=10*t/1e4;n>1&&(r=Math.ceil(c.logWithBase(n,2)));var i=1e4*Math.pow(2,r),o=Math.round(e[0]/i),a=Math.round(e[1]/i),s=Math.round(e[2]/i),l=r+"_"+o+"_"+a+"_"+s,u=this._id2origin[l];return null==u&&(u={vec3:g.createFrom(o*i,a*i,s*i),id:l},this._id2origin[l]=u),u},e.prototype.materialChanged=function(e){this.onContentChanged&&this.onContentChanged()},e.prototype.createRenderTargetInternal=function(e,t){for(var r=e,n=0;this._renderTargets[r];)r=e+"_"+ ++n;return this._renderTargets[r]=h.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0}),r},e}(),x=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],w=new n;return _}.apply(null,n))||(e.exports=i)},1365:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1297),r(1281)],void 0===(i=function(e,t,r,n){return function(){function e(){this.camera=null,this.pixelRatio=1,this.depth=null,this.highlight=null,this.lightingData=null,this.normals=null,this.pass=r.MATERIAL,this.shadowMap=null,this.slot=n.BACKGROUND,this.ssaoHelper=null,this.offscreenRenderingHelper=null,this.stencilRenderingHelper=null,this.framebufferTex=null,this.rctx=null,this.options=null,this.renderOccludedOnly=!1}return Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return this.pass===r.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},1366:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1313),r(1281)],void 0===(i=function(e,t,r,n){var i={near:0,far:0};return function(){function e(){this.renderersChanged=!1,this.renderers=[],this.slots=[];for(var e=0;e<n.MAX_SLOTS;++e)this.slots[e]=[]}return e.prototype.addRenderer=function(e,t){this.renderers.push(t);for(var r=0;r<e.length;++r){var n=e[r];this.slots[n].push(t)}this.renderersChanged=!0},e.prototype.removeRenderer=function(e){this.renderers=this.renderers.filter(function(t){return t!==e});for(var t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter(function(t){return t!==e});this.renderersChanged=!0},e.prototype.prepareRender=function(e){for(var t=0,r=this.renderers;t<r.length;t++){var n=r[t];n.prepareRender&&n.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var r=!1,n=0,i=this.slots[e];n<i.length;n++){var o=i[n];o.render(t)&&(o.didRender=!0,r=!0)}return r},e.prototype.queryDepthRange=function(e){var t=i;t.near=1/0,t.far=-1/0;for(var n=0,o=this.renderers;n<o.length;n++){var a=o[n];if(a.queryDepthRange){var s=a.queryDepthRange(e);s&&r.union(t,s,t)}}return t},e.prototype.needsRender=function(){if(this.renderersChanged)return!0;for(var e=0,t=this.renderers;e<t.length;e++)if(t[e].needsRender)return!0;return!1},e.prototype.needsHighlight=function(){for(var e=0,t=this.renderers;e<t.length;e++)if(t[e].needsHighlight)return!0;return!1},e.prototype.needsLinearDepth=function(){for(var e=0,t=this.renderers;e<t.length;e++)if(t[e].needsLinearDepth)return!0;return!1},e.prototype.resetNeedsRender=function(){this.renderersChanged=!1;for(var e=0,t=this.renderers;e<t.length;e++){var r=t[e];r.resetNeedsRender?r.resetNeedsRender():r.didRender&&(r.needsRender=!1,r.didRender=!1)}},e}()}.apply(null,n))||(e.exports=i)},1367:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277)],void 0===(i=function(e,t,r){return function(){function e(e){null==e?e=16:e<65536&&(e=r.nextHighestPowerOfTwo(e)),this.array=new Float32Array(e),this.size=0}return e.prototype.resize=function(e,t){var r,n;if(void 0===t&&(t=!1),this.size=e,this.size>this.array.length){for(r=this.array.length||1;r<this.size;)r*=2;return n=new Float32Array(r),t&&n.set(this.array),this.array=n,!0}if(this.size<=this.array.length/2){r=this.array.length;for(var i=2*this.size;r>=i;)r=Math.floor(r/2);return n=new Float32Array(r),t&&n.set(this.array.subarray(0,r)),this.array=n,!0}return!1},e.prototype.append=function(e){var t=this.size;this.resize(this.size+e.length,!0),this.array.set(e,t)},e.prototype.erase=function(e,t){for(var r=e;r<t;++r)this.array[r]=0},e.prototype.getArray=function(){return this.array},e.prototype.getSize=function(){return this.size},e}()}.apply(null,n))||(e.exports=i)},1368:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1287),r(1283),r(1286)],void 0===(i=function(e,t,r,n,i){var o=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.enable=function(){if(!this.isEnabled){var e=this.rctx;this.program=new n(e,a.shader.vertex,a.shader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new i(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new r(e,34962,35044,t)}),this.isEnabled=!0}},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx;r.bindVAO(this.vao),r.bindFramebuffer(t);var n={x:0,y:0,width:0,height:0};null!=t?(n.width=t.descriptor.width,n.height=t.descriptor.height):(n.width=r.gl.canvas.width,n.height=r.gl.canvas.height),r.bindProgram(this.program),r.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/n.width,1/n.height),r.setFaceCullingEnabled(!1),r.drawArrays(4,0,3)},e}(),a={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return o}.apply(null,n))||(e.exports=i)},1369:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277),r(1285)],void 0===(i=function(e,t,r,n){return function(){function e(e){this._rctx=e,this.fbo=null,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this._rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareHighlightPass=function(){r.assert(this.enabled);var e=this._rctx,t=e.gl;this.fbo.resize(this.width,this.height),e.bindFramebuffer(this.fbo),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){this.enabled||(this.fbo=n.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this.fbo.dispose(),this.fbo=null)},e}()}.apply(null,n))||(e.exports=i)},1370:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277)],void 0===(i=function(e,t,r){return function(){function e(e,t){null==t&&(t=4);var n=r.nextHighestPowerOfTwo(t*e);this.array=new Float32Array(n),this.zeroItem=new Float32Array(e),this.endSlot=0,this.perInstanceDataSize=e,this.emptySlots=[],this.emptySlotsIdx=0,this.id2slot={},this.slot2id=new Array(t)}return e.prototype.prepareFree=function(e){this.emptySlots.length+=e},e.prototype.free=function(e){var t=this.id2slot[e];null!=t&&(this.emptySlots[this.emptySlotsIdx++]=t,this.slot2id[t]=void 0)},e.prototype.prepareAllocate=function(e){var t=e-this.emptySlotsIdx;t>0&&this._resizeArray((this.endSlot+t)*this.perInstanceDataSize)},e.prototype.allocate=function(e){var t;return t=this.emptySlotsIdx>0?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++,this.id2slot[e]=t,this.slot2id[t]=e,t},e.prototype.getSlot=function(e){return this.id2slot[e]},e.prototype.getOffset=function(e){return e*this.perInstanceDataSize},e.prototype.getArray=function(){return this.array},e.prototype.fill=function(e,t,r){this.array.set(r,e*this.perInstanceDataSize+t)},e.prototype.compact=function(){if(this.emptySlotsIdx>0){for(this.emptySlots.length=this.emptySlotsIdx,this.emptySlots.sort(function(e,t){return e-t});this.emptySlotsIdx>0&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;this.emptySlotsIdx>0;){this.emptySlotsIdx--;var e=this.endSlot-1,t=this.emptySlots[this.emptySlotsIdx],r=e*this.perInstanceDataSize,n=t*this.perInstanceDataSize;this.array.set(this.array.subarray(r,r+this.perInstanceDataSize),n),this.array.set(this.zeroItem,r);var i=this.slot2id[e];this.slot2id[e]=void 0,this.slot2id[t]=i,this.id2slot[i]=t,this.endSlot--}}return this._resizeArray(this.endSlot*this.perInstanceDataSize),this.emptySlots.length=0,this.array},e.prototype._resizeArray=function(e){var t,r;if(e>this.array.length){for(t=this.array.length||1;t<e;)t*=2;(r=new Float32Array(t)).set(this.array),this.array=r}else if(e<=this.array.length/2){t=this.array.length;for(var n=2*e;t>=n;)t/=2;(r=new Float32Array(t)).set(this.array.subarray(0,t)),this.array=r}},e}()}.apply(null,n))||(e.exports=i)},1371:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push([n[0],n[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];n[0]=n[0]*t,n[1]=n[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort(function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0})},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var r=[],n=0;n<e.length;n++){var i=e[n];if(!(i[1]<t[0]||i[0]>t[1])){var o=[i[0],i[1]];o[0]<t[0]&&(o[0]=t[0]),o[1]>t[1]&&(o[1]=t[1]),r.push(o)}}return r},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var r=1;r<e.length;r++){var n=t[t.length-1];n[1]+1<e[r][0]?t.push(e[r]):n[1]<e[r][1]&&(n[1]=e[r][1],t.pop(),t.push(n))}return t},e.invertIntervals=function(e,t){for(var r=[],n=0,i=0;i<e.length;i++){var o=e[i];o[0]>n&&r.push([n,o[0]-1]),n=o[1]+1}return n<=t&&r.push([n,t]),r},e.offsetIntervals=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];r.push([i[0]+t,i[1]+t])}return r},e}()}.apply(null,n))||(e.exports=i)},1372:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277),r(1285)],void 0===(i=function(e,t,r,n){return function(){function e(e){this._rctx=e,this._depthFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(e){e!==this.enabled&&(e?this.enable():this.disable())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this._rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareDepthPass=function(){r.assert(this.enabled);var e=this._rctx,t=e.gl;this._depthFBO.resize(this.width,this.height),e.bindFramebuffer(this._depthFBO),e.setClearStencil(0),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e.setBlendingEnabled(!1)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){r.assert(!this.enabled),this._depthFBO=n.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})},e.prototype.disable=function(){r.assert(this.enabled),this._depthFBO.dispose(),this._depthFBO=void 0},e}()}.apply(null,n))||(e.exports=i)},1373:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277),r(1285)],void 0===(i=function(e,t,r,n){return function(){function e(e){this.rctx=e,this.normalFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.viewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this.rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareNormalPass=function(){r.assert(this.enabled);var e=this.rctx,t=e.gl;this.normalFBO.resize(this.width,this.height),e.bindFramebuffer(this.normalFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this.rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){this.enabled||(this.normalFBO=n.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=void 0)},e}()}.apply(null,n))||(e.exports=i)},1374:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1312),r(1287),r(1285),r(1283),r(1280),r(1286)],void 0===(i=function(e,t,n,i,o,a,s,l){return function(){function e(e){this._isLoadingResources=!1,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;return!!this.data||(this._isLoadingResources=!0,r.e(83).then(function(){var n=[r(1490)];(function(r){t.data=r,t._isLoadingResources=!1,e&&e()}).apply(null,n)}).catch(r.oe),!1)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new a(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new a(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new a(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new l(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new i(e,34962,35044,t)}),this.tmpFramebufferEdges=o.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=o.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx,n={x:0,y:0,width:0,height:0};null!=t?(n.width=t.descriptor.width,n.height=t.descriptor.height):(n.width=r.gl.canvas.width,n.height=r.gl.canvas.height),r.bindVAO(this.vao),r.setFaceCullingEnabled(!0),r.setCullFace(1029),r.setFrontFace(2305),r.setBlendingEnabled(!1),r.setDepthTestEnabled(!1),r.setViewport(n.x,n.y,n.width,n.height),this.tmpFramebufferEdges.resize(n.width,n.height),r.bindFramebuffer(this.tmpFramebufferEdges),r.setClearColor(0,0,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programEdgeDetect),r.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(n.width,n.height),r.bindFramebuffer(this.tmpFramebufferBlend),r.setClearColor(0,0,1,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),r.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),r.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),r.drawArrays(4,0,3),r.bindFramebuffer(t),r.setClearColor(0,1,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),r.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),r.drawArrays(4,0,3),r.setDepthTestEnabled(!0)},e.prototype.loadTextureFromBase64=function(e,t,r){var i=new s(this.rctx,{pixelFormat:r,dataType:5121,wrapMode:33071,samplingMode:t},null);return n.requestImage(e).then(function(e){i.resize(e.width,e.height),i.setData(e)}),i},e}()}.apply(null,n))||(e.exports=i)},1375:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277)],void 0===(i=function(e,t,r){return function(){function e(e){this._enabled=!1,this._rctx=e}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.prepareStencilWritePass=function(){r.assert(this.enabled);var e=this._rctx;e.setStencilFunction(519,1,255),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255)},e.prototype.finish=function(){if(this.enabled){var e=this._rctx;e.setStencilFunction(519,0,0),e.setStencilOp(7680,7680,7680)}},e.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)},e.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)},e.prototype.enable=function(){this._enabled=!0,this._rctx.setStencilTestEnabled(!0)},e.prototype.disable=function(){this._enabled=!1,this._rctx.setStencilTestEnabled(!1)},e}()}.apply(null,n))||(e.exports=i)},1376:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unrolledCopyVec3=function(e,t){for(var r=e.typedBuffer,n=e.typedBufferStride,i=t.typedBuffer,o=t.typedBufferStride,a=t.count,s=0;s<a;s++){var l=s*n,u=s*o;r[l]=i[u],r[l+1]=i[u+1],r[l+2]=i[u+2]}}}.apply(null,n))||(e.exports=i)},1377:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1278),r(1333)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.aquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:r.mat4d.identity(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&0==--t.refCount&&this.originData.delete(e.id)},e.prototype.updateViewMatrices=function(e){this.originData.forEach(function(t){r.mat4d.set(e,t.viewMatrix),n.applyToViewMatrix(t.origin.vec3,t.viewMatrix)})},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=i}.apply(null,n))||(e.exports=i)},1378:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e){this._gridSize=e,this._origins={}}return e.prototype.getOrigin=function(t){var r=this._gridSize,n=Math.round(t[0]/r),i=Math.round(t[1]/r),o=Math.round(t[2]/r),a=""+e.ORIGIN_PREFIX+n+"/"+i+"/"+o,s=this._origins[a];if(!s){var l=this._gridSize,u=e.OFFSET;s={id:a,vec3:[n*l+u,i*l+u,o*l+u]},this._origins[a]=s}return s},e.ORIGIN_PREFIX="rg_",e.OFFSET=1.11,e}()}.apply(null,n))||(e.exports=i)},1379:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1380),r(1381)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var i=function(){function e(e,i){void 0===i&&(i=1),this.textureBuffer=new n.TextureBackedBuffer(e,i),this.indexManager=new r.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.aquireIndex=function(){var e=this.indexManager.aquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=i}.apply(null,n))||(e.exports=i)},1380:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.aquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=r}.apply(null,n))||(e.exports=i)},1381:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1326),r(1280)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new n(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new r.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,r,n,i,o){var a=e*this.fieldCount+t;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,n),this.data.set(a,2,i),this.data.set(a,3,o)},e.prototype.setDataElement=function(e,t,r,n){var i=e*this.fieldCount+t;this.dirty=!0,this.data.set(i,r,n)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var n=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,i=new r.BufferViewVec4u8(new ArrayBuffer(4*n));i.typedBuffer.set(this.data.typedBuffer),this.data=i}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=i}.apply(null,n))||(e.exports=i)},1382:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(10),r(1384),r(1383),r(40),r(63),r(1289),r(1343)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var d={type:"solid",uber:!0,strokesTexture:null},c=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),p=function(){function e(t,n,i){this.rctx=t,this.programRepository=n,this.refCount=new c,this.renderables=new Set,this.depthBiasZ=-4e-4,this.depthBiasXY=.5,this.tmpViewToWorldNormalMatrix=a.mat3d.create(),this.settings=r({},d,i),this.key=e.getKey(this.settings.uber,this.settings.type);var o=this.settings.strokesTexture.variants;this.writerSettings={variants:o},this.createPrograms()}return e.prototype.dispose=function(){for(var e in this.programs){var t=this.programs[e];t&&(this.programRepository.decreaseRefCount(t),this.programs[e]=null)}},e.prototype.addRenderable=function(e){this.renderables.add(e)},e.prototype.removeRenderable=function(e){this.renderables.delete(e)},e.prototype.forEachRenderable=function(e){this.renderables.forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.bind(this.programs.regular,e,t)},e.prototype.bindSilhouetteEdges=function(e,t){this.bind(this.programs.silhouette,e,t)},e.prototype.bind=function(e,t,r){this.rctx.bindProgram(e),e.setUniformMatrix4fv("uProj",t.proj),e.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ),e.setUniform2f("uPixelToNDC",2/t.viewport[2],2/t.viewport[3]),e.setUniform2f("uNDCToPixel",t.viewport[2]/2,t.viewport[3]/2),e.setUniform1f("uDistanceFalloffFactor",r.distanceFalloffFactor),e.setUniform2f("uViewportDimInv",1/t.viewport[2],1/t.viewport[3])},e.prototype.renderRegularEdges=function(e,t,r){this.render(this.programs.regular,e,e.regular.vao,t,r)},e.prototype.renderSilhouetteEdges=function(e,t,r){this.render(this.programs.silhouette,e,e.silhouette.vao,t,r)},e.prototype.render=function(e,t,r,n,i){this.setUniforms(e,t,n);var o=this.rctx;o.bindVAO(r),o.capabilities.instancing.drawArraysInstanced(6,0,4,i)},e.prototype.setUniforms=function(e,r,n){r.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),e.setUniformMatrix4fv("uView",n.view),e.setUniformMatrix4fv("uModel",r.transform.modelMatrix);var i=n.viewInvTransp,o=a.mat4d.toMat3(i,this.tmpViewToWorldNormalMatrix);e.setUniform3f("uCameraPosition",i[3],i[7],i[11]),e.setUniformMatrix3fv("uViewToWorldNormalMatrix",o),(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(n.fovY/2)/(n.viewport[3]/2)),e.setUniform3fv("uLocalOrigin",r.transform.origin.vec3)},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,r=t.texture;this.rctx.bindTexture(r,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",s.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.getDefines=function(e){return[e.silhouette,!!this.rctx.capabilities.blendMinMax,"solid"===this.settings.type&&!this.settings.uber,"sketch"===this.settings.type&&!this.settings.uber,this.settings.uber]},e.prototype.createPrograms=function(){var e=this.programRepository.getShaderVariationsProgram(f,this.getDefines({silhouette:!1}),void 0,void 0,u.EdgeShaderAttributeLocations),t=this.programRepository.getShaderVariationsProgram(f,this.getDefines({silhouette:!0}),void 0,void 0,u.EdgeShaderAttributeLocations);this.programRepository.increaseRefCount(e),this.programRepository.increaseRefCount(t),this.programs={regular:e,silhouette:t}},e.loadShaders=function(e,t,r){if(e.EdgeRendererUtils_readComponentColor||e._parse(o),e.fsRibbonEdge||e._parse(i),!t.getShaderVariations(f)){var n=new l("ribbonEdge",["vsRibbonEdge","fsRibbonEdge"],null,t,e,r);n.addDefine("Silhouette","SILHOUETTE"),n.addDefine("AntiAliasing","ANTIALIASING"),n.addDefine("Solid","SOLID"),n.addDefine("Sketch","SKETCH"),n.addDefine("Uber","UBER"),t.addShaderVariations(f,n)}},e.getKey=function(e,t){return e?"edges-uber":"edges-t:"+t},e}();t.EdgeRenderer=p;var f="edge-shader-variations";t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}}.apply(null,n))||(e.exports=i)},1383:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="EdgeRendererUtils_distanceBasedPerspectiveFactor"><![CDATA[\n  uniform float uDistanceFalloffFactor;\n\n  float distanceBasedPerspectiveFactor(float distance) {\n    return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n  }\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_readComponentData"><![CDATA[\n  uniform sampler2D uComponentDataTex;\n  uniform vec2 uComponentDataTexInvDim;\n\n  attribute float aComponentIndex;\n\n  #define COMPONENT_COLOR_FIELD_OFFSET 0.0\n  #define COMPONENT_OTHER_FIELDS_OFFSET 1.0\n  #define COMPONENT_FIELD_COUNT 2.0\n\n  #define LINE_WIDTH_FRACTION_FACTOR 8.0\n  #define EXTENSION_LENGTH_OFFSET 128.0\n\n  #define COMPONENT_TEX_WIDTH 4096.0\n\n  vec2 componentTextureCoords(float componentIndex, float fieldOffset) {\n    float fieldIndex = COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n    float rowIndex = floor(fieldIndex / COMPONENT_TEX_WIDTH);\n    float colIndex = mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n    vec2 linearIndex = vec2(\n      (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n      (rowIndex + 0.5) * uComponentDataTexInvDim.y\n    );\n\n    return linearIndex;\n  }\n\n  struct ComponentData {\n    vec4 color;\n    float lineWidth;\n    float extensionLength;\n    float type;\n  };\n\n  ComponentData readComponentData() {\n    vec2 colorIndex = componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n    vec2 otherIndex = componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n    vec4 colorValue = texture2D(uComponentDataTex, colorIndex);\n    vec4 otherValue = texture2D(uComponentDataTex, otherIndex);\n\n    return ComponentData(\n      vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n      otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n      otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n      -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;\n    );\n  }\n\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_isSilhouetteEdge"><![CDATA[\n  // #uniforms: uView, uModel\n  bool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\n    // transform the two face normals\n    vec3 viewNormalA = (uView * uModel * vec4(normalA, 0.0)).xyz;\n    vec3 viewNormalB = (uView * uModel * vec4(normalB, 0.0)).xyz;\n\n    // compute the direction from the edge to the camera\n    vec3 viewDir = -viewPos.xyz;\n\n    // check which of the two faces are visible\n    // display the edge if exactly one of the two is visible\n    float faceAVisible = dot(viewDir, viewNormalA); // positive if visible\n    float faceBVisible = dot(viewDir, viewNormalB); // positive if visible\n\n    // 1 if exactly one face visible, 0 otherwise\n    return faceAVisible * faceBVisible < 0.0;\n  }\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_adjustProjectedPosition"><![CDATA[\n  uniform vec2 uDepthBias;\n  uniform vec2 uViewportDimInv;\n\n  // Utility function to check for NaN values\n  bool isNaN(float val) {\n    return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n    // important: some nVidias failed to cope with version below.\n    // Probably wrong optimization.\n    /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/\n  }\n\n  // An offset in xy screen space, along the projected normal of the edge\n  // This reduces depth fighting when looking at a face from a flat angle\n  vec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\n    float offsetXY = uDepthBias.x;\n    float offsetZ  = uDepthBias.y;\n\n    // screen space pixel offset\n    // we multiply by two to account for the fact that NDC go from -1 to 1\n    // we multiply by projPos.w to compensate for the perspective divison that happens later\n    // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n    // towards the camera\n    vec4 projNormal = uProj * uView * vec4(worldNormal, 0.0);\n\n    return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n  }\n\n  // A z-offset, using a depth based heuristic.\n  float calculateProjectedBiasZ(vec4 projPos) {\n    float offsetZ = uDepthBias.y;\n    return sqrt(projPos.z) * offsetZ;\n  }\n\n  vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n    vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);\n\n    // we currently have to do this check because some geometries come with 0 length edge normals.\n    // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n    if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {\n      projPos.xy += offsetXY;\n    }\n\n    projPos.z += calculateProjectedBiasZ(projPos);\n\n    return projPos;\n  }\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_worldNormal"><![CDATA[\n  vec3 modelToWorldNormal(vec3 normal) {\n    return (uModel * vec4(normal, 0)).xyz;\n  }\n\n  vec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\n    return modelToWorldNormal(normalize(normalA + normalB));\n  }\n]]></snippet>\n\n<snippet name="EdgeRendererUtils_extensionFalloff"><![CDATA[\n  // Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\n  // fall-off exponentially\n  float calculateExtensionLength(float extensionLength, float lineLength) {\n    return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n  }\n]]></snippet>\n\n</snippets>\n'},1384:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsRibbonEdgeStyleOutputs"><![CDATA[\n#if defined(SKETCH) || defined(UBER)\n\n  uniform vec2 uStrokesTextureScale;\n  uniform float uStrokesLog2Resolution;\n  uniform float uStrokeVariants;\n\n  varying vec2 vStrokeUV;\n  varying float vLineIndex;\n\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n    vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n    float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n    vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\n    vStrokeUV.x += aVariantOffset;\n\n    vLineIndex = lineIndex;\n  }\n#endif /* SKETCH || UBER */\n\n#if defined(SKETCH)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n  }\n#elif defined(SOLID)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  }\n#elif defined(UBER)\n  varying float vType;\n\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vType = unpackedAttributes.type;\n\n    if (unpackedAttributes.type <= 0.0) {\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n    }\n  }\n#endif /* UBER */\n\n]]></snippet>\n\n<snippet name="vsRibbonEdgeLineAmplitudeRegular"><![CDATA[\n\n#if defined(UBER) || !defined(SKETCH)\n\n  float calculateLineAmplitudeRegular() {\n    return 0.0;\n  }\n\n#endif /* UBER || !SKETCH */\n\n#if !defined(UBER) && !defined(SKETCH)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeRegular();\n  }\n\n#endif /* !UBER && !SKETCH */\n\n]]></snippet>\n\n<snippet name="vsRibbonEdgeLineAmplitudeSketch"><![CDATA[\n\n#if defined(UBER) || defined(SKETCH)\n\n  uniform float uStrokesAmplitude;\n\n  float calculateLineAmplitudeSketch() {\n    return uStrokesAmplitude;\n  }\n\n#endif /* UBER || SKETCH */\n\n#ifdef SKETCH\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSketch();\n  }\n\n#endif /* SKETCH */\n\n]]></snippet>\n\n<snippet name="vsRibbonEdgeLineAmplitudeUber"><![CDATA[\n\n#ifdef UBER\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    float type = unpackedAttributes.type;\n\n    if (type <= 0.0) {\n      return calculateLineAmplitudeSketch();\n    }\n    else {\n      return calculateLineAmplitudeRegular();\n    }\n  }\n\n#endif /* UBER */\n\n]]></snippet>\n\n<snippet name="vsRibbonEdge"><![CDATA[\n  $vsprecisionf\n\n  // Transformations\n  uniform mat4 uProj;\n  uniform mat4 uView;\n  uniform mat4 uModel;\n  uniform vec3 uCameraPosition;\n\n  // Line configuration\n\n  // Conversion constants\n  uniform vec2 uPixelToNDC;\n  uniform vec2 uNDCToPixel;\n\n  // Inputs\n  attribute vec3 aPosition0;\n  attribute vec3 aPosition1;\n  attribute float aVariantOffset;\n  attribute float aVariantStroke;\n  attribute float aVariantExtension;\n\n#ifdef SILHOUETTE\n\n  attribute vec3 aNormalA;\n  attribute vec3 aNormalB;\n\n#else /* SILHOUETTE */\n\n  attribute vec3 aNormal;\n\n#endif /* SILHOUETTE */\n\nattribute vec2 aSideness;\nattribute vec2 aPackedAttributes;\n\nstruct UnpackedAttributes {\n  vec2 sideness;\n  vec2 sidenessNorm;\n  float lineWidthPixels;\n  float extensionLengthPixels;\n\n#ifdef UBER\n\n  float type;\n\n#endif\n};\n\n  // Output required to compute color\n  varying vec4 vColor;\n\n  // Output required to compute distance to line/caps\n  varying vec3 vPosition;\n  varying float vRadius;\n  varying float vLineLengthPixels;\n  varying float vSizeFalloffFactor;\n\n  $EdgeRendererUtils_adjustProjectedPosition\n\n  $vsRibbonEdgeStyleOutputs\n\n  $vsRibbonEdgeLineAmplitudeRegular\n  $vsRibbonEdgeLineAmplitudeSketch\n  $vsRibbonEdgeLineAmplitudeUber\n\n  $EdgeRendererUtils_readComponentData\n  $EdgeRendererUtils_distanceBasedPerspectiveFactor\n  $EdgeRendererUtils_worldNormal\n  $EdgeRendererUtils_extensionFalloff\n\n#ifdef SILHOUETTE\n\n  $EdgeRendererUtils_isSilhouetteEdge\n\n#endif /* SILHOUETTE */\n\n  vec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vec2 sideness = unpackedAttributes.sideness;\n    vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n    vec4 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);\n    vec4 projPosV0 = uProj * viewPosV0;\n    vec4 projPosV1 = uProj * viewPosV1;\n    vec4 projPos = uProj * viewPos;\n\n    vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n    vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;\n    float lineLengthPixels = length(screenSpaceLinePixels);\n\n    float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;\n    vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;\n    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n    float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z);\n    float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;\n\n    float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n    float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes);\n\n    vSizeFalloffFactor = falloffFactor;\n\n    float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n    float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n#ifdef ANTIALIASING\n\n    const float aaPaddingPixels = 1.0;\n\n    // Line size with padding\n    float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n    float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;\n\n    // Line length with padding\n    float aaPaddedLineLengthPixels = extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\n    float halfAAPaddedLineLengthPixels = aaPaddedLineLengthPixels * 0.5;\n\n#else /* ANTIALIASING */\n\n    // Even if there is no AA, we still want to do proper <1px rendering,\n    // so we effectively clamp the pixel sizes to minimum of 1px and compute\n    // coverage in the fragment shader\n    float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n    float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;\n\n    float halfAAPaddedLineLengthPixels = max(extendedLineLengthPixels, 1.0) * 0.5;\n\n#endif /* ANTIALIASING */\n\n    // Half line width in NDC including padding for anti aliasing\n    vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n    vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;\n    vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;\n\n    // Compute screen space position of vertex, offsetting for line size and end caps\n    vec2 ndcOffset = (\n        screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n      + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n    );\n\n    projPos.xy += ndcOffset * projPos.w;\n    projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n    projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n    // Line length with end caps\n    float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n    float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n    // Position in pixels with origin at first vertex of line segment\n    vPosition = vec3(\n      halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n      pixelPositionAlongLine,\n      pixelPositionAlongLine / extendedLineLengthPixels\n    );\n\n    // The line width radius in pixels\n    vRadius = lineWidthPixels * 0.5;\n    vLineLengthPixels = extendedLineLengthPixels;\n\n#ifdef SILHOUETTE\n\n    gl_Position = isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10, 10, 10, 1);\n\n#else /* SILHOUETTE */\n\n    gl_Position = projPos;\n\n#endif /* SILHOUETTE */\n\n#ifdef UBER\n\n    if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) {\n      gl_Position = vec4(10, 10, 10, 1);\n    }\n\n#elif defined(SKETCH)\n\n    if (lineLengthPixels <= 3.0) {\n      gl_Position = vec4(10, 10, 10, 1);\n    }\n\n#endif\n\n    return projPos;\n  }\n\n#ifdef UBER\n\n  UnpackedAttributes unpackAttributes(ComponentData component) {\n\n    vec2 sidenessNorm = aSideness;\n    vec2 sideness = sidenessNorm * 2.0 - 1.0;\n\n    float fType = component.type;\n    float extensionLengthPixels = component.extensionLength;\n    float lineWidth = component.lineWidth;\n\n    if (fType <= 0.0) {\n      extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n    }\n\n    return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n  }\n\n#else /* UBER */\n\n  UnpackedAttributes unpackAttributes(ComponentData component) {\n    vec2 sidenessNorm = aSideness;\n    vec2 sideness = sidenessNorm * 2.0 - 1.0;\n    float extensionLengthPixels = component.extensionLength;\n\n#ifdef SKETCH\n\n    extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n\n#endif /* SKETCH */\n\n    float lineWidth = component.lineWidth;\n\n    return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n  }\n\n#endif /* UBER */\n\n  void main() {\n    ComponentData component = readComponentData();\n    UnpackedAttributes unpackedAttributes = unpackAttributes(component);\n\n    vec4 worldPosV0 = uModel * vec4(aPosition0, 1.0);\n    vec4 worldPosV1 = uModel * vec4(aPosition1, 1.0);\n\n    vec4 viewPosV0 = uView * worldPosV0;\n    vec4 viewPosV1 = uView * worldPosV1;\n\n#ifdef SILHOUETTE\n\n    vec3 worldNormal = silhouetteWorldNormal(aNormalA, aNormalB);\n\n#else /* SILHOUETTE */\n\n    vec3 worldNormal = modelToWorldNormal(aNormal);\n\n#endif /* SILHOUETTE */\n\n    // General geometric computation for all types of edges\n    vec4 projPos = calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\n\n    // Component color\n    vColor = component.color;\n\n    // Specific computation for different edge styles\n    calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\n  }\n]]></snippet>\n\n<snippet name="fsRibbonEdgeLineOffsetSketch"><![CDATA[\n\n$rgba2float\n\n#if defined(UBER) || defined(SKETCH)\n\n  uniform sampler2D uStrokesTexture;\n  uniform float uStrokesNormalizationScale;\n\n  varying vec2 vStrokeUV;\n\n  float calculateLineOffsetSketch() {\n    float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n  }\n\n  float calculateLinePressureSketch() {\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0, 0.5)));\n  }\n\n#endif /* UBER || SKETCH */\n\n#ifdef SKETCH\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSketch();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSketch();\n  }\n\n#endif /* SKETCH */\n\n]]></snippet>\n\n<snippet name="fsRibbonEdgeLineOffsetRegular"><![CDATA[\n\n#if defined(UBER) || !defined(SKETCH)\n\n  float calculateLineOffsetRegular() {\n    return 0.0;\n  }\n\n  float calculateLinePressureRegular() {\n    return 1.0;\n  }\n\n#endif /* UBER || !SKETCH */\n\n#if !defined(UBER) && !defined(SKETCH)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetRegular();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureRegular();\n  }\n\n#endif /* !UBER || !SKETCH */\n\n]]></snippet>\n\n<snippet name="fsRibbonEdgeLineOffsetUber"><![CDATA[\n\n#ifdef UBER\n  varying float vType;\n\n  float calculateLineOffset() {\n    if (vType <= 0.0) {\n      return calculateLineOffsetSketch();\n    }\n    else {\n      return calculateLineOffsetRegular();\n    }\n  }\n\n  float calculateLinePressure() {\n    if (vType <= 0.0) {\n      return calculateLinePressureSketch();\n    }\n    else {\n      return calculateLinePressureRegular();\n    }\n  }\n#endif /* UBER */\n\n]]></snippet>\n\n<snippet name="fsRibbonEdge"><![CDATA[\n  $fsprecisionf\n\n  varying vec4 vColor;\n  varying float vRadius;\n  varying vec3 vPosition;\n  varying float vLineLengthPixels;\n  varying float vSizeFalloffFactor;\n  varying float vLineIndex;\n\n  // At which coverage threshold we discard a fragment completely\n  #define COVERAGE_TEST_THRESHOLD 0.01\n\n  $fsRibbonEdgeLineOffsetRegular\n  $fsRibbonEdgeLineOffsetSketch\n  $fsRibbonEdgeLineOffsetUber\n\n  vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n    float lineOffset = calculateLineOffset();\n    float positionX = position.x - lineOffset;\n\n    if (radius < 1.0) {\n      // Handle this specifically for subpixel sizes:\n      // 1. Compute correct coverage (note coverage is computed by\n      //    0.5 - dist, so we make sure that that will lead to correct\n      //    subpixel coverage\n      // 2. Ignore rounded caps\n      float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n      float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n      float coverage = min(coverageX, coverageY);\n\n      return vec2(0.5 - coverage, 0.0);\n    }\n    else {\n      // Between -radius -> 0 for start cap, 0 for line, 0 -> radius\n      float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);\n\n      vec2 lineToPosition = vec2(positionX, positionOnCap);\n      return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n    }\n  }\n\n  void main() {\n\n    float radius = vRadius * calculateLinePressure();\n\n    vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n    float coverage = clamp(0.5 - distance.x, 0.0, 1.0);\n\n#ifdef ANTIALIASING\n\n    const float coverageLimit = COVERAGE_TEST_THRESHOLD;\n\n#else /* ANTIALIASING */\n\n    // Use subpixel coverage computation when lines get subpixel widths\n    // so we still render them appropriately. Otherwise discard anything\n    // that is not fully within the line\n    float coverageLimit = radius <= 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\n\n#endif /* ANTIALIASING */\n\n    if (coverage < coverageLimit) {\n      discard;\n    }\n\n    float alpha = vColor.a * coverage;\n\n    gl_FragColor = vec4(vColor.rgb, alpha);\n  }\n]]></snippet>\n\n</snippets>\n'},1385:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(63),r(1277),r(1280)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){if(!e)return null;for(var r=e.length/2,n=s*r,i=new Array(r),o=0,a=1===t,u=0;u<e.length;u+=2){var d=(e[u]+e[u+1])/2;i[o++]=a?Math.min(n,1-(1-d)*l):Math.min(n,d*l)}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var r=t.strokesDefinition.resolution,s=r/2,l=new Uint8Array(4*r*r),u=4*r*s,d=t.strokesDefinition.amplitude,c=2*d,p=4*r,f=n.log2(r)+1,h=t.strokesDefinition.strokes.length,m=(f-1)*h*p,v=0,g=t.strokesDefinition.strokes;v<g.length;v++){for(var y=g[v],b=y.distance,_=y.pressure,x=m,w=0;w<f;w++){0!==w&&(b=a(b,0),_=a(_,1));for(var S=0;S<t.strokesDefinition.resolution;S++){var C=.5+(b?b[S%b.length]/c:0),D=_?_[S%_.length]:1;i.packFloatRGBA(C,l,x),i.packFloatRGBA(D,l,x+u),x+=4}x-=p*(h+1)}m+=p}return{resolution:r,texture:new o(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:r,height:r,wrapMode:10497},l),normalizationScale:c,amplitude:d,variants:h}};var s=.1,l=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,n))||(e.exports=i)},1386:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(407)],void 0===(i=function(e,t,r){function n(e,t){var n=r.binaryIndexOf(e,t,!0);return-1===n?t<e[0]?0:e.length:n}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRequiresUberRenderer=function(e){if(0===e.length)return!1;for(var t=e[0].type,r=0;r<e.length;r++)if(t!==e[r].type)return!0;return!1},t.determineAllTransparent=function(e){if(0===e.length)return!0;for(var t=0;t<e.length;t++){var r=e[t].material;if(r.size*r.color[3]*r.opacity>0)return!1}return!0},t.cloneIndices=function(e){if(Uint16Array.from)return e instanceof Uint16Array?Uint16Array.from(e):Uint32Array.from(e);for(var t=e instanceof Uint16Array?new Uint16Array(e.length):new Uint32Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t},t.estimateLengthAtDistance=function(e,t,r,n){return r*(n/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=n,t.computeEdgeCount=function(e,t,r){return e.length-n(e,t*r.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,r,n){for(var i=0;i<e.length;i++){var o=e[i].index,a=t[i],s=t[i+1];if(n)for(var l=a;l<s;l++){var u=n[l];r.set(u,o)}else for(l=a;l<s;l++)r.set(l,o)}}}.apply(null,n))||(e.exports=i)},1387:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(40),r(1388)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r.vec3d,o=r.vec4d,a=i.create(),s=function(){function e(){this._renderLighting={main:{intensity:i.create(),direction:i.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldDirection=i.create(),this._oldSpecular=o.create(),this._oldDiffuse=o.create(),this._oldAmbient=o.create()}return e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t||e.getDefine("GROUND_NORMAL_SHADING")){var r=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",r)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8])),e.setUniform3fv("lightDirection",this._oldDirection)},e.prototype.set=function(e){this._info=e,n.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics),i.negate(this._renderLighting.main.direction,this._oldDirection);var t=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldAmbient[3]=1,this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*t,this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*t,this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*t,this._oldDiffuse[3]=1;var r=i.set(this._oldDiffuse,a);i.scale(r,.4*this._info.globalFactor),i.add(this._oldAmbient,r)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),e.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},e}();t.SceneLighting=s}.apply(null,n))||(e.exports=i)},1388:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(40),r(63),r(1389),r(1304)],void 0===(i=function(e,t,r,n,i,o){function a(e){return(e+1)*(e+1)}function s(e){return n.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function l(e,t,r){var n=e[0],i=e[1],o=e[2],s=r||[];return s.length=a(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*n,s[2]=.4886025119*o,s[3]=.4886025119*i),t>=2&&(s[4]=1.09254843059*n*i,s[5]=1.09254843059*i*o,s[6]=.31539156525*(3*o*o-1),s[7]=1.09254843059*n*o,s[8]=.54627421529*(n*n-i*i)),s}function u(e,t){var r=a(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=r;for(var i=0;i<r;i++)n.r[i]=n.g[i]=n.b[i]=0;return n}function d(e,t){for(var r=s(t.r.length),n=0,o=e;n<o.length;n++){var a=o[n];p.negate(a.direction,y),l(y,r,v),i.elementwiseProduct(v,b),i.scalarProduct(v,a.intensity[0],g),i.add(t.r,g),i.scalarProduct(v,a.intensity[1],g),i.add(t.g,g),i.scalarProduct(v,a.intensity[2],g),i.add(t.b,g)}return t}function c(e,t){l(y,0,v);for(var r=0,n=e;r<n.length;r++){var i=n[r];t.r[0]+=v[0]*b[0]*i.intensity[0]*4*Math.PI,t.g[0]+=v[0]*b[0]*i.intensity[1]*4*Math.PI,t.b[0]+=v[0]*b[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0});var p=r.vec3d;t.numberOfCoefficients=a,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=s,t.computeCoefficients=l,t.initSHCoefficients=u,t.projectFillLights=d,t.projectAmbientLights=c,t.combineLights=function(e,t,r,n){u(t,n.sh),p.set3(0,0,0,r.intensity);var a=!1,s=f,l=h,v=m;s.length=0,l.length=0,v.length=0;for(var g=0,y=e;g<y.length;g++)(x=y[g])instanceof o.MainLight&&!a?(p.set(x.direction,r.direction),r.intensity[0]=x.intensity[0],r.intensity[1]=x.intensity[1],r.intensity[2]=x.intensity[2],r.castShadows=x.castShadows,a=!0):x instanceof o.MainLight||x instanceof o.FillLight?s.push(x):x instanceof o.AmbientLight?l.push(x):x instanceof o.SphericalHarmonicsLight&&v.push(x);d(s,n.sh),c(l,n.sh);for(var b=0,_=v;b<_.length;b++){var x=_[b];i.add(n.sh.r,x.sh.r),i.add(n.sh.g,x.sh.g),i.add(n.sh.b,x.sh.b)}};var f=[],h=[],m=[],v=[0],g=[0],y=p.create(),b=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,n))||(e.exports=i)},1389:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r},t.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t[n];return r},t.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t;return r},t.add=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}}.apply(null,n))||(e.exports=i)},1390:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderHUD"><![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  uniform float pixelRatio;\n  uniform vec2 screenOffset;\n  uniform vec2 anchorPos;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  uniform vec4 screenSizePerspective;\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n  varying vec3 debugBorderCoords;\n#endif\n\n  attribute vec2 $uv0;\n  attribute vec4 $color;\n  attribute vec2 $size;\n  attribute vec4 $auxpos2;\n\n  varying vec4 vcolor;\n\n  varying vec2 vtc;\n  varying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  varying float voccluded;\n#endif\n\n  $vvUniforms\n\n  $alignToPixelCenter\n  $alignToPixelOrigin\n  $projectPositionHUD\n  $vvFunctions\n\n  void main(void) {\n    ProjectHUDAux projectAux;\n    vec4 posProj = projectPositionHUD(projectAux);\n\n    vec2 inputSize;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n    inputSize = screenSizePerspectiveScaleVec2($size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n\n    vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n\n#else\n\n    inputSize = $size;\n\n    vec2 screenOffsetScaled = screenOffset;\n#endif\n\n#ifdef VV_SIZE\n    // only use width (.xx) for proportional scaling\n    // (if no width was defined in vv, width\n    //  will be a copy of height vv)\n    inputSize *= vvGetScale($auxpos2).xx;\n#endif\n\n    vec2 combinedSize = inputSize * pixelRatio;\n    vec4 quadOffset = vec4(0);\n\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n    bool visible = testVisibilityHUD(posProj);\n#endif\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  voccluded = visible ? 0.0 : 1.0;\n#endif\n\n#ifdef OCCL_TEST\n    if (visible) {\n#endif\n      // UV goes from 0 to 1.99999, where the integer part is used\n      // for the normalized vertex coordinates, and the fractional\n      // part is used for texture sampling\n      vec2 uv01 = floor($uv0);\n      vec2 uv = $uv0 - uv01;\n\n      // Displace icon based on anchor position (normalized for size) and\n      // absolute screen offset. anchorPos is [-0.5, 0.5]\n      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n\n#ifdef SIGNED_DISTANCE_FIELD\n\n      // SDF primitives might be scaled so that the SDF texture resolution does\n      // not match the resolution of the canvas, but we still want to render\n      // outline-only (\'cross\' and \'x\') primitives cleanly. Aligning to a screen\n      // pixel border at the geometry center achieves this, since SDF textures\n      // always have power of 2 dimensions.\n      posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n      posProj += quadOffset;\n\n      // Aligning vertex positions to the nearest (using \'floor\') screen pixel\n      // border renders textures with pixel-perfect results. If the texture\n      // resolution does not match the canvas resolution then aligning is\n      // redundant.\n      if (inputSize.x == $size.x) {\n        posProj = alignToPixelOrigin(posProj, viewport.zw);\n      }\n#endif\n\n      gl_Position = posProj;\n\n      vtc = uv;\n\n#ifdef DEBUG_DRAW_BORDER\n      debugBorderCoords = vec3(uv01, 1.0 / combinedSize);\n#endif\n\n      vsize = inputSize;\n#ifdef OCCL_TEST\n    } else {\n      vtc = vec2(.0);\n\n#ifdef DEBUG_DRAW_BORDER\n      debugBorderCoords = vec3(0);\n#endif\n\n    }\n#endif\n\n    gl_Position = posProj;\n\n#ifdef VV_COLOR\n    vcolor = vvGetColor($auxpos2, vvColorValues, vvColorColors);\n#else\n    vcolor = $color / 255.0;\n#endif\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderHUDBaseVariables"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec4 overrideColor;\n  uniform vec4 outlineColor;\n  uniform float outlineSize;\n\n  varying vec4 vcolor;\n\n  varying vec2 vtc;\n  varying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  varying float voccluded;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n  varying vec3 debugBorderCoords;\n#endif\n]]></snippet>\n\n<snippet name="fragmentShaderHUDBaseMain"><![CDATA[\n  vec4 premultiply(vec4 v) {\n    return vec4(v.rgb * v.a, v.a);\n  }\n\n  $rgba2float\n\n  void main() {\n\n#ifdef SIGNED_DISTANCE_FIELD\n    vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n    vec4 fillPixelColor = overrideColor * vcolor;\n\n    // Attempt to sample texel centers to avoid that thin cross outlines\n    // disappear with large symbol sizes.\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n    const float txSize = 128.0;\n    const float texelSize = 1.0 / txSize;\n    // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n    vec2 scaleFactor = (vsize - txSize) * texelSize;\n    vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n    // Get distance and map it into [-0.5, 0.5]\n    float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n    // Distance in output units (i.e. pixels)\n    float dist = d * vsize.x;\n\n    // Create smooth transition from the icon into its outline\n    fillPixelColor.a *= clamp(0.5 - dist, 0.0, 1.0);\n\n    if (outlineSize > 0.25) {\n      vec4 outlinePixelColor = outlineColor;\n      float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n      // Create smooth transition around outline\n      outlinePixelColor.a *= clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n      // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n      float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n      vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n        vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n      gl_FragColor = vec4(compositeColor, compositeAlpha);\n    }\n    else {\n      gl_FragColor = premultiply(fillPixelColor);\n    }\n\n    // visualize SDF:\n    // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n#else\n\n    // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\n    // fragment color. Input textures should already be pre-multiplied and so\n    // don\'t require adjustment, but the override and vertex colors must be\n    // modulated by their alpha values.\n\n    gl_FragColor = texture2D(tex, vtc, -0.5) * premultiply(overrideColor * vcolor);\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n     float isBorder = float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\n     gl_FragColor = mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\n#endif\n\n    if (gl_FragColor.a < 0.1) {\n      discard;\n    }\n\n]]></snippet>\n\n<snippet name="fragmentShaderHUD"><![CDATA[\n$fragmentShaderHUDBaseVariables\n$fragmentShaderHUDBaseMain\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderHUDHighlight"><![CDATA[\n$fragmentShaderHUDBaseVariables\n\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n$fragmentShaderHUDBaseMain\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n    // Instead of deciding on a per-pixel basis if the highlight is occluded,\n    // do it for all highlight pixel based on the centroid occlusion. This\n    // is a temporary solution for:\n    // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\n    if (voccluded == 1.0) {\n      gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n    } else {\n      gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n    }\n#else\n    $highlightWrite\n#endif\n  }\n]]></snippet>\n\n\n<snippet name="vertexShaderOcclusionTestPixel"><![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  $alignToPixelCenter\n  $projectPositionHUD\n\n  void main(void) {\n    vec4 posProjCenter;\n\n    // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just project outside\n    // of clip space.\n    if (dot($position, $position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel filtering to affect\n      // the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n    }\n    else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n]]></snippet>\n\n</snippets>\n'},1391:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new r(t):null},t.getTimestamp=function(e,t,r){void 0===r&&(r=50);var n=e.capabilities.disjointTimerQuery;if(!n)return null;if(n.timestampBits()<=0)return null;var i=n.createQuery();n.createTimestamp(i);var o=function(){var e=n.resultAvailable(i),a=n.disjoint();if(!e||a)a?t():setTimeout(o,r);else{var s=n.getResult(i);t(s/1e6)}};o()},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;if(!t)return!1;var r=t.timestampBits();return console.log({bits:r}),r>0};var r=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var r=this.timer.getResult(this.query);this.cb(r/1e6)}},e}()}.apply(null,n))||(e.exports=i)},1392:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderTexOnly"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n    vtc = $uv0;\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderTexOnly"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec4 color;\n  varying vec2 vtc;\n\n  void main() {\n    vec4 texColor = texture2D(tex, vtc);\n    gl_FragColor = texColor * color;\n  }\n]]></snippet>\n\n</snippets>\n'},1393:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277)],void 0===(i=function(e,t,r){function n(e,t){return e+"_"+t}var i=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,r.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t){this.textureRep=e,this.programRep=t,this.id2glMaterialRef={}}return e.prototype.aquire=function(e){return this.aquireExt(e,"color")},e.prototype.aquireDepthShadowMap=function(e){return this.aquireExt(e,"depthShadowMap")},e.prototype.aquireDepth=function(e){return this.aquireExt(e,"depth")},e.prototype.aquireNormal=function(e){return this.aquireExt(e,"normal")},e.prototype.aquireHighlight=function(e){return this.aquireExt(e,"highlight")},e.prototype.aquireExt=function(e,t){var r,o=n(e.id,t),a=this.id2glMaterialRef[o];if(null==a){var s=e.getGLMaterials()[t];r=s?new s(e,this.programRep,this.textureRep):void 0,a=new i(r),this.id2glMaterialRef[o]=a}else r=a.getGLMaterial();return a.incRefCnt(),r&&this.increaseProgramReferences(r),r},e.prototype.release=function(e){this.releaseExt(e,"color")},e.prototype.releaseDepth=function(e){this.releaseExt(e,"depth")},e.prototype.releaseNormal=function(e){this.releaseExt(e,"normal")},e.prototype.releaseDepthShadowMap=function(e){this.releaseExt(e,"depthShadowMap")},e.prototype.releaseHighlight=function(e){this.releaseExt(e,"highlight")},e.prototype.releaseExt=function(e,t){var r=n(e,t),i=this.id2glMaterialRef[r];if(i.decRefCnt(),0===i.getRefCnt()){var o=i.getGLMaterial();o&&(this.decreaseProgramReferences(o),o.dispose()),delete this.id2glMaterialRef[r]}},e.prototype.updateMaterialParameters=function(e){var t=this.id2glMaterialRef[n(e,"color")];t&&t.getGLMaterial()&&this.updateParamsForMat(t.getGLMaterial());var r=this.id2glMaterialRef[n(e,"depth")];r&&r.getGLMaterial()&&this.updateParamsForMat(r.getGLMaterial());var i=this.id2glMaterialRef[n(e,"depthShadowMap")];i&&i.getGLMaterial()&&this.updateParamsForMat(i.getGLMaterial());var o=this.id2glMaterialRef[n(e,"normal")];o&&o.getGLMaterial()&&this.updateParamsForMat(o.getGLMaterial());var a=this.id2glMaterialRef[n(e,"highlight")];a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())},e.prototype.updateParamsForMat=function(e){e.updateParameters&&(this.decreaseProgramReferences(e),e.updateParameters(),this.increaseProgramReferences(e))},e.prototype.increaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,n=0;n<t.length;n++)r.increaseRefCount(t[n])},e.prototype.decreaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,n=0;n<t.length;n++)r.decreaseRefCount(t[n])},e}()}.apply(null,n))||(e.exports=i)},1394:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(1277),r(1280)],void 0===(i=function(e,t,r,n,i){var o=r.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),a=function(){function e(e){this._glTexture=null,this._refCount=0,this._glTexture=e}return e.prototype.incRefCnt=function(){++this._refCount},e.prototype.decRefCnt=function(){--this._refCount,n.assert(this._refCount>=0)},e.prototype.getRefCnt=function(){return this._refCount},e.prototype.setGLTexture=function(e){this._glTexture=e},e.prototype.getGLTexture=function(){return this._glTexture},e}();return function(){function e(e,t,r,n){this.NUM_PARALLEL=8,this.textures=e,this._programRepository=t,this.getViewportToRestore=r,this._rctx=n,this.NUM_PARALLEL=8,this.id2textureRef={},this.loading={},this._queue=[],this.listeners=[],this.afExt=n.capabilities.textureFilterAnisotropic,this.maxMaxAnisotropy=this.afExt?n.parameters.maxMaxAnisotropy:1,this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy),this._needsRender=!0,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256);for(var i=0;i<this._fallbackTextureData.length;++i)this._fallbackTextureData[i]=255,this._fallbackTextureTransparentData[i]=(i+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}return e.prototype.resetNeedsRender=function(){this._needsRender=!1},e.prototype.needsRender=function(){return this._needsRender},e.prototype.aquire=function(e,t,r){var s=this,l=this.id2textureRef[e];if(null==l){var u=this.textures[e];n.assert(void 0!==u),u.setUnloadFunc(this._unload.bind(this));var d=!0===t,c=this._createGLTextureDescription(u);if(l=new a(null),n.assert(null==this.id2textureRef[e]),this.id2textureRef[e]=l,u.initializeThroughRender){var p=u.initializeThroughRender(this._rctx,c);l.setGLTexture(p),r&&r(l)}else if(u.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(e,c,r):this._queue.push([e,c,r]);else try{u.initializeThroughUpload(this._rctx,c,this._programRepository,this.getViewportToRestore(),function(e){l.setGLTexture(e),s._needsRender=!0,r&&r(l)})}catch(e){o.error("#aquire","Error loading texture: "+e.toString())}null==l.getGLTexture()&&l.setGLTexture(new i(this._rctx,this._fallbackTextureDesc,d?this._fallbackTextureTransparentData:this._fallbackTextureData)),this._needsRender=!0}return l.incRefCnt(),l},e.prototype.release=function(e){var t=this.id2textureRef[e];void 0!==t&&(t.decRefCnt(),n.assert(t.getRefCnt()>=0))},e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},e.prototype.getIsLoaded=function(e){if(null==this.id2textureRef[e])return!1;if(void 0!==this.loading[e])return!1;for(var t=0;t<this._queue.length;++t)if(this._queue[t][0]===e)return!1;return!0},e.prototype.addTextureListener=function(e){n.assert(-1===this.listeners.indexOf(e)),this.listeners.push(e)},e.prototype.removeTextureListener=function(e){var t=this.listeners.indexOf(e);n.assert(-1!==t),this.listeners.splice(t,1)},e.prototype.getTexture=function(e){return this.textures[e]},e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},e.prototype._unload=function(e){var t=this.id2textureRef[e];if(void 0!==t){var r=t.getGLTexture();r&&r.dispose(),delete this.id2textureRef[e]}this.next(e)},e.prototype._createGLTextureDescription=function(e){var t=e.params&&e.params.wrapClamp;return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&e.params&&e.params.mipmap&&!e.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:t?33071:void 0}},e.prototype.next=function(e){if(e in this.loading){delete this.loading[e];var t=Object.keys(this.id2textureRef),r=Object.keys(this.loading);this.listeners.forEach(function(n){n(e,t,r)}),this.processQueue()}},e.prototype._loadImage=function(e,t,r){var i=this;n.assert(null==this.loading[e]),this.loading[e]=!0;var o=this.textures[e];n.assert(void 0!==o),setTimeout(function(){var n=i.id2textureRef[e];n&&n.getRefCnt()&&o.initializeThroughUpload(i._rctx,t,i._programRepository,i.getViewportToRestore(),function(t){i.next(e),i._needsRender=!0,n&&n.getRefCnt()&&(n.setGLTexture(t),r&&r(n))})},0)},e.prototype.processQueue=function(){for(var e=[],t=0;t<this._queue.length;++t){var r=this._queue[t][0],n=this.id2textureRef[r];void 0!==n&&(0===n.getRefCnt()?(n.getGLTexture().dispose(),delete this.id2textureRef[r]):e.push(this._queue[t]))}this._queue=e;var i=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(t=0;t<i;++t)this._loadImage(this._queue[t][0],this._queue[t][1],this._queue[t][2]);this._queue.splice(0,i)},e}()}.apply(null,n))||(e.exports=i)},1395:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n\x3c!--\n===============================================================================\nSmartly downsamples a texture, halfing its resolution. This allows for a square\nscreen region to check if none, any or all pixels were set.\n\nThe red channel is always ceiled after interpolating the 4 merged pixels.\nThis allows to evaluate:\nany(pixels.red != 0.0) as red == 1.0\nnone(pixels.red != 0.0) as red == 0.0\n\nThe green and blue channels are set to floor(max(green, blue)).\nThis allows to evaluate:\nall(pixels.green || pixels.blue) as green == 1.0\n===============================================================================\n--\x3e\n\n<snippet name="vsConservativeDownsample"><![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n\n  void main()\n  {\n    gl_Position = vec4(vec2(1.0) - $position * 2.0, .0, 1.0);\n  }\n]]></snippet>\n\n<snippet name="fsConservativeDownsample"><![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform vec2 invFramebufferDim;\n\n  void main()\n  {\n    vec2 coord = gl_FragCoord.xy * invFramebufferDim;\n    vec4 value = texture2D(tex, coord);\n    float mx = floor(max(value.g, value.b));\n    gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);\n  }\n]]></snippet>\n\n\x3c!--\n===============================================================================\nGaussian blur with linear sampling. Supports different number of samples, but\nonly 5 samples have proper weights. Uses linear texture interpolation to reduce\nthe number of samples taken.\n\nDefines:\nGRID_OPTIMIZATION (set or !set)\nGAUSSIAN_SAMPLES (3,5,7)\n\nThis technique requires linear filtering on source texture\nhttp://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\n===============================================================================\n--\x3e\n<snippet name="vsHighlightBlurFastGaussian"><![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n  attribute vec2 $uv0;\n\n  #ifdef GRID_OPTIMIZATION\n    uniform sampler2D coverageTex;\n    varying vec3 blurCoordinate;\n  #else\n    uniform vec2 blurSize;\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n  #endif\n\n  void main()\n  {\n    gl_Position = vec4($position, 0.0, 1.0);\n\n    #ifdef GRID_OPTIMIZATION\n      // sample the coverage texture at the block center\n      // and if no coverage detected, create degenerate triangle\n      vec4 cov = texture2D(coverageTex, $uv0);\n      if (cov.r == 0.0) {\n        gl_Position = vec4(0,0,0,0);\n      }\n\n      // create texture coordinate for blur center\n      // encode information about fully inside block in z coordinate\n      blurCoordinate = vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n    #else\n      vec2 uv = $position.xy * .5 + vec2(.5);\n\n      #if GAUSSIAN_SAMPLES == 3\n        // not proper gaussian weights\n        blurCoordinates[0] = uv;\n        blurCoordinates[1] = uv + blurSize * 1.407333;\n        blurCoordinates[2] = uv - blurSize * 1.407333;\n      #elif GAUSSIAN_SAMPLES == 5\n        blurCoordinates[0] = uv;\n        blurCoordinates[1] = uv + blurSize * 1.407333;\n        blurCoordinates[2] = uv - blurSize * 1.407333;\n        blurCoordinates[3] = uv + blurSize * 3.294215;\n        blurCoordinates[4] = uv - blurSize * 3.294215;\n      #elif GAUSSIAN_SAMPLES == 7\n        // not proper gaussian weights\n        blurCoordinates[0] = uv;\n        blurCoordinates[1] = uv + blurSize * 1.407333;\n        blurCoordinates[2] = uv - blurSize * 1.407333;\n        blurCoordinates[3] = uv + blurSize * 3.294215;\n        blurCoordinates[4] = uv - blurSize * 3.294215;\n        blurCoordinates[5] = uv + blurSize * 5.1;\n        blurCoordinates[6] = uv - blurSize * 5.1;\n      #elif GAUSSIAN_SAMPLES == 9\n        // not proper gaussian weights\n        blurCoordinates[0] = uv;\n        blurCoordinates[1] = uv + blurSize * 1.407333;\n        blurCoordinates[2] = uv - blurSize * 1.407333;\n        blurCoordinates[3] = uv + blurSize * 3.294215;\n        blurCoordinates[4] = uv - blurSize * 3.294215;\n        blurCoordinates[5] = uv + blurSize * 5.1;\n        blurCoordinates[6] = uv - blurSize * 5.1;\n        blurCoordinates[7] = uv + blurSize * 7.1;\n        blurCoordinates[8] = uv - blurSize * 7.1;\n      #endif\n    #endif\n  }\n]]></snippet>\n\n<snippet name="fsHighlightBlurFastGaussian"><![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n\n  #ifdef GRID_OPTIMIZATION\n    uniform vec2 blurSize;\n    varying vec3 blurCoordinate;\n  #else\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n  #endif\n\n  void main()\n  {\n    #ifdef GRID_OPTIMIZATION\n      vec2 uv = blurCoordinate.xy;\n      vec4 center = texture2D(tex, uv);\n\n      // do not blur if no pixel or all pixels in neighborhood are set\n      if (blurCoordinate.z == 1.0) {\n        gl_FragColor = center;\n      }\n      else {\n        vec4 sum = vec4(0.0);\n\n        #if GAUSSIAN_SAMPLES == 3\n          // not proper gaussian weights\n          sum += center * 0.204164;\n          sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        #elif GAUSSIAN_SAMPLES == 5\n          sum += center * 0.204164;\n          sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n          sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        #elif GAUSSIAN_SAMPLES == 7\n          // not proper gaussian weights\n          sum += center * 0.204164;\n          sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n          sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n          sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n          sum += texture2D(tex, uv + blurSize * 5.1) * 0.03;\n          sum += texture2D(tex, uv - blurSize * 5.1) * 0.03;\n        #elif GAUSSIAN_SAMPLES == 9\n          // not proper gaussian weights\n          sum += center * 0.154164;\n          sum += texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n          sum += texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n          sum += texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n          sum += texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n          sum += texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n          sum += texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n          sum += texture2D(tex, uv + blurSize * 7.5) * 0.05;\n          sum += texture2D(tex, uv - blurSize * 7.5) * 0.05;\n        #endif\n\n        gl_FragColor = sum;\n      }\n    #else\n      vec4 sum = vec4(0.0);\n\n      #if GAUSSIAN_SAMPLES == 3\n        // not proper gaussian weights\n        sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n      #elif GAUSSIAN_SAMPLES == 5\n        sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n        sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n      #elif GAUSSIAN_SAMPLES == 7\n        // not proper gaussian weights\n        sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n        sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n        sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n        sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n        sum += texture2D(tex, blurCoordinates[5]) * 0.03;\n        sum += texture2D(tex, blurCoordinates[6]) * 0.03;\n      #elif GAUSSIAN_SAMPLES == 9\n        // not proper gaussian weights\n        sum += texture2D(tex, blurCoordinates[0]) * 0.154164;\n        sum += texture2D(tex, blurCoordinates[1]) * 0.204005;\n        sum += texture2D(tex, blurCoordinates[2]) * 0.204005;\n        sum += texture2D(tex, blurCoordinates[3]) * 0.123913;\n        sum += texture2D(tex, blurCoordinates[4]) * 0.123913;\n        sum += texture2D(tex, blurCoordinates[5]) * 0.09;\n        sum += texture2D(tex, blurCoordinates[6]) * 0.09;\n        sum += texture2D(tex, blurCoordinates[7]) * 0.05;\n        sum += texture2D(tex, blurCoordinates[8]) * 0.05;\n      #endif\n\n      gl_FragColor = sum;\n    #endif\n  }\n]]></snippet>\n\n\x3c!--\n===============================================================================\nMerging blurred outlines with source image, advanced version\n\nDefines:\nGRID_OPTIMIZATION (set or !set)\nGRID_DEBUG (set or !set)\n===============================================================================\n--\x3e\n<snippet name="vsHighlightApply"><![CDATA[\n\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  #ifdef GRID_OPTIMIZATION\n    attribute vec2 $uv0;\n    uniform sampler2D coverageTex;\n  #endif\n\n  void main()\n  {\n    #ifdef GRID_OPTIMIZATION\n      #ifdef GRID_DEBUG\n        vec4 cov = texture2D(coverageTex, $uv0);\n        // if no highlight pixel set in this block,\n        // or all pixels set, hide block\n        if (cov.r == 0.0 || cov.g == 1.0 || cov.b == 1.0) {\n          gl_Position = vec4(0,0,0,0);\n          return;\n        }\n        gl_Position = vec4($position, .0, 1.0);\n        uv = $uv0;\n        return;\n      #else\n        vec4 cov = texture2D(coverageTex, $uv0);\n        // if no highlight pixel set in this block, hide block\n        if (cov.r == 0.0) {\n          gl_Position = vec4(0,0,0,0);\n          return;\n        }\n      #endif\n    #endif\n\n    gl_Position = vec4($position, .0, 1.0);\n    uv = $position.xy * .5 + vec2(.5);\n  }\n]]></snippet>\n\n<snippet name="fsHighlightApply"><![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform sampler2D origin;\n\n  uniform vec4 color;\n  uniform float outlineSize;\n  uniform float blurSize;\n  uniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\n\n  varying vec2 uv;\n\n  void main()\n  {\n    #if defined(GRID_OPTIMIZATION) && defined(GRID_DEBUG)\n      gl_FragColor = vec4(uv, 0, 1.0);\n    #else\n      // Read the highlight intensity from the blurred highlight image\n      vec4 blurredHighlightValue = texture2D(tex, uv);\n      float highlightIntensity = blurredHighlightValue.a;\n\n      // Discard all pixels which are not affected by highlight\n      if (highlightIntensity == 0.0) {\n        discard;\n      }\n\n      vec4 origin_color = texture2D(origin, uv);\n\n      float outlineIntensity;\n      float fillIntensity;\n\n      // if occluded\n      if (blurredHighlightValue.g > blurredHighlightValue.b) {\n        outlineIntensity = color.w * opacities[1];\n        fillIntensity = color.w * opacities[3];\n      }\n      // if unoccluded\n      else {\n        outlineIntensity = color.w * opacities[0];\n        fillIntensity = color.w * opacities[2];\n      }\n\n      float inner = 1.0 - outlineSize / 9.0;\n      float outer = 1.0 - (outlineSize + blurSize) / 9.0;\n\n      float outlineFactor = smoothstep(outer, inner, highlightIntensity);\n      //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);\n      float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n      float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n      // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n      // I.e., color should not be premultiplied with alpha\n      gl_FragColor = vec4(color.xyz, intensity);\n    #endif\n  }\n]]></snippet>\n\n</snippets>\n'},1396:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsOffscreenRenderer"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position = vec4($position.xy, 0.0, 1.0);\n    vtc = $position.xy * 0.5 + 0.5;\n  }\n]]></snippet>\n\n<snippet name="fsOffscreenRenderer"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n\n  varying vec2 vtc;\n\n  void main() {\n    gl_FragColor = texture2D(tex, vtc);\n  }\n]]></snippet>\n\n<snippet name="fsOffscreenRendererTransparentToHUDVisibility"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n\n  varying vec2 vtc;\n\n  void main() {\n    gl_FragColor = vec4(1.0 - texture2D(tex, vtc).a);\n  }\n]]></snippet>\n\n\n\n</snippets>\n'},1397:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(1285),r(1457),r(1280)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a={dataType:5121},s={},l=function(){function e(e){this.rctx=e,this.framebuffers=new Map,this.depthTextures=new Map,this.depthBuffers=new Map,this.colorTextures=new Map,this.nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(e){return e.dispose()}),this.depthBuffers.clear(),this.depthTextures.forEach(function(e){return e.dispose()}),this.depthTextures.clear(),this.colorTextures.forEach(function(e){return e.dispose()}),this.colorTextures.clear()},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var r=this.depthTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new o(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this.depthTextures.set(e.id,r)),r}},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var n=this.depthBuffers.get(e.id);return n?n.descriptor.width===t.width&&n.descriptor.height===t.height||n.resize(t.width,t.height):(n=new i(this.rctx,r({internalFormat:34041},t)),this.depthBuffers.set(e.id,n)),n}},e.prototype.getColorTexture=function(e,t){var r=this.colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new o(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this.colorTextures.set(e.id,r)),r},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},s,e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},a,e)},e.prototype.getFramebuffer=function(e,t,r){var i=this.getKey(t,r),o=this.framebuffers.get(i),a=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=r?this.getDepthTexture(r,e):void 0;return o?((o.width!==e.width||o.height!==e.height||o.colorTexture!==a||o.depthStencilTexture!==s)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e.width,e.height),o.attachColorTexture(a),o.attachDepthStencilTexture(s)),o):(o=r?n.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:4},s):n.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(i,o),o)}var l=r?this.getDepthBuffer(r,e):void 0;return o?((o.width!==e.width||o.height!==e.height||o.colorTexture!==a)&&(o.detachColorTexture(),o.detachDepthStencilBuffer(),o.resize(e.width,e.height),o.attachColorTexture(a),o.attachDepthStencilBuffer(l)),o):(o=n.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:r?3:0},l),this.framebuffers.set(i,o),o)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e}();t.RenderTargetHelper=l}.apply(null,n))||(e.exports=i)},1398:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1277)],void 0===(i=function(e,t,r){return function(){function e(){this.shaderVariators={},this._nextId=0,this._programsByName={},this._namesById=[],this._programRefCount=[],this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){for(var e in this._programsByName)this._programsByName[e].dispose();this._programsByName=null,this._namesById=null,this._programRefCount=null},e.prototype.add=function(e,t){r.assert(null==this._programsByName[e]),this._programsByName[e]=t,this._namesById[t.id]=e},e.prototype.get=function(e){return this._programsByName[e]},e.prototype.addShaderVariations=function(e,t){this.shaderVariators[e]=t},e.prototype.getShaderVariations=function(e){return this.shaderVariators[e]},e.prototype.getShaderVariationsProgram=function(e,t,r,n,i){var o=this.getShaderVariations(e);return o&&o.getProgram(t,r,n,i)},e.prototype.getProgramsUsingUniform=function(e){return this._commonUniforms[e]||[]},e.prototype.increaseRefCount=function(e){var t=e.id;this._programRefCount[t]?this._programRefCount[t]++:(this._programRefCount[t]=1,this._findCommonUniforms(e))},e.prototype.decreaseRefCount=function(e){var t=e.id;this._programRefCount[t]>1?this._programRefCount[t]--:(this._forgetCommonUniforms(e),this._programRefCount[t]=0)},e.prototype._getNextId=function(){return this._nextId++},e.prototype._findCommonUniforms=function(e){for(var t in this._commonUniforms)e.hasUniform(t)&&(r.assert(-1===this._commonUniforms[t].indexOf(e),"common uniforms of program have already been determined"),this._commonUniforms[t].push(e))},e.prototype._forgetCommonUniforms=function(e){for(var t in this._commonUniforms){var r=this._commonUniforms[t],n=r.indexOf(e);n>-1&&(r[n]=r[r.length-1],r.pop())}},e}()}.apply(null,n))||(e.exports=i)},1399:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1455),r(1277)],void 0===(i=function(e,t,r,n){return function(){function e(e){var t=n.VertexAttrConstants;for(var r in t)this[t[r]]=n.VertexAttrConstants[r];if(e)for(var i in e)this[i]=e[i]}return e.prototype._parse=function(e){for(var t=r.parse(e).getElementsByTagName("snippet"),i=/\$[a-zA-Z0-9_]+[ \t]*/,o=/[\$\s]+/g,a=0;a<t.length;a++){var s=t[a].getAttribute("name");n.assert(null==this[s]);for(var l=t[a].textContent;;){var u=l.match(i);if(null==u)break;var d=this[u[0].replace(o,"")];n.assert(void 0!==d),l=l.replace(u[0],d)}this[s]=l}},e}()}.apply(null,n))||(e.exports=i)},1400:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n  <snippet name="createFsSSAOSrc"><![CDATA[\n\n  $fsprecisionf\n\n  uniform sampler2D rnm;\n  uniform sampler2D normalMap;\n  uniform sampler2D depthMap;\n  uniform float   ssaoAtt;\n  uniform vec2    rnmScale;\n  uniform float   radius;\n  uniform vec2    nearFar;\n  uniform vec3    pSphere[64];\n\n  varying vec2    uv;\n\n  const float   strength = .07;\n  const float   falloff = .000002;\n\n  $rgba2float\n  void main(void) {\n    vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n    float currentPixelDepth = rgba2float(texture2D(depthMap, uv));\n    vec3 ep = vec3(uv.xy, currentPixelDepth);\n    vec3 norm = vec3(-1.0) + 2.0 * texture2D(normalMap, uv).xyz;\n    float bl = .0;\n    float f = mix(nearFar.x, nearFar.y, currentPixelDepth) / nearFar.x;\n    float radD = radius / f;\n    radD = min(radD, .5);\n    float depthDifference;\n    vec3 ray;\n\n    for(int i = 0; i < NUM_TAP_SAMPLES; ++i) {\n      ray = radD*reflect(pSphere[i], fres);\n      vec2 tc = ep.xy + sign(dot(ray, norm) ) * ray.xy;\n      if (tc.x >= .0 && tc.y >= .0 && tc.x <= 1.0 && tc.y <= 1.0) {\n        float occluderDepth = rgba2float(texture2D(depthMap, tc));\n        vec3 occluderNormal = vec3(-1.0) + 2.0 * texture2D(normalMap, tc).xyz;\n        depthDifference = currentPixelDepth - occluderDepth;\n        bl += step(falloff, depthDifference) * (1.0 - dot(occluderNormal, norm)) * (1.0 - smoothstep(falloff, strength, depthDifference));\n      }\n    }\n\n    float ao = 1.0 + bl * (-1.38 / float(NUM_TAP_SAMPLES)) * ssaoAtt;\n    gl_FragColor.a = ao;\n  }\n]]></snippet>\n\n  <snippet name="getDepthLinear"><![CDATA[\n  float getDepthLinear(vec2 ssC) {\n    return -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\n  }\n]]></snippet>\n\n<snippet name="createFsSSAOSrcObscurance"><![CDATA[\n  $fsprecisionf\n\n  uniform mat4 projMatrixInv;\n\n  uniform sampler2D normalMap;\n  uniform sampler2D depthMap;\n\n  uniform float     intensity;\n\n  uniform float projScale;\n  uniform float     radius;\n  uniform vec2      nearFar;\n\n  uniform vec4      projInfo;\n\n  uniform vec2    screenDimensions;\n\n  //noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\n  uniform vec3    pSphere[NUM_TAP_SAMPLES]; //tap position\n  uniform vec2    rnmScale;\n  uniform sampler2D rnm; //noise texture\n\n  //set z scaling, used to prevent division in ortho mode\n  uniform vec2 zScale;\n\n  varying vec2  uv;\n  varying vec4  camPos;\n\n  $rgba2float\n  $getDepthLinear\n\n  /** Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\n  /*uniform float numSpiralTurns;\n  vec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    // Radius relative to ssR\n    float alpha = (float(sampleNumber) + 0.5) * (1.0 / float(NUM_TAP_SAMPLES));\n    float angle = alpha * (numSpiralTurns * 6.28) + spinAngle;\n\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n  }*/\n\n\n  float fallOffFunction(float vv, float vn, float bias) {\n    float radius2 = radius * radius;\n\n    // A: From the HPG12 paper\n    // Note large epsilon to avoid overdarkening within cracks\n    // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n    // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n    float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n    // C: Medium contrast (which looks better at high radii), no division.  Note that the\n    // contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\n    // more computationally efficient and happens to be aesthetically pleasing.\n    // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n    // D: Low contrast, no division operation\n    // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);\n  }\n\n\n  /** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\n  float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(normalize(v), n_C);\n    return fallOffFunction(vv, vn, 0.1);\n  }\n\n\n  /**\n   * Reconstruct camera-space P.xyz from screen-space S = (x, y) in\n   * pixels and camera-space z < 0.  Assumes that the upper-left pixel center\n   * is at (0.5, 0.5) [but that need not be the location at which the sample tap\n   * was placed!]\n   *\n   * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\n   */\n  vec3 reconstructCSPosition(vec2 S, float z) {\n    return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n  }\n\n  void main(void) {\n    //Hash function used in the HPG12 AlchemyAO paper\n    //Not supported in WebGL -> using texture lookup as in old SSAO shader instead\n    //ivec2 ssC = ivec2(gl_FragCoord.xy);\n    //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n    vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n    float currentPixelDepth = getDepthLinear(uv);\n\n    if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {\n      gl_FragColor = vec4(0);\n      return;\n    }\n\n    vec3 currentPixelPos = reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n    // get the normal of current fragment\n    vec4 norm4 = texture2D(normalMap, uv);\n    vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;\n    bool isTerrain = norm4.w<0.5;\n\n    float sum = .0;\n\n    vec4 occluderFragment;\n    vec3 ray;\n\n    vec3 tapPixelPos;\n\n    // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n    // bug or deviation from CE somewhere else?\n    float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n    for(int i = 0; i < NUM_TAP_SAMPLES; ++i)\n    {\n      // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n      //float ssR;\n      //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);\n      // get the depth of the occluder fragment\n      //vec2 offset = vec2(-unitOffset*radius*ssR*ps);\n\n      vec2 unitOffset = reflect(pSphere[i], fres).xy;\n      vec2 offset = vec2(-unitOffset*radius*ps);\n\n\n      //don\'t use current or very nearby samples\n      if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;\n\n\n      vec2 tc = vec2(gl_FragCoord.xy + offset);\n      if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;\n      vec2 tcTap = tc/screenDimensions;\n      float occluderFragmentDepth = getDepthLinear(tcTap);\n\n      if (isTerrain) {\n        bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;\n        if (isTerrainTap) {\n          continue;\n        }\n      }\n\n      tapPixelPos = reconstructCSPosition(tc, occluderFragmentDepth);\n\n      sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n    }\n\n    // output the result\n\n    float A = max(1.0-sum*intensity/float(NUM_TAP_SAMPLES),0.0);\n\n    // Anti-tone map to reduce contrast and drag dark region farther\n    // (x^0.2 + 1.2 * x^4)/2.2\n    A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n\n    //gl_FragColor = vec4(norm/2.0+0.5, 1.0);\n    //gl_FragColor = vec4(-currentPixelDepth/1000.0);\n    //gl_FragColor = vec4(tapPixelPos.x/100.0);\n    gl_FragColor = vec4(A);\n\n\n  }\n]]></snippet>\n\n<snippet name="fsBlurEdgeAware"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D normalMap;\n  uniform sampler2D depthMap;\n  uniform sampler2D tex;\n\n\n  uniform vec2 blurSize;\n\n\n  uniform float g_BlurFalloff;\n  uniform float projScale;\n\n\n  varying vec2 uv;\n\n  uniform vec2    nearFar;\n\n  //set z scaling, used to prevent division in ortho mode\n  uniform vec2 zScale;\n\n  $rgba2float\n  $getDepthLinear\n\n  float BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness)\n  {\n    float c = texture2D(tex, uv).r;\n    float d = getDepthLinear(uv);\n\n    float ddiff = d - center_d;\n\n    float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n    w_total += w;\n\n    return w*c;\n  }\n\n  void main(void)\n  {\n\n    float b = 0.0;\n    float w_total = 0.0;\n\n    float center_d =  getDepthLinear(uv);\n\n    float sharpness = -0.05*projScale/(center_d*zScale.x+zScale.y);\n    for (int r = -RADIUS; r <= RADIUS; ++r)\n    {\n      float rf = float(r);\n      vec2 uvOffset = uv + rf*blurSize;\n      b += BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n    }\n\n    gl_FragColor = vec4(b/w_total);\n  }\n]]></snippet>\n\n\n  <snippet name="fsBlurSrc0"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D tex;\n  uniform float blurSize;\n  varying vec2 uv;\n\n  void main() {\n    int rad = RADIUS - 1;\n\n    vec4 sum = vec4(0.0);\n    for (int k = -RADIUS; k <= RADIUS; ++k) {     // NOTE for-variable-init must be a const expression\n      float fi = float(k);\n]]></snippet>\n\n  <snippet name="fsBlurSrc1"><![CDATA[\n    }\n\n    gl_FragColor = sum / float(RADIUS * RADIUS);\n  }\n]]></snippet>\n\n  <snippet name="fsBlurH"><![CDATA[\n  $fsBlurSrc0\n      sum += texture2D(tex, vec2(uv.x + fi * blurSize, uv.y)) * (float(rad) - abs(fi) + 1.0);\n  $fsBlurSrc1\n]]></snippet>\n\n  <snippet name="fsBlurV"><![CDATA[\n  $fsBlurSrc0\n      sum += texture2D(tex, vec2(uv.x, uv.y + fi * blurSize)) * (float(rad) - abs(fi) + 1.0);\n  $fsBlurSrc1\n]]></snippet>\n\n</snippets>\n'},1401:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1402),r(1436)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=null,o=[];t.enabled=!1,t.begin=function(){t.enabled&&(i=[])},t.trace=function(e){t.enabled&&null!=i&&i.push(e)},t.end=function(){if(t.enabled){var e=i;return i=null,e&&(o.forEach(function(t){return t(e)}),o.length=0),e}},t.instrumentContext=function(e){return t.enabled?n.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),e):r.makeDebugContext(e,void 0,function(e,n){t.enabled&&i&&i.push("gl."+e+"("+r.glFunctionArgsToString(e,n)+")")}):e},t.request=function(e){o.push(e)}}.apply(null,n))||(e.exports=i)},1402:function(e,t,r){var n;void 0===(n=function(){function e(e){if(null==l)for(var t in l={},u={},e)"number"==typeof e[t]&&(l[e[t]]=t,u[t]=e[t])}function t(){if(null==l)throw"WebGLDebugUtils.init(ctx) not called"}function r(e){t();var r=l[e];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function n(e,t,n,i){var o;if(void 0!==(o=s[e])&&(void 0!==(o=o[t])&&o[n])){if("object"==typeof o[n]&&void 0!==o[n].enumBitwiseOr){for(var a=o[n].enumBitwiseOr,l=0,d=[],c=0;c<a.length;++c){var p=u[a[c]];0!=(i&p)&&(l|=p,d.push(r(p)))}return l===i?d.join(" | "):r(i)}return r(i)}return null===i?"null":void 0===i?"undefined":i.toString()}function i(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function o(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var n=0;n<t;++n)e.disableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(n,0);e.deleteBuffer(r);var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(n=0;n<i;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}var a=function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)},s={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},l=null,u=null;return{init:e,mightBeEnum:function(e){return t(),void 0!==l[e]},glEnumToString:r,glFunctionArgToString:n,glFunctionArgsToString:function(e,t){for(var r="",i=t.length,o=0;o<i;++o)r+=(0==o?"":", ")+n(e,i,o,t[o]);return r},makeDebugContext:function t(o,s,l,u){function d(e,t){return function(){l&&l(t,arguments);var r=e[t].apply(e,arguments),n=u.getError();return 0!=n&&(c[n]=!0,s(n,t,arguments)),r}}u=u||o,e(o),s=s||function(e,t,i){for(var o="",s=i.length,l=0;l<s;++l)o+=(0==l?"":", ")+n(t,s,l,i[l]);a("WebGL error "+r(e)+" in "+t+"("+o+")")};var c={},p={};for(var f in o)if("function"==typeof o[f])if("getExtension"!=f)p[f]=d(o,f);else{var h=d(o,f);p[f]=function(){return t(h.apply(o,arguments),s,l,u)}}else i(p,o,f);return p.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return o.NO_ERROR},p},makeLostContextSimulatingCanvas:function(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function r(){++m,p||h==m&&e.loseContext()}function n(e,t){var n=e[t];return function(){if(r(),!p)return n.apply(e,arguments)}}function a(e){return{statusMessage:e,preventDefault:function(){v=!0}}}var s,l=[],u=[],d={},c=1,p=!1,f=[],h=0,m=0,v=!1,g=0,y={};e.getContext=function(t){return function(){var o=t.apply(e,arguments);if(o instanceof WebGLRenderingContext){if(o!=s){if(s)throw"got different context";d=function(e){for(var t in e)"function"==typeof e[t]?d[t]=n(e,t):i(d,e,t);d.getError=function(){if(r(),!p)for(;e=s.getError();)y[e]=!0;for(var e in y)if(y[e])return delete y[e],e;return d.NO_ERROR};for(var o=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],a=0;a<o.length;++a)d[h=o[a]]=function(t){return function(){if(r(),p)return null;var n=t.apply(e,arguments);return n.__webglDebugContextLostId__=c,f.push(n),n}}(e[h]);var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(a=0;a<l.length;++a)d[h=l[a]]=function(t){return function(){return r(),p?null:t.apply(e,arguments)}}(d[h]);var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(a=0;a<u.length;++a){var h;d[h=u[a]]=function(t){return function(){return r(),!p&&t.apply(e,arguments)}}(d[h])}return d.checkFramebufferStatus=function(t){return function(){return r(),p?d.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(t){return function(){return r(),p?-1:t.apply(e,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(t){return function(){return r(),p?0:t.apply(e,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return p},d}(s=o)}return d}return o}}(e.getContext);var b=function(e){l.push(t(e))},_=function(e){u.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(r,n,i){switch(r){case"webglcontextlost":b(n);break;case"webglcontextrestored":_(n);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!p){for(p=!0,h=0,++c;s.getError(););(function(){for(var e=Object.keys(y),t=0;t<e.length;++t)delete y[e]})(),y[s.CONTEXT_LOST_WEBGL]=!0;var t=a("context lost"),r=l.slice();setTimeout(function(){for(var n=0;n<r.length;++n)r[n](t);g>=0&&setTimeout(function(){e.restoreContext()},g)},0)}},e.restoreContext=function(){p&&u.length&&setTimeout(function(){if(!v)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<f.length;++e){var t=f[e];t instanceof WebGLBuffer?s.deleteBuffer(t):t instanceof WebGLFramebuffer?s.deleteFramebuffer(t):t instanceof WebGLProgram?s.deleteProgram(t):t instanceof WebGLRenderbuffer?s.deleteRenderbuffer(t):t instanceof WebGLShader?s.deleteShader(t):t instanceof WebGLTexture&&s.deleteTexture(t)}})(),o(s),p=!1,m=0,v=!1;for(var e=u.slice(),t=a("context restored"),r=0;r<e.length;++r)e[r](t)},0)},e.loseContextInNCalls=function(e){if(p)throw"You can not ask a lost contet to be lost";h=m+e},e.getNumCalls=function(){return m},e.setRestoreTimeout=function(e){g=e},e},resetToInitialState:o}}.apply(null,[]))||(e.exports=n)},1403:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1404),r(1405),r(1332),r(1406),r(1347),r(1305),r(1316),r(1348),r(1411),r(1349),r(1414),r(1416),r(1336)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h){Object.defineProperty(t,"__esModule",{value:!0}),t.initializeShaders=function(e,t,m){e._parse(n),e._parse(r),f.loadShaders(e,t,m),h.loadShaders(e,t,m),s.loadShaders(e,t,m),l.loadShaders(e,t,m),u.loadShaders(e,t,m),c.loadShaders(e,t,m),p.loadShaders(e,t,m),a.loadShaders(e,t,m),d.loadShaders(e,t,m),i.EdgeView.loadShaders(e,t,m),o.loadShaders(e,t,m)}}.apply(null,n))||(e.exports=i)},1404:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="commonAttributesAndUniformsHUD"><![CDATA[\n  attribute vec3 $position;\n  attribute vec3 $normal;\n  attribute vec4 $auxpos1;\n\n  uniform mat4 proj;\n\n  uniform mat4 view;\n  uniform mat4 viewNormal;\n\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n\n  uniform vec4 viewport;\n\n  uniform vec3 camPos;\n\n  uniform float polygonOffset;\n  uniform float cameraGroundRelative;\n\n#ifdef VERTICAL_OFFSET\n\n  // [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\n  uniform vec4 verticalOffset;\n\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  // [ divisor, offset, minPixelSize, paddingPixels ]\n  uniform vec4 screenSizePerspectiveAlignment;\n\n#endif\n\n  uniform sampler2D hudVisibilityTexture;\n]]></snippet>\n\n<snippet name="projectPositionHUD"><![CDATA[\n  $screenSizePerspective\n\n  // Corresponds to cos(10 deg), used to compare against dot product of two vectors\n  const float SMALL_OFFSET_ANGLE = 0.984807753012208;\n\n  struct ProjectHUDAux {\n    vec3 posModel;\n    vec3 posView;\n    vec3 vnormal;\n\n    float distanceToCamera;\n    float absCosAngle;\n  };\n\n\n  /**\n   * Apply the simulated polygon offset for HUD objects that improves\n   * issues with Z-fighting.\n   *\n   * @param posView {vec3} (inout) the position in view space. Will be modified in place.\n   * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\n   * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\n   *   and the view direction.\n   *\n   * Dependencies:\n   *\n   *   Attributes:\n   *     - auxpos1: contains centerOffset and pointGroundDistance\n   *\n   *   Uniforms:\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n   *         reduced flickering.\n   *     - viewport: the viewport [x, y, width, height]\n   */\n  float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n    float pointGroundSign = sign(pointGroundDistance);\n\n    if (pointGroundSign == 0.0) {\n      pointGroundSign = 1.0;\n    }\n\n    // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n    // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n    float groundRelative = cameraGroundRelative * pointGroundSign;\n\n    // view angle dependent part of polygon offset emulation\n    // we take the absolute value because the sign that is dropped is\n    // instead introduced using the ground-relative position of the symbol and the camera\n    if (polygonOffset > .0) {\n      float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n      float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n      float factor = (1.0 - tanAlpha / viewport[2]);\n\n      // same side of the terrain\n      if (groundRelative > 0.0) {\n        posView *= factor;\n      }\n      // opposite sides of the terrain\n      else {\n        posView /= factor;\n      }\n    }\n\n    return groundRelative;\n  }\n\n  /**\n   * Project the 3d position of a HUD object from world space to clip space. In addition\n   * to standard model view projection, it also emulates a polygon offset to\n   * help with points above/below ground and icon flickering. The resulting location\n   * is the anchor of the HUD object, i.e. the position that is used also for testing\n   * visibility of the HUD object. Note that the returned projected position is not\n   * aligned to a pixel center or border, it is up to the caller to align if necessary.\n   *\n   * Dependencies:\n   *\n   *   Attributes:\n   *     - position: contains the point world position\n   *     - normal: contains the world normal pointing up at the point\n   *     - auxpos1: contains centerOffset and pointGroundDistance\n   *\n   *   Uniforms:\n   *     - model: the object -> world transformation matrix\n   *     - modelNormal: the object -> world normal transformation matrix (inv transp of model)\n   *     - view: the world -> view transformation matrix\n   *     - viewNormal: the world -> view normal transformation matrix (inv transp of view)\n   *     - proj: the view -> clip projection matrix\n   *     - verticalOffset: a vec4 containing:\n   *         - the screen height of the vertical offset\n   *         - the screen height of the vertical offset as a fraction of camera distance.\n   *         - the minimum world size vertical offset.\n   *         - the maximum world size vertical offset.\n   *       This will do a screen sized offset of the point along its normal (used for line callouts)\n   *     - screenSizePerspectiveAlignment: a vec3 containing\n   *         - the view distance dependent divisor\n   *         - the view distance dependent offset\n   *         - the minimum pixel size\n   *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n   *         reduced flickering.\n   *     - camPos: the position of the camera in world space\n   *     - viewport: the viewport [x, y, width, height]\n   */\n  vec4 projectPositionHUD(out ProjectHUDAux aux) {\n    // centerOffset is in view space and is used to implement world size offsetting\n    // of labels with respect to objects. It also pulls the label towards the viewer\n    // so that the label is visible in front of the object.\n    vec3 centerOffset = $auxpos1.xyz;\n\n    // The pointGroundDistance is the distance of the geometry to the ground and is\n    // negative if the point is below the ground, or positive if the point is above\n    // ground.\n    float pointGroundDistance = $auxpos1.w;\n\n    aux.posModel = (model * vec4($position, 1.0)).xyz;\n    aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n    aux.vnormal = (modelNormal * vec4($normal, 1.0)).xyz;\n\n    // Screen sized offset in world space, used for example for line callouts\n    // Note: keep this implementation in sync with the CPU implementation, see\n    //   - MaterialUtil.verticalOffsetAtDistance\n    //   - HUDMaterial.applyVerticalOffsetTransformation\n\n    aux.distanceToCamera = length(aux.posView);\n\n    vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n    float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n    aux.absCosAngle = abs(cosAngle);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n    vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n\n#endif\n\n#ifdef VERTICAL_OFFSET\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n    float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n    float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n    vec3 modelOffset = aux.vnormal * worldOffset;\n\n    aux.posModel += modelOffset;\n\n    vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n    aux.posView += viewOffset;\n\n    // Since we elevate the object, we need to take that into account\n    // in the distance to ground\n    pointGroundDistance += worldOffset;\n\n#endif\n\n    float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n    // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n    aux.posView += vec3(centerOffset.x, centerOffset.y, 0);\n\n    // Same material all have same z != 0.0 condition so should not lead to\n    // branch fragmentation and will save a normalization if it\'s not needed\n    if (centerOffset.z != 0.0) {\n      aux.posView -= normalize(aux.posView) * centerOffset.z;\n    }\n#endif\n\n    vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n    float centerOffsetY = centerOffset.y;\n#endif\n\n    posProj.xy += vec2(centerOffset.x, centerOffsetY) * 2.0 / viewport.zw * posProj.w;\n\n#endif\n\n    // constant part of polygon offset emulation\n    posProj.z -= groundRelative * polygonOffset * posProj.w;\n\n    return posProj;\n  }\n\n  uniform float uRenderTransparentlyOccludedHUD;\n\n  /**\n   * Test for visibility of a HUD object.\n   *\n   * Dependencies:\n   *\n   *   Uniforms:\n   *     - hudVisibilityTexture: the texture that contains the visibility information\n   *     - markerColor: the special marker color that is used to write visibility information\n   *     - viewport: the viewport\n   */\n  bool testVisibilityHUD(vec4 posProj) {\n    // For occlusion testing, use the nearest pixel center to avoid\n    // subpixel filtering messing up the color we use to test for\n    vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n    vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n    // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n    // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n    // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n    // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n    if (uRenderTransparentlyOccludedHUD > 0.5) {\n      // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n      // uRenderTransparentlyOccludedHUD = 0.75\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n    }\n    // and visible pixels that are not occluded by semi-transparent geometry here\n    else {\n      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n    }\n\n    // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r > 0.0;\n  }\n]]></snippet>\n\n</snippets>\n'},1405:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="alignToPixelCenter"><![CDATA[\n  vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n    // From clip space to (0 : 1), bias towards right pixel edge\n    vec2 xy = vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n\n    // Size of a pixel in range (0 : 1)\n    vec2 pixelSz = vec2(1.0) / widthHeight;\n\n    // Round to nearest pixel center\n    vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n\n    // Convert back to clip space\n    vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n    return vec4(result, clipCoord.zw);\n  }\n]]></snippet>\n\n<snippet name="alignToPixelOrigin"><![CDATA[\n  vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n    // From clip space to (0 : 1),\n    vec2 xy = vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n\n    // Size of a pixel in range (0 : 1)\n    vec2 pixelSz = vec2(1.0) / widthHeight;\n\n    // Round to nearest pixel border, (0 : 1)\n    vec2 ij = floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n\n    // Convert back to clip space\n    vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n    return vec4(result, clipCoord.zw);\n  }\n]]></snippet>\n\n<snippet name="float2rgba"><![CDATA[\n  // This is the maximum float value representable as 32bit fixed point,\n  // it is rgba2float(vec4(1)) inlined.\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n  const vec4 fixedPointFactors = vec4(1, 256, 256 * 256, 256 * 256 * 256);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n]]></snippet>\n\n<snippet name="rgba2float"><![CDATA[\n  // Factors to convert rgba back to float\n  const vec4 rgba2float_factors = vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\n\n  float rgba2float(vec4 rgba) {\n    // Convert components from 0->1 back to 0->255 and then\n    // add the components together with their corresponding\n    // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n    return dot(rgba, rgba2float_factors);\n  }\n]]></snippet>\n\n<snippet name="calcFragDepth"><![CDATA[\n  float calcFragDepth(const in float depth) {\n    //calc polygon offset\n    const float SLOPE_SCALE = 2.0;\n    const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)\n    float m = max(abs(dFdx(depth)), abs(dFdy(depth)));\n    float result = depth + SLOPE_SCALE * m + BIAS;\n    return clamp(result, .0, .999999);\n  }\n]]></snippet>\n\n<snippet name="evalShadow"><![CDATA[\n  $rgba2float\n\n  // "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\n  // once IE11 is fine with it, const should probably be re-introduced\n  float evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n    //choose correct cascade\n    int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n    if (i >= num) return .0;\n\n    mat4 mat = i == 0 ? matrix[0] : i == 1 ? matrix[1] : i == 2 ? matrix[2] : matrix[3];\n\n    vec4 lv = mat * vec4(vpos, 1.0);\n    lv.xy /= lv.w;\n\n    //vertex completely outside? -> no shadow\n    vec3 lvpos = .5 * lv.xyz + vec3(.5);\n    if (lvpos.z >= 1.0) return .0;\n    if (lvpos.x < .0 || lvpos.x > 1.0 || lvpos.y < .0 || lvpos.y > 1.0) return .0;\n\n    //calc coord in cascade texture\n    vec2 uv = vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n\n    float texSize = .5 / halfPxSz;\n\n    //filter, offset by half pixels\n    vec2 st = fract((vec2(halfPxSz) + uv) * texSize);\n\n    float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n    float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n    float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n    float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n\n    return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n  }\n]]></snippet>\n\n\n\x3c!--\n  Scene Lighting Definitions:\n  ================================================\n\n  defines:\n    - SH_ORDER: 1|2|3\n  input:\n    - normal: vec3\n    - albedo: vec3\n    - shadow: float\n    - ssao: float\n  return:\n    - color: vec3\n--\x3e\n<snippet name="sceneLightingDefinitions"><![CDATA[\n  $viewingMode\n\n  // main light\n  /////////////////////////////////////////\n  uniform vec3 lightingMainDirection;\n  uniform vec3 lightingMainIntensity;\n\n  // ambient lighting\n  /////////////////////////////////////////\n  #ifndef SH_ORDER\n    #define SH_ORDER 2\n  #endif\n\n  #if SH_ORDER == 0\n    uniform vec3 lightingAmbientSH0;\n  #elif SH_ORDER == 1\n    uniform vec4 lightingAmbientSH_R;\n    uniform vec4 lightingAmbientSH_G;\n    uniform vec4 lightingAmbientSH_B;\n  #elif SH_ORDER == 2\n    uniform vec3 lightingAmbientSH0;\n    uniform vec4 lightingAmbientSH_R1;\n    uniform vec4 lightingAmbientSH_G1;\n    uniform vec4 lightingAmbientSH_B1;\n    uniform vec4 lightingAmbientSH_R2;\n    uniform vec4 lightingAmbientSH_G2;\n    uniform vec4 lightingAmbientSH_B2;\n  #endif\n\n  // special tweaking\n  //////////////////////////////////////////\n  uniform float lightingFixedFactor;\n  uniform float lightingGlobalFactor;\n\n  uniform float ambientBoostFactor;\n\n  // evaluation\n  //////////////////////////////////////////\n\n  vec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n    // evaluate the main light\n    float dotVal = mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\n    vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n\n    // evaluate the sh ambient light\n    #if SH_ORDER == 0\n      vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n    #elif SH_ORDER == 1\n      vec4 sh0 = vec4(\n        0.282095,\n        0.488603 * normal.x,\n        0.488603 * normal.z,\n        0.488603 * normal.y\n      );\n      vec3 ambientLight = vec3(\n        dot(lightingAmbientSH_R, sh0),\n        dot(lightingAmbientSH_G, sh0),\n        dot(lightingAmbientSH_B, sh0)\n      );\n    #elif SH_ORDER == 2\n      vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n      vec4 sh1 = vec4(\n        0.488603 * normal.x,\n        0.488603 * normal.z,\n        0.488603 * normal.y,\n        1.092548 * normal.x * normal.y\n      );\n      vec4 sh2 = vec4(\n        1.092548 * normal.y * normal.z,\n        0.315392 * (3.0 * normal.z * normal.z - 1.0),\n        1.092548 * normal.x * normal.z,\n        0.546274 * (normal.x * normal.x - normal.y * normal.y)\n      );\n      ambientLight += vec3(\n        dot(lightingAmbientSH_R1, sh1),\n        dot(lightingAmbientSH_G1, sh1),\n        dot(lightingAmbientSH_B1, sh1)\n      );\n      ambientLight += vec3(\n        dot(lightingAmbientSH_R2, sh2),\n        dot(lightingAmbientSH_G2, sh2),\n        dot(lightingAmbientSH_B2, sh2)\n      );\n    #endif\n    ambientLight *= (1.0 - ssao);\n\n    // inverse gamma correction on the albedo color\n    float gamma = 2.1;\n    vec3 albedoGammaC = pow(albedo, vec3(gamma));\n\n    // physically correct BRDF normalizes by PI\n    const float PI = 3.14159;\n    vec3 totalLight = mainLight + ambientLight + additionalLight;\n    totalLight = min(totalLight, vec3(PI, PI, PI));\n    vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n    // apply gamma correction to the computed color\n    outColor = pow(outColor, vec3(1.0/gamma));\n\n    return outColor;\n  }\n\n]]></snippet>\n\n<snippet name="sceneLightingAdditionalLightGlobal"><![CDATA[\n  vec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\n    // heuristic lighting model originally used in the terrain shading\n    // now used to generated additional ambient light\n\n#ifdef VIEWING_MODE_GLOBAL\n\n      float vndl = -dot(normalize(worldPos), lightingMainDirection);\n\n#else\n\n      float vndl = -dot(vec3(0,0,1), lightingMainDirection);\n\n#endif\n\n    additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n  }\n]]></snippet>\n\n<snippet name="normal2envTC"><![CDATA[\n  vec2 normal2envTC(vec3 normal) {\n    float v = .5 + .5 * asin(normal.y) * 0.63661977;\n    float u = .5 - .5 * atan(normal.z, normal.x) * 0.31830988;\n    return vec2(u, v);\n  }\n]]></snippet>\n\n<snippet name="vertexShaderShowDepth"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  attribute vec2 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n\n  void main(void) {\n    gl_Position = proj * vec4($position.x, $position.y, .0, 1.0);\n    vtc = $uv0;\n  }\n]]></snippet>\n\n  <snippet name="fragmentShaderShowDepth"><![CDATA[\n  $fsprecisionf\n\n  uniform sampler2D depthTex;\n  varying vec2 vtc;\n  $rgba2float\n  void main() {\n  // gl_FragColor = vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\n     gl_FragColor = vec4(rgba2float(texture2D(depthTex, vtc)));\n  // gl_FragColor = texture2D(depthTex, vtc);\n  }\n]]></snippet>\n\n<snippet name="vsUVQuad"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $position;\n  varying vec2 uv;\n\n  void main(void) {\n    gl_Position = vec4($position.x, $position.y, .0, 1.0);\n    uv = $position * .5 + vec2(.5);\n  }\n]]></snippet>\n\n<snippet name="toScreenCoords"><![CDATA[\n  vec4 toScreenCoords(vec3 vertex) {\n    vec4 vClipSpace = proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n    vClipSpace.xy *= screenSize;\n    return vClipSpace/abs(vClipSpace.w);\n  }\n]]></snippet>\n\n<snippet name="vvUniforms"><![CDATA[\n#if defined(VV_SIZE)\n  #define VV_CUSTOM_MODEL_MATRIX\n#endif\n\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  uniform vec3 vvSizeValue;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform mat3 vvSymbolRotation;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform vec3 vvSymbolAnchor;\n#endif\n\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n\n]]></snippet>\n\n<snippet name="vvFunctions"><![CDATA[\n// Evaluation of size\n#if defined(VV_SIZE)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n  }\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return vvSizeValue;\n  }\n#endif\n\n// Applying the model matrix\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n    return vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n  }\n\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n    // Normal transform is the inverse transpose of model transform\n    return vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\n  }\n#endif\n\n#ifdef VV_COLOR\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value = featureAttribute.y;\n    if (value <= values[0]) {\n      return colors[0];\n    }\n\n    for (int i = 1; i < VV_COLOR_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n\n    return colors[VV_COLOR_N - 1];\n  }\n#endif\n]]></snippet>\n\n<snippet name="rgb2hsv"><![CDATA[\nvec3 rgb2hsv(vec3 c)\n{\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n]]></snippet>\n\n<snippet name="hsv2rgb"><![CDATA[\nvec3 hsv2rgb(vec3 c)\n{\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n]]></snippet>\n\n<snippet name="colorMixMode"><![CDATA[\n$rgb2hsv\n$hsv2rgb\n\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha = 0.0;\n\n  const float maxTint = 85.0;\n  const float maxReplace = 170.0;\n  const float scaleAlpha = 3.0;\n\n  if (symbolColor.a == 0.0) {\n    colorMixMode = 1; // fully transparent -> multiply\n    symbolAlpha = 0.0;\n  }\n  else if (symbolColor.a <= maxTint) {\n    colorMixMode = 0; // tint\n    symbolAlpha = scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a <= maxReplace) {\n    colorMixMode = 3; // replace\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode = 1;  // multiply\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n  }\n\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed = internalColor * textureColor;\n  vec3 allMixed = internalMixed * externalColor;\n\n  if (mode == 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn = rgb2hsv(internalMixed);\n    vec3 hsvTint = rgb2hsv(externalColor);\n    vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed = internalOpacity * textureOpacity;\n  float allMixed = internalMixed * externalOpacity;\n\n  if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n\n]]></snippet>\n\n<snippet name="highlightWrite"><![CDATA[\n  // the following uniforms are common to all highlight shaders:\n  // uniform sampler2D depthTex\n  // uniform vec4 highlightViewportPixelSz\n  float sceneDepth = texture2D(depthTex, (gl_FragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n  if (gl_FragCoord.z > sceneDepth + 5e-6) {\n    gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n  }\n]]></snippet>\n\n<snippet name="screenSizePerspective"><![CDATA[\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n// Note that the implementation here should be kept in sync with the corresponding\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\n\n/**\n * Compute the screen size perspective lower bound from pre-computed screen\n * size perspective factors (or parameters, since both store the pixel lower\n * bound information in the same place). When computing the minimum size,\n * the padding (e.g. text halo) is scaled with the same factor as the\n * original size scales to reach the minimum size.\n *\n * {\n *    x: N/A\n *    y: N/A\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\n\n  // Original calculation:\n  //   padding = 2 * factor.w\n  //   minSize = factor.z\n  //\n  //   minSize + minSize / size * padding\n  //\n  // Incorporates padding (factor.w, e.g. text halo size) into the\n  // minimum bounds calculation, taking into account that padding\n  // would scale down proportionally to the size.\n  //\n  // Calculation below is the same, but avoids division by zero when\n  // size would be zero, without branching using step.\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\n\n  // nonZeroSize is 1 if size > 0, and 0 otherwise\n  float nonZeroSize = 1.0 - step(size, 0.0);\n\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                   // proportionally scaled padding\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n      )\n    )\n  );\n}\n\n/**\n * Computes the view angle dependent screen size perspective factor. The goal\n * of this factor is that:\n *\n *   1. There is no perspective when looking top-down\n *   2. There is a smooth and quick transition to full perspective when\n *      tilting.\n */\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\n\n/**\n * Precomputes a set of factors that can be used to apply screen size perspective\n * The factors are based on the viewing angle, distance to camera and the screen size\n * perspective parameters:\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n *\n * The result is a set of factors that can be used to apply the perspective:\n *\n * {\n *    x: distance based relative scale factor (0 -> 1)\n *    y: view dependent scale factor\n *    z: minPixelSize (abs)\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\n\n/**\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\n */\n\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\n\n/**\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n/**\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\n */\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\n\n/**\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n#endif\n]]></snippet>\n\n<snippet name="computeNormal"><![CDATA[\n  #ifdef GROUND_NORMAL_SHADING\n    #ifdef VIEWING_MODE_GLOBAL\n      vec3 normal = normalize(vpos + localOrigin);\n    #else\n      vec3 normal = vec3(0,0,1);\n    #endif\n  #else\n    // compute normal\n    #ifdef DOUBLESIDED\n      vec3 normal = dot(vnormal, viewDir)>0.0 ? -vnormal : vnormal;\n    #elif defined(WINDINGORDERDOUBLESIDED)\n      vec3 normal = gl_FrontFacing ? vnormal : -vnormal;\n    #else\n      vec3 normal = vnormal;\n    #endif\n    normal = normalize(normal);\n  #endif\n]]></snippet>\n\n<snippet name="decodeNormal"><![CDATA[\nvec3 decodeNormal(vec2 f)\n{\n    float z = 1.0 - abs(f.x) - abs(f.y);\n    return vec3(f + sign(f) * min(z, 0.0), z);\n}\n]]></snippet>\n\n</snippets>\n'},1406:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(1407),r(1295),r(1292),r(1281),r(1289),r(1277),r(1284),r(1284)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d){var c=[{name:l.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:20,normalized:!1},{name:l.VertexAttrConstants.UV0,count:2,type:5126,offset:12,stride:20,normalized:!1}],p={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,polygonOffset:!1},f=function(e){function t(t,r){var n=e.call(this,r)||this;return n.canBeMerged=!1,n.params=u.copyParameters(t,p),n}return r(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){var e=this.params;return{size:e.size,color1:e.color1,color2:e.color2,transparent:e.transparent,polygonOffset:e.polygonOffset}},t.prototype.setParameterValues=function(e){u.updateParameters(this.params,e)&&this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.getOutputAmount=function(e){return 5*e},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return c},t.prototype.fillInterleaved=function(e,t,r,n,i,o){d.fillInterleaved(e,t,r,n,c,i,o)},t.prototype.intersect=function(e,t,r,n,i,o,a,s){return d.intersectTriangleGeometry(e,t,r,n,i,o,a)},t.prototype.getGLMaterials=function(){return{color:h,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},t.prototype.getAllTextureIds=function(){return[]},t.loadShaders=function(e,t,r){e._parse(n);var i=new s("checker-board",["vsCheckerBoard","fsCheckerBoard"],null,t,e,r);t.addShaderVariations("checker-board-material-shader-variations",i)},t}(o),h=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.programRep=r,i.params=u.copyParameters(t.getParams()),i.selectProgram(),i}return r(t,e),t.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("checker-board-material-shader-variations",[])},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return e===(this.params.transparent?a.TRANSPARENT_MATERIAL:a.OPAQUE_MATERIAL)},t.prototype.getProgram=function(){return this.program},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},t.prototype.bind=function(e,t){var r=this.program;e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(!1),e.setFaceCullingEnabled(!1),this.params.transparent&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),this.params.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-25)),e.bindProgram(r),r.setUniform2fv("size",this.params.size),r.setUniform4fv("color1",this.params.color1),r.setUniform4fv("color2",this.params.color2)},t.prototype.bindView=function(e,t){var r=t.origin,n=this.getProgram();u.bindView(r,t.view,n)},t.prototype.bindInstance=function(e,t){this.getProgram().setUniformMatrix4fv("model",t.transformation)},t.prototype.release=function(e){e.setDepthWriteEnabled(!0),this.params.transparent&&e.setBlendingEnabled(!1),this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1)},t}(i);return f}.apply(null,n))||(e.exports=i)},1407:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsCheckerBoard"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  varying vec2 vUV;\n\n  void main(void) {\n    vUV = $uv0;\n    gl_Position = proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n  }\n]]></snippet>\n\n<snippet name="fsCheckerBoard"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n\n  uniform vec2 size;\n  uniform vec4 color1;\n  uniform vec4 color2;\n\n  varying vec2 vUV;\n\n  void main() {\n    vec2 uvScaled = vUV / (2.0 * size);\n\n    vec2 uv = fract(uvScaled - 0.25);\n    vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n    float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n    float t = mix(abs(ab.x + ab.y), 0.5, fade);\n\n    gl_FragColor = mix(color2, color1, t);\n  }\n]]></snippet>\n</snippets>\n'},1408:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderColorMaterial"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  attribute vec3 $position;\n#ifdef VERTEXCOLORS\n  attribute vec4 $color;\n\n  varying vec4 vColor;\n#endif\n\n  void main(void) {\n#ifdef VERTEXCOLORS\n    vColor = $color * 0.003921568627451; // = 1/255;\n#endif\n    gl_Position = proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderColorMaterial"><![CDATA[\n  $fsprecisionf\n\n  uniform vec4 eColor;\n#ifdef VERTEXCOLORS\n  varying vec4 vColor;\n#endif\n\n  void main() {\n#ifdef VERTEXCOLORS\n    gl_FragColor = vColor * eColor;\n#else\n    gl_FragColor = eColor;\n#endif\n  }\n]]></snippet>\n</snippets>\n'},1409:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="calculateVerticalOffset"><![CDATA[\n  $viewingMode\n\n#ifdef VERTICAL_OFFSET\n  // [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\n  uniform vec4 verticalOffset;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  uniform vec4 screenSizePerspectiveAlignment;\n\n  $screenSizePerspective\n\n#endif\n\n  vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n    float viewDistance = length((view * vec4(worldPos, 1)).xyz);\n    float verticalOffsetOffsetDistance = verticalOffset.x * viewDistance;\n\n#ifdef VIEWING_MODE_GLOBAL\n    vec3 worldNormal = normalize(worldPos + localOrigin);\n#else\n    vec3 worldNormal = vec3(0, 0, 1);\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n    float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n\n    float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n    float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n    // Screen sized offset in world space, used for example for line callouts\n    float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n\n    return worldNormal * worldOffset;\n  }\n#endif\n]]>\n</snippet>\n\n<snippet name="vsViewInputs"><![CDATA[\n  uniform mat4 proj;\n  uniform mat4 view;\n#ifdef INSTANCED_DOUBLE_PRECISION\n  uniform vec3 viewOriginHi;\n  uniform vec3 viewOriginLo;\n#endif\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n]]>\n</snippet>\n\n<snippet name="vsTransformInputs"><![CDATA[\n#ifdef INSTANCED\n#ifdef INSTANCED_DOUBLE_PRECISION\n  attribute vec3 modelOriginHi;\n  attribute vec3 modelOriginLo;\n  attribute mat3 model;\n  attribute mat3 modelNormal;\n#else\n  attribute mat4 model;\n  attribute mat4 modelNormal;\n#endif\n#else /* INSTANCED */\n  uniform mat4 model;\n  uniform mat4 modelNormal;\n#endif /* INSTANCED */\n]]>\n</snippet>\n\n<snippet name="vsLocalPosition"><![CDATA[\n#ifdef VV_CUSTOM_MODEL_MATRIX\nvec4 localPosition() { return vvTransformPosition($position, instanceFeatureAttribute); }\n#else\nvec4 localPosition() { return vec4($position, 1.0); }\n#endif\n]]>\n</snippet>\n\n<snippet name="vsLocalNormal"><![CDATA[\n  $decodeNormal\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef COMPRESSED_NORMALS\nvec4 localNormal() { return vvTransformNormal(decodeNormal($normalCompressed), instanceFeatureAttribute); }\n# else\nvec4 localNormal() { return vvTransformNormal($normal, instanceFeatureAttribute); }\n# endif\n#else\n# ifdef COMPRESSED_NORMALS\nvec4 localNormal() { return vec4(decodeNormal($normalCompressed), 1.0); }\n# else\nvec4 localNormal() { return vec4($normal, 1.0); }\n# endif\n#endif\n]]>\n</snippet>\n\n<snippet name="vsLocalCenter"><![CDATA[\n#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute); }\n# endif\n#else\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vec4(vec3(0, 0, 0), 1.0); }\n# endif\n#endif\n]]>\n</snippet>\n\n<snippet name="doublePrecisionArithmethic"><![CDATA[\n// based on https://www.thasler.com/blog/blog/glsl-part2-emu\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 = hiA + hiB;\n  vec3 e = t1 - hiA;\n  vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n  return t1 + t2;\n}\n]]>\n</snippet>\n\n\x3c!-- Keep is synchronized with the logic in Material.js:isVisible --\x3e\n<snippet name="externalColorMix"><![CDATA[\n  vec3 matColor = max(ambient, diffuse); // combine the old material parameters into a single one\n  #if defined(VERTEXCOLORS)\n      // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\n      vec3 albedo_ = mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n      float opacity_ = layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  #else\n      // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\n      vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n      float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  #endif\n  albedo_+= 0.25 * specular; // don\'t completely ignore specular for now\n]]></snippet>\n\n<snippet name="calcMipMapLevel"><![CDATA[\n  float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n    // from:\n    //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n    //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n    //   - http://www.linedef.com/virtual-texture-demo.html\n    float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n    return max(0.0, 0.5 * log2(deltaMaxSqr));\n  }\n]]></snippet>\n\n<snippet name="coverageCorrectionFactor"><![CDATA[\n  // base on https://medium.com/@bgolus/anti-aliased-alpha-test-the-esoteric-alpha-to-coverage-8b177335ae4f\n  float coverageCorrectionFactor(vec2 uv) {\n#ifdef ALPHA_COVERAGE_CORRECTION\n    const float MipScale = 0.25;\n    uv *= texSize;\n    return 1.0 + max(0.0, calcMipMapLevel(dFdx(uv), dFdy(uv))) * MipScale;\n#else\n    return 1.0;\n#endif\n  }\n]]></snippet>\n\n<snippet name="alphaThreshold"><![CDATA[\n#ifdef ALPHA_COVERAGE_CORRECTION\n  #define ALPHA_THRESHOLD 0.5\n#else\n  #define ALPHA_THRESHOLD 0.33\n#endif\n]]></snippet>\n\n<snippet name="vsPhongSrc"><![CDATA[\n  $vsViewInputs\n  $vsTransformInputs\n\n#ifdef INSTANCEDCOLOR\n  attribute vec4 instanceColor;\n#endif\n  attribute vec3 $position;\n#ifdef COMPRESSED_NORMALS\n  attribute vec2 $normalCompressed;\n#else\n  attribute vec3 $normal;\n#endif\n  varying vec3 vpos;\n  varying vec3 vnormal;\n\n#ifdef COMPONENTCOLORS\n  uniform sampler2D uComponentColorTex;\n  uniform vec2 uComponentColorTexInvDim;\n\n  attribute float $componentIndex;\n\n  vec4 readComponentColor() {\n    float normalizedIndex = ($componentIndex + 0.5) * uComponentColorTexInvDim.x;\n    vec2 indexCoord = vec2(\n      mod(normalizedIndex, 1.0),\n      (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n    );\n    return texture2D(uComponentColorTex, indexCoord);\n  }\n#endif\n\n#ifdef RECEIVE_SHADOWS\n  varying float linearDepth;\n#endif\n\n#ifdef VERTEXCOLORS\n  attribute vec4 $color;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\n  attribute vec4 $symbolColor;\n#endif\n\n#if defined(VV_SIZE) || defined(VV_COLOR)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n\n$vvUniforms\n\n#if defined(VERTEXCOLORS)\n  varying vec4 vcolor;\n#endif\n\n  // Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\n  // We pass the externalColor uniform from VS to FS through the vcolorExt varying because\n  // there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\n  // since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\n  // This should be further cleaned up later with through the following issue:\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\n  uniform vec4 externalColor;\n  varying vec4 vcolorExt;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\n  varying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n  $vvFunctions\n\n  $colorMixMode\n\n  $calculateVerticalOffset\n\n  $vsLocalPosition\n  $vsLocalNormal\n  $vsLocalCenter\n  $doublePrecisionArithmethic\n\n  void main(void) {\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n    vpos = model * localPosition().xyz ;\n    vnormal = normalize(modelNormal * localNormal().xyz);\n\n    vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n    vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n    vpos = (model * localPosition()).xyz;\n    vnormal = normalize((modelNormal * localNormal()).xyz);\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n    // Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\n    // (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\n    // issues on iPad/iPhone with the \'w\' component require the depth to be\n    // passed as varying to properly drive the cascading shadow map index.\n    linearDepth = gl_Position.w;\n#endif\n\n#ifdef VERTEXCOLORS\n    vcolor = $color * 0.003921568627451; // = 1/255\n#endif\n\n    vcolorExt = externalColor;\n\n#ifdef INSTANCEDCOLOR\n    vcolorExt *= instanceColor;\n#endif\n#ifdef VV_COLOR\n    vcolorExt *= vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n#ifdef SYMBOLVERTEXCOLORS\n    int symbolColorMixMode;\n    vcolorExt *= decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n    colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n#ifdef COMPONENTCOLORS\n    int symbolColorMixMode;\n    vcolorExt *= decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n    colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n]]></snippet>\n\n<snippet name="fsPhongSrc"><![CDATA[\n  uniform vec3 camPos;\n  uniform vec3 localOrigin;\n\n  $sceneLightingDefinitions\n  $sceneLightingAdditionalLightGlobal\n\n  // material parameters\n  //////////////////////////////////////////\n  uniform vec3 ambient;\n  uniform vec3 diffuse;\n  uniform vec3 specular;\n  uniform float opacity;\n  uniform float layerOpacity;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\n  varying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\n  uniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\n  uniform sampler2D depthTex;\n  uniform int shadowMapNum;\n  uniform vec4 shadowMapDistance;\n  uniform mat4 shadowMapMatrix[4];\n  uniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\n  uniform sampler2D ssaoTex;\n  uniform vec4 viewportPixelSz;\n#endif\n\n\n  varying vec3 vpos;\n  varying vec3 vnormal;\n#if defined(VERTEXCOLORS)\n  varying vec4 vcolor;\n#endif\n  varying vec4 vcolorExt;\n\n#ifdef RECEIVE_SHADOWS\n  varying float linearDepth;\n  $evalShadow\n#endif\n\n  $colorMixMode\n\n  void main() {\n    vec3 viewDir = normalize(vpos - camPos);\n\n    $computeNormal\n\n    vec3 reflDir = normalize(reflect(viewDir, normal));\n\n    // compute ssao\n    #ifdef RECEIVE_SSAO\n        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        ssao = viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n    #else\n        float ssao = 1.0;\n    #endif\n\n    // At global scale we create some additional ambient light based on the main light to simulate global illumination\n    float additionalAmbientScale;\n    vec3 additionalLight = sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n\n    // compute shadowing\n    float shadow = 0.0;\n    #ifdef RECEIVE_SHADOWS\n      shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n    #elif defined(VIEWING_MODE_GLOBAL)\n      // at global scale (and in global scenes) we fall back to this approximation\n      // to shadow objects on the dark side of the earth\n      shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n    #endif\n\n\n]]></snippet>\n\n<snippet name="vsPhong"><![CDATA[\n  $vsprecisionf\n\n  $vsPhongSrc\n  }\n]]></snippet>\n\n<snippet name="fsPhong"><![CDATA[\n    $fsprecisionf\n\n    $fsPhongSrc\n\n    vec4 texColor = vec4(1,1,1,1);\n    $externalColorMix\n\n#ifdef TRANSPARENCY_DISCARD\n    if (opacity_ < 0.001) {\n      discard;\n    }\n#endif\n\n    vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\n    gl_FragColor = vec4(shadedColor, opacity_);\n  }\n]]></snippet>\n\n<snippet name="vsPhongTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsPhongSrc\n#ifndef FLIPV\n    vtc = $uv0;\n#else\n    vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n\n  }\n]]></snippet>\n\n<snippet name="fsPhongTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n  varying vec2 vtc;\n\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  $fsPhongSrc\n\n    // read texture color\n    vec4 texColor = texture2D(tex, vtc);\n    if (texColor.a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n      discard;\n    }\n\n    $externalColorMix\n\n#ifdef TRANSPARENCY_DISCARD\n    if (opacity_ < 0.001) {\n      discard;\n    }\n#endif\n\n    vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n\n    gl_FragColor = vec4(shadedColor, opacity_);\n  }\n]]></snippet>\n\n<snippet name="vsPhongAtlasTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec4 $uv0;\n  attribute vec4 $region;\n  varying vec2 vtc;\n  varying vec4 regionV;\n  $vsPhongSrc\n#ifndef FLIPV\n    vtc = $uv0.xy;\n#else\n    vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n    regionV = $region/65535.0;\n  }\n]]></snippet>\n\n<snippet name="fsPhongAtlasTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n  varying vec2 vtc;\n  varying vec4 regionV;\n\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  $fsPhongSrc\n\n    vec2 uv = vtc;\n    uv = fract(uv);\n    //[umin, vmin, umax, vmax]\n\n    vec2 atlasScale = regionV.zw - regionV.xy;\n    uv = uv.xy * atlasScale + regionV.xy;\n\n    vec4 texColor;\n\n    // calculate derivative of continuous texture coordinate\n    // to avoid mipmapping artifacts caused by manual wrapping in shader\n    vec2 dUVdx = dFdx(vtc) * atlasScale;\n    vec2 dUVdy = dFdy(vtc) * atlasScale;\n\n    #ifdef GL_EXT_shader_texture_lod\n      #extension GL_EXT_shader_texture_lod : enable\n\n      // workaround for artifacts in Windows 10 using Intel HD Graphics 4000 series\n      // see: https://devtopia.esri.com/Zurich-R-D-Center/arcgis-js-api-canvas3d-issues/issues/768\n      const float epsilon = 1.0E-32;\n      float zeroUVShift = uv.x == 0.0 && uv.y == 0.0 ? epsilon : 0.0;\n\n      texColor = texture2DGradEXT(tex, uv + zeroUVShift, dUVdx, dUVdy);\n    #else\n      // use bias to compensate for difference in automatic vs desired mipmap level\n      vec2 dUVdxAuto = dFdx(uv);\n      vec2 dUVdyAuto = dFdy(uv);\n      float mipMapLevel = calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n      float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n      texColor = texture2D(tex, uv, mipMapLevel - autoMipMapLevel);\n    #endif\n\n    if (texColor.a * coverageCorrectionFactor(uv) < ALPHA_THRESHOLD) {\n      discard;\n    }\n\n    $externalColorMix\n\n#ifdef TRANSPARENCY_DISCARD\n    if (opacity_ < 0.001) {\n      discard;\n    }\n#endif\n\n    vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n    gl_FragColor = vec4(shadedColor, opacity_);\n  }\n]]></snippet>\n\n<snippet name="vsDepthSrc"><![CDATA[\n  $vsViewInputs\n  $vsTransformInputs\n\n  uniform vec2 nearFar;\n  attribute vec3 $position;\n  varying float depth;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  $vsLocalPosition\n  $vsLocalCenter\n  $doublePrecisionArithmethic\n\n  void main(void) {\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n    vec3 vpos = model * localPosition().xyz;\n\n    vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n    vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n    vec3 vpos = (model * localPosition()).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    vec4 eye = view * vec4(vpos, 1);\n\n    gl_Position = proj * eye;\n    depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n]]></snippet>\n\n<snippet name="vsDepth"><![CDATA[\n  $vsprecisionf\n\n  $vsDepthSrc\n  }\n]]></snippet>\n\n<snippet name="vsDepthTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsDepthSrc\n#ifndef FLIPV\n        vtc = $uv0;\n#else\n        vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]></snippet>\n\n<snippet name="vsNormalSrc"><![CDATA[\n  $vsViewInputs\n  $vsTransformInputs\n\n  uniform mat4 viewNormal;\n  attribute vec3 $position;\n#ifdef COMPRESSED_NORMALS\n  attribute vec2 $normalCompressed;\n#else\n  attribute vec3 $normal;\n#endif\n  varying vec3 vnormal;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  $vsLocalPosition\n  $vsLocalNormal\n  $vsLocalCenter\n  $doublePrecisionArithmethic\n\n  void main(void) {\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n    vec3 vpos = model * localPosition().xyz + modelOriginHi;\n    vnormal = normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\n\n    vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n    vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n    vec3 vpos = (model * localPosition()).xyz;\n    vnormal = normalize((viewNormal * modelNormal * localNormal()).xyz);\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    gl_Position = proj * view * vec4(vpos, 1);\n]]></snippet>\n\n<snippet name="vsNormal"><![CDATA[\n  $vsprecisionf\n\n  $vsNormalSrc\n  }\n]]></snippet>\n\n<snippet name="vsNormalTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsNormalSrc\n#ifndef FLIPV\n    vtc = $uv0;\n#else\n    vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]></snippet>\n\n<snippet name="vsHighlightSrc"><![CDATA[\n  $vsprecisionf\n\n  $vsViewInputs\n  $vsTransformInputs\n\n  attribute vec3 $position;\n\n  $vvUniforms\n#if defined(VV_CUSTOM_MODEL_MATRIX)\n  attribute vec4 instanceFeatureAttribute;\n#endif\n  $vvFunctions\n\n  $calculateVerticalOffset\n\n  $vsLocalPosition\n  $vsLocalCenter\n  $doublePrecisionArithmethic\n\n  void main(void) {\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n    vec3 vpos = model * localPosition().xyz;\n\n    vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n    vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n    vec3 vpos = (model * localPosition()).xyz;\n\n#ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    gl_Position = proj * view * vec4(vpos, 1);\n]]></snippet>\n\n<snippet name="vsHighlight"><![CDATA[\n  $vsHighlightSrc\n  }\n]]></snippet>\n\n<snippet name="vsHighlightTextured"><![CDATA[\n  $vsprecisionf\n\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n  $vsHighlightSrc\n#ifndef FLIPV\n    vtc = $uv0;\n#else\n    vtc = vec2($uv0.x, 1.0-$uv0.y);\n#endif\n  }\n]]></snippet>\n\n<snippet name="fsDepthSrc"><![CDATA[\n  varying float depth;\n\n  void main() {\n]]></snippet>\n\n<snippet name="fsDepth"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n\n  $calcFragDepth\n  $float2rgba\n  $fsDepthSrc\n#ifndef BIAS_SHADOWMAP\n    gl_FragColor = float2rgba(depth);\n#else\n    gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n  }\n]]></snippet>\n\n<snippet name="fsDepthTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n  varying vec2 vtc;\n\n  $calcFragDepth\n  $float2rgba\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  $fsDepthSrc\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n      discard;\n    }\n#ifndef BIAS_SHADOWMAP\n    gl_FragColor = float2rgba(depth);\n#else\n    gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n  }\n]]></snippet>\n\n<snippet name="fsNormal"><![CDATA[\n  $fsprecisionf\n\n  varying vec3 vnormal;\n  void main() {\n    vec3 normal = normalize(vnormal);\n    if (gl_FrontFacing == false) normal = -normal;\n\n#ifndef ALPHA_ZERO\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n\n  }\n]]></snippet>\n\n<snippet name="fsNormalTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  varying vec3 vnormal;\n  varying vec2 vtc;\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  void main() {\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n      discard;\n    }\n    vec3 normal = normalize(vnormal);\n    if (gl_FrontFacing == false) normal = -normal;\n#ifndef ALPHA_ZERO\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n  }\n]]></snippet>\n\n<snippet name="fsHighlight"><![CDATA[\n  $fsprecisionf\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n  void main() {\n    $highlightWrite\n  }\n]]></snippet>\n\n<snippet name="fsHighlightTextured"><![CDATA[\n  $enableRequiredExtensions\n  $fsprecisionf\n  $alphaThreshold\n\n  varying vec2 vtc;\n  uniform sampler2D tex;\n  uniform vec2 texSize;\n\n  uniform sampler2D depthTex;\n  uniform vec4 highlightViewportPixelSz;\n\n  $calcMipMapLevel\n  $coverageCorrectionFactor\n\n  void main() {\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n      discard;\n    }\n\n    $highlightWrite\n  }\n]]></snippet>\n\n</snippets>\n'},1410:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderLineCallout"><![CDATA[\n  $vsprecisionf\n\n  $commonAttributesAndUniformsHUD\n\n  attribute vec2 $uv0;\n\n  uniform float lineSize;\n  uniform vec2 pixelToNDC;\n  uniform float borderSize;\n  uniform vec2 screenOffset;\n\n  varying vec4 coverageSampling;\n  varying vec2 lineSizes;\n\n  $alignToPixelOrigin\n  $alignToPixelCenter\n\n  $projectPositionHUD\n\n  void main(void) {\n    ProjectHUDAux projectAux;\n    vec4 endPoint = projectPositionHUD(projectAux);\n\n#ifdef OCCL_TEST\n    if (!testVisibilityHUD(endPoint)) {\n      gl_Position = vec4(1e38, 1e38, 1e38, 1);\n    }\n    else {\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n      vec2 screenOffsetScaled = screenOffset;\n#endif\n\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView = (view * model * vec4($position, 1.0)).xyz;\n      applyHUDViewDependentPolygonOffset($auxpos1.w, projectAux.absCosAngle, posView);\n\n      vec4 startPoint = proj * vec4(posView, 1);\n\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n\n      startPoint.xy += screenOffsetNorm * startPoint.w;\n      endPoint.xy += screenOffsetNorm * endPoint.w;\n\n      // Align start and end to pixel origin\n      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n\n#ifdef DEPTH_HUD\n\n#ifdef DEPTH_HUD_ALIGN_START\n      endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n      startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n\n#endif\n\n      vec4 projectedPosition = mix(startAligned, endAligned, $uv0.y);\n\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n\n#else\n\n      float lineSizeScaled = lineSize;\n      float borderSizeScaled = borderSize;\n\n#endif\n\n      float halfPixelSize = lineSizeScaled * 0.5;\n\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt = floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding = 1.0 + borderSizeScaled;\n      vec2 ndcOffset = (pixelOffset - padding + $uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection = ($uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize = 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n      coverageSampling = vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position = projectedPosition;\n\n#ifdef OCCL_TEST\n    }\n#endif\n  }\n]]></snippet>\n\n<snippet><![CDATA[\n\n]]></snippet>\n\n<snippet name="fragmentShaderLineCallout"><![CDATA[\n  $fsprecisionf\n\n  uniform vec4 color;\n  uniform vec4 borderColor;\n\n  varying vec4 coverageSampling;\n  varying vec2 lineSizes;\n\n  void main() {\n    // Mix between line and border coverage offsets depending on whether we need\n    // a border (based on the sidedness).\n    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n    // Mix between border and line color based on the line coverage (conceptually the line\n    // blends on top of the border background).\n    //\n    // Anti-alias by blending final result using the full (including optional border) coverage\n    // and the color alpha\n    float borderAlpha = color.a * borderColor.a * coverage.y;\n    float colorAlpha = color.a * coverage.x;\n\n    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n#ifdef DEPTH_HUD\n\n    if (finalAlpha < 0.01) {\n      discard;\n    }\n\n#else\n\n    // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n    // need to divide by finalAlpha). We avoid the division here by setting the\n    // appropriate blending function in the material.\n    vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n\n    gl_FragColor = vec4(finalRgb, finalAlpha);\n\n#endif\n\n  }\n]]></snippet>\n\n</snippets>\n'},1411:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(1412),r(1278),r(1295),r(1292),r(1281),r(1289),r(1277),r(1284),r(1279)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){var p=i.vec3d,f=i.mat4d,h=[{name:u.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:36,normalized:!1},{name:u.VertexAttrConstants.NORMAL,count:3,type:5126,offset:12,stride:36,normalized:!1},{name:u.VertexAttrConstants.UV0,count:2,type:5126,offset:24,stride:36,normalized:!1},{name:u.VertexAttrConstants.AUXPOS1,count:1,type:5126,offset:32,stride:36,normalized:!1}],m={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},v=function(e){function t(t,r){var n=e.call(this,r)||this;return n.params=d.copyParameters(t,m),n}return r(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){var e=this.params;return{width:e.width,outlineSize:e.outlineSize,outlineColor:e.outlineColor,stripeLength:e.stripeLength,stripeEvenColor:e.stripeEvenColor,stripeOddColor:e.stripeOddColor,polygonOffset:e.polygonOffset}},t.prototype.setParameterValues=function(e){d.updateParameters(this.params,e)&&this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.getOutputAmount=function(e){return 2*(e/2+1)*9},t.prototype.getInstanceBufferLayout=function(){},t.prototype.getVertexBufferLayout=function(){return h},t.prototype.fillInterleaved=function(e,t,r,n,i,o){var a=e.vertexAttr[u.VertexAttrConstants.POSITION].data,s=e.vertexAttr[u.VertexAttrConstants.NORMAL].data,l=a.length/3,m=e&&e.indices&&e.indices.position;m&&m.length!==2*(l-1)&&console.warn("MeasurementArrowMaterial does not support indices");for(var v=o+c.findAttribute(h,u.VertexAttrConstants.POSITION).offset/4,g=o+c.findAttribute(h,u.VertexAttrConstants.NORMAL).offset/4,S=o+c.findAttribute(h,u.VertexAttrConstants.UV0).offset/4,C=o+c.findAttribute(h,u.VertexAttrConstants.AUXPOS1).offset/4,D=y,E=b,A=_,T=x,O=w,I=0,R=0;R<l;++R){var P=3*R;if(p.set3(a[P],a[P+1],a[P+2],D),R<l-1){var M=3*(R+1);p.set3(a[M],a[M+1],a[M+2],E),p.set3(s[M],s[M+1],s[M+2],O),p.normalize(O),p.subtract(E,D,A),p.normalize(A),p.cross(O,A,T),p.normalize(T)}var L=p.dist(D,E);t&&r&&(f.multiplyVec3(t,D),f.multiplyVec3(t,E),f.multiplyVec3(r,T)),d.fill(D,0,i,v,void 0,3),v+=9,d.fill(D,0,i,v,void 0,3),v+=9,d.fill(T,0,i,g,void 0,3),g+=9,d.fill(T,0,i,g,void 0,3),g+=9,i[S]=I,i[S+1]=-1,i[S+=9]=I,i[S+1]=1,S+=9,R<l-1&&(I+=L)}for(R=0;R<l;++R)i[C]=I,i[C+=9]=I,C+=9},t.prototype.intersect=function(e,t,r,n,i,o,a,s){},t.prototype.getGLMaterials=function(){return{color:g,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},t.prototype.getAllTextureIds=function(){return[]},t.loadShaders=function(e,t,r){e._parse(n);var i=new l("measurement-arrow",["vsMeasurementArrow","fsMeasurementArrow"],null,t,e,r);t.addShaderVariations("measurement-arrow-material-shader-variations",i)},t}(a),g=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.params=d.copyParameters(t.getParams()),i.selectProgram(),i}return r(t,e),t.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("measurement-arrow-material-shader-variations",[])},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram()},t.prototype.beginSlot=function(e){return e===s.OPAQUE_MATERIAL},t.prototype.getProgram=function(){return this.program},t.prototype.getDrawMode=function(e){return e.gl.TRIANGLE_STRIP},t.prototype.bind=function(e,t){var r=this.program;e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(!0),e.setFaceCullingEnabled(!1),e.setBlendingEnabled(!1),this.params.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.bindProgram(r),r.setUniform1f("width",this.params.width),r.setUniform1f("outlineSize",this.params.outlineSize),r.setUniform4fv("outlineColor",this.params.outlineColor),r.setUniform1f("stripeLength",this.params.stripeLength),r.setUniform4fv("stripeEvenColor",this.params.stripeEvenColor),r.setUniform4fv("stripeOddColor",this.params.stripeOddColor)},t.prototype.bindView=function(e,t){var r=t.origin,n=this.getProgram();d.bindView(r,t.view,n)},t.prototype.bindInstance=function(e,t){this.getProgram().setUniformMatrix4fv("model",t.transformation)},t.prototype.release=function(e){e.setDepthTestEnabled(!0),e.setDepthWriteEnabled(!0),e.setBlendingEnabled(!1),this.params.polygonOffset&&e.setPolygonOffsetFillEnabled(!1)},t}(o),y=p.create(),b=p.create(),_=p.create(),x=p.create(),w=p.create(),S=f.create();return f.identity(S),v}.apply(null,n))||(e.exports=i)},1412:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsMeasurementArrow"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  uniform float width;\n\n  attribute vec3 $position;\n  attribute vec3 $normal;\n  attribute vec2 $uv0;\n  attribute float $auxpos1;\n\n  varying vec2 vtc;\n  varying float vlength;\n  varying float vradius;\n\n  void main(void) {\n    vec3 bitangent = $normal;\n\n    vtc = $uv0;\n    vlength = $auxpos1;\n    vradius = 0.5 * width;\n\n    vec4 pos = view * vec4((model * vec4($position + vradius * bitangent * $uv0.y, 1.0)).xyz, 1.0);\n    gl_Position = proj * pos;\n  }\n]]></snippet>\n\n<snippet name="fsMeasurementArrow"><![CDATA[\n  $fsprecisionf\n\n  uniform float outlineSize;\n  uniform vec4 outlineColor;\n  uniform float stripeLength;\n  uniform vec4 stripeEvenColor;\n  uniform vec4 stripeOddColor;\n\n  varying vec2 vtc;\n  varying float vlength;\n  varying float vradius;\n\n  #define INV_SQRT2 (1.0 / sqrt(2.0))\n\n  vec4 arrowColor(vec2 tc, float len) {\n    float d = INV_SQRT2 * (tc.x - abs(tc.y));\n    d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n    d = min(d, 1.0 - abs(tc.y));\n\n    if (d < 0.0) {\n      return vec4(0.0);\n    } else if (d < outlineSize) {\n      return outlineColor;\n    } else {\n      return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n    }\n  }\n\n  void main(void) {\n    vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n    vec4 color = arrowColor(ntc, vlength / vradius);\n    if (color.a == 0.0) {\n      discard;\n    }\n    gl_FragColor = color;\n  }\n\n]]></snippet>\n\n</snippets>\n'},1413:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vsRibbonLine"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n\n  uniform float extLineWidth;\n  uniform float nearPlane;\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n  varying vec2 vtc;\n\n  attribute vec4 $color;\n  varying vec4 vColor;\n\n  attribute float $size;\n\n#ifndef WALL\n  uniform float miterLimit;\n  attribute vec3 $auxpos1;\n  attribute vec3 $auxpos2;\n#endif\n\n#ifdef SCREENSCALE\n  uniform vec2 screenSize;\n  $toScreenCoords\n#define VECTYPE vec2\n#define ZEROVEC vec2(0.0, 0.0)\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*$uv0.y > 0.0\n\n#else //ifdef SCREENSCALE\n\n#define VECTYPE vec3\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\n// these macros are only valid for "strip" type lines:\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*$uv0.y < 0.0\n\n#endif //ifdef SCREENSCALE\n\n  float interp(float ncp, vec4 a, vec4 b) {\n    return (-ncp - a.z) / (b.z - a.z);\n  }\n\n#ifdef SCREENSCALE\n\n  void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\n    float vnp = nearPlane*0.99;\n\n    //We have four vertices per point on the line. Start and end vertices\n    //are treated differently --\x3e d > 0, d < 0\n    float d = abs($uv0.y) - 1.1;\n\n    //current pos behind ncp --\x3e we need to clip\n    if(pos.z > -nearPlane) {\n      if (d < 0.0) {\n        //previous in front of ncp\n        if(prev.z < -nearPlane) {\n          pos = mix(prev, pos, interp(vnp, prev, pos));\n          next = pos;\n        } else {\n          pos = vec4(0, 0, 0, 1);\n        }\n      }\n      //next in front of ncp\n      if(d > 0.0) {\n        if(next.z < -nearPlane) {\n          pos = mix(pos, next, interp(vnp, pos, next));\n          prev = pos;\n        } else {\n          pos = vec4(0, 0, 0, 1);\n        }\n      }\n    } else {\n      //current position visible\n      //previous behind ncp\n      if (prev.z > -nearPlane) {\n        prev = mix(pos, prev, interp(vnp, pos, prev));\n      }\n      //next behind ncp\n      if (next.z > -nearPlane) {\n        next = mix(next, pos, interp(vnp, next, pos));\n      }\n    }\n\n    pos= proj * pos;\n    pos.xy *= screenSize;\n    pos /= pos.w;\n\n    next = proj * next;\n    next.xy *= screenSize;\n    next /= next.w;\n\n    prev = proj * prev;\n    prev.xy *= screenSize;\n    prev /= prev.w;\n  }\n\n#endif // SCREENSCALE\n\n  void main(void) {\n\n#ifdef SCREENSCALE\n  // Check for special value of uv0.y which is used by the Renderer when graphics\n  // are removed before the VBO is recompacted. If this is the case, then we just\n  // project outside of clip space.\n  if ($uv0.y == 0.0) {\n    // Project out of clip space\n    gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n  }\n  else {\n#endif\n\n  float lineWidth = extLineWidth + $size;\n\n#ifdef SCREENSCALE\n\n#if 0\n    vec4 pos = toScreenCoords($position.xyz);\n    vec2 left = (pos - toScreenCoords($auxpos1)).xy;\n    vec2 right = (toScreenCoords($auxpos2) - pos).xy;\n#else\n    vec4 pos  = view * vec4((model * vec4($position.xyz, 1.0)).xyz, 1.0);\n    vec4 prev = view * vec4((model * vec4($auxpos1.xyz, 1.0)).xyz, 1.0);\n    vec4 next = view * vec4((model * vec4($auxpos2.xyz, 1.0)).xyz, 1.0);\n\n    clipAndTransform(pos, prev, next);\n\n    vec2 left = (pos - prev).xy;\n    vec2 right = (next - pos).xy;\n#endif\n\n#else // ifdef SCREENSCALE\n    vec4 pos = vec4($position, 1.0);\n#ifndef WALL\n    vec3 left = $position.xyz - $auxpos1;\n    vec3 right = $auxpos2 - $position.xyz;\n    vec3 up = normalize($position.xyz);\n#endif // ifndef WALL\n#endif // ifdef SCREENSCALE\n\n#ifdef WALL\n    float displacementLen = lineWidth;\n    vec3 displacementDir = normalize($position.xyz);//vec3(0.0, 1.0, 0.0);\n#else // ifdef WALL\n\n    float leftLen = length(left);\n    left = (leftLen > 0.001) ? left/leftLen : ZEROVEC;\n\n    float rightLen = length(right);\n    right = (rightLen > 0.001) ? right/rightLen : ZEROVEC;\n\n    // determine if vertex is on the "outside or "inside" of the join\n    bool isOutside = ISOUTSIDE;\n\n    // compute miter join position first\n    float displacementLen = lineWidth;\n    VECTYPE displacementDir = normalize(left + right);\n    displacementDir = PERPENDICULAR(displacementDir);\n    if (leftLen > 0.001 && rightLen > 0.001) {\n      float nDotSeg = dot(displacementDir, left);\n      displacementLen /= length(nDotSeg*left - displacementDir);\n\n      // limit displacement of inner vertices\n      if (!isOutside) {\n        displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n      }\n    }\n\n    if (isOutside && (displacementLen > miterLimit*lineWidth)) {\n      // convert to bevel join if miterLimit is exceeded\n      if (leftLen < 0.001) {\n        displacementDir = right;\n      }\n      else if (rightLen < 0.001) {\n        displacementDir = left;\n      }\n      else {\n        displacementDir = (abs($uv0.y) - 1.1 < 0.0) ? left : right;\n      }\n      displacementDir = normalize(displacementDir);\n      displacementDir = PERPENDICULAR(displacementDir);\n      displacementLen = lineWidth;\n    }\n\n#endif // ifdef WALL\n\n#ifdef SCREENSCALE\n    pos.xy += displacementDir * floor($uv0.y + 0.5) * displacementLen;\n    pos.xy /= screenSize;\n#else\n    pos.xyz += displacementDir * floor($uv0.y + 0.5) * displacementLen;\n    pos = proj * view * model * pos;\n#endif\n\n    vtc = $uv0;\n    vColor = $color * 0.003921568627451; // = 1/255\n    gl_Position = pos;\n\n#ifdef SCREENSCALE\n    }\n#endif\n  }\n]]></snippet>\n\n\n<snippet name="fsRibbonLine"><![CDATA[\n  $fsprecisionf\n\n  uniform vec4 eColor;\n  varying vec4 vColor;\n  varying vec2 vtc;\n\n#ifdef STIPPLE\n  uniform float stippleLengthDoubleInv;\n#endif\n\n  void main() {\n\n#ifdef STIPPLE\n    if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n      discard;\n    }\n#endif\n\n    gl_FragColor = eColor * vColor;\n  }\n]]></snippet>\n\n<snippet name="fsRibbonLineHighlight"><![CDATA[\n  $fsprecisionf\n\n#ifdef STIPPLE\n  uniform float stippleLengthDoubleInv;\n#endif\n\n  void main() {\n#ifdef STIPPLE\n    if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n      discard;\n    }\n#endif\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n  }\n]]></snippet>\n\n</snippets>\n'},1414:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1415),r(1282),r(1283)],void 0===(i=function(e,t,r,n,i){return function(){function e(){}return e.loadShaders=function(e,t,o){e._parse(r);var a=new i(o,e.vertexShaderBlendLayers,e.fragmentShaderBlendLayers,n.Default3D);t.add("blendLayers",a)},e}()}.apply(null,n))||(e.exports=i)},1415:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderBlendLayers"><![CDATA[\n  $vsprecisionf\n\n  attribute vec3 $position;\n  attribute vec2 $uv0;\n\n  uniform float scale;\n  uniform vec2 offset;\n\n  varying vec2 uv;\n\n  void main(void) {\n    gl_Position = vec4($position, 1.0);\n    uv = $uv0 * scale + offset;;\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderBlendLayers"><![CDATA[\n  $fsprecisionf\n\n  varying vec2 uv;\n\n  uniform sampler2D tex;\n  uniform float opacity;\n\n  void main() {\n    vec4 color = texture2D(tex, uv);\n\n    // Note: output in pre-multiplied alpha for correct alpha compositing\n    gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;\n  }\n]]></snippet>\n\n</snippets>\n'},1416:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1417),r(1282),r(1281),r(1284),r(1283)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(e,t,r,n){void 0===n&&(n=4),this.program=e.get("simple"),this.color=t,this.depthFunc=r,this.drawMode=n}return e.prototype.beginSlot=function(e){return e===i.INTERNAL_MATERIAL},e.prototype.getProgram=function(){return this.program},e.prototype.bind=function(e,t){e.bindProgram(this.program),this.program.setUniformMatrix4fv("model",o.IDENTITY),this.program.setUniformMatrix4fv("proj",t.proj),this.program.setUniform4fv("color",this.color),e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA),e.setDepthTestEnabled(!0),void 0!==this.depthFunc&&e.setDepthFunction(this.depthFunc)},e.prototype.release=function(e){void 0!==this.depthFunc&&e.setDepthFunction(513),e.setBlendingEnabled(!1)},e.prototype.bindView=function(e,t){o.bindView(t.origin,t.view,this.program)},e.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},e.prototype.getDrawMode=function(e){return this.drawMode},e.loadShaders=function(e,t,i){e._parse(r);var o=new a(i,e.vertexShaderSimple,e.fragmentShaderSimple,n.Default3D);t.add("simple",o)},e}()}.apply(null,n))||(e.exports=i)},1417:function(e,t){e.exports='<?xml version="1.0" encoding="UTF-8"?>\n\n<snippets>\n\n<snippet name="vertexShaderSimple"><![CDATA[\n  $vsprecisionf\n\n  uniform mat4 proj;\n  uniform mat4 view;\n  uniform mat4 model;\n  attribute vec3 $position;\n\n  void main(void) {\n    gl_Position = proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\n  }\n]]></snippet>\n\n<snippet name="fragmentShaderSimple"><![CDATA[\n  $fsprecisionf\n\n  uniform vec4 color;\n\n  void main() {\n    gl_FragColor = color;\n  }\n]]></snippet>\n</snippets>\n'},1418:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9),r(1300),r(1307),r(1278),r(1328),r(1277),r(1419)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=2e4,d=[0,0],c=o.mat4d.create(),p=[n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create()],f=r("dojo-debug-messages");return function(){function e(e,t,r,n,s){this._content=new Map,this._frustumCullingEnabled=!0,this._maxFarNearRatio=u,this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null},this._needsRender=!0,this._rctx=s,this._gl=s.gl,this._visualizer=new l(e,t,r,n,this._rctx),this._camera=new i(o.vec3.createFrom(0,100,-100),o.vec3.createFrom(0,0,0)),f&&(this._stats.visualizerRenderTimer=new a(10),this._stats.viewportRenderTimer=new a(10))}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){var e={},t=this._visualizer.getCombinedStats();for(var r in t)e[r]=t[r];if(e.renderGeometriesTotal=this._stats.renderGeometriesTotal,e.renderGeometriesVisible=this._stats.renderGeometriesVisible,f&&(e.visualizerTotalRenderTime=this._stats.visualizerRenderTimer.getTotal(),e.visualizerCurrentRenderTime=this._stats.visualizerRenderTimer.getLastFiltered(),e.viewportTotalRenderTime=this._stats.viewportRenderTimer.getTotal(),e.viewportCurrentRenderTime=this._stats.viewportRenderTimer.getLastFiltered(),e.totalNumFramesRendered=this._stats.viewportRenderTimer.getNumMeasurements()),void 0!==this._gl.getUsedTextureMemory&&(e.textureMemory=this._gl.getUsedTextureMemory()),void 0!==this._gl.getUsedRenderbufferMemory&&(e.renderbufferMemory=this._gl.getUsedRenderbufferMemory()),void 0!==this._gl.getUsedVBOMemory&&(e.VBOMemory=this._gl.getUsedVBOMemory()),void 0!==this._gl.getUsedTextureMemoryStats){var n=this._gl.getUsedTextureMemoryStats();for(var i in n)e["texMem type: "+i]=n[i]}return e},e.prototype.dispose=function(){this._visualizer.dispose(),this._visualizer=null},e.prototype.setLighting=function(e){this._visualizer.setLighting(e)},e.prototype.getViewParams=function(e){var t=this._visualizer.getViewParams(e);return e&&!e.frustumCullingEnabled||(t.frustumCullingEnabled=this._frustumCullingEnabled),e&&!e.maxFarNearRatio||(t.maxFarNearRatio=this._maxFarNearRatio),t},e.prototype.setViewParams=function(e){void 0!==e.frustumCullingEnabled&&(this._frustumCullingEnabled=e.frustumCullingEnabled),void 0!==e.maxFarNearRatio&&(-1===e.maxFarNearRatio?this._maxFarNearRatio=u:this._maxFarNearRatio=e.maxFarNearRatio),this._visualizer.setViewParams(e),this._needsRender=!0},e.prototype.setRenderParams=function(e){this._visualizer.setRenderParams(e)},e.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()},e.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()},e.prototype.modify=function(e,t,r,n){this._visualizer.modify(e,t,r,n),this._content=this._visualizer.getContent()},e.prototype.getContent=function(){return this._content},e.prototype.setCamera=function(e){this._camera.copyFrom(e),this._updateNearFar(),this._needsRender=!0},e.prototype.getCamera=function(){return this._camera},e.prototype.getPickRay=function(e,t,r){return this.pickRayWithBeginPoint(e,void 0,this._camera.viewMatrix,t,r)},e.prototype.pickRayWithBeginPoint=function(e,t,r,n,i){return this._visualizer.getPickRay(e,t,this._camera,r,n,i)},e.prototype.addExternalRenderer=function(e,t){return this._visualizer.addExternalRenderer(e,t)},e.prototype.removeExternalRenderer=function(e){return this._visualizer.removeExternalRenderer(e)},e.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()},e.prototype.render=function(e,t){f&&this._stats.viewportRenderTimer.start(),this._updateNearFar(),f&&this._stats.visualizerRenderTimer.start(),this._visualizer.render(this._camera,e,t),f&&(this._stats.visualizerRenderTimer.stop(),this._stats.viewportRenderTimer.stop())},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._visualizer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()},e.prototype._updateNearFar=function(){(this._frustumCullingEnabled||this._maxFarNearRatio>0)&&(d[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,d),this._maxFarNearRatio>0&&d[1]>0&&(this._camera.far=d[1],this._camera.near=Math.max(d[0],this._camera.far/this._maxFarNearRatio)))},e.prototype._computeFrustumCullingAndNearFar=function(e,t){var r=this;o.mat4d.perspective(this._camera.fovY,this._camera.aspect,1,10,c),s.matrixToFrustumPlanes(this._camera.viewMatrix,c,p),this._stats.renderGeometriesTotal=0,this._stats.renderGeometriesVisible=0;var n=-Number.MAX_VALUE,i=-Number.MAX_VALUE,a=p[0][0],l=p[0][1],u=p[0][2],d=p[0][3],f=p[1][0],h=p[1][1],m=p[1][2],v=p[1][3],g=p[2][0],y=p[2][1],b=p[2][2],_=p[2][3],x=p[3][0],w=p[3][1],S=p[3][2],C=p[3][3],D=p[4][0],E=p[4][1],A=p[4][2],T=p[4][3],O=p[5][3];this._content.forEach(function(e){r._stats.renderGeometriesTotal++;var t=e.center,o=t[0],s=t[1],c=t[2],p=e.bsRadius;if(!(a*o+l*s+u*c+d>p||f*o+h*s+m*c+v>p||g*o+y*s+b*c+_>p||x*o+w*s+S*c+C>p)){var T=D*o+E*s+A*c,O=T+p,I=-T+p;O>n&&(n=O),I>i&&(i=I),r._stats.renderGeometriesVisible++}});var I=n!==-Number.MAX_VALUE;n+=T,i+=O,this._stats.renderGeometriesVisible>0&&I&&(t[0]=.99*Math.max(1-n,2),t[1]=1.01*Math.max(10+i,t[0]+1))},e}()}.apply(null,n))||(e.exports=i)},1419:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1420),r(1302),r(1313),r(1421),r(1278),r(1337),r(1338),r(1331),r(1330),r(1297),r(1422),r(1339),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h){var m=a.vec3d,v=a.mat4d,g=h.assert;return function(){function e(e,t,r,n,i){this._drawShadowMapDebugQuad=!1,this._drawSSAOMapDebugQuad=!1,this._needsRender=!0,this._content=new Map,this._stage=e,this._rctx=i,this._renderer=new u(t,r,n,this._rctx,!1),this._programRep=t,this._helpers={shadowMap:new p(t,this._rctx),ssao:new f(t,n,this._rctx,this.setNeedsRender.bind(this)),highlight:new s(t,n,this._rctx),renderOccluded:new d(t,n,this._rctx),offscreenRendering:new l(t,this._rctx)}}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()},e.prototype.dispose=function(){this._renderer.dispose(),this._helpers.shadowMap.enabled=!1,this._helpers.shadowMap.dispose(),this._helpers.ssao.enabled=!1,this._helpers.ssao.dispose(),this._helpers.highlight.enabled=!1,this._helpers.renderOccluded.enabled=!1,this._helpers.offscreenRendering.enabled=!1},e.prototype.setLighting=function(e){this._renderer.setLighting(e)},e.prototype.getViewParams=function(e){var t=e||{};return e&&!e.pixelRatio||(t.pixelRatio=this._renderer.getPixelRatio()),t},e.prototype.setViewParams=function(e){null!=e.pixelRatio&&this._renderer.setPixelRatio(e.pixelRatio)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=e.shadowMapResolution),void 0!==e.shadowMap&&(this._helpers.shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=e.shadowMapMaxCascades),this._helpers.highlight.enabled=!0,void 0!==e.ssao&&(this._helpers.ssao.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._helpers.ssao.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._helpers.ssao.radius=e.ssaoRadius),void 0!==e.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter."),void 0!==e.ssaoSamples&&(this._helpers.ssao.samples=e.ssaoSamples),void 0!==e.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=e.drawShadowMapDebugQuad),void 0!==e.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=e.drawSSAODebugQuad),this._renderer.ssaoEnabled=this._helpers.ssao.enabled,void 0!==e.offscreenRendering&&(this._helpers.offscreenRendering.enabled=e.offscreenRendering),e.background&&(this._helpers.offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=e.antialiasingEnabled?"smaa":"none"),void 0!==e.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=e.earlyOcclusionPixelDraw),void 0!==e.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(e.defaultHighlightOptions),this._needsRender=!0},e.prototype.getRenderParams=function(){var e={};return this._helpers.shadowMap.isSupported&&(e.shadowMap=this._helpers.shadowMap.enabled,e.shadowMapResolution=this._helpers.shadowMap.textureResolution,e.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades),this._helpers.ssao.isSupported&&(e.ssao=this._helpers.ssao.enabled,e.ssaoAttenuation=this._helpers.ssao.attenuation,e.ssaoRadius=this._helpers.ssao.radius,e.ssaoFilterRadius=this._helpers.ssao.filterRadius,e.ssaoSamples=this._helpers.ssao.samples),e},e.prototype.modify=function(e,t,r,n){this._renderer.modify(e,t,r,n);for(var i=0;i<t.length;++i)this._content.delete(t[i].uniqueName);for(i=0;i<e.length;++i)this._content.set(e[i].uniqueName,e[i]);for(i=0;i<r.length;++i)g(this._content.get(r[i].renderGeometry.uniqueName)===r[i].renderGeometry)},e.prototype.getContent=function(){return this._content},e.prototype.getPickRay=function(e,t,r,n,i,o){m.unproject(m.createFrom(e[0],e[1],0),n,r.projectionMatrix,r.fullViewport,i),m.unproject(m.createFrom(e[0],e[1],1),n,r.projectionMatrix,r.fullViewport,o)},e.prototype.getProjectionMatrix=function(e,t,r,n,i){var o=h.fovx2fovy(t,e[2],e[3]);v.perspective(180*o/Math.PI,e[2]/e[3],r,n,i)},e.prototype.addExternalRenderer=function(e,t){return this._renderer.addExternalRenderer(e,t)},e.prototype.removeExternalRenderer=function(e){return this._renderer.removeExternalRenderer(e)},e.prototype.getExternalRenderers=function(){return this._renderer.getExternalRenderers()},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},e.prototype.setNeedsRender=function(){this._needsRender=!0},e.prototype.render=function(e,t,i){var o=e.viewport;if(this._renderer.prepareRender(e),this._helpers.shadowMap.enabled){n.ENABLE_PROFILE_DEPTH_RANGE&&r.begin("depthRange");var a=this.computeDepthRange(e);n.ENABLE_PROFILE_DEPTH_RANGE&&r.end("depthRange"),this._helpers.shadowMap.prepare(e,t,this._content,a);for(var s=this._helpers.shadowMap.getCascades(),l=0;l<s.length;++l){var u=s[l];u.camera.setGLViewport(this._rctx),this._renderer.renderGeometryPass(c.MATERIAL_DEPTH_SHADOWMAP,u.camera)}this._helpers.shadowMap.finish(i),e.setGLViewport(this._rctx)}if(this._helpers.shadowMap.bindAll(this._programRep),this._renderer.renderAuxiliaryBuffers(e,i,this._helpers),this._renderer.render(e,i,this._helpers),this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled){var d=v.ortho(o[0],o[2],o[1],o[3],-1,1);this._helpers.shadowMap.drawDebugQuad(d)}if(this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled){d=v.ortho(o[0],o[2],o[1],o[3],-1,1);this._helpers.ssao.drawQuad(d)}},e.prototype.getEdgeView=function(){return this._renderer.edgeView},e.prototype.computeDepthRange=function(e){var t=o.depthRangeFromScene(e,this._content,this._stage.getLayers());return i.union(t,this.getExternalRenderers().queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e}()}.apply(null,n))||(e.exports=i)},1420:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){function t(t){return t in i||(i[t]=new e(t)),i[t]}function r(e){console.log(t(e).toJSON())}var n=1e3,i={},o={};e.get=t,e.begin=function(e){t(e).begin()},e.end=function(e,i){void 0===i&&(i=!0),t(e).end();var a=performance.now();!i||e in o&&!(a>=o[e]+n)||(r(e),o[e]=a)},e.log=r,e.logAll=function(){for(var e in i)r(e)}}(r||(r={})),r}.apply(null,n))||(e.exports=i)},1421:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1309),r(1350),r(1290),r(1313),r(1278),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t){var r=o.empty(),n=t.getObjects();return t.getSpatialQueryAccelerator()?function(e,t,r){var n=t.eye,i=t.viewForward,a=t.frustumPlanes,s=function(e){return!e.areAllComponentsHidden()},l=r.objectCount;if(l<h)o.set(S,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(n,i,"front-to-back",S,function(r,n){u(e,t,r),S.far=e.near,n.setRange(S)},a,s),o.set(S,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(n,i,"back-to-front",S,function(r,n){u(e,t,r),S.near=e.far,n.setRange(S)},a,s);else{var d=Math.max(Math.min(l,m),Math.ceil(l*v)),p=r.findClosest(i,"front-to-back",a,s,d),f=r.findClosest(i,"back-to-front",a,s,d);p&&f&&(c(e,t,p.getCenter(),p.getBSRadius()),c(e,t,f.getCenter(),f.getBSRadius()))}}(r,e,t.getSpatialQueryAccelerator()):function(e,t,r){C.clear(),r.forEach(function(e){e.areAllComponentsHidden()||C.add(e)}),C.empty||(C.sort(t),o.set(S,t.near,Math.min(e.near,t.far)),C.forEachInDepthRange(S,"front-to-back",function(r,n,i){n<e.near&&u(e,t,r)}),o.set(S,Math.max(e.far,t.near),t.far),C.forEachInDepthRange(S,"back-to-front",function(t,r,n){e.far=Math.max(e.far,n)}))}(r,e,n),r}function u(e,t,r){if(!r.areAllComponentsHidden()&&n.frustumSphere(t.frustumPlanes,r.getCenter(),r.getBSRadius())){var i=r.objectTransformation,o=w;r.geometryRecords.forEach(function(r){a.mat4d.multiply(i,r.getShaderTransformation(),o);var n=a.mat4d.maxScale(o),s=r.geometry.getBoundingInfo();d(e,t,s,o,n)})}}function d(e,t,r,i,o){var s=t.eye,l=t.viewForward;a.mat4d.multiplyVec3(i,r.center,x);var u=l[0]*(x[0]-s[0])+l[1]*(x[1]-s[1])+l[2]*(x[2]-s[2]),c=r.bsRadius*o;if(!(u-c>e.near&&u+c<e.far)&&n.frustumSphere(t.frustumPlanes,x,c))if(r.bsRadius>f&&r.getChildren())for(var p=r.getChildren(),h=0;h<8;++h)p[h]&&d(e,t,p[h],i,o);else E.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function c(e,t,r,n){var i=t.eye,o=t.viewForward,a=(r[0]-i[0])*o[0]+(r[1]-i[1])*o[1]+(r[2]-i[2])*o[2];e.near=Math.min(e.near,a-n),e.far=Math.max(e.far,a+n)}Object.defineProperty(t,"__esModule",{value:!0});var p=1e4,f=100,h=500,m=500,v=.1;t.depthRangeFromScene=function(e,t,r){if(t.size<p)return D.compute(e,t);var n=o.empty();for(var i in r){var a=r[i];o.union(n,l(e,a))}return n},t.depthRangeFromLayer=l;var g=function(){function e(){this._items=new r({allocator:function(){return{obj:null,distance:0,near:0,far:0}}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,r=e.viewForward;this._items.forEach(function(e){var n=e.obj,i=n.getCenter(),o=n.getBSRadius(),a=(i[0]-t[0])*r[0]+(i[1]-t[1])*r[1]+(i[2]-t[2])*r[2];e.distance=a,e.near=a-o,e.far=a+o}),this._items.sort(function(e,t){return e.distance-t.distance})},e.prototype.forEachInDepthRange=function(e,t,r){if("front-to-back"===t)for(var n=0;n<this._items.length;++n){(i=this._items.data[n]).far<e.near||i.near>e.far||r(i.obj,i.near,i.far)}else for(n=this._items.length-1;n>=0;--n){var i;(i=this._items.data[n]).far<e.near||i.near>e.far||r(i.obj,i.near,i.far)}},e}(),y=function(){function e(){this.view=a.mat4d.create(),this.viewProj=a.mat4d.create(),this.planes=[a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create()],this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var r=this;this.reset(),a.mat4d.set(e.viewMatrix,this.view),a.mat4d.multiply(e.projectionMatrix,this.view,this.viewProj),e.copyFrustumPlanes(this.planes);var n=this.view,o=n[2],s=n[6],l=n[10],u=n[14],d=this.range,c=0;if(t.forEach(function(e){var t=e.instanceParameters.componentVisibilities,n=e.componentOffsets;if(!i.isAllHidden(t,n)&&e.castShadow){var a,d;e.hasShaderTransformation?(a=e.getBoundingSphere(e.getShaderTransformation(),1,x),d=x):(a=e.bsRadius,d=e.center);var p=o*d[0]+s*d[1]+l*d[2]+u,f=p-a,h=p+a;r.geometries[c]=e,r.near[c]=-h,r.far[c]=-f,++c}}),0===this.geometries.length)return d;for(var p=0;p<this.geometries.length;++p)this.near[p]>d.far&&(d.far=this.near[p]),this.near[p]>2&&this.far[p]<d.near&&(d.near=this.far[p]);var f=this.looseRange;f.near=Math.max(.5*d.near,2),f.far=2*d.far;var h=0,m=0;for(p=0;p<this.geometries.length;++p)this.near[p]<d.near&&(this.near[p]>=f.near?d.near=this.near[p]:this.nearCandidates[h++]=p),this.far[p]>d.far&&(this.far[p]<=f.far?d.far=this.far[p]:this.farCandidates[m++]=p);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return d;this.nearCandidates.sort(function(e,t){return r.near[e]<r.near[t]?-1:r.near[e]>r.near[t]?1:0}),this.farCandidates.sort(function(e,t){return r.far[e]<r.far[t]?1:r.far[e]>r.far[t]?-1:0});for(p=0;p<this.nearCandidates.length;++p){var v=this.nearCandidates[p];if(this.near[v]<d.near){var g=(y=this.geometries[v]).boundingInfo;this.includeNearBoundingInfoRec(g,y.getShaderTransformation())}}for(p=0;p<this.farCandidates.length;++p){v=this.farCandidates[p];if(this.far[v]>d.far){var y;g=(y=this.geometries[v]).boundingInfo;this.includeFarBoundingInfoRec(g,y.getShaderTransformation())}}return d},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();a.mat4d.multiplyVec3(t,n,x);var i=a.mat4d.maxScale(t),o=x[0],s=x[1],l=x[2];if(r*=i,!(this.planes[0][0]*o+this.planes[0][1]*s+this.planes[0][2]*l+this.planes[0][3]>r||this.planes[1][0]*o+this.planes[1][1]*s+this.planes[1][2]*l+this.planes[1][3]>r||this.planes[2][0]*o+this.planes[2][1]*s+this.planes[2][2]*l+this.planes[2][3]>r||this.planes[3][0]*o+this.planes[3][1]*s+this.planes[3][2]*l+this.planes[3][3]>r)){var u=this.view[2]*o+this.view[6]*s+this.view[10]*l+this.view[14],d=u+r;if(!(-(u-r)<2||-d>=this.range.near)){if(-d>this.looseRange.near)return void(this.range.near=-d);if(r>f){var c=e.getChildren();if(void 0!==c){for(var p=0;p<8;++p)void 0!==c[p]&&this.includeNearBoundingInfoRec(c[p],t);return}}E.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();a.mat4d.multiplyVec3(t,n,x);var i=a.mat4d.maxScale(t),o=x[0],s=x[1],l=x[2];if(r*=i,!(this.planes[0][0]*o+this.planes[0][1]*s+this.planes[0][2]*l+this.planes[0][3]>r||this.planes[1][0]*o+this.planes[1][1]*s+this.planes[1][2]*l+this.planes[1][3]>r||this.planes[2][0]*o+this.planes[2][1]*s+this.planes[2][2]*l+this.planes[2][3]>r||this.planes[3][0]*o+this.planes[3][1]*s+this.planes[3][2]*l+this.planes[3][3]>r)){var u=this.view[2]*o+this.view[6]*s+this.view[10]*l+this.view[14]-r;if(!(-u<=this.range.far)){if(-u<this.looseRange.far)return void(this.range.far=-u);if(r>f){var d=e.getChildren();if(void 0!==d){for(var c=0;c<8;++c)void 0!==d[c]&&this.includeFarBoundingInfoRec(d[c],t);return}}E.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=y;var b=function(){function e(){this.modelViewProj=a.mat4d.create(),this.clipPosition=[a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,r,n,i){var o=this.modelViewProj;a.mat4d.multiply(t,r,o);for(var s=!1,l=0;l<8;++l){var u=this.clipPosition[l],d=0===l||3===l||4===l||7===l?n[0]:i[0],c=0===l||1===l||4===l||5===l?n[1]:i[1],p=l<4?n[2]:i[2];u[0]=o[0]*d+o[4]*c+o[8]*p+o[12],u[1]=o[1]*d+o[5]*c+o[9]*p+o[13],u[2]=o[2]*d+o[6]*c+o[10]*p+o[14],u[3]=o[3]*d+o[7]*c+o[11]*p+o[15]}for(l=0;l<12;++l){for(var f=this.clipPosition[_[l][0]],h=this.clipPosition[_[l][1]],m=this.clipPosition[_[l][2]],v=this.clipTriangle(f,h,m),g=!0,y=0;y<v.length;++y){if((b=v[y][3])>=2){g=!1;break}}if(!g){s=!0;for(y=0;y<v.length;++y){var b;(b=v[y][3])<e.near&&(e.near=b),b>e.far&&(e.far=b)}}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void s.assert(!1)},e.prototype.intersect=function(e,t,r){var n=0;return 0===r?n=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?n=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?n=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(n=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),a.vec4d.lerp(e,t,n,a.vec4d.create())},e.prototype.clipTriangle=function(e,t,r){for(var n=[e,t,r],i=0;i<4;++i){var o=n;n=[];for(var a=0;a<o.length;++a){var s=o[a],l=o[(a+1)%o.length];this.inside(l,i)?(this.inside(s,i)||n.push(this.intersect(s,l,i)),n.push(l)):this.inside(s,i)&&n.push(this.intersect(s,l,i))}}return n},e}(),_=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],x=a.vec3d.create(),w=a.mat4d.create(),S=o.empty(),C=new g,D=new y,E=new b}.apply(null,n))||(e.exports=i)},1422:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(1307),r(1282),r(1288),r(1278),r(1293),r(1277),r(1287),r(1285),r(1280),r(1279),r(1286)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f){function h(e,t,r,n,i,o,s,u){a.vec2d.set2(0,0,j);for(var d=0;d<4;++d)a.vec2d.add(j,e[d],j);a.vec2d.scale(j,.25),a.vec2d.set2(0,0,k);for(d=4;d<8;++d)a.vec2d.add(k,e[d],k);a.vec2d.scale(k,.25),a.vec2d.lerp(e[4],e[5],.5,z[0]),a.vec2d.lerp(e[5],e[6],.5,z[1]),a.vec2d.lerp(e[6],e[7],.5,z[2]),a.vec2d.lerp(e[7],e[4],.5,z[3]);var c=0,p=a.vec2d.dist2(z[0],j);for(d=1;d<4;++d){var f=a.vec2d.dist2(z[d],j);f<p&&(p=f,c=d)}a.vec2d.subtract(z[c],e[c+4],B);var h,m,v=B[0];B[0]=-B[1],B[1]=v,a.vec2d.subtract(k,j,G),a.vec2d.lerp(B,G,r),a.vec2d.normalize(B),h=m=a.vec2d.dot(a.vec2d.subtract(e[0],j,H),B);for(d=1;d<8;++d){var g=a.vec2d.dot(a.vec2d.subtract(e[d],j,H),B);g<h?h=g:g>m&&(m=g)}a.vec2d.set(j,n),a.vec2d.scale(B,h-t,H),a.vec2d.add(n,H,n);var y=-1,b=1,_=0,x=0;for(d=0;d<8;++d){a.vec2d.subtract(e[d],n,W),a.vec2d.normalize(W);var w=B[0]*W[1]-B[1]*W[0];w>0?w>y&&(y=w,_=d):w<b&&(b=w,x=d)}l.verify(y>0,"leftArea"),l.verify(b<0,"rightArea"),a.vec2d.scale(B,h,q),a.vec2d.add(q,j,q),a.vec2d.scale(B,m,$),a.vec2d.add($,j,$),Y[0]=-B[1],Y[1]=B[0];var S=l.rayRay2D(n,e[x],$,a.vec2d.add($,Y,H),1,i),C=l.rayRay2D(n,e[_],$,H,1,o),D=l.rayRay2D(n,e[_],q,a.vec2d.add(q,Y,H),1,s),E=l.rayRay2D(n,e[x],q,H,1,u);l.verify(S,"rayRay"),l.verify(C,"rayRay"),l.verify(D,"rayRay"),l.verify(E,"rayRay")}function m(e,t){return 3*t+e}function v(e,t){return a.vec3d.set3(e[t],e[t+3],e[t+6],Q),Q}function g(e,t,r,n,i){a.vec2d.scale(a.vec2d.subtract(r,n,X),.5),Z[0]=X[0],Z[1]=X[1],Z[2]=0,Z[3]=X[1],Z[4]=-X[0],Z[5]=0,Z[6]=X[0]*X[0]+X[1]*X[1],Z[7]=X[0]*X[1]-X[1]*X[0],Z[8]=1,Z[m(0,2)]=-a.vec2d.dot(v(Z,0),e),Z[m(1,2)]=-a.vec2d.dot(v(Z,1),e);var o=a.vec2d.dot(v(Z,0),r)+Z[m(0,2)],s=a.vec2d.dot(v(Z,1),r)+Z[m(1,2)],l=a.vec2d.dot(v(Z,0),n)+Z[m(0,2)],u=a.vec2d.dot(v(Z,1),n)+Z[m(1,2)];o=-(o+l)/(s+u),Z[m(0,0)]+=Z[m(1,0)]*o,Z[m(0,1)]+=Z[m(1,1)]*o,Z[m(0,2)]+=Z[m(1,2)]*o,o=1/(a.vec2d.dot(v(Z,0),r)+Z[m(0,2)]),s=1/(a.vec2d.dot(v(Z,1),r)+Z[m(1,2)]),Z[m(0,0)]*=o,Z[m(0,1)]*=o,Z[m(0,2)]*=o,Z[m(1,0)]*=s,Z[m(1,1)]*=s,Z[m(1,2)]*=s,Z[m(2,0)]=Z[m(1,0)],Z[m(2,1)]=Z[m(1,1)],Z[m(2,2)]=Z[m(1,2)],Z[m(1,2)]+=1,o=-.5*((o=a.vec2d.dot(v(Z,1),t)+Z[m(1,2)])/(s=a.vec2d.dot(v(Z,2),t)+Z[m(2,2)])+(l=a.vec2d.dot(v(Z,1),r)+Z[m(1,2)])/(u=a.vec2d.dot(v(Z,2),r)+Z[m(2,2)])),Z[m(1,0)]+=Z[m(2,0)]*o,Z[m(1,1)]+=Z[m(2,1)]*o,Z[m(1,2)]+=Z[m(2,2)]*o,o=a.vec2d.dot(v(Z,1),t)+Z[m(1,2)],l=-(s=a.vec2d.dot(v(Z,2),t)+Z[m(2,2)])/o,Z[m(1,0)]*=l,Z[m(1,1)]*=l,Z[m(1,2)]*=l,i[0]=Z[0],i[1]=Z[1],i[2]=0,i[3]=Z[2],i[4]=Z[3],i[5]=Z[4],i[6]=0,i[7]=Z[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=Z[6],i[13]=Z[7],i[14]=0,i[15]=Z[8]}for(var y=r.getLogger("esri.views.3d.webgl-engine.lib.ShadowMap"),b=function(){return function(){this.camera=new n,this.lightMat=a.mat4d.create()}}(),_=function(){function e(e,t){this.doShadowMapMipmapsWork=!1,this.textureRes=4096,this.numCascades=1,this.maxNumCascades=2,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.programRep=e,this.rctx=t,this.emptyTexture=s.createEmptyTexture(t);for(var r=0;r<4;++r)this.cascades.push(new b)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this.rctx.capabilities.standardDerivatives},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(e){this.textureRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=l.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)F[e]=this.cascades[e];return F.length=this.numCascades,F},e.prototype.prepare=function(e,t,r,n){l.assert(this.enabled),a.mat4d.multiply(e.projectionMatrix,e.viewMatrix,w);var i=n.near,o=n.far;i<2&&(i=2),o<2&&(o=2),i>=o&&(i=2,o=4),this.numCascades=Math.min(1+Math.floor(l.logWithBase(o/i,4)),this.maxNumCascades);for(var s=Math.pow(o/i,1/this.numCascades),u=0;u<this.numCascades+1;++u)this.cascadeDistances[u]=i*Math.pow(s,u);a.mat4d.inverse(w,S),a.mat4d.lookAt([0,0,0],[-t[0],-t[1],-t[2]],[0,1,0],L);var d=e.viewMatrix,c=e.projectionMatrix;for(u=0;u<this.numCascades;++u){var p=this.cascades[u],f=-this.cascadeDistances[u],m=-this.cascadeDistances[u+1],v=(c[10]*f+c[14])/Math.abs(c[11]*f+c[15]),y=(c[10]*m+c[14])/Math.abs(c[11]*m+c[15]);l.assert(v<y);for(var b=0;b<8;++b){var _=b%4==0||b%4==3?-1:1,E=b%4==0||b%4==1?-1:1,F=b<4?v:y;a.vec4d.set4(_,E,F,1,C),a.mat4d.multiplyVec4(S,C,D[b]);for(var U=0;U<3;++U)D[b][U]/=D[b][3]}a.vec3d.negate(D[0],N),a.mat4d.translate(L,N,x),p.camera.viewMatrix=x;for(b=0;b<8;++b)a.mat4d.multiplyVec3(p.camera.viewMatrix,D[b]);a.vec3d.set(D[0],A),a.vec3d.set(D[0],T);for(b=1;b<8;++b)for(U=0;U<3;++U)A[U]=Math.min(A[U],D[b][U]),T[U]=Math.max(T[U],D[b][U]);A[2]-=200,T[2]+=200,p.camera.near=-T[2],p.camera.far=-A[2],i=1/D[0][3],o=1/D[4][3],l.assert(i<o);var V=i+Math.sqrt(i*o),j=Math.sin(Math.acos(d[2]*t[0]+d[6]*t[1]+d[10]*t[2]));h(D,V/=j,j,O,I,R,P,M),g(O,I,P,M,p.camera.projectionMatrix),p.camera.projectionMatrix[10]=2/(A[2]-T[2]),p.camera.projectionMatrix[14]=-(A[2]+T[2])/(A[2]-T[2]),a.mat4d.multiply(p.camera.projectionMatrix,p.camera.viewMatrix,p.lightMat);var k=this.textureRes/2;p.camera.viewport[0]=u%2==0?0:k,p.camera.viewport[1]=0===Math.floor(u/2)?0:k,p.camera.viewport[2]=k,p.camera.viewport[3]=k}this.lastOrigin=null,this.cascadeDistances[this.numCascades]=100*o;var z=this.rctx,B=z.gl;z.bindFramebuffer(this.fbo),z.bindTexture(null,7),z.setClearColor(1,1,1,1),z.clear(B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT),z.setBlendingEnabled(!1)},e.prototype.finish=function(e){l.assert(this.enabled),this.rctx.bindFramebuffer(e),this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()},e.prototype.bind=function(e){var t=this.rctx,r=this.enabled;t.bindTexture(r?this.depthTexture:this.emptyTexture,7),t.bindProgram(e),e.setUniform1i("depthTex",7),e.setUniform1f("depthHalfPixelSz",r?.5/this.textureRes:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),r=0;r<t.length;r++)this.bind(t[r])},e.prototype.bindView=function(e,t){if(this.enabled){var r=this.lastOrigin;if(!r||r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]){this.lastOrigin=this.lastOrigin||a.vec3d.create(),a.vec3d.set(t,this.lastOrigin);for(var n=0;n<this.numCascades;++n){a.mat4d.translate(this.cascades[n].lightMat,t,U);for(var i=0;i<16;++i)V[16*n+i]=U[i]}}e.setUniformMatrix4fv("shadowMapMatrix",V)}},e.prototype.drawDebugQuad=function(e){l.assert(this.enabled);var t=this.rctx,r=t.gl;if(!this.debugQuadVAO){var n=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new f(t,i.Default3D,{geometry:o.Pos2Tex},{geometry:u.createVertex(t,r.STATIC_DRAW,n)})}var a=this.programRep.get("showDepth"),s=this.debugQuadVAO;t.setDepthTestEnabled(!1),t.bindProgram(a),a.setUniformMatrix4fv("proj",e),a.setUniform1i("depthTex",0),t.bindTexture(this.depthTexture,0),t.bindVAO(s),p.assertCompatibleVertexAttributeLocations(s,a),t.drawArrays(r.TRIANGLE_STRIP,0,p.vertexCount(s,"geometry")),t.setDepthTestEnabled(!0)},e.prototype.enable=function(){if(!this.enabled){if(!this.isSupported)return void y.warn("Shadow maps are not supported for this browser or hardware");var e=this.rctx.gl,t={target:e.TEXTURE_2D,pixelFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,wrapMode:e.CLAMP_TO_EDGE,samplingMode:e.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes};this.depthTexture=new c(this.rctx,t),this.fbo=d.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}},e.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.fbo=null,this.depthTexture=null)},e}(),x=a.mat4d.create(),w=a.mat4d.create(),S=a.mat4d.create(),C=a.vec4d.create(),D=[],E=0;E<8;++E)D.push(a.vec4d.create());var A=a.vec3d.create(),T=a.vec3d.create(),O=a.vec2d.create(),I=a.vec2d.create(),R=a.vec2d.create(),P=a.vec2d.create(),M=a.vec2d.create(),L=a.mat4d.create(),N=a.vec3d.create(),F=[],U=a.mat4d.create(),V=new Float32Array(64),j=a.vec2d.create(),k=a.vec2d.create(),z=[a.vec2d.create(),a.vec2d.create(),a.vec2d.create(),a.vec2d.create()],B=a.vec2d.create(),G=a.vec2d.create(),H=a.vec2d.create(),W=a.vec2d.create(),q=a.vec2d.create(),$=a.vec2d.create(),Y=a.vec2d.create(),Q=a.vec3d.create(),X=a.vec2d.create(),Z=a.mat3d.create();return _}.apply(null,n))||(e.exports=i)},1423:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1280)],void 0===(i=function(e,t,r){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}Object.defineProperty(t,"__esModule",{value:!0});var i=542327876,o=131072,a=4,s=33776,l=33778,u=33779,d=n("DXT1"),c=n("DXT3"),p=n("DXT5"),f=31,h=0,m=1,v=2,g=3,y=4,b=7,_=20,x=21;t.createDDSTexture=function(e,t,n,w){var S=new Int32Array(n,0,f);if(S[h]!==i)return console.error("Invalid magic number in DDS header"),null;if(!(S[_]&a))return console.error("Unsupported format, must contain a FourCC code"),null;var C,D,E=S[x];switch(E){case d:C=8,D=s;break;case c:C=16,D=l;break;case p:C=16,D=u;break;default:return console.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(E)),null}var A=1;S[v]&o&&!1!==w&&(A=Math.max(1,S[b]));var T,O,I=S[y],R=S[g],P=S[m]+4;t.samplingMode=A>1?9987:9729,t.hasMipmap=A>1,t.width=S[y],t.height=S[g];var M=new r(e,t);e.bindTexture(M);for(var L=0;L<A&&(O=Math.floor((I+3)/4)*Math.floor((R+3)/4)*C,T=new Uint8Array(n,P,O)),e.gl.compressedTexImage2D(e.gl.TEXTURE_2D,L,D,I,R,0,T),P+=O,(1!==I||1!==R)&&1!==A;++L)I=Math.max(1,I>>1),R=Math.max(1,R>>1);return M}}.apply(null,n))||(e.exports=i)},1427:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(1)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.title=null,t}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title})},n([o.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),i=n([o.subclass("esri.renderers.support.LegendOptions")],t)}(o.declared(i));t.LegendOptions=a,t.default=a}.apply(null,n))||(e.exports=i)},1432:function(e,t,r){var n,i;n=[r(35),r(4),r(12),r(24),r(32),r(5),r(8),r(151),r(217),r(31),r(1355),r(1640)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){var p="size",f=n({sizeInfo:p,colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),h=n({widthAndDepth:"width-and-depth"}),m=n({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"}),v=(n({classedSize:"classed-size",classedColor:"classed-color",univariateColorSize:"univariate-color-size"}),n({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),n({percentTotal:"percent-of-total"}),Math.PI),g=l.opacityToTransparency,y=l.transparencyToOpacity;return e([t,r],{declaredClass:"esri.renderers.Renderer",properties:{authoringInfo:{type:c,value:null,json:{write:!0}},requiredFields:{dependsOn:["visualVariables"],get:function(){var e=Object.create(null);return this.collectRequiredFields(e),Object.keys(e).sort()}},type:{type:String,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}},visualVariables:{json:{read:{source:["visualVariables","rotationType","rotationExpression"],reader:function(e,t){return this._readVariables(e,t)}},write:function(e,t,r,n){var i=[];e.forEach(function(e,t){e.type===p?i.push(this._writeSizeInfo(e,n,t)):"color"===e.type?i.push(this._writeColorInfo(e,n,t)):"opacity"===e.type?i.push(this._writeOpacityInfo(e,n,t)):"rotation"===e.type&&i.push(this._writeRotationInfo(e,n,t))},this),t.visualVariables=i}}}},constructor:function(){this._cache={}},_rotationRE:/^\[([^\]]+)\]$/i,_viewScaleRE:/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,_visualVariablesSetter:function(e){var t=this._cache;this.visualVariables&&this.visualVariables.forEach(function(e,r){t.hasOwnProperty(r)&&(t[r]=null)},this),e&&e.some(function(e){return!!e.target})&&e.sort(function(e,t){return e.target===t.target?0:e.target?1:-1}),e&&e.forEach(function(e,r){"color"===e.type?t[r]=this._processColorInfo(e):"opacity"===e.type?t[r]=this._processOpacityInfo(e):e.type===p?t[r]=this._processSizeInfo(e):"rotation"===e.type&&(t[r]=this._processRotationInfo(e))},this),this._set("visualVariables",e)},getSymbol:function(e,t){},getVisualVariableValues:function(e,t){var r,n=this.visualVariables;return n&&(r=n.map(function(r){var n,i=r.type,a=i+"Info";switch((t=o.mixin({},t))[a]=r,i){case p:n=this.getSize(e,t);break;case"color":n=this.getColor(e,t);break;case"opacity":n=this.getOpacity(e,t);break;case"rotation":n=this.getRotationAngle(e,t)}return{variable:r,value:n}},this).filter(function(e){return null!=e.value},this)),r},hasVisualVariables:function(e,t){return e?!!this.getVisualVariablesForType(e,t):!!(this.getVisualVariablesForType(p,t)||this.getVisualVariablesForType("color",t)||this.getVisualVariablesForType("opacity",t)||this.getVisualVariablesForType("rotation",t))},getVisualVariablesForType:function(e,t){var r,n=this.visualVariables;return n&&(r=n.filter(function(r){return r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target)}))&&0===r.length&&(r=void 0),r},getSize:function(e,t){var r=this._getVarInfo(t&&t.sizeInfo,p),n=r.variable,i=this._cache[r.cacheKey],o=null;if(n){var a=n.minSize,s=n.maxSize,l="object"==typeof a&&a?this._getSize(e,a,i&&i.minSize,t):a,u="object"==typeof s&&s?this._getSize(e,s,i&&i.maxSize,t):s;o=this._getSize(e,n,i&&i.root,t,[l,u])}return o},getSizeRangeAtScale:function(e,t){var r,n=this._getVarInfo(e,p),i=this._cache[n.cacheKey],o={scale:t};if((e=n.variable)&&t){var a=e.minSize,s=e.maxSize,l="object"==typeof a&&a?this._getSize({},a,i&&i.minSize,o):a,u="object"==typeof s&&s?this._getSize({},s,i&&i.maxSize,o):s;if(null!=l||null!=u){if(l>u){var d=u;u=l,l=d}r={minSize:l,maxSize:u}}}return r},getColor:function(e,t){var r=this._getVarInfo(t&&t.colorInfo,"color");return this._getColorComponent(e,r.variable,this._cache[r.cacheKey],t)},getOpacity:function(e,t){var r=this._getVarInfo(t&&t.opacityInfo,"opacity");return this._getColorComponent(e,r.variable,this._cache[r.cacheKey],t,!0)},getRotationAngle:function(e,t){var r=this._getVarInfo(t&&t.rotationInfo,"rotation"),n=r.variable,i=this._cache[r.cacheKey],o=n.axis||"heading",a="heading"===o&&"arithmetic"===n.rotationType?90:0,l="heading"===o&&"arithmetic"===n.rotationType?-1:1,u=n.field,d=i&&i.compiledFunc,c=e.attributes,p=0;return(u||d)&&(d?p=s.executeFunction(d,s.createExecContext(e,s.getViewInfo(t))):"function"==typeof u?p=u.apply(this,arguments):c&&(p=c[u]||0),p="number"!=typeof p||isNaN(p)?null:a+l*p),p},collectRequiredFields:function(e){var t=[];this.visualVariables&&(t=t.concat(this.visualVariables)),t.forEach(function(t){t&&(t.field&&(e[t.field]=!0),t.normalizationField&&(e[t.normalizationField]=!0),t.valueExpression&&s.extractFieldNames(t.valueExpression).forEach(function(t){e[t]=!0}))})},_getVarInfo:function(e,t){var r;if(e&&e.type===t&&this.visualVariables)r=this.visualVariables.indexOf(e),e=this.visualVariables[r];else if(this.visualVariables){var n=this.getVisualVariablesForType(t);e=n&&n[0],r=this.visualVariables.indexOf(e)}return{variable:e,cacheKey:r}},_readSizeInfo:function(e){return e.axis&&(e.axis=h.fromJSON(e.axis)),e.valueUnit&&(e.valueUnit=m.fromJSON(e.valueUnit)),e},_readColorInfo:function(e){return e&&(e.colors&&e.colors.forEach(function(t,r){Array.isArray(t)?e.colors[r]=u.fromJSON(t):e.colors[r]=new u(t)}),e.stops&&e.stops.forEach(function(t,r){t.color&&Array.isArray(t.color)?e.stops[r].color=u.fromJSON(t.color):t.color&&(e.stops[r].color=new u(t.color))})),e},_readOpacityInfo:function(e){var t;return e&&((t=o.mixin({},e)).transparencyValues&&(t.opacityValues=t.transparencyValues.map(y),delete t.transparencyValues),t.stops&&(t.stops=t.stops.map(function(e){return(e=o.mixin({},e)).opacity=y(e.transparency),delete e.transparency,e}))),t},_readVariables:function(e,t){e&&(e=e.map(function(e){return(e=o.clone(e)).type=f.fromJSON(e.type),e.type===p?e=this._readSizeInfo(e):"color"===e.type?e=this._readColorInfo(e):"opacity"===e.type&&(e=this._readOpacityInfo(e)),e},this));var r=t.rotationType,n=t.rotationExpression;if(n){var i={type:"rotation",rotationType:r},a=n.match(this._rotationRE);a&&a[1]&&(i.field=a[1],e||(e=[]),e.push(i))}return e},_createCache:function(e){var t=e&&e.valueExpression,r=s.createSyntaxTree(t),n=s.createFunction(r),i=!(!e||!e.expression)||this._viewScaleRE.test(t);return{ipData:this._interpolateData(e),hasExpr:!!t,compiledFunc:n,isScaleDriven:i}},_processColorInfo:function(e){return e&&(e.colors&&e.colors.forEach(function(t,r){t instanceof u||(e.colors[r]=new u(t))}),e.stops&&e.stops.forEach(function(t,r){!t.color||t.color instanceof u||(e.stops[r].color=new u(t.color))}),this._sortStops(e.stops)),this._createCache(e)},_processOpacityInfo:function(e){return this._sortStops(e&&e.stops),this._createCache(e)},_processSizeInfo:function(e){return e.stops&&Array.isArray(e.stops)?e.stops=this._processSizeInfoStops(e.stops):(e.minSize=e.minSize&&this._processSizeInfoSize(e.minSize),e.maxSize=e.maxSize&&this._processSizeInfoSize(e.maxSize)),{root:this._createCache(e),minSize:this._createCache(e.minSize),maxSize:this._createCache(e.maxSize)}},_processSizeInfoSize:function(e){return"object"==typeof e?e.stops=this._processSizeInfoStops(e.stops):e=i.toPt(e),e},_processSizeInfoStops:function(e){return e&&Array.isArray(e)&&(e.forEach(function(e){e.size=i.toPt(e.size)}),this._sortStops(e)),e},_sortStops:function(e){e&&Array.isArray(e)&&e.sort(function(e,t){return e.value-t.value})},_processRotationInfo:function(e){return this._createCache(e)},_getSize:function(e,t,r,n,i){var o=e.attributes,a=t.field,l=t.stops,u=0,c=r&&r.hasExpr,p=r&&r.compiledFunc,f=r&&r.ipData,h=r&&r.isScaleDriven,m="number"==typeof e,g=m?e:null;if(a||h||c){var y,b=n&&n.scale,_=i?i[0]:t.minSize,x=i?i[1]:t.maxSize,w=t.minDataValue,S=t.maxDataValue,C=t.valueUnit||"unknown",D=t.valueRepresentation,E=t.scaleBy,A=t.normalizationField,T=o?parseFloat(o[A]):void 0,O=n&&n.shape;if(h?g=null==b?this._getAverageValue(t):b:"number"!=typeof g&&(c?g=s.executeFunction(p,s.createExecContext(e,s.getViewInfo(n))):"function"==typeof a?g=a.apply(this,arguments):o&&(g=o[a])),null==g||A&&!m&&(isNaN(T)||0===T))return null;if(isNaN(T)||m||(g/=T),l){var I,R=this._lookupData(g,f),P=R[0],M=R[1];P===M?u=l[P].size:u=(I=l[P].size)+(l[M].size-I)*R[2]}else if(null!=_&&null!=x&&null!=w&&null!=S)if(g<=w)u=_;else if(g>=S)u=x;else if(y=(g-w)/(S-w),"area"===E&&O){var L="circle"===O,N=L?v*Math.pow(_/2,2):_*_,F=N+y*((L?v*Math.pow(x/2,2):x*x)-N);u=L?2*Math.sqrt(F/v):Math.sqrt(F)}else u=_+y*(x-_);else if("unknown"===C)null!=_&&null!=w?(_&&w?(y=g/w,u="circle"===O?2*Math.sqrt(y*Math.pow(_/2,2)):"square"===O||"diamond"===O||"image"===O?Math.sqrt(y*Math.pow(_,2)):y*_):u=g+(_||w),u=u<_?_:u,null!=x&&u>x&&(u=x)):u=g;else{var U=(n&&n.resolution?n.resolution:1)*d.meterIn[C];"area"===D?(u=Math.sqrt(g/v)/U,u*=2):(u=g/U,"radius"!==D&&"distance"!==D||(u*=2)),null!=_&&u<_&&(u=_),null!=x&&u>x&&(u=x)}}else t&&null==(u=l&&l[0]&&l[0].size)&&(u=t.minSize);return isNaN(u)?0:u},_getAverageValue:function(e){var t,r,n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2},_getColorComponent:function(e,t,r,n,i,o){var a,l=e.attributes,u=t&&t.field,d="number"==typeof e,c=d?e:null,p=r&&r.hasExpr,f=r&&r.compiledFunc,h=r&&r.ipData;if(u||p){var m=t.normalizationField,v=l?parseFloat(l[m]):void 0;"number"!=typeof c&&(p?c=s.executeFunction(f,s.createExecContext(e,s.getViewInfo(n))):"function"==typeof u?c=u.apply(this,arguments):l&&(c=l[u])),null==c||m&&!d&&(isNaN(v)||0===v)||(isNaN(v)||d||(c/=v),a=i?this._getOpacity(c,t,h):this._getColor(c,t,h))}else if(t){var g=t.stops;i?null==(a=g&&g[0]&&g[0].opacity)&&(a=t.opacityValues&&t.opacityValues[0]):a=g&&g[0]&&g[0].color||t.colors&&t.colors[0]}return o&&(o.data=c,o.value=a),o||a},_interpolateData:function(e){var t;if(e)if(e.colors||e.opacityValues){var r,n=(e.colors||e.opacityValues).length,i=e.minDataValue,o=(e.maxDataValue-i)/(n-1);for(t=[],r=0;r<n;r++)t[r]=i+r*o}else e.stops&&(t=e.stops.map(function(e){return e.value||0}));return t},_getOpacity:function(e,t,r){var n,i=this._lookupData(e,r);if(t=t||this.opacityInfo,i){var o,a=i[0],s=i[1];a===s?n=this._getOpacValue(t,a):n=(o=this._getOpacValue(t,a))+(this._getOpacValue(t,s)-o)*i[2]}return n},_getOpacValue:function(e,t){return e.opacityValues?e.opacityValues[t]:e.stops[t].opacity},_getColor:function(e,t,r){var n,i=this._lookupData(e,r);if(t=t||this.colorInfo,i){var o=i[0],a=i[1];n=o===a?this._getColorObj(t,o):u.blendColors(this._getColorObj(t,o),this._getColorObj(t,a),i[2]),n=new u(n)}return n},_getColorObj:function(e,t){return e.colors?e.colors[t]:e.stops[t].color},_lookupData:function(e,t){var r;if(t){var n=0,i=t.length-1;t.some(function(t,r){return e<t?(i=r,!0):(n=r,!1)}),r=[n,i,(e-t[n])/(t[i]-t[n])]}return r},_processForContext:function(e,t,r){if(t&&"web-scene"===t.origin){var n=null!=e.expression,i=null!=e.valueExpressionTitle&&"rotation"===e.type;t.messages&&(n&&t.messages.push(new a("property:unsupported",e.type+"VisualVariable.expression is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:r+".expression",context:t})),i&&t.messages.push(new a("property:unsupported",e.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:r+".valueExpressionTitle",context:t}))),n&&delete e.expression,i&&delete e.valueExpressionTitle}else e.type===p&&this._convertExpressionToArcade(e)},_writeRotationInfo:function(e,t,r){return e&&(e=o.mixin({},e),this._processForContext(e,t,"visualVariables["+r+"]"),e.type=f.toJSON(e.type),e=o.fixJson(e,!0)),e},_convertExpressionToArcade:function(e){e&&e.expression&&(e.valueExpression="$view.scale")},_writeSizeInfo:function(e,t,r){if(e){e=o.mixin({},e),this._processForContext(e,t,"string"==typeof r?r:"visualVariables["+r+"]");var n=e.minSize,i=e.maxSize;n&&(e.minSize="number"==typeof n?n:this._writeSizeInfo(n,t,"visualVariables["+r+"].minSize")),i&&(e.maxSize="number"==typeof i?i:this._writeSizeInfo(i,t,"visualVariables["+r+"].maxSize"));var a=e.legendOptions,s=e.type,l=e.axis;e.type=f.toJSON(s),l&&(e.axis=h.toJSON(l)),a&&(e.legendOptions=o.mixin({},a),(a=a.customValues)&&(e.legendOptions.customValues=a.slice(0))),e.stops&&(e.stops=e.stops.map(function(e){return null===(e=o.mixin({},e)).label&&delete e.label,e})),e=o.fixJson(e,!0)}return e},_writeColorInfo:function(e,t,r){return e&&(e=o.mixin({},e),this._processForContext(e,t,"visualVariables["+r+"]"),e.type=f.toJSON(e.type),e.colors&&(e.colors=e.colors.map(function(e){return u.toJSON(e)})),e.stops&&(e.stops=e.stops.map(function(e){return(e=o.mixin({},e)).color&&(e.color=u.toJSON(e.color)),null==e.value&&(e.value=0),null===e.label&&delete e.label,e})),e.legendOptions&&(e.legendOptions=o.mixin({},e.legendOptions)),e=o.fixJson(e,!0)),e},_writeOpacityInfo:function(e,t,r){var n;return e&&(n=o.mixin({},e),this._processForContext(n,t,"visualVariables["+r+"]"),n.type=f.toJSON(n.type),n.opacityValues&&(n.transparencyValues=n.opacityValues.map(g),delete n.opacityValues),n.stops&&(n.stops=n.stops.map(function(e){return(e=o.mixin({},e)).transparency=g(e.opacity),delete e.opacity,null===e.label&&delete e.label,e})),n.legendOptions&&(n.legendOptions=o.mixin({},n.legendOptions)),n=o.fixJson(n,!0)),n}})}.apply(null,n))||(e.exports=i)},1437:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSymbolColor=function(e,t,r){if(null==e||"ignore"===t)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);r[0]=Math.floor(255*e[0]),r[1]=Math.floor(255*e[1]),r[2]=Math.floor(255*e[2]);var n=Math.floor(85*e[3]);r[3]=0===n?0:"tint"===t?n:"replace"===t?n+85:n+170}}.apply(null,n))||(e.exports=i)},1438:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(31),r(32)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createMaterial=function(e,t,i){var o=t&&t.enabled&&t.edges;if(!o)return null;var a=r.toUnitRGBA(o.color),s=i;switch(o.type){case"solid":return e.createSolidEdgeMaterial({color:a,size:n.pt2px(o.size),extensionLength:n.pt2px(o.extensionLength),opacity:s});case"sketch":return e.createSketchEdgeMaterial({color:a,size:n.pt2px(o.size),extensionLength:n.pt2px(o.extensionLength),opacity:s})}}}.apply(null,n))||(e.exports=i)},1439:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1309),r(1278),r(1277)],void 0===(i=function(e,t,r,n,i){function o(e,t,r){e[0]=Math.min(e[0],t[0]-r),e[1]=Math.min(e[1],t[1]-r),e[2]=Math.min(e[2],t[2]-r)}function a(e,t,r){e[0]=Math.max(e[0],t[0]+r),e[1]=Math.max(e[1],t[1]+r),e[2]=Math.max(e[2],t[2]+r)}function s(e,t,r){return(r=r||e)[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r}function l(e,t,r){var n=e[0],i=e[1],o=e[2];return r[0][0]*n+r[0][1]*i+r[0][2]*o+r[0][3]>t||r[1][0]*n+r[1][1]*i+r[1][2]*o+r[1][3]>t||r[2][0]*n+r[2][1]*i+r[2][2]*o+r[2][3]>t||r[3][0]*n+r[3][1]*i+r[3][2]*o+r[3][3]>t||r[4][0]*n+r[4][1]*i+r[4][2]*o+r[4][3]>t||r[5][0]*n+r[5][1]*i+r[5][2]*o+r[5][3]>t}function u(e,t){for(var r=1/0,n=null,i=0;i<8;++i){var o=d(e,t,m[i]);o<r&&(r=o,n=m[i])}return n}function d(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}var c,p=function(){function e(e,t,r,i){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=r,i&&(void 0!==i.maximumObjectsPerNode&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),void 0!==i.maximumDepth&&(this._maximumDepth=i.maximumDepth)),isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(t)?this._root=new f(null,n.vec3d.createFrom(0,0,0),.5):this._root=new f(null,e,t/2)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var r=this._objectOrObjectsArray(e);t=null==t?r.length:t,this._objectCount+=t,this._grow(r);for(var n=f.acquire(),i=0;i<t;i++){var o=r[i];n.init(this._root),this._isDegenerate(o)?this._degenerateObjects.add(o):this._add(o,n)}f.release(n)},e.prototype.remove=function(e,t){var r=this._objectOrObjectsArray(e);this._objectCount-=r.length;for(var n=f.acquire(),i=0;i<r.length;i++){var o=r[i],a=t||this._boundingSphereFromObject(o,S);this._isValidRadius(a.radius)?(n.init(this._root),this._remove(o,a,n)):this._degenerateObjects.delete(o)}f.release(n),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,r){var n=this;this._forEachNode(this._root,function(i){if(!n._intersectsNode(e,t,i))return!1;var o=i.node;return o.terminals.forEach(function(i){n._intersectsObject(e,t,i)&&r(i)}),null!==o.residents&&o.residents.forEach(function(i){n._intersectsObject(e,t,i)&&r(i)}),!0})},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,r,n,i){return this._findClosest(e,"front-to-back"===t?c.FRONT_TO_BACK:c.BACK_TO_FRONT,r,n,i)},e.prototype.forEachInDepthRange=function(e,t,r,n,i,o,a,s){this._forEachInDepthRange(e,t,"front-to-back"===r?c.FRONT_TO_BACK:c.BACK_TO_FRONT,n,i,o,a,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,function(t){return e(t.node,t.center,2*t.halfSize)})},e.prototype._intersectsNode=function(e,t,r){return s(r.center,2*-r.halfSize,_),s(r.center,2*r.halfSize,x),i.rayBoxTest(e,t,_,x)},e.prototype._intersectsObject=function(e,t,r){var n=this._objectToBoundingSphere.getRadius(r);return!(n>0)||i.raySphere(e,t,this._objectToBoundingSphere.getCenter(r),n)},e.prototype._forEachNode=function(e,t){for(var r=f.acquire().init(e),n=[r];0!==n.length;){if(t(r=n.pop())&&!r.isLeaf())for(var i=0;i<r.node.children.length;i++){r.node.children[i]&&n.push(f.acquire().init(r).advance(i))}f.release(r)}},e.prototype._forEachNodeDepthOrdered=function(e,t,r,n){void 0===n&&(n=c.FRONT_TO_BACK);for(var i=f.acquire().init(e),o=[i],a=function(e,t,r){if(!T.length)for(var n=0;n<8;++n)T[n]={index:0,distance:0};for(n=0;n<8;++n){var i=h[n];T[n].index=n,T[n].distance=d(e,t,i)}for(T.sort(function(e,t){return e.distance-t.distance}),n=0;n<8;++n)r[n]=T[n].index;return r}(r,n,O);0!==o.length;){if(t(i=o.pop())&&!i.isLeaf())for(var s=7;s>=0;--s){var l=a[s];if(!(l>=i.node.children.length))i.node.children[l]&&o.push(f.acquire().init(i).advance(l))}f.release(i)}},e.prototype._findClosest=function(e,t,r,i,o){var a=this,s=1/0,c=1/0,p=null,f=u(e,t),h=0,m=function(n){if(++h,!i||i(n)){var o=a._objectToBoundingSphere.getCenter(n),u=a._objectToBoundingSphere.getRadius(n);if(!r||!l(o,u,r)){var f=d(e,t,o),m=f-u;m<s&&(s=m,c=f+u,p=n)}}};return this._forEachNodeDepthOrdered(this._root,function(i){if(null!=o&&h>=o)return!1;if(r&&l(i.center,i.halfSize*v,r))return!1;if(n.vec3d.scale(f,i.halfSize,b),n.vec3d.add(b,i.center),d(e,t,b)>c)return!1;var a=i.node;return a.terminals.forEach(function(e){m(e)}),null!==a.residents&&a.residents.forEach(function(e){m(e)}),!0},e,t),p},e.prototype._forEachInDepthRange=function(e,t,r,i,o,a,s,p){var f=this,h=-1/0,m=1/0,g={setRange:function(e){r===c.FRONT_TO_BACK?(h=Math.max(h,e.near),m=Math.min(m,e.far)):(h=Math.max(h,-e.far),m=Math.min(m,-e.near))}};g.setRange(i);var y=d(t,r,e),_=u(t,r),x=u(t,-1*r),w=0,S=function(e){if(++w,!s||s(e)){var n=f._objectToBoundingSphere.getCenter(e),i=f._objectToBoundingSphere.getRadius(e),u=d(t,r,n)-y;u-i>m||u+i<h||a&&l(n,i,a)||o(e,g)}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=p&&w>=p)return!1;if(a&&l(e.center,e.halfSize*v,a))return!1;if(n.vec3d.scale(_,e.halfSize,b),n.vec3d.add(b,e.center),d(t,r,b)-y>m)return!1;if(n.vec3d.scale(x,e.halfSize,b),n.vec3d.add(b,e.center),d(t,r,b)-y<h)return!1;var i=e.node;return i.terminals.forEach(function(e){S(e)}),null!==i.residents&&i.residents.forEach(function(e){S(e)}),!0},t,r)},e.prototype._objectOrObjectsArray=function(e){return Array.isArray(e)?e:(g[0]=e,g)},e.prototype._remove=function(e,t,r){w.length=0;var n=r.advanceTo(t,function(e,t){w.push(e.node,t)})?r.node.terminals:r.node.residents;if(n.removeUnordered(e),0===n.length)for(var i=w.length-2;i>=0;i-=2){var o=w[i],a=w[i+1];if(!this._purge(o,a))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,S))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var n=f.acquire().init(e);this._add(t.data[r],n),f.release(n)}},e.prototype._grow=function(e){var t=this;if(0!==e.length){var r=this._boundingSphereFromObjects(e,function(e,r){return t._boundingSphereFromObject(e,r)},C);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))n.vec3d.set(r.center,this._root.center),this._root.halfSize=1.25*r.radius;else{var i=f.acquire();this._rootBoundsForRootAsSubNode(r,i),this._placingRootViolatesMaxDepth(i)?this._rebuildTree(r,i):this._growRootAsSubNode(i),f.release(i)}}},e.prototype._rebuildTree=function(e,t){var r=this;n.vec3d.set(t.center,D.center),D.radius=t.halfSize;var i=this._boundingSphereFromObjects([e,D],function(e){return e},E),o=f.acquire().init(this._root);this._root.initFrom(null,i.center,1.25*i.radius),this._forEachNode(o,function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0}),f.release(o)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,function(e){return t=Math.max(t,e.depth),!0}),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var r=e.radius,n=e.center,i=-1/0,o=this._root.center,a=this._root.halfSize,s=0;s<3;s++){var l=o[s]-a-(n[s]-r),u=n[s]+r-(o[s]+a),d=Math.max(0,Math.ceil(l/(2*a))),c=Math.max(0,Math.ceil(u/(2*a)))+1,p=Math.pow(2,Math.ceil(Math.log(d+c)*Math.LOG2E));i=Math.max(i,p),A[s].min=d,A[s].max=c}for(s=0;s<3;s++){var f=(i-((d=A[s].min)+(c=A[s].max)))/2;d+=Math.ceil(f),c+=Math.floor(f);var h=o[s]-a-d*a*2;y[s]=h+(c+d)*a}return t.initFrom(null,y,i*a,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;n.vec3d.set(this._root.center,C.center),C.radius=this._root.halfSize,this._root.init(e),e.advanceTo(C,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,n=0;n<t.length&&null==e;)e=t[r=n++];for(;n<t.length;)if(t[n++])return-1;return r},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,r=this._root.halfSize,n=e.center;return e.radius<=r&&n[0]>=t[0]-r&&n[0]<=t[0]+r&&n[1]>=t[1]-r&&n[1]<=t[1]+r&&n[2]>=t[2]-r&&n[2]<=t[2]+r},e.prototype._boundingSphereFromObject=function(e,t){return n.vec3d.set(this._objectToBoundingSphere.getCenter(e),t.center),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,r){if(1===e.length){var i=t(e[0],C);n.vec3d.set(i.center,r.center),r.radius=i.radius}else{_[0]=1/0,_[1]=1/0,_[2]=1/0,x[0]=-1/0,x[1]=-1/0,x[2]=-1/0;for(var s=0;s<e.length;s++){i=t(e[s],C);this._isValidRadius(i.radius)&&(o(_,i.center,i.radius),a(x,i.center,i.radius))}n.vec3d.scale(n.vec3d.add(_,x,r.center),.5),r.radius=Math.max(x[0]-_[0],x[1]-_[1],x[2]-_[2])/2}return r},e}(),f=function(){function e(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this.center=n.vec3d.create(),this.initFrom(e,t,r,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,r,i,o){return void 0===t&&(t=null),void 0===i&&(i=this.halfSize),void 0===o&&(o=this.depth),this.node=t||e.createEmptyNode(),r&&n.vec3d.set(r,this.center),this.halfSize=i,this.depth=o,this},e.prototype.advance=function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var n=h[t];return this.center[0]+=n[0]*this.halfSize,this.center[1]+=n[1]*this.halfSize,this.center[2]+=n[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,r){for(void 0===r&&(r=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!r)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var n=this._childIndex(e);t&&t(this,n),this.advance(n)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,r=this.center,n=0,i=0;i<3;i++)r[i]<t[i]&&(n|=1<<i);return n},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}},e.acquire=function(){if(0===this._pool.length)return new e;var t=this._pool[this._pool.length-1];return this._pool.length--,t},e.release=function(e){this._pool.push(e)},e._pool=[],e}();!function(e){e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(c||(c={}));var h=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],m=[[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,-1,-1],[1,-1,1],[1,1,-1],[1,1,1]],v=Math.sqrt(3),g=[null],y=n.vec3d.create(),b=n.vec3d.create(),_=n.vec3d.create(),x=n.vec3d.create(),w=[],S={center:n.vec3d.create(),radius:0},C={center:n.vec3d.create(),radius:0},D={center:n.vec3d.create(),radius:0},E={center:n.vec3d.create(),radius:0},A=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],T=[],O=[];return p}.apply(null,n))||(e.exports=i)},1442:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8)],void 0===(i=function(e,t,r){function n(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+d.identifierOffset,d.identifierLength)),version:t.getUint16(r+d.versionOffset,u),checksum:t.getUint32(r+d.checksumOffset,u)}}function i(e,t){return{sizeLo:e.getUint32(t+c.sizeLo,u),sizeHi:e.getUint32(t+c.sizeHi,u),minX:e.getFloat64(t+c.minX,u),minY:e.getFloat64(t+c.minY,u),minZ:e.getFloat64(t+c.minZ,u),maxX:e.getFloat64(t+c.maxX,u),maxY:e.getFloat64(t+c.maxY,u),maxZ:e.getFloat64(t+c.maxZ,u),errorX:e.getFloat64(t+c.errorX,u),errorY:e.getFloat64(t+c.errorY,u),errorZ:e.getFloat64(t+c.errorZ,u),count:e.getUint32(t+c.count,u),reserved:e.getUint32(t+c.reserved,u)}}function o(e,t,r){var n=[];t=a(e,t,n);for(var i=[],o=0;o<n.length;o++){i.length=0,t=a(e,t,i);for(var s=0;s<i.length;s++)r.push(i[s]+n[o])}return t}function a(e,t,n){var i=new DataView(e,t),o=i.getUint8(0),a=31&o,s=!!(32&o),l=(192&o)>>6,d=0;if(0===l)d=i.getUint32(1,u),t+=5;else if(1===l)d=i.getUint16(1,u),t+=3;else{if(2!==l)throw new r("lepcc-decode-error","Bad count type");d=i.getUint8(1),t+=2}if(s)throw new r("lepcc-decode-error","LUT not implemented");for(var c=Math.ceil(d*a/8),p=new Uint8Array(e,t,c),f=0,h=0,m=0,v=-1>>>32-a,g=0;g<d;g++){for(;h<a;)f|=p[m]<<h,h+=8,m+=1;n[g]=f&v,f>>>=a,(h-=a)+a>32&&(f|=p[m-1]>>8-h)}return t+m}function s(e,t){return{sizeLo:e.getUint32(t+p.sizeLo,u),sizeHi:e.getUint32(t+p.sizeHi,u),count:e.getUint32(t+p.count,u),colorMapCount:e.getUint16(t+p.colorMapCount,u),lookupMethod:e.getUint8(t+p.lookupMethod),compressionMethod:e.getUint8(t+p.compressionMethod)}}function l(e,t){return{sizeLo:e.getUint32(t+f.sizeLo,u),sizeHi:e.getUint32(t+f.sizeHi,u),count:e.getUint32(t+f.count,u),scaleFactor:e.getUint16(t+f.scaleFactor,u),bitsPerPoint:e.getUint8(t+f.bitsPerPoint),reserved:e.getUint8(t+f.reserved)}}Object.defineProperty(t,"__esModule",{value:!0});var u=!0,d={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16},c={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};t.decodeXYZ=function(e){var t=new DataView(e,0),a=0,s=n(e,t,a),l=s.identifier,u=s.version;if(a+=d.byteCount,"LEPCC     "!==l)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var p=i(t,a);if(a+=c.byteCount,p.sizeHi*Math.pow(2,32)+p.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var f=new Float64Array(3*p.count),h=[],m=[],v=[],g=[];if((a=o(e,a=o(e,a=o(e,a=o(e,a,h),m),v),g))!==e.byteLength)throw new r("lepcc-decode-error","Bad length");for(var y=0,b=0,_=0;_<h.length;_++){b+=h[_];for(var x=0,w=0;w<m[_];w++){x+=v[y];var S=g[y];f[3*y]=Math.min(p.maxX,p.minX+2*p.errorX*x),f[3*y+1]=Math.min(p.maxY,p.minY+2*p.errorY*b),f[3*y+2]=Math.min(p.maxZ,p.minZ+2*p.errorZ*S),y++}}return{errorX:p.errorX,errorY:p.errorY,errorZ:p.errorZ,result:f}};var p={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};t.decodeRGB=function(e){var t=new DataView(e,0),i=0,o=n(e,t,i),a=o.identifier,l=o.version;if(i+=d.byteCount,"ClusterRGB"!==a)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var u=s(t,i);if(i+=p.byteCount,u.sizeHi*Math.pow(2,32)+u.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");if(2!==u.lookupMethod&&1!==u.lookupMethod||0!==u.compressionMethod){if(0===u.lookupMethod&&0===u.compressionMethod){if(3*u.count+i!==e.byteLength||0!==u.colorMapCount)throw new r("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(u.lookupMethod<=2&&1===u.compressionMethod){if(i+3!==e.byteLength||1!==u.colorMapCount)throw new r("lepcc-decode-error","Bad count");for(var c=t.getUint8(i),f=t.getUint8(i+1),h=t.getUint8(i+2),m=new Uint8Array(3*u.count),v=0;v<u.count;v++)m[3*v]=c,m[3*v+1]=f,m[3*v+2]=h;return m}throw new r("lepcc-decode-error","Bad method "+u.lookupMethod+","+u.compressionMethod)}if(3*u.colorMapCount+u.count+i!==e.byteLength||u.colorMapCount>256)throw new r("lepcc-decode-error","Bad count");var g=new Uint8Array(e,i,3*u.colorMapCount),y=new Uint8Array(e,i+3*u.colorMapCount,u.count);for(m=new Uint8Array(3*u.count),v=0;v<u.count;v++){var b=y[v];m[3*v]=g[3*b],m[3*v+1]=g[3*b+1],m[3*v+2]=g[3*b+2]}return m};var f={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};t.decodeIntensity=function(e){var t=new DataView(e,0),i=0,o=n(e,t,i),s=o.identifier,u=o.version;if(i+=d.byteCount,"Intensity "!==s)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var c=l(t,i);if(i+=f.byteCount,c.sizeHi*Math.pow(2,32)+c.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var p=new Uint16Array(c.count);if(8===c.bitsPerPoint){if(c.count+i!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(var h=new Uint8Array(e,i,c.count),m=0;m<c.count;m++)p[m]=h[m]*c.scaleFactor}else if(16===c.bitsPerPoint){if(2*c.count+i!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(h=new Uint16Array(e,i,c.count),m=0;m<c.count;m++)p[m]=h[m]*c.scaleFactor}else{if(a(e,i,h=[])!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(m=0;m<c.count;m++)p[m]=h[m]*c.scaleFactor}return p}}.apply(null,n))||(e.exports=i)},1450:function(e,t,r){var n;!function(t){function r(e){this._callbacks=[],this._errbacks=[],this._cancelCallback=e,this._iscancelled=!1,this._isdone=!1,this._iserr=!1}r.prototype.cancel=function(e){this._callbacks=[],this._errbacks=[],this._iscancelled=!0,this._cancelCallback&&this._cancelCallback(e)},r.prototype.then=function(e,t,r){var n;if(!this._iscancelled)return this._isdone?n=e.apply(r,this.result):this._iserr&&t?n=t.apply(r,this.result):(this._callbacks.push(function(){return e.apply(r,arguments)}),t&&this._errbacks.push(function(){return t.apply(r,arguments)})),n},r.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]},r.prototype.resolve=r.prototype.done,r.prototype.reject=function(){if(!this._iscancelled){this.result=arguments,this._iserr=!0;for(var e=0;e<this._errbacks.length;e++)this._errbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]}},r.prototype.isRejected=function(){return this._iserr},r.prototype.isFulfilled=function(){return this._isdone||this._iserr},r.prototype.isResolved=function(){return this._isdone},r.prototype.isCancelled=function(){return this._iscancelled};var i={Promise:r,join:function(e){function t(e,t){return function(){t&&(s=!0),o+=1,a[e]=Array.prototype.slice.call(arguments),o===i&&(s?n.reject():n.done(a))}}for(var n=new r,i=e.length,o=0,a=[],s=!1,l=0;l<i;l++)e[l].then(t(l,!1),t(l,!0));return 0===e.length&&n.done(),n},chain:function e(t,n){var i=new r;return 0===t.length?i.done.apply(i,n):t[0].apply(null,n).then(function(){t.splice(0,1),e(t,arguments).then(function(){i.done.apply(i,arguments)})}),i}};void 0===(n=function(){return i}.apply(null,[]))||(e.exports=n)}()},1451:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._listeners={}}return e.prototype.hasEventListener=function(e){return null!=this._listeners[e]&&this._listeners[e].size>0},e.prototype.on=function(e,t){var r=this;null==this._listeners[e]&&(this._listeners[e]=new Map);var n={};return this._listeners[e].set(n,t),{remove:function(){return r._listeners[e].delete(n)}}},e.prototype.emit=function(e,t){null!=this._listeners[e]&&this._listeners[e].forEach(function(e){return e(t)})},e}();t.Evented=r}.apply(null,n))||(e.exports=i)},1452:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(27),r(8),r(6),r(19),r(20),r(26),r(421),r(148),r(1352),r(74),r(1437)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p){function f(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function h(e,t){var r,n=t[0],i=t[1],o=t[2],a=t[3],s=0;n<e[0]&&(s+=(r=e[0]-n)*r);i<e[1]&&(s+=(r=e[1]-i)*r);o<e[2]&&(s+=(r=e[2]-o)*r);n>e[3]&&(s+=(r=n-e[3])*r);i>e[4]&&(s+=(r=i-e[4])*r);o>e[5]&&(s+=(r=o-e[5])*r);if(s>a*a)return 0;if(s>0)return 1;var l=1/0;return n-e[0]<l&&(l=n-e[0]),i-e[1]<l&&(l=i-e[1]),o-e[2]<l&&(l=o-e[2]),e[3]-n<l&&(l=e[3]-n),e[4]-i<l&&(l=e[4]-i),e[5]-o<l&&(l=e[5]-o),l>a?2:1}function m(e,t,r){for(var n=[],i=r&&r.missingFields,o=r&&r.originalFields,a=0,s=e;a<s.length;a++){for(var l=s[a],u=l.toLowerCase(),d=!1,c=0,p=t;c<p.length;c++){var f=p[c];if(u===f.name.toLowerCase()){n.push(f.name),d=!0,o&&o.push(l);break}}!d&&i&&i.push(l)}return n}function v(e,t,r){if(null!=e.maxRecordCount&&t.length>e.maxRecordCount){var o=function(e,t){for(var r=e.length,n=Math.ceil(r/t),i=[],o=0;o<n;o++){var a=Math.floor(r*o/n),s=Math.floor(r*(o+1)/n);i.push(e.slice(a,s))}return i}(t,e.maxRecordCount);return i.all(o.map(function(t){return v(e,t,r)})).then(b)}var a=new u({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return new l(e.parsedUrl.path).execute(a).then(function(e){return e&&e.features&&e.features.length===t.length?e.features.map(function(e){return e.attributes}):i.reject(new n("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function g(e,t,a,s,l){for(var u=[],c=0;c<t.attributeData.length;c++){var p=t.attributeData[c],f=e[c];if(f&&-1!==s.indexOf(f.name)){var h=o.makeAbsolute(p.href,t.baseUrl);u.push({url:h,storageInfo:f})}}return i.eachAlways(u.map(function(e){return r(e.url,{responseType:"array-buffer"}).then(function(t){return d.readBinaryAttribute(e.storageInfo,t.data)})})).then(function(e){var t=[];if(!l.ignoreUnavailableFields&&e.some(function(e){return null==e.value})){for(var r=[],o=0;o<e.length;o++)null==e[o].value&&r.push({name:u[o].storageInfo.name,error:e[o].error});return i.reject(new n("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:r}))}for(var s=0,d=a;s<d.length;s++){var c=d[s],p={};for(o=0;o<e.length;o++)null!=e[o].value&&(p[u[o].storageInfo.name]=y(e[o].value,c));t.push(p)}return t})}function y(e,t){var r=e[t];return e instanceof Int16Array?r===E?null:r:e instanceof Int32Array?r===A?null:r:r!=r?null:r}function b(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];t=t.concat(i)}return t}function _(e){var t=new a(f(e.store.indexCRS||e.store.geographicCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function x(e){var t=new a(f(e.store.vertexCRS||e.store.projectedCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function w(e,t,r){if(!s.canProject(e,t))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&e.isGeographic)throw new n("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{})}function S(e,t,r){var n=_(e),i=x(e);w(n,t,r),w(i,t,r)}function C(e){return"mesh-3d"===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.DDS_ENCODING_STRING="image/vnd-ms.dds",t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"],t.extractWkid=f,t.getAppropriateTextureEncoding=function(e,r){if(Array.isArray(e)){if(r){var n=e.indexOf(t.DDS_ENCODING_STRING);if(n>-1)return n}for(var i=0;i<e.length;i++)if(t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(e[i])>-1)return i;throw new Error("Could not find appropriate texture encoding (among "+e.toString()+")")}return-1},t.findIntersectingNodes=function e(t,r,n,i,o,a){if(null!=n){var s=n.mbs;if(r!==i&&(s=D,c.mbsToMbs(n.mbs,i,s,r)),0!==h(t,s)&&(a(n),n.children))for(var l=0;l<n.children.length;++l)e(t,r,o[n.children[l].id],i,o,a)}},t.buildTopNodeMap=function(e,t,r,n){if(void 0===n&&(n=Number.POSITIVE_INFINITY),t<=0)e.clear();else{var i=new Map,o=Number.POSITIVE_INFINITY;e.forEach(function(a,s){var l=r(a);if(s<t)return o=Math.min(o,l),void i.set(a.id,l);if(!(l<=o||l>=n)){i.set(a.id,l);for(var u=o=i.get(e.front().id),d=0,c=1;c<t;++c){var p=e.data[c],f=i.get(p.id);f<o&&(d=c,u=o,o=f)}e.data[d]=a,o=u}}),e.length=Math.min(e.length,t),e.sort(function(e,t){return i.get(t.id)-i.get(e.id)})}};var D=[0,0,0,0];t.intersectBoundingBoxWithMbs=h,t.findFieldsCaseInsensitive=m,t.whenGraphicAttributes=function(e,t,r,o,a,s){var l=!0===(s&&s.populateObjectId),u=s.ignoreUnavailableFields?void 0:[],d=1===o.length&&"*"===o[0];!d&&l&&(o=function(e,t){return e.filter(function(e){return e.toLowerCase()!==t.toLowerCase()}).concat([t])}(o,r));var c=d?o:m(o,e.fields,{missingFields:u});if(u&&0!==u.length)return i.reject(new n("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:u}));if(0===t.length)return i.resolve(t);var p=e.associatedLayer,f=e.attributeStorageInfo,h=d?e.fields.map(function(e){return e.name}):c;if(p)return function(e,t,r,n){t.sort(function(e,t){return e.attributes[r]-t.attributes[r]});var i=t.map(function(e){return e.attributes[r]}),o=[],a=m(n,e.fields,{originalFields:o});return v(e,i,a).then(function(e){for(var r=0;r<t.length;r++){var n=t[r],i=e[r];n.attributes={};for(var s=0;s<o.length;s++)n.attributes[o[s]]=i[a[s]]}return t})}(p,t,r,h);var y=function(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];o in t.attributes||r.push(o)}return r}(h,t[0]);if(0===y.length)return i.resolve(t);if(f){var b=a();return null==b?i.reject(new n("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):g(f,b.node,b.indices,y,s).then(function(e){for(var r=0;r<t.length;r++){for(var n=0,i=h;n<i.length;n++){var o=i[n];o in e[r]||(e[r][o]=t[r].attributes[o])}t[r].attributes=e[r]}return t})}return i.reject(new n("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var E=-Math.pow(2,15),A=-Math.pow(2,31);t.getCachedAttributeValue=y,t.convertFlatRangesToOffsets=function(e,t,r){void 0===r&&(r=2);for(var i=null!=t?t:e.length/r,o=new Uint32Array(i+1),a=0;a<i;a++){var s=e[a*r],l=3*s;o[a]=l;var u=(a-1)*r+1;if(u>=0&&s-1!==e[u])throw new n("Face ranges are not continuous")}var d=3*(e[(i-1)*r+1]+1);return o[o.length-1]=d,o},t.getIndexCrs=_,t.getVertexCrs=x,t.getCacheKeySuffix=function(e,t){return t===c.SphericalECEFSpatialReference?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null},t.checkSpatialReference=w,t.checkSpatialReferences=S,t.checkSceneLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{})},t.checkSceneLayerCompatibleWithView=function(e,t){S(e,t.spatialReference,t.viewingMode)},t.checkPointCloudLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})},t.checkPointCloudLayerCompatibleWithView=function(e,t){w(e.spatialReference,t.spatialReference,t.viewingMode)},t.encodeSymbolColor=p.encodeSymbolColor,t.rendererNeedsTextures=function(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;var t=e.getSymbols();if(0===t.length)return!0;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(!C(i)||0===i.symbolLayers.length)return!0;for(var o=0,a=i.symbolLayers.items;o<a.length;o++){var s=a[o];if("fill"!==s.type||null==s.material||"replace"!==s.material.colorMixMode)return!0}}return!1}}.apply(null,n))||(e.exports=i)},1453:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(82),r(114),r(1492),r(1493),r(1482),r(1494)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function u(e,t,r){if(!e)return null;if(e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type)return r&&r.messages&&r.messages.push(new i("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null;var n=function(e){return e&&c[e.type]||null}(e);if(n){var o=new n;return o.read(e,r),o}return r&&r.messages&&e&&r.messages.push(new i("renderer:unsupported","Renderers of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:r})),null}function d(e,t,n){return e?n&&"web-scene"===n.origin&&"heatmap"===e.type?(n.messages&&n.messages.push(new r("renderer:unsupported","Renderer of type '"+e.declaredClass+"' are not supported in scenes.",{renderer:e,context:n})),null):e.write(t,n):null}Object.defineProperty(t,"__esModule",{value:!0});var c={simple:s,uniqueValue:l,classBreaks:o,heatmap:a};t.read=u,t.writeTarget=function(e,t,r,i){var o=d(e,{},i);o&&n.setDeepValue(r,o,t)},t.write=d,t.fromJSON=function(e,t){return u(e,0,t)}}.apply(null,n))||(e.exports=i)},1461:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(40)],void 0===(i=function(e,t,r){function n(e,t,n,i,o,s,l,u,d,c,p){return function(e,t,n){for(var i=r.vec3d.dist2(e.maxVert[0],e.minVert[0]),o=0,a=1;a<7;++a){var s=r.vec3d.dist2(e.maxVert[a],e.minVert[a]);s>i&&(i=s,o=a)}r.vec3d.set(e.minVert[o],t),r.vec3d.set(e.maxVert[o],n)}(e,i,o),r.vec3d.dist2(i,o)<f?1:(r.vec3d.subtract(i,o,l),r.vec3d.normalize(l),function(e,t,n,i){for(var o=e.data,a=e.offsetIdx,s=e.strideIdx,l=Number.NEGATIVE_INFINITY,u=0,d=a;d<o.length;d+=s){r.vec3d.set3(o[d]-t[0],o[d+1]-t[1],o[d+2]-t[2],C);var c=n[0]*C[0]+n[1]*C[1]+n[2]*C[2],p=r.vec3d.length2(n),f=r.vec3d.length2(C)-c*c/p;f>l&&(l=f,u=d)}return r.vec3d.set3(o[u],o[u+1],o[u+2],i),l}(t,i,l,s)<f?2:(r.vec3d.subtract(o,s,u),r.vec3d.normalize(u),r.vec3d.subtract(s,i,d),r.vec3d.normalize(d),r.vec3d.cross(u,l,n),r.vec3d.normalize(n),a(t,n,l,u,d,c),0))}function i(e,t,n,i,s,l,u,d,c,p){o(e,t,n,i,s,v,g),void 0!==v[0]&&(r.vec3d.subtract(v,n,y),r.vec3d.normalize(y),r.vec3d.subtract(v,i,b),r.vec3d.normalize(b),r.vec3d.subtract(v,s,_),r.vec3d.normalize(_),r.vec3d.cross(b,l,x),r.vec3d.normalize(x),r.vec3d.cross(_,u,w),r.vec3d.normalize(w),r.vec3d.cross(y,d,S),r.vec3d.normalize(S),a(e,x,l,b,y,c),a(e,w,u,_,b,c),a(e,S,d,y,_,c)),void 0!==g[0]&&(r.vec3d.subtract(g,n,y),r.vec3d.normalize(y),r.vec3d.subtract(g,i,b),r.vec3d.normalize(b),r.vec3d.subtract(g,s,_),r.vec3d.normalize(_),r.vec3d.cross(b,l,x),r.vec3d.normalize(x),r.vec3d.cross(_,u,w),r.vec3d.normalize(w),r.vec3d.cross(y,d,S),r.vec3d.normalize(S),a(e,x,l,b,y,c),a(e,w,u,_,b,c),a(e,S,d,y,_,c))}function o(e,t,n,i,o,a,s){!function(e,t,n,i,o){var a=e.data,s=e.offsetIdx,l=e.strideIdx;r.vec3d.set3(a[s],a[s+1],a[s+2],i),r.vec3d.set(i,o),n[0]=r.vec3d.dot(P,t),n[1]=n[0];for(var u=s+l;u<a.length;u+=l){r.vec3d.set3(a[u],a[u+1],a[u+2],P);var d=r.vec3d.dot(P,t);d<n[0]&&(n[0]=d,r.vec3d.set(P,i)),d>n[1]&&(n[1]=d,r.vec3d.set(P,o))}}(e,t,D,s,a);var l=r.vec3.dot(n,t);D[1]-f<=l&&(a[0]=void 0),D[0]+f>=l&&(s[0]=void 0)}function a(e,t,n,i,o,a){if(!(r.vec3d.length2(t)<f)){r.vec3d.cross(n,t,E),r.vec3d.cross(i,t,A),r.vec3d.cross(o,t,T),s(e,t,D),I[1]=D[0],O[1]=D[1],R[1]=O[1]-I[1];for(var l=[n,i,o],u=[E,A,T],d=0;d<3;++d){s(e,l[d],D),I[0]=D[0],O[0]=D[1],s(e,u[d],D),I[2]=D[0],O[2]=D[1],R[0]=O[0]-I[0],R[2]=O[2]-I[2];var c=p(R);c<a.quality&&(r.vec3d.set(l[d],a.b0),r.vec3d.set(t,a.b1),r.vec3d.set(u[d],a.b2),a.quality=c)}}}function s(e,t,r){var n=e.data,i=e.offsetIdx,o=e.strideIdx;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(var a=i;a<n.length;a+=o){var s=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)}}function l(e,t,n){r.vec3d.set(e,n.center),r.vec3d.scale(t,.5,n.halfSize),r.quat4.identity(n.quaternion)}function u(e,t,n){r.vec3d.set(t,M),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?M[0]=0:Math.abs(t[1])>Math.abs(t[2])?M[1]=0:M[2]=0,r.vec3d.length2(M)<f&&(M[0]=M[1]=M[2]=1),r.vec3d.cross(t,M,L),r.vec3d.normalize(L),r.vec3d.cross(t,L,N),r.vec3d.normalize(N),d(e,t,L,N,F,U),r.vec3d.subtract(U,F,V),c(t,L,N,F,U,V,n)}function d(e,t,r,n,i,o){s(e,t,D),i[0]=D[0],o[0]=D[1],s(e,r,D),i[1]=D[0],o[1]=D[1],s(e,n,D),i[2]=D[0],o[2]=D[1]}function c(e,t,n,i,o,a,s){k[0]=e[0],k[3]=e[1],k[6]=e[2],k[1]=t[0],k[4]=t[1],k[7]=t[2],k[2]=n[0],k[5]=n[1],k[8]=n[2],r.quat4.fromRotationMatrix(k,s.quaternion),r.vec3d.add(i,o,z),r.vec3d.scale(z,.5),r.vec3d.scale(e,z[0],s.center),r.vec3d.scale(t,z[1],j),r.vec3d.add(s.center,j),r.vec3d.scale(n,z[2],j),r.vec3d.add(s.center,j),r.vec3d.scale(a,.5,s.halfSize)}function p(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}Object.defineProperty(t,"__esModule",{value:!0});var f=1e-6,h=r.vec3d.create(),m=r.vec3d.create();t.computeOBB=function(e,t){var o=e.data,a=e.strideIdx,s=o.length/a;if(!(s<=0)){var f=new B(e);r.vec3d.add(f.minProj,f.maxProj,h),r.vec3d.scale(h,.5),r.vec3d.subtract(f.maxProj,f.minProj,m);var v=p(m),g=new G;g.quality=v,s<14&&(e={data:new Float64Array(f.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var y=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),x=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),C=r.vec3d.create();switch(n(f,e,C,y,b,_,x,w,S,g)){case 1:return void l(h,m,t);case 2:return void u(e,x,t)}i(e,C,y,b,_,x,w,S,g),d(e,g.b0,g.b1,g.b2,F,U);var D=r.vec3d.create();r.vec3d.subtract(U,F,D),g.quality=p(D),g.quality<v?c(g.b0,g.b1,g.b2,F,U,D,t):l(h,m,t)}};var v=r.vec3d.create(),g=r.vec3d.create(),y=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),x=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),C=r.vec3d.create(),D=r.vec2d.create(),E=r.vec3d.create(),A=r.vec3d.create(),T=r.vec3d.create(),O=r.vec3d.create(),I=r.vec3d.create(),R=r.vec3d.create(),P=r.vec3d.create(),M=r.vec3d.create(),L=r.vec3d.create(),N=r.vec3d.create(),F=r.vec3d.create(),U=r.vec3d.create(),V=r.vec3d.create(),j=r.vec3d.create(),k=r.mat3d.create(),z=r.vec3d.create(),B=function(){return function(e){this.minVert=[],this.maxVert=[],this.buffer=new ArrayBuffer(448);var t=0;for(this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;this.minVert.length<7;)this.minVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(;this.maxVert.length<7;)this.maxVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(var n=0;n<7;++n)this.minProj[n]=Number.POSITIVE_INFINITY,this.maxProj[n]=Number.NEGATIVE_INFINITY;var i=[],o=[],a=e.data,s=e.offsetIdx,l=e.strideIdx;for(n=s;n<a.length;n+=l){var u=a[n];u<this.minProj[0]&&(this.minProj[0]=u,i[0]=n),u>this.maxProj[0]&&(this.maxProj[0]=u,o[0]=n),(u=a[n+1])<this.minProj[1]&&(this.minProj[1]=u,i[1]=n),u>this.maxProj[1]&&(this.maxProj[1]=u,o[1]=n),(u=a[n+2])<this.minProj[2]&&(this.minProj[2]=u,i[2]=n),u>this.maxProj[2]&&(this.maxProj[2]=u,o[2]=n),(u=a[n]+a[n+1]+a[n+2])<this.minProj[3]&&(this.minProj[3]=u,i[3]=n),u>this.maxProj[3]&&(this.maxProj[3]=u,o[3]=n),(u=a[n]+a[n+1]-a[n+2])<this.minProj[4]&&(this.minProj[4]=u,i[4]=n),u>this.maxProj[4]&&(this.maxProj[4]=u,o[4]=n),(u=a[n]-a[n+1]+a[n+2])<this.minProj[5]&&(this.minProj[5]=u,i[5]=n),u>this.maxProj[5]&&(this.maxProj[5]=u,o[5]=n),(u=a[n]-a[n+1]-a[n+2])<this.minProj[6]&&(this.minProj[6]=u,i[6]=n),u>this.maxProj[6]&&(this.maxProj[6]=u,o[6]=n)}for(n=0;n<7;++n){var d=i[n];r.vec3d.set3(a[d],a[d+1],a[d+2],this.minVert[n]),d=o[n],r.vec3d.set3(a[d],a[d+1],a[d+2],this.maxVert[n])}}}(),G=function(){return function(){this.b0=r.vec3d.createFrom(1,0,0),this.b1=r.vec3d.createFrom(0,1,0),this.b2=r.vec3d.createFrom(0,0,1),this.quality=0}}()}.apply(null,n))||(e.exports=i)},1467:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1278),r(1277)],void 0===(i=function(e,t,r,n){var i=r.vec3d;return function(){function e(e,t,r,o){n.assert(e.length>=1),n.assert(r.length%t==0),n.assert(r.length>=e.length*t),n.assert(3===o.size||4===o.size),this.primitiveIndices=e,this.indices=r,this._position=o,this._numIndexPerPrimitive=t;var a=o.data,s=o.offsetIdx,l=o.strideIdx,u=e.length,d=s+l*r[t*e[0]];this.bbMin=i.createFrom(a[d],a[d+1],a[d+2]),this.bbMax=i.create(this.bbMin);for(var c=0;c<u;++c)for(var p=t*e[c],f=0;f<t;++f){var h=s+l*r[p+f];this.bbMin[0]=Math.min(a[h],this.bbMin[0]),this.bbMax[0]=Math.max(a[h],this.bbMax[0]),++h,this.bbMin[1]=Math.min(a[h],this.bbMin[1]),this.bbMax[1]=Math.max(a[h],this.bbMax[1]),++h,this.bbMin[2]=Math.min(a[h],this.bbMin[2]),this.bbMax[2]=Math.max(a[h],this.bbMax[2])}this.center=i.create(),i.lerp(this.bbMin,this.bbMax,.5,this.center),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var m=this.bsRadius*this.bsRadius;for(c=0;c<u;++c)for(p=t*e[c],f=0;f<t;++f){var v=a[h=s+l*r[p+f]]-this.center[0],g=a[h+1]-this.center[1],y=a[h+2]-this.center[2],b=v*v+g*g+y*y;if(!(b<=m)){var _=Math.sqrt(b),x=.5*(_-this.bsRadius);this.bsRadius=this.bsRadius+x,m=this.bsRadius*this.bsRadius;var w=x/_;this.center[0]+=v*w,this.center[1]+=g*w,this.center[2]+=y*w}}}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this.children)return this.children;if(i.dist2(this.bbMin,this.bbMax)>1){for(var t=i.lerp(this.bbMin,this.bbMax,.5,i.create()),r=this.primitiveIndices.length,n=new Uint8Array(r),o=new Array(8),a=0;a<8;++a)o[a]=0;var s=this._position,l=s.data,u=s.offsetIdx,d=s.strideIdx;for(a=0;a<r;++a){for(var c=0,p=this._numIndexPerPrimitive*this.primitiveIndices[a],f=u+d*this.indices[p],h=l[f],m=l[f+1],v=l[f+2],g=1;g<this._numIndexPerPrimitive;++g){var y=l[f=u+d*this.indices[p+g]],b=l[f+1],_=l[f+2];y<h&&(h=y),b<m&&(m=b),_<v&&(v=_)}h<t[0]&&(c|=1),m<t[1]&&(c|=2),v<t[2]&&(c|=4),n[a]=c,++o[c]}var x=0;for(a=0;a<8;++a)o[a]>0&&++x;if(x<2)return;var w=new Array(8);for(a=0;a<8;++a)w[a]=o[a]>0?new Uint32Array(o[a]):void 0;for(a=0;a<8;++a)o[a]=0;for(a=0;a<r;++a){w[c=n[a]][o[c]++]=this.primitiveIndices[a]}this.children=new Array(8);for(a=0;a<8;++a)void 0!==w[a]&&(this.children[a]=new e(w[a],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},e}()}.apply(null,n))||(e.exports=i)},1469:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(407),r(1278),r(1294),r(1296),r(1439)],void 0===(i=function(e,t,r,n,i,o,a){var s=n.vec3d;return function(){function e(t,r,n){this._parentStages=[],this._children=new Set,this.id=e._idGen.gen(n),this.name=t,r=r||{},this.group=r.group||"",this.isPickable=null==r.isPickable||r.isPickable,this.translation=s.create(r.translation),this._extent=[s.createFrom(0,0,0),s.createFrom(1e3,1e3,1e3)],this._extentDirty=!0}return e.prototype.getParentStages=function(){return this._parentStages},e.prototype.addParentStage=function(e){-1===this._parentStages.indexOf(e)&&this._parentStages.push(e)},e.prototype.removeParentStage=function(e){var t=this._parentStages.indexOf(e);t>-1&&this._parentStages.splice(t,1)},e.prototype.getName=function(){return this.name},e.prototype.getGroup=function(){return this.group},e.prototype.getTranslation=function(){return this.translation},e.prototype.getObjectIds=function(){return r.keysOfSet(this._children,function(e){return e.id})},e.prototype.getObjects=function(){return r.keysOfSet(this._children)},e.prototype.getExtent=function(){return this._updateExtent(),this._extent},e.prototype.addObject=function(e){this._children.add(e),e.addParentLayer(this),this.notifyDirty("layObjectAdded",e),this._invalidateExtent(),this._octree&&this._octree.add(e)},e.prototype.hasObject=function(e){return this._children.has(e)},e.prototype.removeObject=function(e){return!!this._children.delete(e)&&(e.removeParentLayer(this),this.notifyDirty("layObjectRemoved",e),this._invalidateExtent(),this._octree&&this._octree.remove(e),!0)},e.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},e.prototype.getCenter=function(){this._updateExtent();var e=s.create();return s.lerp(this._extent[0],this._extent[1],.5,e)},e.prototype.getBSRadius=function(){return this._updateExtent(),.5*s.dist(this._extent[0],this._extent[1])},e.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._children.size>50&&this._createOctree(),this._octree},e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null},e.prototype.notifyDirty=function(e,t,r,n){r=r||o.LAYER;for(var i=n||this,a=0;a<this._parentStages.length;a++)this._parentStages[a].notifyDirty(r,i,e,t)},e.prototype._createOctree=function(){for(var e=this.getExtent(),t=0,n=0;n<3;n++)t=Math.max(t,e[1][n]-e[0][n]);var i=s.create();s.lerp(e[0],e[1],.5,i),this._octree=new a(i,1.2*t,{getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._children))},e.prototype._invalidateExtent=function(){this._extentDirty=!0},e.prototype._updateExtent=function(){var e=this;if(this._extentDirty){if(this._extentDirty=!1,0===this._children.size)return void(this._extent=[[0,0,0],[0,0,0]]);var t=null;this._children.forEach(function(r){var n=r.getBBMin(),i=r.getBBMax();if(t)for(var o=0;o<3;++o)e._extent[0][o]=Math.min(e._extent[0][o],n[o]),e._extent[1][o]=Math.max(e._extent[1][o],i[o]);else t=[s.create(n),s.create(i)]}),this._extent=t}},e._idGen=new i,e}()}.apply(null,n))||(e.exports=i)},1470:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:r,renderGeometry:e,renderer:t})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.renderer.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,n))||(e.exports=i)},1471:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),n=0,i=Object.keys(e);n<i.length;n++){var o=i[n];if(o.toLowerCase()===r)return e[o]}return null}}.apply(null,n))||(e.exports=i)},1475:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1492),r(1493),r(1432),r(1482),r(1494),r(1453)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.ClassBreaksRenderer=r,t.HeatmapRenderer=n,t.BaseRenderer=i,t.SimpleRenderer=o,t.UniqueValueRenderer=a,t.isRenderer=function(e){return e instanceof t.BaseRenderer},t.fromJSON=s.fromJSON}.apply(null,n))||(e.exports=i)},1476:function(e,t,r){var n,i;n=[r(216),r(12),r(5),r(24),r(156),r(1549),r(1496),r(1514),r(151),r(97),r(150),r(204)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){function p(e){var t=l.createSyntaxTree(e),r=t&&t.body&&t.body[0]&&t.body[0].body&&t.body[0].body.body;if(!r||1!==r.length)return null;var n="ExpressionStatement"===r[0].type&&r[0].expression;if(!n||"MemberExpression"!==n.type)return null;var i=n.object;if(!i||"Identifier"!==i.type||"$feature"!==i.name)return null;var o=n.property;if(!o)return null;switch(o.type){case"Literal":return o.value;case"Identifier":return o.name}return null}function f(e){return!e||"service"!==e.origin&&(!e.layer||!s.isOfType(e.layer,"map-image"))}var h=n({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"}),m=new u,v=t.createSubclass({declaredClass:"esri.layers.support.LabelClass",properties:{name:{type:String,value:null,json:{write:!0}},labelExpression:{type:String,value:null,json:{read:function(e,t,r,n){var i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e},write:{allowNull:!0,writer:function(e,t,r,n){if(this.labelExpressionInfo&&f(n))if(null!=this.labelExpressionInfo.value)e=this._templateStringToSql(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){var i=p(this.labelExpressionInfo.expression);i&&(e="["+i+"]")}null!=e&&(t[r]=e)}}}},labelExpressionInfo:{value:null,type:o,json:{write:{overridePolicy:function(e,t,r){return f(r)?{allowNull:!0}:{enabled:!1}},writer:function(e,t,r,n){if(null==e&&null!=this.labelExpression&&f(n))e=new o({expression:this.getLabelExpressionArcade()});else if(!e)return;var i=e.toJSON(n);i.expression&&(t[r]=i)}}}},labelPlacement:{type:String,value:null,json:{read:function(e,t){return h.fromJSON(e)},write:function(e,t){var r=h.toJSON(e);r&&(t.labelPlacement=r)}}},maxScale:{type:Number,value:0,json:{write:function(e,t){(e||this.minScale)&&(t.maxScale=e)}}},minScale:{type:Number,value:0,json:{write:function(e,t){(e||this.maxScale)&&(t.minScale=e)}}},requiredFields:{readOnly:!0,dependsOn:["labelExpression","labelExpressionInfo","where"],get:function(){var e=Object.create(null);return this._collectRequiredFields(e),Object.keys(e)}},symbol:{value:null,types:c.labelTypes,json:{origins:{"web-scene":{read:d.read,write:{target:{symbol:{types:c.labelTypes3D}},writer:d.writeTarget}}},read:d.read,write:d.writeTarget}},useCodedValues:{type:Boolean,value:null,json:{write:!0}},where:{type:String,value:null,json:{write:!0}}},getLabelExpression:function(){var e={expression:"",type:"none"};return this.labelExpressionInfo?this.labelExpressionInfo.value?(e.expression=this.labelExpressionInfo.value,e.type="conventional"):this.labelExpressionInfo.expression&&(e.expression=this.labelExpressionInfo.expression,e.type="arcade"):null!=this.labelExpression&&(e.expression=this._sqlToTemplateString(this.labelExpression),e.type="conventional"),e},getLabelExpressionArcade:function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return a.convertTemplatedStringToArcade(e.expression);case"arcade":return e.expression}return null},getOptions:function(e){var t={spatialReference:e},r=this.labelExpressionInfo;if(r){var n=r.expression;n&&!r.value&&(t.hasArcadeExpression=!0,t.compiledArcadeFunc=l.createFunction(n))}return t},getLabelExpressionSingleField:function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return function(e){var t=e.match(g);return t&&t[1].trim()||null}(e.expression);case"arcade":return p(e.expression)}return null},clone:function(){return new v({labelExpression:this.labelExpression,labelExpressionInfo:r.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:this.symbol.clone(),where:this.where,useCodedValues:this.useCodedValues})},_collectRequiredFields:function(e){this._collectLabelExpressionRequiredFields(this.getLabelExpression(),e),this._collectWhereRequiredFields(this.where,e)},_sqlToTemplateString:function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")},_templateStringToSql:function(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")},_collectWhereRequiredFields:function(e,t){if(null!=e){var r=e.split(" ");3===r.length&&(t[r[0]]=!0),7===r.length&&(t[r[0]]=!0,t[r[4]]=!0)}},_collectLabelExpressionRequiredFields:function(e,t){if("arcade"===e.type)l.extractFieldNames(e.expression).forEach(function(e){t[e]=!0});else{var r=e.expression.match(/{[^}]*}/g);r&&r.forEach(function(e){t[e.slice(1,-1)]=!0})}}});v.evaluateWhere=function(e,t){var r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;var n=e.split(" ");if(3===n.length)return r(t[n[0]],n[1],n[2]);if(7===n.length){var i=r(t[n[0]],n[1],n[2]),o=n[3],a=r(t[n[4]],n[5],n[6]);switch(o){case"AND":return i&&a;case"OR":return i||a}}return!1}catch(t){console.log("Error.: can't parse = "+e)}},v.buildLabelText=function(e,t,r,n){var i="";if(n&&n.hasArcadeExpression){if(n.compiledArcadeFunc){m.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:r});var o={vars:{$feature:m},spatialReference:n.spatialReference},a=l.executeFunction(n.compiledArcadeFunc,o);null!=a&&(i=a.toString())}}else{var s=t&&t.attributes||{};i=e.replace(/{[^}]*}/g,function(e){return v.formatField(e.slice(1,-1),e,s,r,n)})}return i},v.formatField=function(t,n,o,a,s){var l,u,d=n,c=t.toLowerCase();for(l=0;l<a.length;l++)if(a[l].name.toLowerCase()===c){d=o[a[l].name];var p=a[l].domain;if(p&&"object"==typeof p){if("codedValue"==p.type)for(u=0;u<p.codedValues.length;u++)p.codedValues[u].code==d&&(d=p.codedValues[u].name);else"range"==p.type&&p.minValue<=d&&d<=p.maxValue&&(d=p.name);return null==d?"":d}var f=a[l].type;if("date"==f){var h=e.fromJSON(s&&s.dateFormat||"shortDate"),m="DateFormat"+e.getFormat(h);m&&(d=r.substitute({myKey:d},"{myKey:"+m+"}"))}else"integer"!=f&&"small-integer"!=f&&"long"!=f&&"double"!=f||s&&s.numberFormat&&s.numberFormat.digitSeparator&&s.numberFormat.places&&(d=i.format(d,{places:s.numberFormat.places}))}return null==d?"":d};var g=/^\s*\{([^}]+)\}\s*$/i;return v}.apply(null,n))||(e.exports=i)},1480:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1359),r(1341)],void 0===(i=function(e,t,r,n){return function(){function e(e){e?this.set(e):this.setDefaults()}return Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0}),e.prototype.setUnit=function(e){this._unit=e,this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)},e.prototype.setDefaults=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this.featureExpressionInfoContext=null,this.hasOffsetAdjustment=!1,this.setUnit("meters")},e.prototype.set=function(e){this.mode=e.mode,this._meterUnitOffset=e._meterUnitOffset||0,this._renderUnitOffset=e._renderUnitOffset||0,this.featureExpressionInfoContext=e.featureExpressionInfoContext,this.hasOffsetAdjustment=e.hasOffsetAdjustment,this.setUnit(e.unit)},e.prototype.setOffsetMeters=function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},e.prototype.setOffsetElevationInfoUnits=function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},e.prototype.setOffsetRenderUnits=function(e){this._meterUnitOffset=0,this._renderUnitOffset=e},e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.mixinApi=function(e){null!=e.mode&&(this.mode=e.mode),null!=e.unit&&this.setUnit(e.unit),null!=e.offset&&this.setOffsetElevationInfoUnits(e.offset)},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=n.execute(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e}()}.apply(null,n))||(e.exports=i)},1482:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(5),r(1),r(1432),r(150),r(204)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.description=null,t.label=null,t.symbol=null,t.type="simple",t}var a;return r(t,e),a=t,t.prototype.writeSymbolWebScene=function(e,t,r,n){s.writeTarget(e,t,r,n)},t.prototype.writeSymbol=function(e,t,r,n){s.writeTarget(e,t,r,n)},t.prototype.readSymbol=function(e,t,r){return s.read(e,t,r)},t.prototype.getSymbol=function(e,t){return this.symbol},t.prototype.getSymbols=function(){return this.symbol?[this.symbol]:[]},t.prototype.clone=function(){return new a({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:i.clone(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},n([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),n([o.property({types:l.rendererTypes})],t.prototype,"symbol",void 0),n([o.writer("web-scene","symbol",{symbol:{types:l.rendererTypes3D}})],t.prototype,"writeSymbolWebScene",null),n([o.writer("symbol")],t.prototype,"writeSymbol",null),n([o.reader("symbol")],t.prototype,"readSymbol",null),a=n([o.subclass("esri.renderers.SimpleRenderer")],t)}(o.declared(a))}.apply(null,n))||(e.exports=i)},1483:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(6),r(114)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.loadStyleRenderer=function(e,t){var i=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);return i&&"unique-value"===i.type&&i.styleOrigin?i.populateFromStyle().catch(function(r){t&&t.messages&&t.messages.push(new n("renderer:style-reference","Failed to create unique value renderer from style reference: "+r.message,{error:r,context:t})),e.clear("renderer",t.origin)}).then(function(){return null}):r.resolve(null)}}.apply(null,n))||(e.exports=i)},1492:function(e,t,r){var n,i;n=[r(35),r(5),r(24),r(8),r(7),r(38),r(151),r(62),r(119),r(150),r(204),r(1432),r(1427),r(1642)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f){var h=i.getLogger("esri.renderers.ClassBreaksRenderer");p=p.LegendOptions,f=f.ClassBreakInfo;var m=r({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),v=o.ensureType(f),g=e(c,{declaredClass:"esri.renderers.ClassBreaksRenderer",properties:{backgroundFillSymbol:{types:{base:s,key:"type",typeMap:{"simple-fill":d.types.typeMap["simple-fill"],"picture-fill":d.types.typeMap["picture-fill"],"polygon-3d":d.types.typeMap["polygon-3d"]}},value:null,json:{origins:{"web-scene":{read:u.read,write:{target:{backgroundFillSymbol:{type:l}},writer:u.writeTarget}}},read:u.read,write:u.writeTarget}},classBreakInfos:{type:[f],json:{read:function(e,t,r){if(Array.isArray(e)){var n=t.minValue;return e.map(function(e){var t=new f;return t.read(e,r),null==t.minValue&&(t.minValue=n),null==t.maxValue&&(t.maxValue=t.minValue),n=t.maxValue,t})}},write:function(e,t,r,n){e=e.map(function(e){return e.write({},n)}),this._areClassBreaksConsecutive()&&e.forEach(function(e){delete e.classMinValue}),t[r]=e}}},minValue:{type:Number,readOnly:!0,dependsOn:["classBreakInfos"],get:function(){return this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0},json:{read:!1,write:{overridePolicy:function(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}},defaultLabel:{type:String,value:null,json:{write:!0}},defaultSymbol:{types:d.rendererTypes,value:null,json:{origins:{"web-scene":{read:u.read,write:{target:{defaultSymbol:{types:d.rendererTypes3D}},writer:u.writeTarget}}},read:u.read,write:u.writeTarget}},valueExpression:{type:String,value:null,json:{write:!0}},valueExpressionTitle:{type:String,value:null,json:{write:!0}},compiledFunc:{dependsOn:["valueExpression"],get:function(){return a.createFunction(this.valueExpression)}},legendOptions:{type:p,value:null,json:{write:!0}},field:{value:null,cast:function(e){return null==e?e:"function"==typeof e?e:o.ensureString(e)},json:{type:String,write:function(e,t,r,i){"string"==typeof e?t[r]=e:i&&i.messages?i.messages.push(new n("property:unsupported","ClassBreaksRenderer.field set to a function cannot be written to JSON")):h.error(".field: cannot write field to JSON since it's not a string value")}}},isMaxInclusive:!0,normalizationField:{type:String,value:null,json:{write:!0}},normalizationTotal:{type:Number,value:null,json:{write:!0}},normalizationType:{type:String,value:null,dependsOn:["normalizationField","normalizationTotal"],get:function(){var e=this._get("normalizationType"),t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t?"field":r&&"percent-of-total",t&&r&&console.warn("warning: both normalizationField and normalizationTotal are set!")):"field"!==e&&"percent-of-total"!==e||(e=null),e},json:{read:m.fromJSON,write:function(e,t){var r=m.toJSON(e);r&&(t.normalizationType=r)}}},requiredFields:{dependsOn:["field","normalizationField","valueExpression"]},type:{value:"class-breaks",json:{write:function(e,t){t.type="classBreaks"}}}},constructor:function(){this.classBreakInfos=[]},addClassBreakInfo:function(e,r,n){var i;i="number"==typeof e?new f({minValue:e,maxValue:r,symbol:n}):v(t.clone(e)),this.classBreakInfos.push(i),1===this.classBreakInfos.length&&this.notifyChange("minValue")},removeClassBreakInfo:function(e,t){var r,n,i=this.classBreakInfos.length;for(n=0;n<i;n++)if((r=[this.classBreakInfos[n].minValue,this.classBreakInfos[n].maxValue])[0]==e&&r[1]==t){this.classBreakInfos.splice(n,1);break}},getBreakIndex:function(e,t){var r,n,i,o=this.field,s=e.attributes,l=this.classBreakInfos.length,u=this.isMaxInclusive;if(this.valueExpression)r=a.executeFunction(this.compiledFunc,a.createExecContext(e,a.getViewInfo(t)));else if("function"==typeof o)r=o(e);else{r=parseFloat(s[o]);var d,c,p=this.normalizationType;if(p)if(d=parseFloat(this.normalizationTotal),c=parseFloat(s[this.normalizationField]),"log"===p)r=Math.log(r)*Math.LOG10E;else if("percent-of-total"!==p||isNaN(d)){if("field"===p&&!isNaN(c)){if(isNaN(r)||isNaN(c))return-1;r/=c}}else r=r/d*100}if(null!=r&&!isNaN(r)&&"number"==typeof r)for(n=0;n<l;n++)if((i=[this.classBreakInfos[n].minValue,this.classBreakInfos[n].maxValue])[0]<=r&&(u?r<=i[1]:r<i[1]))return n;return-1},getClassBreakInfo:function(e,t){var r=this.getBreakIndex(e,t);return-1!==r?this.classBreakInfos[r]:null},getSymbol:function(e,t){var r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol},getSymbols:function(){var e=[];return this.classBreakInfos.forEach(function(t){t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e},clone:function(){return new g({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:t.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:t.clone(this.visualVariables),legendOptions:t.clone(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},collectRequiredFields:function(e){this.inherited(arguments),[this.field,this.normalizationField].forEach(function(t){t&&(e[t]=!0)}),this.valueExpression&&a.extractFieldNames(this.valueExpression).forEach(function(t){e[t]=!0})},_areClassBreaksConsecutive:function(){for(var e=this.classBreakInfos,t=1;t<e.length;t++)if(e[t-1].maxValue!==e[t].minValue)return!1;return!0}});return g}.apply(null,n))||(e.exports=i)},1493:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(31),r(5),r(1),r(1432),r(1643)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this)||this;return r.blurRadius=10,r.colorStops=[new l.HeatmapColorStop({ratio:0,color:new i("rgba(255, 140, 0, 0)")}),new l.HeatmapColorStop({ratio:.75,color:new i("rgba(255, 140, 0, 1)")}),new l.HeatmapColorStop({ratio:.9,color:new i("rgba(255, 0,   0, 1)")})],r.field=null,r.fieldOffset=0,r.maxPixelIntensity=100,r.minPixelIntensity=0,r.type="heatmap",r}var s;return r(t,e),s=t,t.prototype.clone=function(){return new s({blurRadius:this.blurRadius,colorStops:o.clone(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})},n([a.property({type:Number,json:{write:!0}})],t.prototype,"blurRadius",void 0),n([a.property({type:[l.HeatmapColorStop],json:{write:!0}})],t.prototype,"colorStops",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),n([a.property({type:Number,json:{write:{overridePolicy:function(e,t,r){return{enabled:null==r}}}}})],t.prototype,"fieldOffset",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"maxPixelIntensity",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"minPixelIntensity",void 0),n([a.property({dependsOn:["field"],readOnly:!0})],t.prototype,"requiredFields",void 0),s=n([a.subclass("esri.renderers.HeatmapRenderer")],t)}(a.declared(s))}.apply(null,n))||(e.exports=i)},1494:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(92),r(420),r(407),r(8),r(5),r(7),r(19),r(1),r(38),r(51),r(1432),r(1495),r(1427),r(1644),r(151),r(150),r(1253),r(204)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g,y,b,_,x){var w=u.getLogger("esri.renderers.UniqueValueRenderer"),S=p.ensureType(g.default);return function(e){function t(t){var r=e.call(this)||this;return r._valueInfoMap={},r._isDefaultSymbolDerived=!1,r.type="unique-value",r.backgroundFillSymbol=null,r.field=null,r.field2=null,r.field3=null,r.valueExpression=null,r.valueExpressionTitle=null,r.legendOptions=null,r.defaultLabel=null,r.fieldDelimiter=null,r.portal=null,r.styleOrigin=null,r.diff={uniqueValueInfos:function(e,t){if(e||t){if(!e||!t)return{type:"complete",oldValue:e,newValue:t};for(var r=!1,n={type:"collection",added:[],removed:[],changed:[],unchanged:[]},i=0;i<t.length;i++)!function(i){var o=a.find(e,function(e){return e.value===t[i].value});o?m.diff(o,t[i])?(n.changed.push({type:"complete",oldValue:o,newValue:t[i]}),r=!0):(n.unchanged.push({oldValue:o,newValue:t[i]}),r=!0):(n.added.push(t[i]),r=!0)}(i);for(i=0;i<e.length;i++)!function(i){a.find(t,function(t){return t.value===e[i].value})||(n.removed.push(e[i]),r=!0)}(i);return r?n:void 0}}},r._set("uniqueValueInfos",[]),r}var u;return r(t,e),u=t,t.prototype.writeType=function(e,t,r,n){t.type="uniqueValue"},t.prototype.writeBackgroundFillSymbolWebScene=function(e,t,r,n){b.writeTarget(e,t,r,n)},t.prototype.castField=function(e){return null==e?e:"function"==typeof e?e:p.ensureString(e)},t.prototype.writeField=function(e,t,r,n){"string"==typeof e?t[r]=e:n&&n.messages?n.messages.push(new s("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):w.error(".field: cannot write field to JSON since it's not a string value")},Object.defineProperty(t.prototype,"compiledFunc",{get:function(){return y.createFunction(this.valueExpression)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultSymbol",{set:function(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)},enumerable:!0,configurable:!0}),t.prototype.readDefaultSymbol=function(e,t,r){return b.read(e,t,r)},t.prototype.writeDefaultSymbolWebScene=function(e,t,r,n){this._isDefaultSymbolDerived||b.writeTarget(e,t,r,n)},t.prototype.writeDefaultSymbol=function(e,t,r,n){this._isDefaultSymbolDerived||b.writeTarget(e,t,r,n)},t.prototype.readPortal=function(e,t,r){return r.portal||f.getDefault()},t.prototype.readStyleOrigin=function(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){var n=d.read(t.styleUrl,r);return Object.freeze({styleUrl:n})}},t.prototype.writeStyleOrigin=function(e,t,r,n){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=d.write(e.styleUrl,n),d.isAbsolute(t.styleUrl)&&(t.styleUrl=d.normalize(t.styleUrl)))},Object.defineProperty(t.prototype,"uniqueValueInfos",{set:function(e){this.styleOrigin?w.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())},enumerable:!0,configurable:!0}),t.prototype.addUniqueValueInfo=function(e,t){var r;this.styleOrigin?w.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(r="object"==typeof e?S(e):new g.default({value:e,symbol:t}),this.uniqueValueInfos.push(r),this._valueInfoMap[r.value]=r)},t.prototype.removeUniqueValueInfo=function(e){if(this.styleOrigin)w.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(var t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}},t.prototype.getUniqueValueInfo=function(e,t){var r,n=this.field,i=e.attributes;if(this.valueExpression)r=y.executeFunction(this.compiledFunc,y.createExecContext(e,y.getViewInfo(t)));else if("function"!=typeof n&&this.field2){var o=this.field2,a=this.field3,s=[];n&&s.push(i[n]),o&&s.push(i[o]),a&&s.push(i[a]),r=s.join(this.fieldDelimiter||"")}else"function"==typeof n?r=n(e):n&&(r=i[n]);return this._valueInfoMap[r+""]},t.prototype.getSymbol=function(e,t){var r=this.getUniqueValueInfo(e,t);return r&&r.symbol||this.defaultSymbol},t.prototype.getSymbols=function(){for(var e=[],t=0,r=this.uniqueValueInfos;t<r.length;t++){var n=r[t];n.symbol&&e.push(n.symbol)}return this.defaultSymbol&&e.push(this.defaultSymbol),e},t.prototype.clone=function(){var e=new u({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:l.clone(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:l.clone(this.visualVariables),legendOptions:l.clone(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:l.clone(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);var t=l.clone(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(l.clone(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e},t.prototype.collectRequiredFields=function(e){this.inherited(arguments),[this.field,this.field2,this.field3].forEach(function(t){t&&"string"==typeof t&&(e[t]=!0)}),this.valueExpression&&y.extractFieldNames(this.valueExpression).forEach(function(t){e[t]=!0})},t.prototype.populateFromStyle=function(){var e=this;return _.fetchStyle(this.styleOrigin,{portal:this.portal}).then(function(t){var r=[];return e._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(function(n){var i=new o.WebStyleSymbol({styleUrl:t.styleUrl,styleName:t.styleName,portal:e.portal,name:n.name});e.defaultSymbol||n.name!==t.data.defaultItem||(e.defaultSymbol=i,e._isDefaultSymbolDerived=!0);var a=new g.default({value:n.name,symbol:i});r.push(a),e._valueInfoMap[n.name]=a}),e._set("uniqueValueInfos",Object.freeze(r)),!e.defaultSymbol&&e.uniqueValueInfos.length&&(e.defaultSymbol=e.uniqueValueInfos[0].symbol,e._isDefaultSymbolDerived=!0),e})},t.prototype._updateValueInfoMap=function(){var e=this;this._valueInfoMap={},this.uniqueValueInfos.forEach(function(t){return e._valueInfoMap[t.value+""]=t})},t.fromPortalStyle=function(e,t){var r=new u(t&&t.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t&&t.portal||f.getDefault());var n=r.populateFromStyle();return n.catch(function(t){w.error("#fromPortalStyle('"+e+"'[, ...])","Failed to create unique value renderer from style name",t)}),n},t.fromStyleUrl=function(e,t){var r=new u(t&&t.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));var n=r.populateFromStyle();return n.catch(function(t){w.error("#fromStyleUrl('"+e+"'[, ...])","Failed to create unique value renderer from style URL",t)}),n},n([c.property()],t.prototype,"type",void 0),n([c.writer("type")],t.prototype,"writeType",null),n([c.property({types:{base:o.BaseSymbol,key:"type",typeMap:{"simple-fill":x.rendererTypes.typeMap["simple-fill"],"picture-fill":x.rendererTypes.typeMap["picture-fill"],"polygon-3d":x.rendererTypes.typeMap["polygon-3d"]}},json:{read:b.read,write:b.writeTarget}})],t.prototype,"backgroundFillSymbol",void 0),n([c.writer("web-scene","backgroundFillSymbol",{backgroundFillSymbol:{type:o.PolygonSymbol3D}})],t.prototype,"writeBackgroundFillSymbolWebScene",null),n([c.property({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],t.prototype,"field",void 0),n([c.cast("field")],t.prototype,"castField",null),n([c.writer("field")],t.prototype,"writeField",null),n([c.property({type:String,json:{write:!0}})],t.prototype,"field2",void 0),n([c.property({type:String,json:{write:!0}})],t.prototype,"field3",void 0),n([c.property({type:String,json:{write:!0}})],t.prototype,"valueExpression",void 0),n([c.property({type:String,json:{write:!0}})],t.prototype,"valueExpressionTitle",void 0),n([c.property({dependsOn:["valueExpression"]})],t.prototype,"compiledFunc",null),n([c.property({type:v.default,json:{write:!0}})],t.prototype,"legendOptions",void 0),n([c.property({type:String,json:{write:!0}})],t.prototype,"defaultLabel",void 0),n([c.property({types:x.rendererTypes})],t.prototype,"defaultSymbol",null),n([c.reader("defaultSymbol")],t.prototype,"readDefaultSymbol",null),n([c.writer("web-scene","defaultSymbol",{defaultSymbol:{types:x.rendererTypes3D}})],t.prototype,"writeDefaultSymbolWebScene",null),n([c.writer("defaultSymbol")],t.prototype,"writeDefaultSymbol",null),n([c.property({type:String,json:{write:!0}})],t.prototype,"fieldDelimiter",void 0),n([c.property({type:f,readOnly:!0})],t.prototype,"portal",void 0),n([c.reader("portal",["styleName"])],t.prototype,"readPortal",null),n([c.property({readOnly:!0})],t.prototype,"styleOrigin",void 0),n([c.reader("styleOrigin",["styleName","styleUrl"])],t.prototype,"readStyleOrigin",null),n([c.writer("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],t.prototype,"writeStyleOrigin",null),n([c.property({type:[g.default],json:{write:{overridePolicy:function(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],t.prototype,"uniqueValueInfos",null),n([c.property({dependsOn:["field","field2","field3","valueExpression"],readOnly:!0})],t.prototype,"requiredFields",void 0),n([i(1,c.cast(x.ensureType))],t.prototype,"addUniqueValueInfo",null),u=n([c.subclass("esri.renderers.UniqueValueRenderer")],t)}(c.declared(h))}.apply(null,n))||(e.exports=i)},1495:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4),r(17),r(43)],void 0===(i=function(e,t,r,n,i){function o(e){return e instanceof r}function a(e){return e instanceof n?Object.keys(e.items):o(e)?i.getProperties(e).keys():e?Object.keys(e):[]}function s(e,t){return e instanceof n?e.items[t]:e[t]}function l(e){return e?e.declaredClass:null}function u(e,t){var r=e.diff;if(r&&"function"==typeof r)return r(e,t);var n=a(e),i=a(t);if(0!==n.length||0!==i.length){if(!n.length||!i.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};var c=i.filter(function(e){return-1===n.indexOf(e)}),p=n.filter(function(e){return-1===i.indexOf(e)}),f=n.filter(function(r){return i.indexOf(r)>-1&&s(e,r)!==s(t,r)}).concat(c,p).sort(),h=l(e);if(h&&d.indexOf(h)>-1&&f.length)return{type:"complete",oldValue:e,newValue:t};var m,v=o(e)&&o(t);for(var g in f){var y=f[g],b=s(e,y),_=s(t,y),x=void 0;(v||"function"!=typeof b&&"function"!=typeof _)&&b!==_&&(null==b&&null==_||(x=r&&r[y]&&"function"==typeof r[y]?r[y](b,_):"object"==typeof b&&"object"==typeof _&&l(b)===l(_)?u(b,_):{type:"complete",oldValue:b,newValue:_})&&((m=m||{type:"partial",diff:{}}).diff[y]=x))}return m}}Object.defineProperty(t,"__esModule",{value:!0});var d=["esri.Color","esri.portal.Portal"];t.diff=function(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&l(e)!==l(t)?{type:"complete",oldValue:e,newValue:t}:u(e,t)}}.apply(null,n))||(e.exports=i)},1496:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1548)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="__begin__",i="__end__",o=new RegExp(n,"ig"),a=new RegExp(i,"ig"),s=new RegExp("^"+n,"i"),l=new RegExp(i+"$","i"),u='"',d=u+" + ",c=" + "+u;t.convertTemplatedStringToArcade=function(e){var t;return e?(t=r.replace(e,function(e,t){return n+'$feature["'+t+'"]'+i}),t=s.test(t)?t.replace(s,""):u+t,t=(t=l.test(t)?t.replace(l,""):t+u).replace(o,d).replace(a,c)):t='""',t}}.apply(null,n))||(e.exports=i)},1513:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(1306),r(1303),r(9),r(108),r(91),r(407),r(407),r(17),r(5),r(7),r(6),r(1323),r(46),r(15),r(410),r(1),r(406),r(79),r(430),r(99),r(66),r(1359),r(148),r(1325),r(1252),r(1291),r(1612),r(1613),r(1530),r(1452),r(1614),r(1471),r(1438),r(1357),r(40),r(1353),r(74),r(1301),r(1308),r(1469),r(1311),r(1425),r(1340),r(1277),r(1345),r(1305),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g,y,b,_,x,w,S,C,D,E,A,T,O,I,R,P,M,L,N,F,U,V,j,k,z,B,G,H,W,q,$,Y,Q,X){function Z(e){return e.data instanceof ArrayBuffer}var K=z.ModelContentType,J=f.getLogger("esri.views.3d.layers.SceneLayerView3D"),ee=[1,1,1,1],te=[.8,.8,.8],re=[.5,.5,.5],ne=9,ie=function(t){function f(){var e=null!==t&&t.apply(this,arguments)||this;return e._queryEngine=null,e._highlights=new I(e),e._elevationProvider=null,e._worker=new T,e._workerThread=null,e._controllerCreated=!1,e._idbCache=new L.IDBCache("esri-scenelayer-cache","geometries",ne),e._cancelCount=0,e._hasColors=!1,e._hasTextures=!1,e._hasData=!1,e.alwaysLoadEverythingModeEnabled=!1,e._cacheKeySuffix=null,e._definitionExpressionErrors=0,e._maxDefinitionExpressionErrors=20,e}return r(f,t),Object.defineProperty(f.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"rendererNeedsTextures",{get:function(){return M.rendererNeedsTextures(this.layer.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"elevationOffset",{get:function(){var e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"absolute-height"===e.mode){var t=x.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=D.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),f.prototype._enableSecretAlwayLoadMode=function(){this.layer.store.lodModel&&"always-load"===this.layer.store.lodModel&&(this.alwaysLoadEverythingModeEnabled=!0)},Object.defineProperty(f.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this._useCompressedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_useCompressedTextures",{get:function(){var e=this.layer.version,t=!a("trident")||e.major>1||1===e.major&&e.minor>3;return this.view._stage.has("s3tc")&&t},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps&&this.view._stage.has("standardDerivatives")},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_atlasBiasCompensationEnabled",{get:function(){return!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0}),f.prototype.initialize=function(){var t=this;y.open(m.getAbsMid("./SceneLayerWorker",e,X),{client:this}).then(function(e){t.destroyed?e.close():t._workerThread=e}),M.checkSceneLayerValid(this.layer),M.checkSceneLayerCompatibleWithView(this.layer,this.view),this._initGraphicsController(),this.gpuMemoryEstimate=0,this.texMemoryEstimate=0,this.geoMemoryEstimate=0,this._stage=this.view._stage,this._isIntegratedMesh()||(this._edgeView=this._stage.view.getEdgeView()),this._texId2Meta=new Map,this._nodeId2Meta=new Map,this._addThisLayerToStage(),this._elevationProvider=new R({layerView:this,stageLayer:this._stageLayer}),this.handles.add([g.init(this.view,"clippingArea",function(){return t._clippingAreaChanged()}),g.init(this.layer,"renderer",function(e){return t._rendererChange(e)}),g.init(this.layer,"objectIdFilter",function(){return t._filterChange()}),g.init(this.layer,"elevationInfo",function(){return t._elevationInfoChanged()}),g.init(this.layer,"rangeInfos",function(e){return t._rangeInfosChanged(e)}),g.init(this,"_controller.parsedDefinitionExpression",function(){return t._filterChange()}),g.watch(this,"fullOpacity",function(e){return t._opacityChange(e)}),g.watch(this,["elevationOffset","rendererNeedsTextures"],function(){return t._reloadAll()}),g.watch(this,"uncompressedTextureDownsamplingEnabled",function(){return t._reloadAll()}),g.init(this,"suspended",function(e){return t.setVisibility(!e)})],"sceneLayerHandles"),this._idbCache.init(),this._cacheKeySuffix=M.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference),this._componentColorManager=this._hasSymbolColors()?new Y.BufferManager(this._stage.view.renderingContext):null,this._enableSecretAlwayLoadMode()},f.prototype.destroy=function(){this.handles.remove("sceneLayerHandles"),this._workerThread&&(this._workerThread.close(),this._workerThread=null),this._removeThisLayerFromStage(),this._stage=null,this._idbCache&&(this._idbCache.destroy(),this._idbCache=null),null!=this._controller&&(this._controller.destroy(),this._controller=null),this._highlights.destroy(),this._texId2Meta=null,this._nodeId2Meta=null,this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)},f.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},f.prototype.isUpdating=function(){return!this._controllerCreated||!(!this._controller||!this._controller.updating)},f.prototype.memEstimateTextureAdded=function(e){var t=e.getEstimatedTexMemRequiredMB();return this.gpuMemoryEstimate+=t,this.texMemoryEstimate+=t,t},f.prototype.memEstimateTextureRemoved=function(e){var t=e.getEstimatedTexMemRequiredMB();this.gpuMemoryEstimate-=t,this.texMemoryEstimate-=t,this.gpuMemoryEstimate<9.5367431640625e-7&&(this.gpuMemoryEstimate=0,this.texMemoryEstimate=0)},f.prototype.memEstimateGeometryAdded=function(e){var t=e.estimateGpuMemoryUsage()/1048576;return this.gpuMemoryEstimate+=t,this.geoMemoryEstimate+=t,t},f.prototype.memEstimateGeometryRemoved=function(e){var t=e.estimateGpuMemoryUsage()/1048576;this.gpuMemoryEstimate-=t,this.geoMemoryEstimate-=t,this.gpuMemoryEstimate<9.5367431640625e-7&&(this.gpuMemoryEstimate=0,this.texMemoryEstimate=0)},f.prototype._isNodeLoaded=function(e){return this._nodeId2Meta.has(e.id)},f.prototype._initGraphicsController=function(){var e=this,t={addNodeData:function(t,r){return e._addNodeData(t,r)},isNodeLoaded:function(t){return e._isNodeLoaded(t)},removeNodeData:function(t){return e._removeNodeData(t)},getLoadedNodeIDs:function(){return e._getLoadedNodeIDs()},getLoadedAttributes:function(t){return e._getLoadedAttributes(t)},getAttributeData:function(t){return e._getAttributeData(t)},setAttributeData:function(t,r,n){return e._setAttributeData(t,r,n)},getMemoryUsage:function(){return e.view.resourceController.usedMemory}},r={setPolygonOffset:function(t,r){return e._setPolygonOffset(t,!!r)},textureOptions:{useCompressedTextures:this._useCompressedTextures},additionalCancelNodeLoadingHandler:function(){return e._cancel()},loadCachedNodeData:function(t,r){return e._loadCachedNodeData(t,r)},addCachedNodeData:function(t,r,n){return e._addCachedNodeData(t,r,n)}};this.layer.createGraphicsController({layerView:this,layerViewRequiredFunctions:t,layerViewOptionalFunctions:r}).then(function(t){e._controller=t,t.watch("rootNodeVisible",function(){e.notifyChange("suspended")})}).always(function(){e._controllerCreated=!0,e.notifyChange("updating")})},f.prototype.getUsedMemory=function(){return this.gpuMemoryEstimate},f.prototype.getUnloadedMemory=function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0},f.prototype.getCachedMemory=function(){return 0},f.prototype.removeCachedData=function(){this.suspended&&this._removeAllNodeDataFromStage()},f.prototype.setVisibility=function(e){var t=this;if(this._nodeId2Meta.forEach(function(r){var n=r.engineObject;n.setHidden(n.geometryRecords[0],!e),t._edgeView&&t._edgeView.updateObjectVisibility(n,e)}),e){var r=this._isIntegratedMesh()?"im":"scene";this.view.elevationProvider.register(r,this._elevationProvider),this.visibleGeometryChanged()}else this.visibleGeometryChanged(),this.view.elevationProvider.unregister(this._elevationProvider)},f.prototype.getStats=function(){var e={index:0,nodes:this._nodeId2Meta.size.toString(),textures:this._texId2Meta.size,"Total GPU Memory Estimate":this.gpuMemoryEstimate+"MB","Geometry Memory Estimate":this.geoMemoryEstimate+"MB","Texture Memory Estimate":this.texMemoryEstimate+"MB"};return this._controller&&(this._cachingEnabled()&&(e.cache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(e)),e},f.prototype._addThisLayerToStage=function(){for(var e=this._stage,t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;this._whiteTexture=new q(t,"white",{width:8,height:8}),e.add(K.TEXTURE,this._whiteTexture);var n=this.layer.id,i=new G(n,{},n);this._stageLayer=i,e.add(K.LAYER,i),this._stage.addToViewContent([i.id])},f.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var e=this._stage;e.remove(K.TEXTURE,this._whiteTexture.id),this._removeAllNodeDataFromStage(),$.assert(0===this._nodeId2Meta.size),$.assert(0===this._texId2Meta.size),e.remove(K.LAYER,this._stageLayer.id),this._stageLayer=void 0,this.gpuMemoryEstimate=0}},f.prototype._getLoadedAttributes=function(e){var t=this._nodeId2Meta.get(e.id);if(t)return t.loadedAttributes},f.prototype._getAttributeData=function(e){var t=this._nodeId2Meta.get(e.id);if(t)return t.attributeData},f.prototype._setAttributeData=function(e,t,r){var n=this._nodeId2Meta.get(e.id);n&&(n.loadedAttributes=t,n.attributeData=r,this._setObjectSymbology(n),this._addOrUpdateEdgeRendering(n),this._applyFilters(e),this.visibleGeometryChanged(n.engineObject))},f.prototype._getLoadedNodeIDs=function(){return d.keysOfMap(this._nodeId2Meta)},f.prototype._calcEngineMaterialTransparencyParams=function(e,t,r){var n=this.fullOpacity,i=1-$.clamp($.fallbackIfUndefined(t.transparency,0),0,1);return{opacity:i,layerOpacity:n,transparent:i<1||n<1||e&&p.endsWith(e.channels,"a")||!0===t.useVertexColorAlpha||r}},f.prototype._calcEngineMaterialDoubleSidedParams=function(e){return null==e.doubleSided||e.doubleSided},f.prototype._calcEngineMaterialCullFaceParams=function(e){return e.cullFace?e.cullFace:null!=e.doubleSided?e.doubleSided?"none":"back":"none"},f.prototype._getMaterialParameters=function(e,t,r,n){var i;if(null!=e){var o=this._texId2Meta.get(t);i=o&&o.engineTex?o.engineTex.id:this._whiteTexture.id}var a=r.params,s=$.fallbackIfUndefined(a.diffuse,te);"standard"!==r.type&&J.warn("Unknown material type '"+r.type+"', must be 'standard'");var l=this._isIntegratedMesh(),u={ambient:s,diffuse:s,specular:$.fallbackIfUndefined(a.specular,re),atlasRegions:a.vertexRegions,textureId:i,vertexColors:this._hasVertexColors(),componentIndices:this._hasSymbolColors(),componentColorBuffer:this._hasSymbolColors()&&n?n.textureBuffer:null,flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(a),cullFace:this._calcEngineMaterialCullFaceParams(a),writeStencil:l,receiveSSAO:!l,groundNormalShading:l,compressedNormals:!l};if(!l){var d=this._calcEngineMaterialTransparencyParams(e,a);p.mixin(u,d)}return u},f.prototype._createEngineMaterial=function(e,t,r,n,i,o,a){var s=null!=t?this._getI3STexEncoding(t):null,l=this._getMaterialParameters(t,r,n,a),u=new Q(l,i);if(u.metadata={i3sMatId:i,i3sTexId:r,i3sTex:t,i3sMatParams:n.params},null!=t){var d=this._texId2Meta.get(r);d?d.usedByEngineMats.push(u):(d={id:r,usedByEngineMats:[u],images:t.images,encoding:s,atlas:!0===t.atlas,wrap:"none"!==t.wrap[0]||"none"!==t.wrap[1]},this._texId2Meta.set(r,d));var c=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.i3sTexId===t)return i.data}return null}(o,r);if(null!=c&&null==d.engineTex){var p=function(e,t,r,n,i){var o,a=!1;t.encoding===M.DDS_ENCODING_STRING?o=q.DDS_ENCODING:a=!($.isPowerOfTwo(e.width)&&$.isPowerOfTwo(e.height));var s=t.usedByEngineMats.some(function(e){return e.getParams().atlasRegions})||t.atlas,l=(s?n:r)&&!a;return{mipmap:l,wrapClamp:s||!t.wrap,disableAnisotropy:s&&l&&i,encoding:o,noUnpackFlip:!0}}(c,d,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy);d.engineTex=new q(c,d.id,p),this._stage.add(K.TEXTURE,d.engineTex),e.memory+=this.memEstimateTextureAdded(d.engineTex)}if(null!=d.engineTex)for(var f=d.engineTex.id,h=0,m=d.usedByEngineMats;h<m.length;h++){m[h].setParameterValues({textureId:f})}}return u},f.prototype._getI3STexEncoding=function(e){var t=M.getAppropriateTextureEncoding(e.encoding,this._useCompressedTextures);return t>-1?e.encoding[t]:e.encoding},f.prototype._getVertexBufferLayout=function(e,t){var r=e.params.materialID,n=t.materialDefinitions[r];$.assert(void 0!==n,"geometry wants unknown material "+r);var i,o=e.params.textureID||"none";"none"!==o&&(null!=t.textureDefinitions&&null!=t.textureDefinitions[o]||J.warn("textureDefinitions missing in shared resource"),i=t.textureDefinitions[o]);var a=this._getMaterialParameters(i,o,n);return Q.getVertexBufferLayout(a)},f.prototype._createEngineMat=function(e,t,r,n,i){var o=t.params.materialID,a=r.materialDefinitions[o];$.assert(void 0!==a,"geometry wants unknown material "+o);var s,l=t.params.textureID||"none";return"none"!==l&&(null!=r.textureDefinitions&&null!=r.textureDefinitions[l]||J.warn("textureDefinitions missing in shared resource"),s=r.textureDefinitions[l]),this._createEngineMaterial(e,s,l,a,o,n,i)},f.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},f.prototype._findGraphicNodeAndIndex=function(e){var t=N.attributeLookup(e.attributes,this._getObjectIdField()),r=null;return this._nodeId2Meta.forEach(function(e,n){if(!r){var i=e.featureIds.indexOf(t);-1!==i&&(r={node:e.node,index:i})}}),r},f.prototype._getGraphicIndices=function(e,t){var r=this._nodeId2Meta.get(e.id);if(!r)return[];for(var n=[],i=this._getObjectIdField(),o=0,a=t;o<a.length;o++){var s=a[o],l=N.attributeLookup(s.attributes,i),u=r.featureIds.indexOf(l);-1!==u&&n.push(u)}return n},f.prototype.whenGraphicBounds=function(e){var t=this._findGraphicNodeAndIndex(e);if(!t)return h.reject();var r=this._nodeId2Meta.get(t.node.id).engineObject,n=this._boundingBoxCornerPoints(t.index,r,new Float64Array(24));if(k.bufferToBuffer(n,this.view.renderSpatialReference,0,n,this.view.spatialReference,0,8)){var i=_.empty();return _.expandWithBuffer(i,n,0,8),h.resolve({boundingBox:i,screenSpaceObjects:[]})}},f.prototype.whenGraphicAttributes=function(e,t){var r=this;return M.whenGraphicAttributes(this.layer,[e],this._getObjectIdField(),t,function(){var t=r._findGraphicNodeAndIndex(e);return{node:t.node,indices:[t.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(e){return e[0]})},f.prototype.getGraphicFromStageObject=function(e,t){if(this.layer instanceof w)return h.reject();var r=this._getMetadata(e),n=e.getComponentFromTriangleNr(0,t);if(null!=n&&null!=r.featureIds&&n<r.featureIds.length){var i=this._createGraphic(n,r);return h.resolve(i)}return h.reject()},f.prototype._getMetadata=function(e){var t=e.getMetadata();return this._nodeId2Meta.get(t.i3sNode)},f.prototype._getCacheKey=function(e){return e.baseUrl+this._cacheKeySuffix},f.prototype._cachingEnabled=function(){return!this._controller.disableCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix},f.prototype._cancel=function(){this._cancelCount=this._cancelCount+1|0},f.prototype._handleCancelled=function(e){if((this._cancelCount-e|0)>0)throw new s},f.prototype._loadCachedNodeData=function(e,t){var r=this,n=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(e)).then(function(i){if(null==i)return null;if(r._handleCancelled(n),i.nodeVersion!==e.version)return r._idbCache.remove(r._getCacheKey(e)),null;e.obb||(e.obb=j.clone(i.nodeObb),r._controller.updateVisibility(e.id));return r.rendererNeedsTextures&&i.textureData.some(function(e){if(null==e.data)return!0;var t=i.sharedResource.textureDefinitions[e.i3sTexId],n=r._getI3STexEncoding(t);return e.encoding!==n})?t(i.allGeometryData,i.sharedResource).then(function(t){return i.textureData=t,t.every(Z)&&r._idbCache.put(r._getCacheKey(e),i).catch(function(t){return J.warn("Failed to update node with textures in IndexedDB cache: "+e.id+": "+t)}),r._handleCancelled(n),i}):i}):h.resolve(null)},f.prototype._addNodeData=function(e,t){var r=this;return this._transformBundle(e,t).then(function(n){e.obb||(e.obb=n.obb,r._controller.updateVisibility(e.id));var i={allGeometryData:t.allGeometryData,transformedGeometries:n.transformedGeometries,textureData:t.textureData,sharedResource:t.sharedResource,nodeVersion:e.version,nodeObb:e.obb,byteSize:function(e,t){for(var r=1024,n=0,i=e;n<i.length;n++){var o=i[n];r+=o.interleavedVertexData.byteLength+(o.indices?o.indices.byteLength:0),r+=o.positionData.data.byteLength+o.positionData.indices.byteLength}for(var a=0,s=t;a<s.length;a++){var l=s[a];l.data instanceof ArrayBuffer&&(r+=l.data.byteLength)}return r}(n.transformedGeometries,t.textureData)};if(r._cachingEnabled()){var o=i.textureData.map(function(e){return Z(e)?e:{i3sTexId:e.i3sTexId,encoding:e.encoding,data:null}});r._idbCache.put(r._getCacheKey(e),{allGeometryData:i.allGeometryData,transformedGeometries:i.transformedGeometries,textureData:o,sharedResource:i.sharedResource,nodeVersion:i.nodeVersion,nodeObb:i.nodeObb,byteSize:i.byteSize}).catch(function(t){return J.warn("Failed to store node in IndexedDB cache: "+e.id+": "+t)})}return r._addCachedNodeData(e,i,t.attributeDataInfo)})},f.prototype._transformBundle=function(e,t){for(var r=[],n=[t.geometryBuffer],i=0,o=t.allGeometryData;i<o.length;i++)for(var a=0,s=o[i].geometries;a<s.length;a++){var l=s[a];r.push(this._getVertexBufferLayout(l,t.sharedResource))}var u={geometryBuffer:t.geometryBuffer,geometryData:t.allGeometryData,layouts:r,center:e.mbs,obb:e.obb,elevationOffset:this.elevationOffset,hasColors:this._hasColors,needNormals:!this._isIntegratedMesh()&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",u,n):h.resolve(this._worker.transform(u))},f.prototype._addCachedNodeData=function(e,t,r){var n=this;if(this._nodeId2Meta.has(e.id))return this._addOrUpdateEdgeRendering(this._nodeId2Meta.get(e.id)),this._applyFilters(e),h.resolve();if(!this.alwaysLoadEverythingModeEnabled&&!this._controller.isGeometryVisible(e))return h.resolve();var i=t.allGeometryData,o=t.transformedGeometries,a=t.textureData,s=t.sharedResource;if(0===i.length)return h.resolve();if(1!==i.length&&console.warn("Node with",i.length,"geometries is unsupported"),!this.rendererNeedsTextures)for(var l=0,u=a;l<u.length;l++){u[l].data=null}var d={};d[K.OBJECT]={},d[K.GEOMETRY]={},d[K.MATERIAL]={};var c=0,p=!1;e.memory=0;var f=i[0],m=f.componentOffsets,v=f.geometries,g=f.featureIds,y=null,b=null;if(this._hasSymbolColors()){y=this._componentColorManager.getBuffer(g.length),b=new Uint16Array(g.length);for(var _=0;_<g.length;_++)b[_]=y.aquireIndex()}for(var x,w=e.id+"|"+g[0],S=[],C=[],D=[],E=0,A=v;E<A.length;E++){var T=A[E],O=this._createEngineMat(e,T,s,a,y),I=o[c++];p=p||I.hasColors;var R=new W(new Float32Array(I.interleavedVertexData),I.layout,I.positionData,m||W.DefaultOffsets,I.indices||W.DefaultIndices);this._hasSymbolColors()&&this._setComponentIndices(R,b),x=I.corMatrices;var P=V.mat4d.create(x.localTrafo);if(null!=T.transformation){var M=T.transformation;V.mat4d.multiply(P,M,P)}var L=S.length,N=new B(R,w+(L>0?"_"+L:""));S.push(N),C.push(P),D.push([O]),e.memory+=this.memEstimateGeometryAdded(N.getData()),d[K.MATERIAL][O.id]=O,d[K.GEOMETRY][N.id]=N}var F={i3sNode:e.id,layerUid:this.layer.uid},U=new H({idHint:e.id,name:w,geometries:S,materials:D,transformations:C,castShadow:!0,metadata:F}),j=V.mat4d.create();V.mat4d.identity(j),V.mat4d.multiply(j,x.globalTrafo,j),U.setObjectTransformation(j),d[K.OBJECT][U.id]=U;var k={node:e,engineObject:U,featureIds:g,attributeData:r?r.attributeData:null,loadedAttributes:r?r.loadedAttributes:null,componentColorBuffer:y,componentIndices:b};return h.create(function(t){n._addOrUpdateEdgeRendering(k).then(function(){if(n._nodeId2Meta.has(e.id))return n._edgeView&&n._edgeView.removeObject(k.engineObject),void t();n._nodeId2Meta.set(e.id,k),n._setObjectSymbology(k),n._applyFilters(e),n._highlights.objectCreated(U),n.visibleGeometryChanged(U);var r=n._stageLayer,i=n._stage;i.beginMod();var o=d[K.OBJECT];for(var a in o)o.hasOwnProperty(a)&&r.addObject(o[a]);for(var s in d)if(d.hasOwnProperty(s)){var l=d[s];for(var u in l)l.hasOwnProperty(u)&&null==i.get(s,u)&&i.add(s,l[u])}i.endMod(),!n._hasTextures&&null!=e.textureData&&e.textureData.length>0&&(n._hasTextures=!0),n._hasColors||(n._hasColors=p),n._hasData=!0,n.notifyChange("hasTexturesOrVertexColors"),t()})})},f.prototype._clippingAreaChanged=function(){var e=this,t=_.create();k.extentToBoundingBox(this.view.clippingArea,t,this.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null,this._updateFilters(),this._nodeId2Meta.forEach(function(t){return e._applyFilters(t.node)}),this._controller&&this._controller.updateClippingArea(this.view.clippingArea)},f.prototype._filterChange=function(){var e=this;this._updateFilters(),this._nodeId2Meta.forEach(function(t){return e._applyFilters(t.node)})},f.prototype._updateFilters=function(){var e=this,t=[];if(this.layer.objectIdFilter){var r=new Float64Array(this.layer.objectIdFilter.ids),n="include"===this.layer.objectIdFilter.method;r.sort(),t.push(function(t,i){return e._objectIdFilter(r,n,i)})}if(this._controller&&this._controller.parsedDefinitionExpression&&this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var i=this._controller.parsedDefinitionExpression,o=this._controller.definitionExpressionFields;t.push(function(t,r){return e._sqlFilter(t,i,o,r)})}this._clippingArea&&t.push(function(t,r){return e._boundingboxFilter(t,e._clippingArea,r)}),this._filters=t},f.prototype._sqlFilter=function(e,t,r,n){var i={},o=new l(null,null,i);o.layer=this.layer,o.sourceLayer=this.layer;for(var a=this.layer.objectIdField,s=0,u=0,d=this._nodeId2Meta.get(e.id),c=d.featureIds,p=d.attributeData,f=r.every(function(e){return null!=p[e]||e===a}),h=0;h<c.length&&s<n.length;h++)if(n[s]===c[h]){var m=!0;if(f){i[a]=c[h];for(var v=0,g=r;v<g.length;v++){var y=g[v];y!==a&&(i[y]=M.getCachedAttributeValue(p[y],h))}m=this._evaluateClause(t,o)}m&&(n[u]=n[s],u++),s++}n.length=u},f.prototype._evaluateClause=function(e,t){try{return e.testFeature(t)}catch(e){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&J.error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&J.error("Further errors are ignored"),!1}},f.prototype._objectIdFilter=function(e,t,r){for(var n=0,i=0;n<r.length;)u.binaryIndexOf(e,r[n])>=0===t&&(r[i]=r[n],i++),n++;r.length=i},f.prototype._boundingboxFilter=function(e,t,r){var n=[0,0,0,0];k.mbsToMbs(e.mbs,this._controller.crsIndex,n,this.view.renderSpatialReference);var i=null!=t?M.intersectBoundingBoxWithMbs(t,n):2;if(2!==i){if(0===i)return void(r.length=0);var o=0,a=0,s=this._nodeId2Meta.get(e.id),l=s.featureIds,u=s.engineObject.getObjectTransformation(),d=s.engineObject.getGeometryRecords()[0].getShaderTransformation();if(V.mat4d.multiply(u,d),0===u[1]&&0===u[2]&&0===u[3]&&0===u[4]&&0===u[6]&&0===u[7]&&0===u[8]&&0===u[9]&&0===u[11]&&1===u[15]){var c=ae;c[0]=(t[0]-u[12])/u[0],c[1]=(t[1]-u[13])/u[5],c[2]=(t[2]-u[14])/u[10],c[3]=(t[3]-u[12])/u[0],c[4]=(t[4]-u[13])/u[5],c[5]=(t[5]-u[14])/u[10];for(var p=s.engineObject.getGeometryRecords()[0].geometry,f=p.getComponentCount(),h=0;h<f&&o<r.length;h++)if(r[o]===l[h]){var m=p.getComponentAABB(h,se);_.intersects(c,m)&&(r[a]=r[o],a++),o++}r.length=a}}},f.prototype._addOrUpdateEdgeRendering=function(e){return i(this,void 0,void 0,function(){var t,r,n,i,a,s;return o(this,function(o){switch(o.label){case 0:return this._edgeView?(t=e.engineObject,r=this._edgeView.hasObject(t),n=this._extractObjectEdgeMaterials(e),i=n.hasEdges,a=n.perFeatureEdgeMaterials,s=!t.isHidden(t.geometryRecords[0]),r?(this._edgeView.updateAllComponentMaterials(t,a),this._edgeView.updateObjectVisibility(t,s),[3,3]):[3,1]):[2];case 1:return s&&i?[4,this._edgeView.addObject(t,a)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}})})},f.prototype._applyFilters=function(e){var t=this._nodeId2Meta.get(e.id);t&&this._applyFiltersToObjects(e,t)},f.prototype.unhideEdgesForAllFeatures=function(e){var t=e.engineObject;if(this._edgeView&&this._edgeView.hasObject(t)){var r=this.fullOpacity;this._edgeView.updateAllComponentOpacities(t,r)}},f.prototype._applyFiltersToObjects=function(e,t){var r=t.engineObject;if(r.unhideAllComponents(),0!==this._filters.length){for(var n=t.featureIds,i=n.slice(),o=0,a=this._filters;o<a.length;o++)(0,a[o])(e,i);if(i.length!==n.length){for(var s=0,l=r.getGeometryRecords()[0],u=new Array(t.featureIds.length),d=this.fullOpacity,c=0;c<n.length;c++){var p=n[c];s>=i.length||i[s]!==p?(r.setComponentVisibility(l,c,!1),u[c]=0):(s++,u[c]=d)}this._edgeView&&this._edgeView.hasObject(r)&&this._edgeView.updateAllComponentOpacities(r,u)}else this.unhideEdgesForAllFeatures(t)}else this.unhideEdgesForAllFeatures(t)},f.prototype._removeAllNodeDataFromStage=function(){var e=this;this._nodeId2Meta.forEach(function(t,r){return e._removeNodeStageData(r)})},f.prototype._removeNodeData=function(e){var t=this;e.forEach(function(e){return t._removeNodeStageData(e.id)})},f.prototype._removeNodeStageData=function(e){var t=this._nodeId2Meta.get(e);if(t){var r=this._stage,n=this._stageLayer,i=t.engineObject;this._highlights.objectDeleted(i),this._edgeView&&this._edgeView.removeObject(i),this.visibleGeometryChanged(i),n.removeObject(i);for(var o=0,a=i.getGeometryRecords();o<a.length;o++){var s=a[o];this.memEstimateGeometryRemoved(s.geometry.getData()),r.remove(K.GEOMETRY,s.geometry.id);for(var l=0,u=s.materials;l<u.length;l++){var d=u[l];this._removeMaterial(d,r)}}if(t.componentIndices){for(var c=0;c<t.componentIndices.length;c++)t.componentColorBuffer.releaseIndex(t.componentIndices[c]);this._componentColorManager.garbageCollect()}r.remove(K.OBJECT,i.id),this._nodeId2Meta.delete(e)}},f.prototype._removeMaterial=function(e,t){t.remove(K.MATERIAL,e.id);var r=e.metadata.i3sTexId||"none";if("none"!==r){var n=this._texId2Meta.get(r),i=n.usedByEngineMats,o=i.indexOf(e);if(o>-1?(i[o]=i[i.length-1],i.pop()):J.error("Missing reference from material to texture"),0===i.length){var a=n.engineTex;a&&a!==this._whiteTexture&&(this.memEstimateTextureRemoved(a),t.remove(K.TEXTURE,n.engineTex.id)),this._texId2Meta.delete(r)}}},f.prototype._setPolygonOffset=function(e,t){var r=this._nodeId2Meta.get(e.id);if(r)for(var n=0,i=r.engineObject.getGeometryRecords();n<i.length;n++)for(var o=0,a=i[n].materials;o<a.length;o++){a[o].setParameterValues({polygonOffset:t})}},f.prototype._rendererChange=function(e){if(this._currentRenderer=e,e&&(e.colorInfo||e.sizeInfo)&&J.warn("renderer.colorInfo and renderer.sizeInfo are not supported for Scene Services. Use visualVariables instead."),e)for(var t=0,r=e.getSymbols();t<r.length;t++){var n=r[t];"mesh-3d"!==n.type&&J.error("Symbols of type '"+n.type+"' are not supported for 3D Object Scene Services.")}this.view.resourceController.setMemoryDirty()},f.prototype._getRenderingInfo=function(e,t){var r,n,i=this._currentRenderer,o=i&&i.getSymbol(e);if(!(o instanceof C&&this._hasSymbolColors()))return null;if(i&&i.visualVariables)for(var a=i.getVisualVariableValues(e),s=0;s<a.length;s++){var l=a[s],u=l.variable.type;"color"===u?r=l.value:"opacity"===u&&(n=l.value)}return t.symbol=o,t.color=r?[r.r/255,r.g/255,r.b/255]:null,null!=n?t.opacity=n:r&&null!=r.a?t.opacity=r.a:t.opacity=null,t},f.prototype._getSymbolFillMaterial=function(e,t){for(var r=0,n=e.symbolLayers.items;r<n.length;r++){var i=n[r];if("fill"===i.type){var o=i.material,a=null!=o?o.color:null;return null!=a?(le[0]=a.r/255,le[1]=a.g/255,le[2]=a.b/255,le[3]=a.a,t.color=le):t.color=null,void(t.colorMixMode=null!=o?o.colorMixMode:null)}}t.color=null,t.colorMixMode=null},f.prototype._hasSymbolColors=function(){if(this._isIntegratedMesh()||!this.layer.store.defaultGeometrySchema)return!1;var e=this.layer.store.defaultGeometrySchema.featureAttributes;return!!(e&&e.faceRange&&e.id)},f.prototype._isIntegratedMesh=function(){return this.layer instanceof w},f.prototype._hasVertexColors=function(){return null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color)},f.prototype._extractObjectEdgeMaterials=function(e){for(var t,r=[],n=e.featureIds?e.featureIds.length:1,i=this.layer.objectIdField,o=new l(null,null,{}),a=o.attributes,s=this._currentRenderer&&this._currentRenderer.requiredFields,u=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),d=this.fullOpacity,c=!1,p=0;p<n;p++){if(t=u,null!=i&&null!=e.featureIds&&(a[i]=e.featureIds[p]),null!=s&&null!=e.attributeData)for(var f=0,h=Object.keys(e.attributeData);f<h.length;f++){var m=h[f];a[m]=M.getCachedAttributeValue(e.attributeData[m],p)}var v=this._getRenderingInfo(o,ue),g=e.engineObject,y=g.getComponentVisibility(g.getGeometryRecords()[0],p)?d:0;if(v&&v.symbol instanceof C)for(var b=0,_=v.symbol.symbolLayers.items;b<_.length;b++){var x=_[b];if(x instanceof S){var w=F.createMaterial(this._edgeView,x,y);if(w){c=!0,t=w;break}}}r.push(t)}return{hasEdges:c,perFeatureEdgeMaterials:r}},f.prototype._setObjectSymbology=function(e){if(this._hasSymbolColors()){for(var t=e.featureIds?e.featureIds.length:1,r=new l(null,null,{}),n=r.attributes,i=this.layer.objectIdField,o=this._currentRenderer&&this._currentRenderer.requiredFields,a=!1,s=new Uint8Array(4),u={color:null,colorMixMode:null},d=[0,0,0,0],c=null,p=0;p<t;p++){if(null!=i&&null!=e.featureIds&&(n[i]=e.featureIds[p]),null!=o&&null!=e.attributeData)for(var f=0,h=Object.keys(e.attributeData);f<h.length;f++){var m=h[f];n[m]=M.getCachedAttributeValue(e.attributeData[m],p)}var v=this._getRenderingInfo(r,ue);if(v){v.symbol!==c&&(c=v.symbol,this._getSymbolFillMaterial(v.symbol,u));var g=v.color,y=v.opacity;(g=null==g||null==y?O.overrideColor(g,y,u.color,u.color&&u.color[3],ee,d):O.overrideColor(g,y,null,null,ee,d))[3]<1&&(a=!0),M.encodeSymbolColor(g,u.colorMixMode,s)}else M.encodeSymbolColor(null,null,s);var b=e.componentIndices[p];e.componentColorBuffer.textureBuffer.setData(b,0,s[0],s[1],s[2],s[3])}this._updateObjectOpacity(e.engineObject,a)}},f.prototype._setComponentIndices=function(e,t){for(var r=e.getAttribute($.VertexAttrConstants.COMPONENTINDEX),n=r.data,i=r.offsetIdx,o=r.strideIdx,a=e.getIndices($.VertexAttrConstants.COMPONENTINDEX),s=0;s<t.length;s++)for(var l=e.componentOffsets[s],u=e.componentOffsets[s+1],d=l;d<u;d++){n[i+a[d]*o]=t[s]}},f.prototype._elevationInfoChanged=function(){var e=this.layer.elevationInfo&&this.layer.elevationInfo.unit;e&&!D.supportsUnit(e)&&J.warn("elevationInfo.unit","'"+e+"' is not a valid unit")},f.prototype._rangeInfosChanged=function(e){null!=e&&e.length>0&&J.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")},f.prototype._reloadAll=function(){this._removeAllNodeDataFromStage(),null!=this._controller&&this._controller.restartNodeLoading()},f.prototype._opacityChange=function(e){var t=this;this._nodeId2Meta.forEach(function(e){t._updateObjectOpacity(e.engineObject),t._addOrUpdateEdgeRendering(e)})},f.prototype._updateObjectOpacity=function(e,t){for(var r=0,n=e.getGeometryRecords();r<n.length;r++)for(var i=0,o=n[r].materials;i<o.length;i++){var a=o[i],s=a.metadata;void 0!==t&&(s.symbolIsTransparent=t);var l=a.getParams(),u=this._calcEngineMaterialTransparencyParams(s.i3sTex,s.i3sMatParams,s.symbolIsTransparent);l.transparent===u.transparent&&l.layerOpacity===u.layerOpacity||a.setParameterValues(u)}},f.prototype.queryExtent=function(e){return this._ensureQueryEngine().queryExtent(e)},f.prototype.queryFeatureCount=function(e){return this._ensureQueryEngine().queryFeatureCount(e)},f.prototype.queryFeatures=function(e){return this._ensureQueryEngine().queryFeatures(e)},f.prototype.queryObjectIds=function(e){return this._ensureQueryEngine().queryObjectIds(e)},f.prototype._ensureQueryEngine=function(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine},f.prototype._createQueryEngine=function(){var e=this,t={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new P(this.layer,{forAll:function(r,n){e._forAllFeatures(function(n,i,o){t.id=n,t.index=i,t.meta=o,e._boundingBoxCornerPoints(i,o.engineObject,t.bbCorners),r(t)},n)},createGraphic:function(t){return e._createGraphic(t.index,t.meta)},requestFields:function(t,r,n){return M.whenGraphicAttributes(e.layer,r,e._getObjectIdField(),n,function(){var n=e._getGraphicIndices(t,r);return{node:t,indices:n}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return e._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})},f.prototype._createExtentBuilder=function(){var e=this.view.renderSpatialReference,t=this.view.spatialReference,r=_.empty(),n=new Float64Array(24);return{add:function(i){k.bufferToBuffer(i.bbCorners,e,0,n,t,0,8)&&_.expandWithBuffer(r,n,0,8)},getExtent:function(){return _.toExtent(r,t)}}},f.prototype._forAllFeatures=function(e,t,r){var n=this;this._nodeId2Meta.forEach(function(i,o){n._forAllFeaturesOfNode(i,e,r),t&&t(i.node)})},f.prototype._forAllFeaturesOfNode=function(e,t,r){for(var n=e.featureIds,i=e.engineObject.getGeometryRecords()[0],o=0;o<n.length;o++)if(r||e.engineObject.getComponentVisibility(i,o)){t(n[o],o,e,i)}},f.prototype._createGraphic=function(e,t){var r={};if(null!=t.featureIds&&(r[this._getObjectIdField()]=t.featureIds[e]),null!=t.attributeData)for(var n=0,i=Object.keys(t.attributeData);n<i.length;n++){var o=i[n];r[o]=M.getCachedAttributeValue(t.attributeData[o],e)}var a=new l(null,null,r);return a.layer=this.layer,a.sourceLayer=this.layer,a},f.prototype._boundingBoxCornerPoints=function(e,t,r){for(var n=t.geometries[0].getComponentAABB(e,ae),i=0;i<8;++i)oe[0]=1&i?n[0]:n[3],oe[1]=2&i?n[1]:n[4],oe[2]=4&i?n[2]:n[5],V.mat4d.multiplyVec3(t.objectTransformation,oe),r[3*i]=oe[0],r[3*i+1]=oe[1],r[3*i+2]=oe[2];return r},f.prototype.highlight=function(e,t){var r=this,n=this._highlights;if(e instanceof E){var i=n.acquireSet(t),o=i.set,a=i.handle;return this.queryObjectIds(e).then(function(e){return n.setFeatureIds(o,e)}),a}if("number"==typeof e)return this.highlight([e],t);if(e instanceof l)return this.highlight([e],t);if(e instanceof c&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof l){var s=e.map(function(e){return N.attributeLookup(e.attributes,r._getObjectIdField())}),u=n.acquireSet(t),d=u.set;a=u.handle;return n.setFeatureIds(d,s),a}if("number"==typeof e[0]){s=e;var p=n.acquireSet(t);d=p.set,a=p.handle;return n.setFeatureIds(d,s),a}}return{remove:function(){}}},f.prototype.visibleGeometryChanged=function(e){var t=this;e?this._elevationProvider.objectChanged(e):this._elevationProvider.layerChanged(),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=v.schedule(function(){t.emit("visible-geometry-changed"),t._visibleGeometryChangedSchedulerHandle=null}))},n([b.property()],f.prototype,"layer",void 0),n([b.property()],f.prototype,"_controller",void 0),n([b.property({dependsOn:["_controller.updating"]})],f.prototype,"updating",void 0),n([b.property(U.updatingPercentage)],f.prototype,"updatingPercentage",void 0),n([b.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],f.prototype,"updatingPercentageValue",void 0),n([b.property({readOnly:!0})],f.prototype,"hasTexturesOrVertexColors",null),n([b.property({readOnly:!0,dependsOn:["layer.renderer"]})],f.prototype,"rendererNeedsTextures",null),n([b.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],f.prototype,"elevationOffset",null),n([b.property()],f.prototype,"alwaysLoadEverythingModeEnabled",void 0),n([b.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","_useCompressedTextures"]})],f.prototype,"uncompressedTextureDownsamplingEnabled",null),n([b.property({dependsOn:["layer.version"]})],f.prototype,"_useCompressedTextures",null),n([b.subclass("esri.views.3d.layers.SceneLayerView3D")],f)}(b.declared(A)),oe=V.vec3d.create(),ae=_.create(),se=_.create(),le=[0,0,0,0],ue={symbol:null};return ie}.apply(null,n))||(e.exports=i)},1514:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isOfType=function(e,t){var r=e.constructor._meta;if(!r||!r.bases)return!1;var n=r.bases,i=Array.isArray(t);return n.some(function(e){var r=e.__accessorMetadata__;if(!r)return!1;var n=r.properties;if(!n||!n.type||!n.type.value)return!1;var o=n.type.value;return i?-1!==t.indexOf(o):o===t})}}.apply(null,n))||(e.exports=i)},1516:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(10),r(0),r(29),r(4),r(8),r(6),r(1),r(54),r(408),r(411)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){var p=function(e){function t(t){var r=e.call(this)||this;return r.features=null,r.layer=null,r.objectIdField=null,r.dataSpatialReference=null,r}return r(t,e),t.prototype.queryFeatures=function(e){var t=this;return this._queryFeatures(e).then(function(e){var r=e.map(function(e){return d.hydrateGraphic(e,t.layer)});return new c({features:r,fields:t.layer?t.layer.fields.slice():null,geometryType:t.layer?t.layer.geometryType:null,spatialReference:t.dataSpatialReference?t.dataSpatialReference.clone():null})})},t.prototype.queryObjectIds=function(e){var t=this;return this.objectIdField?this.queryFeatures(e).then(function(e){return t._getObjectIds(e.features)}):this._rejectQuery("Unsupported query")},t.prototype.queryFeatureCount=function(e){return this.features&&!e?s.resolve(this.features.length):this._queryFeatures(e).then(function(e){return e.length})},t.prototype.queryExtent=function(e){var t=this;return this.queryFeatures(e).then(function(e){return{count:e.features.length,extent:t._getExtent(e.features)}})},t.prototype._queryFeatures=function(e){if(this.features){if(e){if(this._isSupportedQuery(e)){var t=this._createFilters(e);return t.length?this._executeQuery(e,t):this._rejectQuery("Invalid query")}return this._rejectQuery("Unsupported query")}return this._returnAllFeatures()}return this._rejectQuery("Engine not initialized")},t.prototype._returnAllFeatures=function(){return s.resolve(this.features.toArray())},t.prototype._executeQuery=function(e,t){var r=this,n=[];return this.features.forEach(function(i){t.every(function(t){return t.call(r,i,e)})&&n.push(i)}),s.resolve(n)},t.prototype._isSupportedQuery=function(e){var t=!0;return(null!=e.distance||null!=e.geometryPrecision||e.groupByFieldsForStatistics&&e.groupByFieldsForStatistics.length||null!=e.maxAllowableOffset||e.multipatchOption||null!=e.num||e.orderByFields&&e.orderByFields.length||e.outFields&&e.outFields.length||e.outSpatialReference||e.outStatistics&&e.outStatistics.length||e.pixelSize||e.quantizationParameters||e.relationParameter||e.returnDistinctValues||null!=e.start||e.text||e.timeExtent||e.where||e.objectIds&&e.objectIds.length&&!this.objectIdField)&&(t=!1),t},t.prototype._createFilters=function(e){var t=[];return e.objectIds&&e.objectIds.length&&t.push(this._createObjectIdFilter()),e.geometry&&"extent"===e.geometry.type&&"intersects"===e.spatialRelationship&&t.push(this._createExtentFilter()),t},t.prototype._createExtentFilter=function(){return function(e,t){var r=e.geometry;if(!r)return!1;var n=t.geometry;return u.fromExtent(n,f),d.computeAABR(r,h),u.intersects(f,h)}},t.prototype._createObjectIdFilter=function(){var e=this;return function(t,r){var n=t.attributes,i=n&&n[e.objectIdField];return r.objectIds.indexOf(i)>-1}},t.prototype._rejectQuery=function(e){return s.reject(new a(this.declaredClass,e))},t.prototype._getObjectIds=function(e){var t=this.objectIdField,r=[];return e.forEach(function(e){var n=e.attributes,i=n&&n[t];null!=i&&r.push(i)}),r},t.prototype._getExtent=function(e){if(0===e.length)return null;u.empty(f);for(var t=0;t<e.length;t++){var r=e[t].geometry;d.computeAABR(r,h),u.expand(f,h,f)}return new i.Extent({xmin:f[0],ymin:f[1],xmax:f[2],ymax:f[3],spatialReference:e[0].geometry.spatialReference})},n([l.property()],t.prototype,"features",void 0),n([l.property({constructOnly:!0})],t.prototype,"layer",void 0),n([l.property()],t.prototype,"objectIdField",void 0),n([l.property()],t.prototype,"dataSpatialReference",void 0),n([l.subclass("esri.layers.graphics.QueryEngine")],t)}(l.declared(o)),f=u.create(),h=u.create();return p}.apply(null,n))||(e.exports=i)},1517:function(e,t,r){var n,i;n=[r(156),r(212)],void 0===(i=function(e,t){function r(e,t){return e-t}function n(e,t){var r,n;return(r=Number(e.toFixed(t)))<e?n=r+1/Math.pow(10,t):(n=r,r-=1/Math.pow(10,t)),[r=Number(r.toFixed(t)),n=Number(n.toFixed(t))]}function i(e,t,r,n,i){var o,a,s=l.percentChange(e,t,r,n);return o=null==s.previous||s.previous<=i,a=null==s.next||s.next<=i,o&&a||s.previous+s.next<=2*i}var o=/^-?(\d+)(\.(\d+))?$/i,a=new RegExp("\\"+t.decimal+"0+$","g"),s=new RegExp("(\\d)0*$","g"),l={numDigits:function(e){var t=String(e),r=t.match(o),n={integer:0,fractional:0};if(r&&r[1])n.integer=r[1].split("").length,n.fractional=r[3]?r[3].split("").length:0;else if(t.toLowerCase().indexOf("e")>-1){var i,a,s=t.split("e"),u=s[0],d=s[1];u&&d&&(u=Number(u),(a=(d=Number(d))>0)||(d=Math.abs(d)),i=l.numDigits(u),a?(i.integer+=d,d>i.fractional?i.fractional=0:i.fractional-=d):(i.fractional+=d,d>i.integer?i.integer=1:i.integer-=d),n=i)}return n},percentChange:function(e,t,r,n){var i,o,a={previous:null,next:null};return null!=r&&(o=t-r-(i=e-r),a.previous=Math.floor(Math.abs(100*o/i))),null!=n&&(o=n-t-(i=n-e),a.next=Math.floor(Math.abs(100*o/i))),a},round:function(e,t){var o,a,s,u,d,c,p,f,h,m,v=e.slice(0),g=t&&null!=t.tolerance?t.tolerance:2,y=t&&t.indexes,b=!(!t||null==t.strictBounds)&&t.strictBounds;if(y)y.sort(r);else for(y=[],p=0;p<v.length;p++)y.push(p);for(p=0;p<y.length;p++)if(o=v[m=y[p]],a=0===m?null:v[m-1],s=m===v.length-1?null:v[m+1],u=l.numDigits(o).fractional){for(f=0,h=!1;f<=u&&!h;)c=n(o,f),h=i(o,d=b&&0===p?c[1]:c[0],a,s,g),f++;h&&(v[m]=d)}return v},format:function(t,r){r=r||{places:20,round:-1};var n=e.format(t,r);return n&&(n=n.replace(s,"$1").replace(a,"")),n}};return l}.apply(null,n))||(e.exports=i)},1518:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(4),r(5),r(1),r(422),r(426)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var i;return r(t,e),i=t,t.fromWorker=function(e){if(!e)return null;var t=JSON.parse(e),r=new i;return r.fields=t.fields&&t.fields.map(function(e){return s.fromJSON(e)}),r.options=t.options,r.process=new(Function.bind.apply(Function,[void 0].concat(t.process.args,[t.process.body]))),r},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i(o.clone({fields:this.fields,options:this.options,process:this.process}))},t.prototype.getField=function(e){return l.getField(e,this.fields)},t.prototype.refresh=function(){this.notifyChange("version")},t.prototype.toWorker=function(){var e=this.process.toString();return JSON.stringify({fields:this.fields,options:this.options,process:{body:e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),args:e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/([^\s,]+)/g)}})},n([a.property({type:[s]})],t.prototype,"fields",void 0),n([a.property()],t.prototype,"options",void 0),n([a.property()],t.prototype,"process",void 0),n([a.property({readOnly:!0,dependsOn:["process","options","fields"]})],t.prototype,"version",null),i=n([a.subclass("esri.layers.support.FeatureProcessing")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},1519:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(1)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=null,t}return r(t,e),n([o.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),n([o.subclass("esri.layers.support.FeatureReduction")],t)}(o.declared(i));t.FeatureReduction=a,t.default=a}.apply(null,n))||(e.exports=i)},1522:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1352),r(1486),r(1278),r(1277)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,r,n,i,o,a){switch(r){case 1:for(var s=0;s<a;s++)n[i]=e[t],t+=1,i+=o;break;case 2:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],t+=2,i+=o;break;case 3:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],n[i+2]=e[t+2],t+=3,i+=o;break;case 4:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],n[i+2]=e[t+2],n[i+3]=e[t+3],t+=4,i+=o;break;default:throw p("Unhandled stride size "+r)}}function s(e,t,r,n,i,o){switch(t){case 1:for(var a=0;a<o;a++)r[n]=e,n+=i;break;case 2:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,n+=i;break;case 3:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,r[n+2]=e,n+=i;break;case 4:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,r[n+2]=e,r[n+3]=e,n+=i;break;default:throw p("Unhandled stride size "+t)}}function l(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw new Error("Unhandled data type: "+e)}function u(e){switch(e){case 5120:return"Int8";case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw new Error("Unhandled data type: "+e)}function d(e){return e%Uint32Array.BYTES_PER_ELEMENT==0}function c(e){return e>0&&e%Uint32Array.BYTES_PER_ELEMENT==0}function p(e){return new Error("I3SGeometryUtil processing failed: "+e)}function f(e){var t=e.normals,r=e.positions,n=e.normalInd,a=e.positionInd;o.assert(e.normalInd.length===e.positionInd.length);for(var s=i.vec3.create(),l=i.vec3.create(),u=i.vec2.create(),d=r.data,c=r.offsetIdx,p=r.strideIdx,f=t.data,h=t.offsetIdx,m=t.strideIdx,v=0;v<a.length;v+=3){var g=a[v],y=c+p*g,b=d[y],_=d[y+1],x=d[y+2];y=c+p*(g=a[v+1]),s[0]=d[y]-b,s[1]=d[y+1]-_,s[2]=d[y+2]-x,y=c+p*(g=a[v+2]),l[0]=d[y]-b,l[1]=d[y+1]-_,l[2]=d[y+2]-x,i.vec3.cross(s,l,s),o.encodeNormal(s,u);for(var w=0;w<3;w++){var S=h+m*n[v+w];f[S]=o.encodeInt16(u[0]),f[S+1]=o.encodeInt16(u[1])}}}function h(e,t,r){var n=e.length/3,i=t.data,a=t.offsetIdx,s=t.strideIdx;if(null!=r)for(var l=r,u=l[0],d=l[1],c=l[2],p=l[4],f=l[5],h=l[6],m=l[8],v=l[9],b=l[10],_=0;_<n;_++){var x=e[3*_],w=e[3*_+1],S=e[3*_+2];g[0]=u*x+d*w+c*S,g[1]=p*x+f*w+h*S,g[2]=m*x+v*w+b*S,o.encodeNormal(g,y),i[a+_*s]=o.encodeInt16(y[0]),i[a+_*s+1]=o.encodeInt16(y[1])}else for(_=0;_<n;_++)g[0]=e[3*_],g[1]=e[3*_+1],g[2]=e[3*_+2],o.encodeNormal(g,y),i[a+_*s]=o.encodeInt16(y[0]),i[a+_*s+1]=o.encodeInt16(y[1])}Object.defineProperty(t,"__esModule",{value:!0});var m=new Uint8Array(64);t.interleaveGeometryBuffer=function(e,t,r,n,i){void 0===n&&(n=[]),void 0===i&&(i=[]);var o=e.params.vertexAttributes,f=o.position.count;if(!c(r[0].stride))throw p("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");for(var h=r[0].stride/Uint32Array.BYTES_PER_ELEMENT,v=new Uint32Array(h*f),g=0,y=r=r.slice(0).sort(function(e,t){return e.offset-t.offset});g<y.length;g++)!function(e){if(-1!==i.indexOf(e.name))return"continue";var r=o[e.name],h=l(e.type),g=void 0,y=!1;if(null==r){var b=n.filter(function(t){return t.name===e.name})[0];if(!b)throw p("Geometry definition is missing attribute");r={valueType:u(e.type),byteOffset:0,count:f,valuesPerElement:e.count};for(var _=0;_<m.length;_++)m[_]=b.byteValue;g=m.buffer,y=!0}else g=t;if(u(e.type)!==r.valueType)throw p("Geometry definition type must match attribute type");if(!d(r.byteOffset)||!d(e.offset))throw p(e.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!c(r.valuesPerElement*h.BYTES_PER_ELEMENT)||!c(e.count*h.BYTES_PER_ELEMENT))throw p(e.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var x=new Uint32Array(g),w=r.byteOffset/Uint32Array.BYTES_PER_ELEMENT,S=r.valuesPerElement*h.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,C=e.offset/Uint32Array.BYTES_PER_ELEMENT,D=e.stride/Uint32Array.BYTES_PER_ELEMENT;y?s(x[0],S,v,C,D,f):a(x,w,S,v,C,D,f)}(y[g]);return v.buffer},t.processAndInterleaveNormals=function(e,t,n,i,o){if("none"===e)f(o);else{var a=r.createTypedView(n,t.params.vertexAttributes.normal),s="earth-centered"===e?i:null;h(a,o.normals,s)}};var v=65536;t.extractPositionData=function(e,t,r){var i=t[0];if(null==i||"position"!==i.name||5126!==i.type)return null;for(var o=new Float32Array(e),a=i.stride/4,s=3*o.length/a,l=new Float32Array(s),u=0;u<s/3;u++)l[3*u]=o[u*a+i.offset],l[3*u+1]=o[u*a+i.offset+1],l[3*u+2]=o[u*a+i.offset+2];var d,c=n.deduplicate(l.buffer,3),p=c.uniqueCount<v;if(r)for(d=new(p?Uint16Array:Uint32Array)(r.length),u=0;u<r.length;u++)d[u]=c.indices[r[u]];else d=p?new Uint16Array(c.indices):c.indices;return{data:new Float32Array(c.buffer),indices:d}};var g=i.vec3.create(),y=i.vec2.create()}.apply(null,n))||(e.exports=i)},1523:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(40),r(74)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.ReprojectionTypes={PER_VERTEX:"perVertex",NO_REPROJECTION:"noReprojection"};var i=1e3,o=new Float64Array(3*i),a=r.vec3d.create();t.reprojectPoints=function(e,t,s,l,u,d){var c=e.data,p=e.offsetIdx,f=e.strideIdx;r.vec3d.set(t,a),a[2]+=s;var h=r.mat4d.create();n.computeLinearTransformation(l,a,h,d);var m=r.mat4d.create();r.mat4d.inverse(h,m);var v=r.mat4d.create();r.mat4d.identity(v);var g=[0,0,0],y=c.length/f;n.vectorToVector(a,l,g,u);for(var b=0;b<y;b+=i){for(var _=Math.min(i,y-b),x=0;x<_;x++){var w=p+f*(b+x);o[3*x]=c[w]+g[0],o[3*x+1]=c[w+1]+g[1],o[3*x+2]=c[w+2]+g[2]}for(n.bufferToBuffer(o,u,0,o,d,0,_),x=0;x<_;x++){var S=o[3*x],C=o[3*x+1],D=o[3*x+2],E=p+f*(b+x);c[E]=m[0]*S+m[4]*C+m[8]*D+m[12],c[E+1]=m[1]*S+m[5]*C+m[9]*D+m[13],c[E+2]=m[2]*S+m[6]*C+m[10]*D+m[14]}}return{localTrafo:v,globalTrafo:h}}}.apply(null,n))||(e.exports=i)},1530:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(78),r(8),r(6),r(408),r(411)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(e,t,r){this._layer=e,this._support=t,this._options=r}return e.prototype.queryExtent=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=0,n=t._support.createExtentBuilder();return t._forAllQueried(e,function(e){r++,n.add(e)}),{count:r,extent:0===r?null:n.getExtent()}})},e.prototype.queryFeatureCount=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=0;return t._forAllQueried(e,function(){return r++}),r})},e.prototype.queryFeatures=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var o=[],a=e&&e.outFields,s=[];return t._forAllQueried(e,function(e){return s.push(t._support.createGraphic(e))},function(e){a&&(o.push(t._support.requestFields(e,s,a)),s=[])})>0&&!e.num?i.reject(new n("Unsupported Query","Large feature query, use Query.num and Query.start to batch")):(a||o.push(i.resolve(s)),r(o))}).then(function(e){for(var r=[],n=0;n<e.length;++n)for(var i=e[n],s=0;s<i.length;++s)r.push(o.hydrateGraphic(i[s],t._layer));var l=new a;return l.features=r,l})},e.prototype.queryObjectIds=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=[];return t._forAllQueried(e,function(e){return r.push(e.id)}),r})},e.defaultExtentBuilder=function(e){var t=null;return{add:function(r){var n=e(r);n&&(t=null!=t?t.union(n):n.clone())},getExtent:function(){return t}}},e.prototype._forAllQueried=function(e,t,r){var n=[];if(e&&e.objectIds){var i=e.objectIds;n.push(function(e){return i.indexOf(e.id)>=0})}var o=e&&e.start||0,a=e&&e.num||1e4;return n.push(function(){return a<=0?(--a,!1):o>0?(--o,!1):(--a,!0)}),this._support.forAll(function(e){for(var r=0,i=n;r<i.length;r++)if(!(0,i[r])(e))return;t(e)},r),Math.max(0,-a)},e.prototype._rejectUnsupported=function(e){if(null==e)return i.resolve();var t=function(e){return i.reject(new n("Unsupported Query","Unsupported property '"+e+"'"))};return null!=e.distance?t("distance"):null!=e.geometryPrecision?t("geometryPrecision"):e.groupByFieldsForStatistics&&e.groupByFieldsForStatistics.length?t("groupByFieldsForStatistics"):null!=e.maxAllowableOffset?t("maxAllowableOffset"):e.multipatchOption?t("multipatchOption"):e.orderByFields&&e.orderByFields.length?t("orderByFields"):e.outSpatialReference?t("outSpatialReference"):e.outStatistics&&e.outStatistics.length?t("outStatistics"):e.pixelSize?t("pixelSize"):e.quantizationParameters?t("quantizationParameters"):e.relationParameter?t("relationParameter"):e.returnDistinctValues?t("returnDistinctValues"):e.text?t("text"):e.timeExtent?t("timeExtent"):e.where?t("where"):e.geometry?t("geometry"):!this._options.enableOutFields&&e.outFields&&e.outFields.length?t("outFields"):!this._options.enableObjectId&&e.objectIds&&e.objectIds.length?t("objectIds"):i.resolve()},e}()}.apply(null,n))||(e.exports=i)},1534:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1492),r(1493),r(1432),r(1482),r(1494)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.types={key:"type",base:i,typeMap:{heatmap:n,simple:o,"unique-value":a,"class-breaks":r}}}.apply(null,n))||(e.exports=i)},1546:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(1),r(1519)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="selection",t}return r(t,e),n([i.property()],t.prototype,"type",void 0),n([i.subclass("esri.layers.support.FeatureReductionSelection")],t)}(i.declared(o.default));t.FeatureReductionSelection=a,t.default=a}.apply(null,n))||(e.exports=i)},1547:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(24),r(5),r(1)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=o({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.description=null,r.drawingTool=null,r.prototype=null,r.thumbnail=null,r}return r(t,e),t.prototype.writeDrawingTool=function(e,t){t.drawingTool=l.toJSON(e)},t.prototype.writePrototype=function(e,t){t.prototype=a.fixJson(a.clone(e),!0)},t.prototype.writeThumbnail=function(e,t){t.thumbnail=a.fixJson(a.clone(e))},n([s.property({json:{write:!0}})],t.prototype,"name",void 0),n([s.property({json:{write:!0}})],t.prototype,"description",void 0),n([s.property({json:{read:l.fromJSON,write:!0}})],t.prototype,"drawingTool",void 0),n([s.writer("drawingTool")],t.prototype,"writeDrawingTool",null),n([s.property({json:{write:!0}})],t.prototype,"prototype",void 0),n([s.writer("prototype")],t.prototype,"writePrototype",null),n([s.property({json:{write:!0}})],t.prototype,"thumbnail",void 0),n([s.writer("thumbnail")],t.prototype,"writeThumbnail",null),n([s.subclass("esri.layers.support.FeatureTemplate")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},1548:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(82)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.replace=function(e,t,n){return void 0===n&&(n=/\{([^\}]+)\}/g),e.replace(n,"function"==typeof t?t:function(e,n){return r.getDeepValue(n,t)})}}.apply(null,n))||(e.exports=i)},1549:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(1),r(1496)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.expression=null,t}var i;return r(t,e),i=t,t.prototype.readExpression=function(e,t){return t.value?a.convertTemplatedStringToArcade(t.value):e},t.prototype.writeExpression=function(e,t,r){null!=this.value&&(e=a.convertTemplatedStringToArcade(this.value)),t[r]=e},t.prototype.clone=function(){return new i({value:this.value,expression:this.expression})},n([o.property({json:{read:!1,write:!1}})],t.prototype,"value",void 0),n([o.property({json:{write:{allowNull:!0}}})],t.prototype,"expression",void 0),n([o.reader("expression",["expression","value"])],t.prototype,"readExpression",null),n([o.writer("expression")],t.prototype,"writeExpression",null),i=n([o.subclass("esri.layers.support.LabelExpressionInfo")],t)}(o.declared(i))}.apply(null,n))||(e.exports=i)},1550:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1476)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=/\[([^\[\]]+)\]/gi;t.reader=function(e,t,i){var o=this;return e?e.map(function(e){var a=new r;if(a.read(e,i),a.labelExpression){var s=t.fields||t.layerDefinition&&t.layerDefinition.fields||o.fields;a.labelExpression=a.labelExpression.replace(n,function(e,t){return"["+function(e,t){if(!t)return e;for(var r=e.toLowerCase(),n=0;n<t.length;n++){var i=t[n].name;if(i.toLowerCase()===r)return i}return e}(t,s)+"]"})}return a}):null}}.apply(null,n))||(e.exports=i)},1612:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1470)],void 0===(i=function(e,t,r){var n=function(){return function(e){this.highlightSet=new r,this.ids=new Set,this.options=e}}();return function(){function e(e){this.highlights=[],this.layerView=e}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.acquireSet=function(e){var t=this,r=new n(e);return this.highlights.push(r),{set:r,handle:{remove:function(){return t.releaseSet(r)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setFeatureIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.layerView._forAllFeatures(function(t,r,n,i){if(e.ids.has(t)){var o=n.engineObject.setComponentHighlight(i,r,e.options);e.highlightSet.addObject(n.engineObject,o)}},null,!0)},e.prototype.objectCreated=function(e){var t=this;this.highlights.forEach(function(r){t.layerView._forAllFeaturesOfNode(t.layerView._getMetadata(e),function(t,n,i,o){if(r.ids.has(t)){var a=e.setComponentHighlight(o,n,r.options);r.highlightSet.addObject(e,a)}},!0)})},e.prototype.objectDeleted=function(e){this.highlights.forEach(function(t){t.highlightSet.removeObject(e)})},e.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e}()}.apply(null,n))||(e.exports=i)},1613:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(4),r(7),r(1),r(54),r(408),r(40),r(1451),r(1344)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){var p=s.empty(),f={spatialReference:null,extent:p},h=u.vec3d.create(),m=u.vec3d.create(),v=u.vec3d.create(),g=o.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(e){function t(t){return e.call(this)||this}return r(t,e),t.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper,this.intersectLayers=[this.stageLayer],this.selector=new c(this.layerView.view.viewingMode);var e=this.layerView.layer.fullExtent;this.zmin=e.zmin,this.zmax=e.zmax},t.prototype.getElevation=function(e){if(l.isPoint(e)){if(!this.renderCoordsHelper.toRenderCoords(e,h))return g.error("could not project point for elevation alignment"),-1/0}else if(!this.renderCoordsHelper.toRenderCoords(e,this.spatialReference,h))return g.error("could not project point for elevation alignment"),-1/0;var t=this.layerView.elevationOffset,r=this.zmin+t,n=this.zmax+t;return u.vec3d.set(h,m),u.vec3d.set(h,v),this.renderCoordsHelper.setAltitude(n,m),this.renderCoordsHelper.setAltitude(r,v),this.selector.init(this.intersectLayers,m,v,null,null,1,!1),this.selector.getMinResult().getIntersectionPoint(h)?this.renderCoordsHelper.getAltitude(h):-1/0},t.prototype.layerChanged=function(){this.spatialReference&&(f.extent=this.computeLayerExtent(this.intersectLayers[0]),f.spatialReference=this.spatialReference,this.emit("elevation-change",f))},t.prototype.objectChanged=function(e){this.spatialReference&&(f.extent=this.computeObjectExtent(e),f.spatialReference=this.spatialReference,this.emit("elevation-change",f))},t.prototype.computeObjectExtent=function(e){return s.empty(p),this.expandExtent(e,p),p},t.prototype.computeLayerExtent=function(e){s.empty(p);for(var t=0,r=e.getObjects();t<r.length;t++){var n=r[t];this.expandExtent(n,p)}return p},t.prototype.expandExtent=function(e,t){for(var r=e.getBBMin(!0),n=e.getBBMax(!0),i=0;i<8;++i)h[0]=1&i?r[0]:n[0],h[1]=2&i?r[1]:n[1],h[2]=4&i?r[2]:n[2],u.mat4d.multiplyVec3(e.objectTransformation,h),this.renderCoordsHelper.fromRenderCoords(h,h,this.spatialReference),s.expand(t,h);return t},n([a.property({constructOnly:!0})],t.prototype,"layerView",void 0),n([a.property({constructOnly:!0})],t.prototype,"stageLayer",void 0),n([a.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],t.prototype,"spatialReference",void 0),n([a.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],t)}(a.declared(i,d.Evented))}.apply(null,n))||(e.exports=i)},1614:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(6)],void 0===(i=function(e,t,r,n){function i(e){return n.create(function(t,r){e.oncomplete=function(){return t()},e.onerror=function(){return r(e.error)},e.onabort=function(){return r(e.error)}})}function o(e){return n.create(function(t,r){"done"===e.readyState?null!=e.error?r(e.error):t(e.result):(e.onsuccess=function(){return t(e.result)},e.onerror=function(){return r(e.error)})})}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r){this._db=null,this._quotaReductionPromise=null,this._gcCounter=0,this._hit=0,this._miss=0,this._destroyed=!1,this.gcFrequency=50,this.maxByteSize=1073741824,this.quotaReductionFactor=.2,this._dbName=e,this._storeName=t,this._version=r}return e.prototype.init=function(){var e=this;return n.resolve().then(function(){var t=indexedDB.open(e._dbName,e._version);return t.onupgradeneeded=function(r){var n=t.result,i=t.transaction,o=n.objectStoreNames.contains(e._storeName)?i.objectStore(e._storeName):n.createObjectStore(e._storeName),a=n.objectStoreNames.contains("last_access")?i.objectStore("last_access"):n.createObjectStore("last_access");a.indexNames.contains("date")||a.createIndex("date","date",{unique:!1}),a.indexNames.contains("byteSize")||a.createIndex("byteSize","byteSize",{unique:!1}),r.oldVersion<e._version&&(o.clear(),a.clear())},o(t)}).then(function(t){e._destroyed?t.close():e._db=t})},e.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null),this._destroyed=!0},e.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype.put=function(e,t){var i=this;return null==this._db?n.reject(new r("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:n.resolve()).then(function(){return i._put(e,t)}).catch(function(r){if("QuotaExceededError"===r.name)return null==i._quotaReductionPromise&&(i._quotaReductionPromise=i._getCacheSize().then(function(e){return i._removeLeastRecentlyAccessed(t.byteSize+Math.ceil(e*i.quotaReductionFactor))}),i._quotaReductionPromise.always(function(){i._quotaReductionPromise=null})),i._quotaReductionPromise.then(function(){return i._put(e,t)});throw r}).then(function(){--i._gcCounter<0&&(i._gcCounter=i.gcFrequency,i._getCacheSize().then(function(e){return i._removeLeastRecentlyAccessed(e-i.maxByteSize)}))})},e.prototype.get=function(e){var t=this;return null==this._db?n.resolve(null):n.resolve().then(function(){return o(t._db.transaction(t._storeName,"readonly").objectStore(t._storeName).get(e))}).then(function(r){return null==r?++t._miss:(++t._hit,t._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:r.byteSize},e)),r}).catch(function(e){return++t._miss,null})},e.prototype.remove=function(e){var t=this;return null==this._db?n.resolve():n.resolve().then(function(){var r=t._db.transaction([t._storeName,"last_access"],"readwrite"),n=r.objectStore(t._storeName),o=r.objectStore("last_access");return n.delete(e),o.delete(e),i(r)})},e.prototype._put=function(e,t){var r=this._db.transaction([this._storeName,"last_access"],"readwrite");return r.objectStore(this._storeName).put(t,e),r.objectStore("last_access").put({date:(new Date).getTime(),byteSize:t.byteSize},e),i(r)},e.prototype._removeLeastRecentlyAccessed=function(e){if(!(e<=0)){var t=this._db.transaction([this._storeName,"last_access"],"readwrite"),r=t.objectStore(this._storeName),n=t.objectStore("last_access"),o=0,a=n.index("date").openCursor(null,"next");return a.onsuccess=function(t){var i=a.result;null!=i&&(null!=i.value.byteSize&&(o+=i.value.byteSize),r.delete(i.primaryKey),n.delete(i.primaryKey),o<e&&i.continue())},i(t)}},e.prototype._getCacheSize=function(){var e=this._db.transaction("last_access"),t=0,r=e.objectStore("last_access").index("byteSize").openKeyCursor();return r.onsuccess=function(e){var n=r.result;if(n){var i=n.key;null!=i&&(t+=i),n.continue()}},i(e).then(function(){return t})},e}();t.IDBCache=a,t.whenTransaction=i,t.whenRequest=o}.apply(null,n))||(e.exports=i)},1623:function(e,t,r){var n,i;n=[r(17),r(146),r(6),r(8),r(411),r(91),r(1516)],void 0===(i=function(e,t,r,n,i,o,a){return e.ofType(o).createSubclass([t],{declaredClass:"esri.layers.graphics.sources.MemorySource",properties:{layer:{value:null},_queryEngine:{value:null,dependsOn:["layer.loaded"],get:function(){return this.get("layer.loaded")?new a({features:this,spatialReference:this.layer.spatialReference,objectIdField:this.layer.objectIdField}):null}}},queryFeatures:function(e){return this._queryEngine?this._queryEngine.queryFeatures(e).then(function(e){var t=new i;return t.features=e,t}):this._rejectQuery("Not ready to execute query")},queryObjectIds:function(e){return this._queryEngine?this._queryEngine.queryObjectIds(e):this._rejectQuery("Not ready to execute query")},queryFeatureCount:function(e){return this._queryEngine?this._queryEngine.queryFeatureCount(e):this._rejectQuery("Not ready to execute query")},queryExtent:function(e){return this._queryEngine?this._queryEngine.queryExtent(e):this._rejectQuery("Not ready to execute query")},_rejectQuery:function(e){return r.reject(new n("MemorySource",e))}})}.apply(null,n))||(e.exports=i)},1640:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(24),r(5),r(1),r(1641)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=o({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),d=o({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size"});return function(e){function t(t){var r=e.call(this)||this;return r.lengthUnit=null,r.visualVariables=null,r}var i;return r(t,e),i=t,Object.defineProperty(t.prototype,"classificationMethod",{get:function(){var e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e},set:function(e){this._set("classificationMethod",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this.type&&"predominance"!==this.type?null:this._get("fields")},set:function(e){this._set("fields",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"field1",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("field1")},set:function(e){this._set("field1",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"field2",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("field2")},set:function(e){this._set("field2",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focus",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("focus")},set:function(e){this._set("focus",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numClasses",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")},set:function(e){this._set("numClasses",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"standardDeviationInterval",{get:function(){var e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e?null:this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")},set:function(e){this._set("standardDeviationInterval",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._get("type")},set:function(e){var t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({classificationMethod:this.classificationMethod,fields:this.fields&&this.fields.slice(0),field1:a.clone(this.field1),field2:a.clone(this.field2),focus:this.focus,numClasses:this.numClasses,lengthUnit:this.lengthUnit,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(function(e){return e.clone()})})},n([s.property({type:String,value:null,dependsOn:["type"],json:{read:u.read,write:u.write}})],t.prototype,"classificationMethod",null),n([s.property({type:[String],value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"fields",null),n([s.property({value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"field1",null),n([s.property({value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"field2",null),n([s.property({type:String,value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"focus",null),n([s.property({type:Number,value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"numClasses",null),n([s.property({type:String,json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],t.prototype,"lengthUnit",void 0),n([s.property({type:Number,value:null,dependsOn:["classificationMethod","type"],json:{write:!0}})],t.prototype,"standardDeviationInterval",null),n([s.property({type:String,value:null,json:{read:d.read,write:d.write}})],t.prototype,"type",null),n([s.property({type:[l],json:{write:!0}})],t.prototype,"visualVariables",void 0),i=n([s.subclass("esri.renderers.support.AuthoringInfo")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},1641:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(24),r(1),r(221)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=o({percentTotal:"percent-of-total"}),u=o({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity"}),d={key:function(e){return"number"==typeof e?"number":"string"},typeMap:{number:Number,string:String},base:null};return function(e){function t(t){var r=e.call(this)||this;return r.endTime=null,r.field=null,r.maxSliderValue=null,r.minSliderValue=null,r.startTime=null,r.type=null,r.units=null,r}var i;return r(t,e),i=t,t.prototype.castEndTime=function(e){return"string"==typeof e||"number"==typeof e?e:null},t.prototype.castStartTime=function(e){return"string"==typeof e||"number"==typeof e?e:null},Object.defineProperty(t.prototype,"style",{get:function(){return"color"===this.type?this._get("style"):null},set:function(e){this._set("style",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theme",{get:function(){return"color"===this.type?this._get("theme")||"high-to-low":null},set:function(e){this._set("theme",e)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})},n([a.property({types:d,json:{write:!0}})],t.prototype,"endTime",void 0),n([s.cast("endTime")],t.prototype,"castEndTime",null),n([a.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"maxSliderValue",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"minSliderValue",void 0),n([a.property({types:d,json:{write:!0}})],t.prototype,"startTime",void 0),n([s.cast("startTime")],t.prototype,"castStartTime",null),n([a.property({type:String,value:null,dependsOn:["type"],json:{read:l.read,write:l.write}})],t.prototype,"style",null),n([a.property({type:String,value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"theme",null),n([a.property({type:String,json:{read:u.read,write:u.write}})],t.prototype,"type",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"units",void 0),i=n([a.subclass("esri.renderers.support.AuthoringInfoVisualVariable")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},1642:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(1),r(150),r(204)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.description=null,t.label=null,t.minValue=null,t.maxValue=0,t.symbol=null,t}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})},n([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),n([o.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],t.prototype,"minValue",void 0),n([o.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],t.prototype,"maxValue",void 0),n([o.property({types:s.rendererTypes,json:{origins:{"web-scene":{read:a.read,write:{target:{symbol:{types:s.rendererTypes3D}},writer:a.writeTarget}}},read:a.read,write:a.writeTarget}})],t.prototype,"symbol",void 0),i=n([o.subclass("esri.renderers.support.ClassBreakInfo")],t)}(o.declared(i));t.ClassBreakInfo=l,t.default=l}.apply(null,n))||(e.exports=i)},1643:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(31),r(12),r(1)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this)||this;return r.color=null,r.ratio=null,r}var o;return r(t,e),o=t,t.prototype.clone=function(){return new o({color:this.color,ratio:this.ratio})},n([a.property({type:i,json:{write:!0}})],t.prototype,"color",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"ratio",void 0),o=n([a.subclass("esri.renderers.support.HeatmapColorStop")],t)}(a.declared(o));t.HeatmapColorStop=s,t.default=s}.apply(null,n))||(e.exports=i)},1644:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(1),r(150),r(204)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.description=null,t.label=null,t.symbol=null,t.value=null,t}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})},n([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),n([o.property({types:s.rendererTypes,json:{origins:{"web-scene":{read:a.read,write:{target:{symbol:{types:s.rendererTypes3D}},writer:a.writeTarget}}},read:a.read,write:a.writeTarget}})],t.prototype,"symbol",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"value",void 0),i=n([o.subclass("esri.renderers.support.UniqueValueInfo")],t)}(o.declared(i));t.UniqueValueInfo=l,t.default=l}.apply(null,n))||(e.exports=i)},1645:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(1)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){return e.call(this,t)||this}var i;return r(t,e),i=t,t.prototype.clone=function(){var e=this,t=e.name,r=e.fields,n=e.isAscending,o=e.isUnique,a=e.description;return new i({name:t,fields:r,isAscending:n,isUnique:o,description:a})},n([o.property({constructOnly:!0})],t.prototype,"name",void 0),n([o.property({constructOnly:!0})],t.prototype,"fields",void 0),n([o.property({constructOnly:!0})],t.prototype,"isAscending",void 0),n([o.property({constructOnly:!0})],t.prototype,"isUnique",void 0),n([o.property({constructOnly:!0})],t.prototype,"description",void 0),i=n([o.subclass("esri.layers.support.FeatureIndex")],t)}(o.declared(i));t.FeatureIndex=a,t.default=a}.apply(null,n))||(e.exports=i)},1646:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(5),r(1),r(462),r(1547)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.id=null,r.name=null,r.domains=null,r.templates=null,r}return r(t,e),t.prototype.readDomains=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];switch(n.type){case"range":t[r]=s.RangeDomain.fromJSON(n);break;case"codedValue":t[r]=s.CodedValueDomain.fromJSON(n);break;case"inherited":t[r]=s.InheritedDomain.fromJSON(n)}}return t},t.prototype.writeDomains=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]&&e[n].toJSON());o.fixJson(r),t.domains=r},t.prototype.readTemplates=function(e){return e&&e.map(function(e){return new l(e)})},t.prototype.writeTemplates=function(e,t){t.templates=e&&e.map(function(e){return e.toJSON()})},n([a.property({json:{write:!0}})],t.prototype,"id",void 0),n([a.property({json:{write:!0}})],t.prototype,"name",void 0),n([a.property({json:{write:!0}})],t.prototype,"domains",void 0),n([a.reader("domains")],t.prototype,"readDomains",null),n([a.writer("domains")],t.prototype,"writeDomains",null),n([a.property({json:{write:!0}})],t.prototype,"templates",void 0),n([a.reader("templates")],t.prototype,"readTemplates",null),n([a.writer("templates")],t.prototype,"writeTemplates",null),n([a.subclass("esri.layers.support.FeatureType")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},1647:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(24),r(1)],void 0===(i=function(e,t,r,n,i,o,a){var s=o({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"});return function(e){function t(t){var r=e.call(this,t)||this;return r.cardinality=null,r.id=null,r.keyField=null,r.name=null,r.relatedTableId=null,r}return r(t,e),n([a.property({json:{read:s.read,write:s.write}})],t.prototype,"cardinality",void 0),n([a.property({json:{read:!0,write:!0}})],t.prototype,"id",void 0),n([a.property({json:{read:!0,write:!0}})],t.prototype,"keyField",void 0),n([a.property({json:{read:!0,write:!0}})],t.prototype,"name",void 0),n([a.property({json:{read:!0,write:!0}})],t.prototype,"relatedTableId",void 0),n([a.subclass("esri.layers.support.Relationship")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},1649:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(12),r(1)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=null,t.field=null,t.currentRangeExtent=null,t.fullRangeExtent=null,t.type="rangeInfo",t}return r(t,e),n([o.property({type:String,json:{read:!0,write:!0}})],t.prototype,"name",void 0),n([o.property({type:String,json:{read:!0,write:!0}})],t.prototype,"field",void 0),n([o.property({type:[Number],json:{read:!0,write:!0}})],t.prototype,"currentRangeExtent",void 0),n([o.property({type:[Number],json:{read:!0,write:!0}})],t.prototype,"fullRangeExtent",void 0),n([o.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),n([o.subclass("esri.layers.support.RangeInfo")],t)}(o.declared(i));t.RangeInfo=a,t.default=a}.apply(null,n))||(e.exports=i)},1669:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(223),r(1670),r(1671)],void 0===(i=function(e,t,r,n,i){function o(e){return r(e,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate()}function a(e){return r(e,["YYYY-M-D"]).toDate()}function s(e){return!0===e}function l(e){return Array.isArray(e)?e:[e]}function u(e){return null!==e?!0!==e:null}function d(e,t){if(null==e)return null;for(var r=!1,n=0,i=t;n<i.length;n++){var o=i[n];if(null==o)r=null;else if(e===o){r=!0;break}}return r}function c(e,t,r){if(null==e)return null;for(var n=t,i=r,o="",a="-[]/{}()*+?.\\^$|",s=0,l=0;l<n.length;l++){var u=n.charAt(l);switch(s){case 0:u===i?s=1:a.indexOf(u)>=0?o+="\\"+u:o+="%"===u?".*":"_"===u?".":u;break;case 1:a.indexOf(u)>=0?o+="\\"+u:o+=u,s=0}}return new RegExp("^"+o+"$").test(e)}function p(e){return e instanceof Date?e.valueOf():e}function f(e){for(var t=[],r={},n=0,i=e;n<i.length;n++){var o=i[n],a=o.toLowerCase();void 0===r[a]&&(t.push(o),r[a]=1)}return t}return function(){function e(){this.parseTree=null,this.parameters=null}return e.create=function(t){var r=new e;return r.parseTree=i.WhereGrammar.parse(t),r},e.prototype.isStandardized=function(){var e=!0;return this.visitAll(this.parseTree,function(t){e&&"function"===t.type&&(e=n.isStandardized(t.name,t.args.value.length))}),e},e.prototype.setVariablesDictionary=function(e){this.parameters=e},e.prototype.testFeature=function(e){return!!this.evaluateNode(this.parseTree,e)},e.prototype.calculateValue=function(e){return this.evaluateNode(this.parseTree,e)},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,function(t){"function"===t.type&&e.push(t.name.toLowerCase())}),f(e)},e.prototype.getFields=function(){var e=[];return this.visitAll(this.parseTree,function(t){"column_ref"===t.type&&e.push(t.column)}),f(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,function(t){"param"===t.type&&e.push(t.value.toLowerCase())}),f(e)},e.prototype.featureValue=function(e,t,r){var n=function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e,i=n[t];if(void 0!==i)return i;for(var o in n)if(t.toLowerCase()===o.toLowerCase())return r.column=o,n[o];return null},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var i=n[r];this.visitAll(i,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var o=0,a=e.value;o<a.length;o++){i=a[o];this.visitAll(i,t)}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNode=function(e,t){switch(e.type){case"case_expression":if("simple"===e.format){for(var r=p(this.evaluateNode(e.operand,t)),i=0;i<e.clauses.length;i++)if(r===p(this.evaluateNode(e.clauses[i].operand,t)))return this.evaluateNode(e.clauses[i].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}else{for(i=0;i<e.clauses.length;i++)if(s(this.evaluateNode(e.clauses[i].operand,t)))return this.evaluateNode(e.clauses[i].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var f=[],h=0,m=e.value;h<m.length;h++){var v=m[h];f.push(this.evaluateNode(v,t))}return f;case"unary_expr":return u(this.evaluateNode(e.expr,t));case"binary_expr":switch(e.operator){case"AND":return function(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"OR":return function(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t);case"IN":var g=l(this.evaluateNode(e.right,t));return d(this.evaluateNode(e.left,t),g);case"NOT IN":g=l(this.evaluateNode(e.right,t));return u(d(this.evaluateNode(e.left,t),g));case"BETWEEN":var y=this.evaluateNode(e.left,t),b=this.evaluateNode(e.right,t);return null==y||null==b[0]||null==b[1]?null:y>=b[0]&&y<=b[1];case"NOTBETWEEN":y=this.evaluateNode(e.left,t),b=this.evaluateNode(e.right,t);return null==y||null==b[0]||null==b[1]?null:y<b[0]||y>b[1];case"LIKE":return c(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape);case"NOT LIKE":return u(c(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return function(e,t,r){if(null==t||null==r)return null;var n=p(t),i=p(r);switch(e){case"<>":return n!==i;case"=":return n===i;case">":return n>i;case"<":return n<i;case">=":return n>=i;case"<=":return n<=i}}(e.operator,this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"*":return this.evaluateNode(e.left,t)*this.evaluateNode(e.right,t);case"-":return this.evaluateNode(e.left,t)-this.evaluateNode(e.right,t);case"+":return this.evaluateNode(e.left,t)+this.evaluateNode(e.right,t);case"/":return this.evaluateNode(e.left,t)/this.evaluateNode(e.right,t)}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return a(e.value);case"timestamp":return o(e.value);case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?((v=new Date).setHours(0,0,0,0),v):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?new Date:this.featureValue(t,e.column,e);case"function":var _=this.evaluateNode(e.args,t);return n.evaluateFunction(e.name,_)}throw new Error("Unsupported sql syntax "+e.type)},e}()}.apply(null,n))||(e.exports=i)},1670:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(213)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateFunction=function(e,t){var r=n[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=n[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var n={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var n=e[2];return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",i=t?e[2]:e[1];if(null==n||null==i)return null;var o="("+r.escapeString(n)+")";switch(e[0]){case"BOTH":return i.replace(new RegExp("^"+o+"*|"+o+"*$","g"),"");case"LEADING":return i.replace(new RegExp("^"+o+"*","g"),"");case"TRAILING":return i.replace(new RegExp(o+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,n))||(e.exports=i)},1671:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1672)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.parse=function(e){return r.parse(e)},e}();t.WhereGrammar=n}.apply(null,n))||(e.exports=i)},1672:function(e,t,r){var n;void 0===(n=function(){"use strict";function e(t,r,n,i){this.message=t,this.expected=r,this.found=n,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function o(e){return a[e.type](e)}var a={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?i(e.parts[t][0])+"-"+i(e.parts[t][1]):i(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,r,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=o(e[t]);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+(t?'"'+n(t)+'"':"end of input")+" found."},{SyntaxError:e,parse:function(t,r){function n(e,t){return{type:"literal",text:e,ignoreCase:t}}function i(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function o(e){var r,n=hi[e];if(n)return n;for(r=e-1;!hi[r];)r--;for(n={line:(n=hi[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return hi[e]=n,n}function a(e,t){var r=o(e),n=o(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function s(e){fi<mi||(fi>mi&&(mi=fi,vi=[]),vi.push(e))}function l(){var e,t;return e=fi,ce()!==ge&&(t=d())!==ge&&ce()!==ge?e=_e(t):(fi=e,e=ge),e}function u(){var e,t,r,n,i,o,a,s;if(e=fi,(t=d())!==ge){for(r=[],n=fi,(i=ce())!==ge&&(o=le())!==ge&&(a=ce())!==ge&&(s=d())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=ce())!==ge&&(o=le())!==ge&&(a=ce())!==ge&&(s=d())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=xe(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function d(){var e,t,r,n,i,o,a,s;if(e=fi,(t=c())!==ge){for(r=[],n=fi,(i=ce())!==ge&&(o=$())!==ge&&(a=ce())!==ge&&(s=c())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=ce())!==ge&&(o=$())!==ge&&(a=ce())!==ge&&(s=c())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=we(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function c(){var e,t,r,n,i,o,a,s;if(e=fi,(t=p())!==ge){for(r=[],n=fi,(i=ce())!==ge&&(o=q())!==ge&&(a=ce())!==ge&&(s=p())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=ce())!==ge&&(o=q())!==ge&&(a=ce())!==ge&&(s=p())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=we(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function p(){var e,r,n,i,o;return e=fi,(r=W())===ge&&(r=fi,33===t.charCodeAt(fi)?(n=Se,fi++):(n=ge,0===gi&&s(Ce)),n!==ge?(i=fi,gi++,61===t.charCodeAt(fi)?(o=De,fi++):(o=ge,0===gi&&s(Ee)),gi--,o===ge?i=void 0:(fi=i,i=ge),i!==ge?r=n=[n,i]:(fi=r,r=ge)):(fi=r,r=ge)),r!==ge&&(n=ce())!==ge&&(i=p())!==ge?e=r=Ae(i):(fi=e,e=ge),e===ge&&(e=function(){var e,t,r;return e=fi,(t=v())!==ge&&ce()!==ge?((r=function(){var e;return(e=function(){var e,t,r,n,i,o;if(fi,e=[],t=fi,(r=ce())!==ge&&(n=f())!==ge&&(i=ce())!==ge&&(o=v())!==ge?t=r=[r,n,i,o]:(fi=t,t=ge),t!==ge)for(;t!==ge;)e.push(t),t=fi,(r=ce())!==ge&&(n=f())!==ge&&(i=ce())!==ge&&(o=v())!==ge?t=r=[r,n,i,o]:(fi=t,t=ge);else e=ge;return e!==ge&&(e=Oe(e)),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=m())!==ge&&ce()!==ge&&(r=ue())!==ge&&ce()!==ge&&(n=u())!==ge&&ce()!==ge&&de()!==ge?(t=Qe(t,n),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=m())!==ge&&ce()!==ge&&(r=ue())!==ge&&ce()!==ge&&(n=de())!==ge?(t=Xe(t),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=m())!==ge&&ce()!==ge&&(r=D())!==ge?(t=Ze(t,r),e=t):(fi=e,e=ge))),e}())===ge&&(e=function(){var e,t,r,n,i,o;return e=fi,(t=W())!==ge&&ce()!==ge&&(r=Y())!==ge&&ce()!==ge&&(n=v())!==ge&&ce()!==ge&&(i=q())!==ge&&ce()!==ge&&(o=v())!==ge?(t=He(r,n,o),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=Y())!==ge&&ce()!==ge&&(r=v())!==ge&&ce()!==ge&&(n=q())!==ge&&ce()!==ge&&(i=v())!==ge?(t=We(t,r,i),e=t):(fi=e,e=ge)),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=B())!==ge&&ce()!==ge&&(r=W())!==ge&&ce()!==ge&&(n=v())!==ge?(t=Be(t,n),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=B())!==ge&&ce()!==ge&&(r=v())!==ge?(t=Ge(t,r),e=t):(fi=e,e=ge)),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=h())!==ge&&ce()!==ge&&(r=A())!==ge&&ce()!==ge&&H()!==ge&&ce()!==ge&&(n=T())!==ge?(t=$e(t,r,n),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=h())!==ge&&ce()!==ge&&(r=A())!==ge?(t=Ye(t,r),e=t):(fi=e,e=ge)),e}()),e}())===ge&&(r=null),r!==ge?(t=Te(t,r),e=t):(fi=e,e=ge)):(fi=e,e=ge),e}()),e}function f(){var e;return t.substr(fi,2)===Ie?(e=Ie,fi+=2):(e=ge,0===gi&&s(Re)),e===ge&&(62===t.charCodeAt(fi)?(e=Pe,fi++):(e=ge,0===gi&&s(Me)),e===ge&&(t.substr(fi,2)===Le?(e=Le,fi+=2):(e=ge,0===gi&&s(Ne)),e===ge&&(t.substr(fi,2)===Fe?(e=Fe,fi+=2):(e=ge,0===gi&&s(Ue)),e===ge&&(60===t.charCodeAt(fi)?(e=Ve,fi++):(e=ge,0===gi&&s(je)),e===ge&&(61===t.charCodeAt(fi)?(e=De,fi++):(e=ge,0===gi&&s(Ee)),e===ge&&(t.substr(fi,2)===ke?(e=ke,fi+=2):(e=ge,0===gi&&s(ze)))))))),e}function h(){var e,t,r,n,i;return e=fi,t=fi,(r=W())!==ge&&(n=ce())!==ge&&(i=G())!==ge?t=r=[r,n,i]:(fi=t,t=ge),t!==ge&&(t=qe(t)),(e=t)===ge&&(e=G()),e}function m(){var e,t,r,n,i;return e=fi,t=fi,(r=W())!==ge&&(n=ce())!==ge&&(i=z())!==ge?t=r=[r,n,i]:(fi=t,t=ge),t!==ge&&(t=qe(t)),(e=t)===ge&&(e=z()),e}function v(){var e,t,r,n,i,o,a,s;if(e=fi,(t=y())!==ge){for(r=[],n=fi,(i=ce())!==ge&&(o=g())!==ge&&(a=ce())!==ge&&(s=y())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=ce())!==ge&&(o=g())!==ge&&(a=ce())!==ge&&(s=y())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=we(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function g(){var e;return 43===t.charCodeAt(fi)?(e=Ke,fi++):(e=ge,0===gi&&s(Je)),e===ge&&(45===t.charCodeAt(fi)?(e=et,fi++):(e=ge,0===gi&&s(tt))),e}function y(){var e,t,r,n,i,o,a,s;if(e=fi,(t=_())!==ge){for(r=[],n=fi,(i=ce())!==ge&&(o=b())!==ge&&(a=ce())!==ge&&(s=_())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=ce())!==ge&&(o=b())!==ge&&(a=ce())!==ge&&(s=_())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=rt(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function b(){var e;return 42===t.charCodeAt(fi)?(e=nt,fi++):(e=ge,0===gi&&s(it)),e===ge&&(47===t.charCodeAt(fi)?(e=ot,fi++):(e=ge,0===gi&&s(at))),e}function _(){var e,t;return(e=function(){var e;return(e=T())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=function(){var e,t,r,n;return e=fi,(t=P())!==ge&&(r=M())!==ge&&(n=L())!==ge?(t=Yt(t,r,n),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=P())!==ge&&(r=M())!==ge?(t=Qt(t,r),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=P())!==ge&&(r=L())!==ge?(t=Xt(t,r),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=P())!==ge&&(t=Zt(t)),e=t))),e}())!==ge?(r=fi,gi++,n=w(),gi--,n===ge?r=void 0:(fi=r,r=ge),r!==ge?(t=$t(t),e=t):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t;return e=fi,(t=j())!==ge&&(t=Ot()),(e=t)===ge&&(e=fi,(t=k())!==ge&&(t=It()),e=t),e}())===ge&&(e=function(){var e;return fi,(e=V())!==ge&&(e=Tt()),e}())===ge&&(e=function(){var e,t,r;return e=fi,(t=re())!==ge&&ce()!==ge&&(r=A())!==ge?(t=At(r),e=t):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t,r;return e=fi,(t=te())!==ge&&ce()!==ge&&(r=A())!==ge?(t=Et(r),e=t):(fi=e,e=ge),e}()),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=K())!==ge&&ce()!==ge&&ue()!==ge&&ce()!==ge&&(r=function(){var e;return(e=function(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===xn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(wn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Sn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,5).toLowerCase()===Cn?(r=t.substr(fi,5),fi+=5):(r=ge,0===gi&&s(Dn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=En(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===An?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Tn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=On(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===In?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Rn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Pn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,6).toLowerCase()===Mn?(r=t.substr(fi,6),fi+=6):(r=ge,0===gi&&s(Ln)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Nn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,6).toLowerCase()===Fn?(r=t.substr(fi,6),fi+=6):(r=ge,0===gi&&s(Un)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Vn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}()),e}())!==ge&&ce()!==ge&&Q()!==ge&&ce()!==ge&&(n=d())!==ge&&ce()!==ge&&de()!==ge?(t=_t(r,n),e=t):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t,r,n,i,o,a,s,l;return e=fi,(t=Z())!==ge&&ce()!==ge&&ue()!==ge&&ce()!==ge&&(r=d())!==ge&&ce()!==ge&&Q()!==ge&&ce()!==ge&&(n=d())!==ge&&ce()!==ge?(i=fi,(o=X())!==ge&&(a=ce())!==ge&&(s=d())!==ge&&(l=ce())!==ge?i=o=[o,a,s,l]:(fi=i,i=ge),i===ge&&(i=null),i!==ge&&(o=de())!==ge?(t=xt(r,n,i),e=t):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t,r,n,i;return e=fi,(t=J())!==ge&&ce()!==ge&&ue()!==ge&&ce()!==ge?((r=E())===ge&&(r=null),r!==ge&&ce()!==ge&&(n=d())!==ge&&ce()!==ge&&Q()!==ge&&ce()!==ge&&(i=d())!==ge&&ce()!==ge&&de()!==ge?(t=wt(r,n,i),e=t):(fi=e,e=ge)):(fi=e,e=ge),e===ge&&(e=fi,(t=J())!==ge&&ce()!==ge&&ue()!==ge&&ce()!==ge?((r=E())===ge&&(r=null),r!==ge&&ce()!==ge&&(n=d())!==ge&&ce()!==ge&&de()!==ge?(t=St(r,n),e=t):(fi=e,e=ge)):(fi=e,e=ge)),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=ee())!==ge&&ce()!==ge&&ue()!==ge&&ce()!==ge&&(r=d())!==ge&&ce()!==ge&&z()!==ge&&ce()!==ge&&(n=d())!==ge&&ce()!==ge&&de()!==ge?(t=Ct(r,n),e=t):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t,r;return e=fi,(t=fe())!==ge&&ce()!==ge&&ue()!==ge&&ce()!==ge?((r=u())===ge&&(r=null),r!==ge&&ce()!==ge&&de()!==ge?(t=Dt(t,r),e=t):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e;return(e=function(){var e,t,r,n,i,o;if(e=fi,(t=ne())!==ge)if(ce()!==ge)if((r=d())!==ge)if(ce()!==ge){for(n=[],i=I();i!==ge;)n.push(i),i=I();n!==ge&&(i=ce())!==ge&&(o=ie())!==ge?(t=zt(r,n),e=t):(fi=e,e=ge)}else fi=e,e=ge;else fi=e,e=ge;else fi=e,e=ge;else fi=e,e=ge;if(e===ge)if(e=fi,(t=ne())!==ge)if(ce()!==ge)if((r=d())!==ge)if(ce()!==ge){for(n=[],i=I();i!==ge;)n.push(i),i=I();n!==ge&&(i=ce())!==ge&&(o=R())!==ge&&ce()!==ge&&ie()!==ge?(t=Bt(r,n,o),e=t):(fi=e,e=ge)}else fi=e,e=ge;else fi=e,e=ge;else fi=e,e=ge;else fi=e,e=ge;return e}())===ge&&(e=function(){var e,t,r,n,i;if(e=fi,(t=ne())!==ge)if(ce()!==ge){for(r=[],n=O();n!==ge;)r.push(n),n=O();r!==ge&&(n=ce())!==ge&&(i=ie())!==ge?(t=Gt(r),e=t):(fi=e,e=ge)}else fi=e,e=ge;else fi=e,e=ge;if(e===ge)if(e=fi,(t=ne())!==ge)if(ce()!==ge){for(r=[],n=O();n!==ge;)r.push(n),n=O();r!==ge&&(n=ce())!==ge&&(i=R())!==ge&&ce()!==ge&&ie()!==ge?(t=Ht(r,i),e=t):(fi=e,e=ge)}else fi=e,e=ge;else fi=e,e=ge;return e}()),e}())===ge&&(e=function(){var e;return fi,(e=function(){var e;return fi,(e=function(){var e,t,r,n;if(e=fi,(t=w())!==ge){for(r=[],n=C();n!==ge;)r.push(n),n=C();r!==ge?(t=dt(t,r),e=t):(fi=e,e=ge)}else fi=e,e=ge;return e}())!==ge&&(e=ut(e)),e}())!==ge&&(e=lt(e)),e}())===ge&&(e=D())===ge&&(e=fi,ue()!==ge&&ce()!==ge&&(t=d())!==ge&&ce()!==ge&&de()!==ge?e=st(t):(fi=e,e=ge)),e}function x(){var e,t,r,n;if(e=fi,(t=w())!==ge){for(r=[],n=S();n!==ge;)r.push(n),n=S();r!==ge?e=t=dt(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function w(){var e;return ct.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(pt)),e}function S(){var e;return ft.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(ht)),e}function C(){var e;return mt.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(vt)),e}function D(){var e,r,n;return fi,e=fi,64===t.charCodeAt(fi)?(r=gt,fi++):(r=ge,0===gi&&s(yt)),r!==ge&&(n=x())!==ge?e=r=[r,n]:(fi=e,e=ge),e!==ge&&(e=bt(e)),e}function E(){var e;return(e=function(){var e,r,n,i;return e=fi,t.substr(fi,7).toLowerCase()===pn?(r=t.substr(fi,7),fi+=7):(r=ge,0===gi&&s(fn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=hn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,8).toLowerCase()===mn?(r=t.substr(fi,8),fi+=8):(r=ge,0===gi&&s(vn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=gn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===yn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(bn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=_n(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}()),e}function A(){var e;return(e=T())===ge&&(e=D()),e}function T(){var e,r,n,i,o;if(e=fi,39===t.charCodeAt(fi)?(r=Rt,fi++):(r=ge,0===gi&&s(Pt)),r===ge&&(t.substr(fi,2)===Mt?(r=Mt,fi+=2):(r=ge,0===gi&&s(Lt))),r!==ge){for(n=[],i=fi,t.substr(fi,2)===Nt?(o=Nt,fi+=2):(o=ge,0===gi&&s(Ft)),o!==ge&&(o=Ut()),(i=o)===ge&&(Vt.test(t.charAt(fi))?(i=t.charAt(fi),fi++):(i=ge,0===gi&&s(jt)));i!==ge;)n.push(i),i=fi,t.substr(fi,2)===Nt?(o=Nt,fi+=2):(o=ge,0===gi&&s(Ft)),o!==ge&&(o=Ut()),(i=o)===ge&&(Vt.test(t.charAt(fi))?(i=t.charAt(fi),fi++):(i=ge,0===gi&&s(jt)));n!==ge?(39===t.charCodeAt(fi)?(i=Rt,fi++):(i=ge,0===gi&&s(Pt)),i!==ge?e=r=kt(n):(fi=e,e=ge)):(fi=e,e=ge)}else fi=e,e=ge;return e}function O(){var e,t,r;return e=fi,oe()!==ge&&ce()!==ge&&(t=d())!==ge&&ce()!==ge&&ae()!==ge&&ce()!==ge&&(r=d())!==ge?e=Wt(t,r):(fi=e,e=ge),e}function I(){var e,t,r;return e=fi,oe()!==ge&&ce()!==ge&&(t=d())!==ge&&ce()!==ge&&ae()!==ge&&ce()!==ge&&(r=d())!==ge?e=Wt(t,r):(fi=e,e=ge),e}function R(){var e,t;return e=fi,se()!==ge&&ce()!==ge&&(t=d())!==ge?e=qt(t):(fi=e,e=ge),e}function P(){var e,r,n;return(e=N())===ge&&(e=fi,45===t.charCodeAt(fi)?(r=et,fi++):(r=ge,0===gi&&s(tt)),r===ge&&(43===t.charCodeAt(fi)?(r=Ke,fi++):(r=ge,0===gi&&s(Je))),r!==ge&&(n=N())!==ge?e=r=Kt(r,n):(fi=e,e=ge)),e}function M(){var e,r,n;return e=fi,46===t.charCodeAt(fi)?(r=Jt,fi++):(r=ge,0===gi&&s(er)),r!==ge?((n=N())===ge&&(n=null),n!==ge?e=r=tr(n):(fi=e,e=ge)):(fi=e,e=ge),e}function L(){var e,t,r;return e=fi,(t=U())!==ge&&(r=N())!==ge?e=t=rr(t,r):(fi=e,e=ge),e}function N(){var e,t;if(fi,e=[],(t=F())!==ge)for(;t!==ge;)e.push(t),t=F();else e=ge;return e!==ge&&(e=nr(e)),e}function F(){var e;return ir.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(or)),e}function U(){var e,r,n;return e=fi,ar.test(t.charAt(fi))?(r=t.charAt(fi),fi++):(r=ge,0===gi&&s(sr)),r!==ge?(lr.test(t.charAt(fi))?(n=t.charAt(fi),fi++):(n=ge,0===gi&&s(ur)),n===ge&&(n=null),n!==ge?e=r=dr(r,n):(fi=e,e=ge)):(fi=e,e=ge),e}function V(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===cr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(pr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=[r,n]:(fi=e,e=ge)):(fi=e,e=ge),e}function j(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===fr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(hr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=[r,n]:(fi=e,e=ge)):(fi=e,e=ge),e}function k(){var e,r,n,i;return e=fi,t.substr(fi,5).toLowerCase()===mr?(r=t.substr(fi,5),fi+=5):(r=ge,0===gi&&s(vr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=[r,n]:(fi=e,e=ge)):(fi=e,e=ge),e}function z(){var e,r,n,i;return e=fi,t.substr(fi,2).toLowerCase()===gr?(r=t.substr(fi,2),fi+=2):(r=ge,0===gi&&s(yr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=br():(fi=e,e=ge)):(fi=e,e=ge),e}function B(){var e,r,n,i;return e=fi,t.substr(fi,2).toLowerCase()===_r?(r=t.substr(fi,2),fi+=2):(r=ge,0===gi&&s(xr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=wr():(fi=e,e=ge)):(fi=e,e=ge),e}function G(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Sr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Cr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Dr():(fi=e,e=ge)):(fi=e,e=ge),e}function H(){var e,r,n,i;return e=fi,t.substr(fi,6).toLowerCase()===Er?(r=t.substr(fi,6),fi+=6):(r=ge,0===gi&&s(Ar)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Tr():(fi=e,e=ge)):(fi=e,e=ge),e}function W(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===Or?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Ir)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Rr():(fi=e,e=ge)):(fi=e,e=ge),e}function q(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===Pr?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Mr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Lr():(fi=e,e=ge)):(fi=e,e=ge),e}function $(){var e,r,n,i;return e=fi,t.substr(fi,2).toLowerCase()===Nr?(r=t.substr(fi,2),fi+=2):(r=ge,0===gi&&s(Fr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Ur():(fi=e,e=ge)):(fi=e,e=ge),e}function Y(){var e,r,n,i;return e=fi,t.substr(fi,7).toLowerCase()===Vr?(r=t.substr(fi,7),fi+=7):(r=ge,0===gi&&s(jr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=kr():(fi=e,e=ge)):(fi=e,e=ge),e}function Q(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===zr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Br)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Gr():(fi=e,e=ge)):(fi=e,e=ge),e}function X(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===Hr?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Wr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=qr():(fi=e,e=ge)):(fi=e,e=ge),e}function Z(){var e,r,n,i;return e=fi,t.substr(fi,9).toLowerCase()===$r?(r=t.substr(fi,9),fi+=9):(r=ge,0===gi&&s(Yr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Qr():(fi=e,e=ge)):(fi=e,e=ge),e}function K(){var e,r,n,i;return e=fi,t.substr(fi,7).toLowerCase()===Xr?(r=t.substr(fi,7),fi+=7):(r=ge,0===gi&&s(Zr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Kr():(fi=e,e=ge)):(fi=e,e=ge),e}function J(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Jr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(en)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=tn():(fi=e,e=ge)):(fi=e,e=ge),e}function ee(){var e,r,n,i;return e=fi,t.substr(fi,8).toLowerCase()===rn?(r=t.substr(fi,8),fi+=8):(r=ge,0===gi&&s(nn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=on():(fi=e,e=ge)):(fi=e,e=ge),e}function te(){var e,r,n,i;return e=fi,t.substr(fi,9).toLowerCase()===an?(r=t.substr(fi,9),fi+=9):(r=ge,0===gi&&s(sn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=ln():(fi=e,e=ge)):(fi=e,e=ge),e}function re(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===un?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(dn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=cn():(fi=e,e=ge)):(fi=e,e=ge),e}function ne(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===jn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(kn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=zn():(fi=e,e=ge)):(fi=e,e=ge),e}function ie(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===Bn?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Gn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Hn():(fi=e,e=ge)):(fi=e,e=ge),e}function oe(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Wn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(qn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=$n():(fi=e,e=ge)):(fi=e,e=ge),e}function ae(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Yn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Qn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Xn():(fi=e,e=ge)):(fi=e,e=ge),e}function se(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Zn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Kn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Jn():(fi=e,e=ge)):(fi=e,e=ge),e}function le(){var e;return 44===t.charCodeAt(fi)?(e=ei,fi++):(e=ge,0===gi&&s(ti)),e}function ue(){var e;return 40===t.charCodeAt(fi)?(e=ri,fi++):(e=ge,0===gi&&s(ni)),e}function de(){var e;return 41===t.charCodeAt(fi)?(e=ii,fi++):(e=ge,0===gi&&s(oi)),e}function ce(){var e,t;for(e=[],t=pe();t!==ge;)e.push(t),t=pe();return e}function pe(){var e;return ai.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(si)),e}function fe(){var e,r,n,i;if(e=fi,(r=x())!==ge&&(r=ut(r)),(e=r)===ge)if(e=fi,96===t.charCodeAt(fi)?(r=li,fi++):(r=ge,0===gi&&s(ui)),r!==ge){if(n=[],di.test(t.charAt(fi))?(i=t.charAt(fi),fi++):(i=ge,0===gi&&s(ci)),i!==ge)for(;i!==ge;)n.push(i),di.test(t.charAt(fi))?(i=t.charAt(fi),fi++):(i=ge,0===gi&&s(ci));else n=ge;n!==ge?(96===t.charCodeAt(fi)?(i=li,fi++):(i=ge,0===gi&&s(ui)),i!==ge?e=r=pi(n):(fi=e,e=ge)):(fi=e,e=ge)}else fi=e,e=ge;return e}function he(e,t,r,n){var i={type:"binary_expr",operator:e,left:t,right:r};return void 0!==n&&(i.escape=n),i}function me(e,t){for(var r=e,n=0;n<t.length;n++)r=he(t[n][1],r,t[n][3]);return r}r=void 0!==r?r:{};var ve,ge={},ye={start:l},be=l,_e=function(e){return e},xe=function(e,t){var r={type:"expr_list"},n=function(e,t,r){return function(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}(e,t)}(e,t);return r.value=n,r},we=function(e,t){return me(e,t)},Se="!",Ce=n("!",!1),De="=",Ee=n("=",!1),Ae=function(e){return function(e,t){return{type:"unary_expr",operator:e,expr:t}}("NOT",e)},Te=function(e,t){return""==t||void 0==t||null==t?e:"arithmetic"==t.type?me(e,t.tail):he(t.op,e,t.right,t.escape)},Oe=function(e){return{type:"arithmetic",tail:e}},Ie=">=",Re=n(">=",!1),Pe=">",Me=n(">",!1),Le="<=",Ne=n("<=",!1),Fe="<>",Ue=n("<>",!1),Ve="<",je=n("<",!1),ke="!=",ze=n("!=",!1),Be=function(e,t){return{op:e+"NOT",right:t}},Ge=function(e,t){return{op:e,right:t}},He=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}},We=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}},qe=function(e){return e[0]+" "+e[2]},$e=function(e,t,r){return{op:e,right:t,escape:r.value}},Ye=function(e,t){return{op:e,right:t,escape:""}},Qe=function(e,t){return{op:e,right:t}},Xe=function(e){return{op:e,right:{type:"expr_list",value:[]}}},Ze=function(e,t){return{op:e,right:t}},Ke="+",Je=n("+",!1),et="-",tt=n("-",!1),rt=function(e,t){return me(e,t)},nt="*",it=n("*",!1),ot="/",at=n("/",!1),st=function(e){return e.paren=!0,e},lt=function(e){return{type:"column_ref",table:"",column:e}},ut=function(e){return e},dt=function(e,t){return e+t.join("")},ct=/^[A-Za-z_\x80-\uFFFF]/,pt=i([["A","Z"],["a","z"],"_",["",""]],!1,!1),ft=/^[A-Za-z0-9_]/,ht=i([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),mt=/^[A-Za-z0-9_.\x80-\uFFFF]/,vt=i([["A","Z"],["a","z"],["0","9"],"_",".",["",""]],!1,!1),gt="@",yt=n("@",!1),bt=function(e){return{type:"param",value:e[1]}},_t=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}},xt=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}},wt=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}},St=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}},Ct=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}},Dt=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}},Et=function(e){return{type:"timestamp",value:e.value}},At=function(e){return{type:"date",value:e.value}},Tt=function(){return{type:"null",value:null}},Ot=function(){return{type:"bool",value:!0}},It=function(){return{type:"bool",value:!1}},Rt="'",Pt=n("'",!1),Mt="N'",Lt=n("N'",!1),Nt="''",Ft=n("''",!1),Ut=function(){return"'"},Vt=/^[^']/,jt=i(["'"],!0,!1),kt=function(e){return{type:"string",value:e.join("")}},zt=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}},Bt=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}},Gt=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}},Ht=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}},Wt=function(e,t){return{type:"when_clause",operand:e,value:t}},qt=function(e){return{type:"else_clause",value:e}},$t=function(e){return{type:"number",value:e}},Yt=function(e,t,r){return parseFloat(e+t+r)},Qt=function(e,t){return parseFloat(e+t)},Xt=function(e,t){return parseFloat(e+t)},Zt=function(e){return parseFloat(e)},Kt=function(e,t){return e[0]+t},Jt=".",er=n(".",!1),tr=function(e){return"."+(null!=e?e:"")},rr=function(e,t){return e+t},nr=function(e){return e.join("")},ir=/^[0-9]/,or=i([["0","9"]],!1,!1),ar=/^[eE]/,sr=i(["e","E"],!1,!1),lr=/^[+\-]/,ur=i(["+","-"],!1,!1),dr=function(e,t){return"e"+(null===t?"":t)},cr="null",pr=n("NULL",!0),fr="true",hr=n("TRUE",!0),mr="false",vr=n("FALSE",!0),gr="in",yr=n("IN",!0),br=function(){return"IN"},_r="is",xr=n("IS",!0),wr=function(){return"IS"},Sr="like",Cr=n("LIKE",!0),Dr=function(){return"LIKE"},Er="escape",Ar=n("ESCAPE",!0),Tr=function(){return"ESCAPE"},Or="not",Ir=n("NOT",!0),Rr=function(){return"NOT"},Pr="and",Mr=n("AND",!0),Lr=function(){return"AND"},Nr="or",Fr=n("OR",!0),Ur=function(){return"OR"},Vr="between",jr=n("BETWEEN",!0),kr=function(){return"BETWEEN"},zr="from",Br=n("FROM",!0),Gr=function(){return"FROM"},Hr="for",Wr=n("FOR",!0),qr=function(){return"FOR"},$r="substring",Yr=n("SUBSTRING",!0),Qr=function(){return"SUBSTRING"},Xr="extract",Zr=n("EXTRACT",!0),Kr=function(){return"EXTRACT"},Jr="trim",en=n("TRIM",!0),tn=function(){return"TRIM"},rn="position",nn=n("POSITION",!0),on=function(){return"POSITION"},an="timestamp",sn=n("TIMESTAMP",!0),ln=function(){return"TIMESTAMP"},un="date",dn=n("DATE",!0),cn=function(){return"DATE"},pn="leading",fn=n("LEADING",!0),hn=function(){return"LEADING"},mn="trailing",vn=n("TRAILING",!0),gn=function(){return"TRAILING"},yn="both",bn=n("BOTH",!0),_n=function(){return"BOTH"},xn="year",wn=n("YEAR",!0),Sn=function(){return"YEAR"},Cn="month",Dn=n("MONTH",!0),En=function(){return"MONTH"},An="day",Tn=n("DAY",!0),On=function(){return"DAY"},In="hour",Rn=n("HOUR",!0),Pn=function(){return"HOUR"},Mn="minute",Ln=n("MINUTE",!0),Nn=function(){return"MINUTE"},Fn="second",Un=n("SECOND",!0),Vn=function(){return"SECOND"},jn="case",kn=n("CASE",!0),zn=function(){return"CASE"},Bn="end",Gn=n("END",!0),Hn=function(){return"END"},Wn="when",qn=n("WHEN",!0),$n=function(){return"WHEN"},Yn="then",Qn=n("THEN",!0),Xn=function(){return"THEN"},Zn="else",Kn=n("ELSE",!0),Jn=function(){return"ELSE"},ei=",",ti=n(",",!1),ri="(",ni=n("(",!1),ii=")",oi=n(")",!1),ai=/^[ \t\n\r]/,si=i([" ","\t","\n","\r"],!1,!1),li="`",ui=n("`",!1),di=/^[^`]/,ci=i(["`"],!0,!1),pi=function(e){return e.join("")},fi=0,hi=[{line:1,column:1}],mi=0,vi=[],gi=0;if("startRule"in r){if(!(r.startRule in ye))throw new Error("Can't start parsing from rule \""+r.startRule+'".');be=ye[r.startRule]}if((ve=be())!==ge&&fi===t.length)return ve;throw ve!==ge&&fi<t.length&&s({type:"end"}),function(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}(vi,mi<t.length?t.charAt(mi):null,mi<t.length?a(mi,mi+1):a(mi,mi))}}}.apply(null,[]))||(e.exports=n)},1711:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(0),r(9),r(108),r(78),r(4),r(407),r(42),r(16),r(7),r(1309),r(146),r(6),r(15),r(1),r(1669),r(406),r(430),r(458),r(1513),r(2143),r(2144),r(2145),r(1452),r(2146),r(1712),r(40),r(74),r(2147)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g,y,b,_,x,w,S,C,D,E,A,T,O,I){function R(e,t){return e.length===t.length&&e.every(function(e){return P(t,e.name)>=0})}function P(e,t){for(var r=t.toLowerCase(),n=0;n<e.length;n++)if(e[n].name.toLowerCase()===r)return n;return-1}var M=c.getLogger("esri.layers.graphics.controllers.I3SOnDemandController"),L=function(e){function t(t){var r=e.call(this)||this;return r.nodeIndex={},r.screenSizeFactor=0,r.featureTarget=5e4,r.updating=!0,r.updatingPercentage=0,r.leafsReached=!1,r._lodFactorProperty=null,r._featureLOD=1,r._stableFeatureLOD=!1,r._isIdle=!1,r._cameraDirty=!0,r._hasFeatures=!1,r._alwaysLoadEverythingModeEnabled=!1,r._uncompressedTextureDownsamplingEnabled=!1,r._downloadingNodes=new Set,r._loadingNodes=new Set,r._updatingNodes=new Map,r._progressMaxNumNodes=1,r._poi=null,r._requiredAttributesDirty=!0,r._updatesDisabled=!1,r.disableCache=!1,r._restartNodeLoading=!1,r._fields=null,r._attributeStorageInfo=null,r._handles=new d,r._idleQueue=new A.IdleQueue,r._errorCount=0,r}return r(t,e),Object.defineProperty(t.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(I.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedDefinitionExpression",{get:function(){if(!(this.layer instanceof _&&this.layer.definitionExpression))return null;try{var e=g.create(this.layer.definitionExpression);if(!e.isStandardized())return M.error("definitionExpression is using non standard function"),null;var t=[],r=e.getFields();return D.findFieldsCaseInsensitive(r,this.layer.fields,{missingFields:t}),t.length>0?(M.error("definitionExpression references unknown fields: "+t.join(", ")),null):e}catch(e){return M.error("Failed to parse definitionExpression: "+e),null}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var e=this.parsedDefinitionExpression.getFields();return D.findFieldsCaseInsensitive(e,this._fields)}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsVertex",{get:function(){return D.getVertexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsIndex",{get:function(){return D.getIndexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootNodeVisible",{get:function(){var e=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return!e||!this._viewportQueries||this._viewportQueries.isNodeVisible(e)},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.updateEventListener={needsUpdate:function(){return!1},idleBegin:function(){e._updateIdleState(!0)},idleEnd:function(){e._updateIdleState(!1)}},this.updateEventListenerWhileSuspended={idleBegin:function(){return e._startNodeLoadingWhileSuspended()}},this._lodHandling=new S(this.layerViewRequiredFunctions,this.layerViewOptionalFunctions,function(){return e.updatingChanged()}),this.layerView._controller=this;var t=this.layer;this._defaultGeometrySchema=t.store.defaultGeometrySchema,this._rootNodeUrl=t.store.rootNode;var r=this._rootNodeUrl.split("/");this._rootNodeId=r[r.length-1],this.disableCache=i("disable-feature:idb-cache"),t instanceof _?("mesh"===t.geometryType?this._lodFactorProperty="qualitySettings.sceneService.3dObject.lodFactor":"point"===t.geometryType&&(this._lodFactorProperty="qualitySettings.sceneService.point.lodFactor"),this._fields=t.fields,this._attributeStorageInfo=t.attributeStorageInfo):t instanceof b&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");var n=a([this.layer.when(),this.layerView.when()]).then(function(){if(!e.destroyed&&e.layerView&&!e.layerView.destroyed){var t=e.layerView.view;e.setClippingArea(t.clippingArea);var r=t.pointsOfInterest;e._centerOnSurface=r.centerOnSurfaceFrequent,e._handles.add(e._centerOnSurface.watch("renderLocation",function(){return e._pointOfInterestChanged()}));var n=e.layerView.view.resourceController;n.memoryEvents.on("quality-changed",function(){return e._setCameraDirty()}),e._handles.add(m.init(e.layerView,"suspended",function(t){e._idleFrameWorker&&(e._idleFrameWorker.remove(),e._idleFrameWorker=null,e.restartNodeLoading()),e._frameWorker&&(e._frameWorker.remove(),e._frameWorker=null),t?e._idleFrameWorker=n.registerIdleFrameWorker(e.updateEventListenerWhileSuspended):(e._idleFrameWorker=n.registerIdleFrameWorker(e.updateEventListener),e._frameWorker=n.registerFrameWorker(function(t){return e._frame(t)}))}),"layerview"),e._handles.add(e.layer.watch("elevationInfo",function(t){return e._elevationInfoChanged(t)}),"layer"),e.layerView instanceof x&&e._handles.add([m.init(e.layerView,"alwaysLoadEverythingModeEnabled",function(t){e._alwaysLoadEverythingModeEnabled=t,e.restartNodeLoading()}),m.init(e.layerView,"uncompressedTextureDownsamplingEnabled",function(t){e._uncompressedTextureDownsamplingEnabled=t,e.restartNodeLoading()})],"layer"),e._handles.add(t.state.watch("camera",function(){return e._setCameraDirty()})),e._handles.add(e.watch("featureTarget",function(){e._stableFeatureLOD=!1})),e._lodFactorProperty&&e._handles.add(e.layerView.view.watch(e._lodFactorProperty,function(){return e._setCameraDirty()}),"quality")}});this.addResolvingPromise(n),this.when(function(){return e._startNodeLoading()})},t.prototype.destroy=function(){this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null),this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null),this._handles.destroy(),this._nodeLoader=null},t.prototype._getRequiredAttributes=function(){if(!(null!=this._attributeStorageInfo&&this.layer instanceof _&&this._fields))return[];var e=Object.create(null);if(this.layer.renderer&&this.layer.renderer.collectRequiredFields(e),this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(t){t._collectRequiredFields(e)}),null!=this.definitionExpressionFields)for(var t=0,r=this.definitionExpressionFields;t<r.length;t++){var n=r[t];e[n]=!0}var i=this._attributeStorageInfo,o=this._fields,a=this.layer.objectIdField;return Object.keys(e).map(function(e){var t=P(i,e),r=P(o,e);return t>=0&&r>=0?{index:t,name:o[r].name,field:o[r],attributeStorageInfo:i[t]}:null}).filter(function(e){return null!=e&&e.name!==a}).sort(function(e,t){return t.index-e.index}).filter(function(e,t,r){return 0===t||r[t-1].index!==e.index})},t.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=!0,this.restartNodeLoading()},t.prototype._labelingChanged=function(){R(this._requiredAttributes,this._getRequiredAttributes())||this._requiredFieldsChange()},t.prototype.setClippingArea=function(e){var t=y.create();O.extentToBoundingBox(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null},t.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=F.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload())))},t.prototype._calculatePointOfInterest=function(e){void 0===e&&(e=T.vec3d.create());var t=this._centerOnSurface.renderLocation,r=T.vec3d.create();T.vec3d.subtract(t,this.camPos,r),T.vec3d.normalize(r);var n=this.layerView.view.renderCoordsHelper,i=T.vec3d.create();n.worldUpAtPosition(t,i);var o=Math.acos(T.vec3d.dot(i,r))-.5*Math.PI;return T.vec3d.lerp(this.camPos,t,Math.max(0,Math.min(1,o/(.5*Math.PI))),e),e},t.prototype.updateClippingArea=function(e){this.setClippingArea(e),this._cameraDirty=!0,this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)},t.prototype._setCameraDirty=function(){this._cameraDirty=!0,this.updatingChanged()},t.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path},t.prototype.updateElevationChanged=function(e,t,r){D.findIntersectingNodes(e,t,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(e){r.push(e)});for(var n=0;n<r.length;n++){var i=r.data[n];this._viewportQueries.invalidateCache(i.id),i.id===this._rootNodeId&&this.notifyChange("rootNodeVisible")}r.length&&this.restartNodeLoading()},t.prototype._elevationInfoChanged=function(e){this._viewportQueries.invalidateCache(),this._initViewData()},t.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0,this.updatingChanged()},t.prototype.schedule=function(e,t){var r=this;return this._idleQueue.push(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw new o;return t})},t.prototype.getUnloadedMemoryEstimate=function(){return this._index?this._index.getUnloadedMemoryEstimate()*this._getLodDropFactor():0},t.prototype._frame=function(e){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty),this.layerView.visible&&this._processLogError(e,!1)},t.prototype._processLogError=function(e,t){void 0===t&&(t=!0);try{this._process(e,t)}catch(e){this._errorCount<50?M.error("Error during processing: "+e):50===this._errorCount&&M.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}},t.prototype._process=function(e,t){if(this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading()),null!=this._nodeLoader&&null!=this._index){for(this._updateViewData()&&(t=!1),!this._processIndex()||!t&&e.done()||(t=!1),t=this._processNodes(e,t);this._idleQueue.length()>0&&(t||!e.done());)t=!1,this._idleQueue.process();this._updateFeatureLOD(),e.done()||this._prefetchIndex(),this.updatingChanged(),this._lodHandling.lodGlobalHandling()}},t.prototype._processIndex=function(){var e=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));this._index.update(l.keysOfSet(this._loadingNodes));var t=this._index.getFeatureEstimate().leafsReached;return this._index.isLoading()||t===this._get("leafsReached")||this._set("leafsReached",t),this._index.load(e)},t.prototype._prefetchIndex=function(){if(!(this._loadingNodes.size>0)){var e=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));this._index.prefetch(e)}},t.prototype._updateFeatureLOD=function(){var e=this._index.getFeatureEstimate(),t=this.featureTarget*this._getLOD()/this._featureLOD;if(e.estimate){var r=!this._index.isLoading();if(!r&&!this._index.isPrefetching()&&this._index.getIndexMissing()>500){if(this._featureLOD<=1e-4)return;this._featureLOD/=1.5,this._stableFeatureLOD=!1}else if(r&&e.estimate<t){if(this._featureLOD>=1e4||e.leafsReached||this._stableFeatureLOD)return;var n=this._featureLOD,i=Math.min(.1*(t/e.estimate-1),.1);if(this._featureLOD*=1+i,!this._index.checkFeatureTarget(t,this._getLOD()))return this._featureLOD=n,void(this._stableFeatureLOD=!0)}else{if(!(e.estimate>1.2*t||r&&e.estimate>t))return;if(this._featureLOD<=1e-4)return;this._featureLOD/=1+.25*(e.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(1e4,Math.max(1e-4,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this._getLOD()),this._index.requestReload()}},t.prototype._processNodes=function(e,t){var r=this,n=(this._isIdle?100:2)-this._loadingNodes.size,i=this._index.getUpdates(n);return i.cancel.forEach(this._cancelNodeIdLoading,this),i.update.forEach(function(n){!t&&e.done()||(t=!1,r._updateLoadedNode(n))}),i.add.forEach(function(n){!t&&e.done()||(t=!1,r._loadNode(n))}),t},t.prototype._cancelNodeLoading=function(){var e=this;this._loadingNodes.clear(),this._downloadingNodes.clear(),this._updatingNodes.forEach(function(t,r){return e._updatingNodes.get(r).cancel()}),this._updatingNodes.clear()},t.prototype._cancelNodeIdLoading=function(e){this._loadingNodes.delete(e),this._downloadingNodes.delete(e)},t.prototype._getAvailableLoadTokens=function(e){return Math.floor((12-1*this._index.getIndexLoading()-2*this._downloadingNodes.size)/e)},t.prototype._hasNodeLoadToken=function(){var e=this._isIdle?5:2;return!(this._downloadingNodes.size>=e)&&this._getAvailableLoadTokens(2)>0},t.prototype.updatingChanged=function(){var e=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.getNodesMissing():0)+2*this._loadingNodes.size,t=!(!(e>0||this._updatingNodes.size>0||this._index&&this._index.isPrefetching()||this._restartNodeLoading||this._cameraDirty||this._idleQueue.length()>0||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===e&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(e,this._progressMaxNumNodes),t!==this._get("updating")&&this._set("updating",t);var r=100*e/this._progressMaxNumNodes;r!==this._get("updatingPercentage")&&this._set("updatingPercentage",r)},t.prototype._initViewData=function(){var e=this.layerView.view,t=e.state.camera,r=e.renderCoordsHelper;this.camPos=T.vec3d.create(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/t.perPixelRatio,this._poi=this._calculatePointOfInterest();var n=this._getLOD();this._viewportQueries=new E(this.crsIndex,r,t,this._poi,this._clippingArea,e.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer,n),screenspaceErrorBias:n,angleDependentLoD:n<.5,disableLod:this._alwaysLoadEverythingModeEnabled}),this._cameraDirty=!1,this.notifyChange("rootNodeVisible")},t.prototype._updateViewData=function(){if(!this._cameraDirty||!this._index)return!1;var e=this.layerView.view,t=e.state.camera;this.camPos=T.vec3d.create(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/t.perPixelRatio,this._poi=this._calculatePointOfInterest(this._poi),this._viewportQueries.updateCamera(t),this._viewportQueries.updatePointOfInterest(this._poi);var r=this._getLOD();this._viewportQueries.updateScreenSpaceErrorBias(r),this._index.progressiveLoadPenalty=F.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload(),this._stableFeatureLOD=!1;var n=!this._alwaysLoadEverythingModeEnabled&&this._removeInvisibleNodes();return this._cameraDirty=!1,this.notifyChange("rootNodeVisible"),n},t.prototype._getProgressiveLoadFactor=function(e,t){return e instanceof _&&"mesh"===e.geometryType?t>=1&&i("enable-feature:progressive-3dobject")?F.factor3dObject:1:e instanceof b&&(t>=1&&!i("disable-feature:progressive-im"))?F.factorIM:1},t.prototype._getLOD=function(){return(this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1)*this.layerView.view.resourceController.memoryFactor*this._featureLOD},t.prototype._getLodDropFactor=function(){return Math.min(this.layerView.view.resourceController.memoryFactor,.5)/.5},t.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData(),this._alwaysLoadEverythingModeEnabled&&this.layerView.visible&&!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()},t.prototype.isGeometryVisible=function(e){return this._viewportQueries.isGeometryVisible(e)},t.prototype.updateVisibility=function(e){return this._viewportQueries.updateNode(e)},t.prototype._shouldLoadNode=function(e){if(!this._lodHandling.shouldLoadNode(e))return!1;var t=this._getLodDropFactor();return!(t>0&&this._viewportQueries.maxDistance>0&&this._lodHandling.childrenEmpty(e)&&this._viewportQueries.distToPOI(e)>this._viewportQueries.maxDistance*t)&&(!e.obb||this._viewportQueries.isGeometryVisible(e))},t.prototype._startNodeLoading=function(){var e=this;if(this._restartNodeLoading=!1,!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return e._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return e._requiredFieldsChange()}),this.layer.watch("labelsVisible",function(){return e._labelingChanged()}),this.layer.watch("labelingInfo",function(){return e._labelingChanged()})],"requiredAttributes"));var t=this.layerViewOptionalFunctions.textureOptions,r=C.TextureFormat.Normal;t&&t.useCompressedTextures?r=C.TextureFormat.Compressed:this._uncompressedTextureDownsamplingEnabled&&(r=C.TextureFormat.Downsampled);var n=this._defaultGeometrySchema,i={textureFormat:r,loadTextureData:this.layerView instanceof x&&this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==n||null==n.ordering};this._nodeLoader=new C(this.streamDataSupplier,M,n,this._requiredAttributes,i);var o=F.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new w(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,o,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,M,function(t){return e.layerViewRequiredFunctions.isNodeLoaded(t)},function(t){return e._shouldLoadNode(t)},function(t){return e._needsUpdate(t)}),this._alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes(),this._lodHandling.startNodeLoading(function(t){return e._viewportQueries.isNodeVisible(t)},function(t){return e._viewportQueries.isGeometryVisible(t)},function(t){return e._index.nodeTraversalState(t)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel}),this.updatingChanged()}},t.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index},t.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._nodeLoader=null,this._index=null,this._poi=null,this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler&&this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler(),this.updatingChanged())},t.prototype._removeInvisibleNodes=function(){var e=this.layerViewRequiredFunctions.getLoadedNodeIDs(),t=this._getLodDropFactor(),r=this._viewportQueries.maxDistance*t,n=t>0&&r>0;N.clear();for(var i=0;i<e.length;i++){var o=this.nodeIndex[e[i]];(!this._viewportQueries.isGeometryVisible(o)||n&&this._lodHandling.childrenEmpty(o)&&this._viewportQueries.distToPOI(o)>r)&&(this._lodHandling.setLodGlobalDirty(),N.push(o))}return N.length>0&&(this.layerViewRequiredFunctions.removeNodeData(N),N.clear(),!0)},t.prototype._needsUpdate=function(e){if(null==e.featureData||0===e.featureData.length||this._updatingNodes.has(e.id))return!1;var t=this.layerViewRequiredFunctions.getLoadedAttributes(e);return null!=t&&t!==this._requiredAttributes},t.prototype._updateLoadedNode=function(e){var t=this,r=e.baseUrl,n=R(this.layerViewRequiredFunctions.getLoadedAttributes(e),this._requiredAttributes)?h.resolve(this.layerViewRequiredFunctions.getAttributeData(e)):this._nodeLoader.loadAttributes(e,r,this._requiredAttributes);this._updatingNodes.set(e.id,n),n.then(function(r){return t.schedule(e.id).then(function(){return t.layerViewRequiredFunctions.setAttributeData(e,t._requiredAttributes,r)})}).catch(function(r){r instanceof o||t.layerViewRequiredFunctions.setAttributeData(e,t._requiredAttributes,{})}).always(function(){t._updatingNodes.delete(e.id),t.updatingChanged()}),this.updatingChanged()},t.prototype._loadNode=function(e){var t=this;e.notInCache&&!this._hasNodeLoadToken()||(this._loadingNodes.add(e.id),this.updatingChanged(),this._loadAndAddBundle(e).always(function(){t._loadingNodes.delete(e.id),t._hasFeatures=t._hasFeatures||!!e.numFeatures,t.updatingChanged()}))},t.prototype._loadAndAddBundle=function(e){return 1!==e.featureData.length&&M.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded."),e.notInCache?this._loadUncached(e):this._loadCached(e).then(function(t){t||(e.notInCache=!0)}).catch(function(t){t instanceof o||(e.notInCache=!0)})},t.prototype._loadCached=function(e){var t=this,r=this.disableCache?null:this.layerViewOptionalFunctions.loadCachedNodeData,n=this.disableCache?null:this.layerViewOptionalFunctions.addCachedNodeData;return r&&n?this.schedule(e.id).then(function(){return r(e,function(e,r){return t._nodeLoader.loadTextures(e,r)})}).then(function(r){if(null==r)return!1;var i=t._requiredAttributes;return function(e){return null!=e.loadedAttributes&&null!=e.attributeData}(r)&&R(r.loadedAttributes,i)?t.schedule(e.id).then(function(){return n(e,r,r)}).then(function(){return t._lodHandling.lodSwapBundleLoaded(e),!0}):t.schedule(e.id).then(function(){return t._nodeLoader.loadAttributes(e,e.baseUrl,i)}).then(function(r){return t.schedule(e.id,{loadedAttributes:i,attributeData:r})}).then(function(t){return n(e,r,t)}).then(function(){return t._lodHandling.lodSwapBundleLoaded(e),!0})}):h.resolve(!1)},t.prototype._loadUncached=function(e){var t=this;return this._downloadingNodes.add(e.id),this._nodeLoader.loadBundleData(e,0).then(function(r){return t._downloadingNodes.delete(e.id),t.schedule(e.id,r)}).then(function(r){return t.layerViewRequiredFunctions.addNodeData(e,r)}).then(function(){t._lodHandling.lodSwapBundleLoaded(e),e.notInCache=!1}).catch(function(t){t instanceof o||(M.error("Failed to load node '"+e.id+"' bundle 0: "+t),e.failed=!0)})},t.prototype._updateIdleState=function(e){e!==this._isIdle&&(this._isIdle=e,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),this.updatingChanged())},t.prototype.updateStats=function(e){e.index=Object.keys(this.nodeIndex).length,this._hasFeatures&&(e.detail=this._featureLOD,e.target=Math.round(this.featureTarget*this._getLOD()/this._featureLOD)),this._index&&this._index.updateStats(e)},n([v.property({readOnly:!0})],t.prototype,"isMeshPyramid",null),n([v.property({readOnly:!0})],t.prototype,"streamDataSupplier",null),n([v.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],t.prototype,"parsedDefinitionExpression",null),n([v.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],t.prototype,"definitionExpressionFields",null),n([v.property({readOnly:!0})],t.prototype,"crsVertex",null),n([v.property({readOnly:!0})],t.prototype,"crsIndex",null),n([v.property({readOnly:!0})],t.prototype,"nodeIndex",void 0),n([v.property()],t.prototype,"camPos",void 0),n([v.property()],t.prototype,"screenSizeFactor",void 0),n([v.property()],t.prototype,"featureTarget",void 0),n([v.property()],t.prototype,"layerView",void 0),n([v.property()],t.prototype,"layerViewRequiredFunctions",void 0),n([v.property()],t.prototype,"layerViewOptionalFunctions",void 0),n([v.property()],t.prototype,"layer",void 0),n([v.property({readOnly:!0})],t.prototype,"updating",void 0),n([v.property({readOnly:!0})],t.prototype,"updatingPercentage",void 0),n([v.property({readOnly:!0})],t.prototype,"leafsReached",void 0),n([v.property({readOnly:!0})],t.prototype,"rootNodeVisible",null),n([v.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],t)}(v.declared(s,f,u)),N=new p,F={factorIM:.2,factor3dObject:.05,distancePenalty:10};return L}.apply(null,n))||(e.exports=i)},1712:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(23)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=new r;return this._deferreds.push(t),this._values.push(e),t.promise},e.prototype.length=function(){return this._deferreds.length},e.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())},e.prototype.cancelAll=function(){for(var e=0,t=this._deferreds;e<t.length;e++)t[e].cancel();this._deferreds.length=0,this._values.length=0},e}();t.IdleQueue=n}.apply(null,n))||(e.exports=i)},2143:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(1309),r(19),r(1452),r(1353)],void 0===(i=function(e,t,r,n,i,o,a){var s=["version","level","sharedResource","attributeData","geometryData","textureData","lodSelection"],l=function(){function e(e,t,r,o,a,s,l,d,c,p,f){var h=this;this.rootId=r,this.progressiveLoadPenalty=o,this.nodeIndex=a,this.streamDataSupplier=s,this.viewportQueries=l,this.logger=d,this._isLoaded=c,this._needsLoading=p,this._needsUpdate=f,this._dirty=!0,this._loading=!0,this._prefetching=!0,this._loadingNodes=new Set,this._indexMissing=1,this._nodesMissing=0,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._nodeTraversalState={},this._version=0,this._featureEstimate={estimate:0,leafsReached:!1},this._unloadedMemoryEstimate=0,this._missing=new n,this._prefetch=new n,this._updates=new u,this.ignoreServiceOBB=!1,this._maxLodLevel=this.viewportQueries.maxLodLevel,this.rootUrl=i.makeAbsolute(t,e),this.traverseVisible(function(e,t){return h.nodeTraversalState(t)})}return e.prototype.requestReload=function(){this._dirty=!0,this._loading=!0,this._prefetching=!0,++this._version},e.prototype.update=function(e){var t=this;if(this._dirty){this._indexMissing=0,this._nodesMissing=0,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(e),this._loading=!1,this._prefetching=!1;var n=!0,i=new d,o=new d;if(this.traverseVisible(function(a,s,l){if(t._updateFeatureEstimate(s,o),!s)return++t._indexMissing,t._loading=!0,t._prefetching=!1,void(t._loadingNodes.has(a.id)||t._missing.push(r({},a,{baseUrl:l})));if(0===t._missing.length&&s.children)for(var u=0,d=s.children;u<d.length;u++){var c=d[u];t.nodeIndex[c.id]||(t._prefetching=!0,t._loadingNodes.has(c.id)||t._prefetch.push(r({},c,{baseUrl:s.baseUrl})))}if(!s.failed&&s.featureData&&0!==s.featureData.length){if(t._isLoaded(s))return i.known+=s.memory,++i.knownNodes,t._needsLoading(s)?s.children&&(n=!1):(i.unremoved+=s.memory,n=!1),void(t._needsUpdate(s)&&t._updates.update.push(s));if(s.memory&&(i.known+=s.memory,++i.knownNodes),t._needsLoading(s)){if(++t._nodesMissing,s.children&&(n=!1),s.memory?(i.missing+=s.memory,i.known+=s.memory,++i.knownNodes):++i.missingNodes,e.indexOf(s.id)>=0)return void(t._updates.cancel=t._updates.cancel.filter(function(e){return e!==s.id}));t._updates.add.push(s)}}}),this._unloadedMemoryEstimate=i.missing-i.unremoved,i.knownNodes>3&&(this._unloadedMemoryEstimate+=i.missingNodes*i.known/i.knownNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=o.known-o.missing,this._featureEstimate.leafsReached=n,o.knownNodes>0){var a=o.known/o.knownNodes,s=o.missing-o.unremoved+o.missingNodes*a;this._featureEstimate.estimate+s>0&&(this._featureEstimate.estimate+=s)}this._dirty=this._indexMissing>0||this._nodesMissing>0||this._updates.add.length>0||this._updates.update.length>0||this._updates.cancel.length>0}},e.prototype.checkFeatureTarget=function(e,t){var r=this,n=this.viewportQueries.updateScreenSpaceErrorBias(t);++this._version;var i=new d;this.traverseVisible(function(e,t){return r._updateFeatureEstimate(t,i)});var o=i.known-i.missing;if(i.knownNodes>0){var a=i.known/i.knownNodes,s=i.missing-i.unremoved+i.missingNodes*a;o+s>0&&(o+=s)}return this.viewportQueries.updateScreenSpaceErrorBias(n),++this._version,o<=e},e.prototype._updateFeatureEstimate=function(e,t){if(e&&!e.failed&&e.featureData&&0!==e.featureData.length)return this._isLoaded(e)?(t.known+=e.numFeatures,++t.knownNodes,void(this._needsLoading(e)||(t.unremoved+=e.numFeatures))):void(this._needsLoading(e)&&(e.numFeatures?(t.missing+=e.numFeatures,t.known+=e.numFeatures,++t.knownNodes):++t.missingNodes))},e.prototype.load=function(e){var t=this;return o.buildTopNodeMap(this._missing,e,function(e){return t.entryPriority(e)}),this._missing.length<=0?this._loading:(this._maxUnloadedPrio=this.entryPriority(this._missing.front()),this._missing.forEach(function(e){return t._loadNode(e)}),this._missing.clear(),this._loading)},e.prototype.prefetch=function(e){var t=this;o.buildTopNodeMap(this._prefetch,e,function(e){return t.entryPriority(e)}),this._prefetch.forEach(function(e){return t._loadNode(e)}),this._prefetch.clear()},e.prototype.isLoading=function(){return this._loading},e.prototype.isPrefetching=function(){return this._prefetching},e.prototype.getIndexLoading=function(){return this._loadingNodes.size},e.prototype.getIndexMissing=function(){return this._indexMissing},e.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate},e.prototype.getNodesMissing=function(){return this._nodesMissing},e.prototype.getUpdates=function(e){var t=this;return o.buildTopNodeMap(this._updates.add,e,function(e){return t.entryPriority(e)},this._maxUnloadedPrio),o.buildTopNodeMap(this._updates.update,Number.POSITIVE_INFINITY,function(e){return t.entryPriority(e)}),this._updates},e.prototype.getFeatureEstimate=function(){return this._featureEstimate},e.prototype.nodeTraversalState=function(e){if(!e)return null;var t=this._nodeTraversalState[e.id];if(t&&t.version===this._version)return t;var r=this.viewportQueries.getLodLevel(e),n=this.viewportQueries.hasLOD(e),i=!0;if(n)if(e.parentNode){var o=this.nodeIndex[e.parentNode.id];if(null==o)return null;var a=this._nodeTraversalState[o.id];i=a&&r>a.lodLevel}else i=r>0;return t?(t.lodLevel=r,t.isChosen=i,t.version=this._version,t):(this._nodeTraversalState[e.id]={nodeHasLOD:n,lodLevel:r,isChosen:i,version:this._version},this._nodeTraversalState[e.id])},e.prototype._loadNode=function(e){var t=this;this._loadingNodes.add(e.id);var r=i.makeAbsolute(e.href,e.baseUrl);this.streamDataSupplier.request(r,"json").then(function(e,r){var n=r,i={id:n.id,mbs:n.mbs,parentNode:n.parentNode,children:n.children,featureData:n.featureData};s.forEach(function(e){i[e]=n.hasOwnProperty(e)?n[e]:null}),n.hasOwnProperty("obb")&&!t.ignoreServiceOBB&&(i.obb=a.clone(n.obb),i.hasServiceOBB=!0,t.viewportQueries.updateNode(i.id)),t.nodeIndex[i.id]=i,i.baseUrl=e,i.featureData&&1===i.featureData.length&&i.featureData[0].featureRange&&(i.numFeatures=i.featureData[0].featureRange[1]-i.featureData[0].featureRange[0]+1),t.nodeTraversalState(i),t._loadingNodes.delete(i.id),t._dirty=!0},function(n){t.loadErrorCallback(r),t._loadingNodes.delete(e.id),t._dirty=!0})},e.prototype.entryPriority=function(e){if(e.id===this.rootId)return 0;var t=0,r=this.nodeIndex[e.id];if(null!=r&&null!=r.parentNode){var n=this._nodeTraversalState[r.parentNode.id];null!=n&&(t=n.lodLevel)}for(var i=this.progressiveLoadPenalty,o=r;o;o=o.parentNode?this.nodeIndex[o.parentNode.id]:null)if(this._isLoaded(o)){i=0;break}var a=this.viewportQueries.distToPOI(e);return-a-t*(a+this.progressiveLoadPenalty)+i},e.prototype.traverseVisible=function(e){var t=this.nodeIndex[this.rootId];t?this._traverse({id:this.rootId,mbs:t.mbs,href:this.rootUrl},t,e,""):e({id:this.rootId,mbs:null,href:this.rootUrl},null,"")},e.prototype._traverse=function(e,t,r,n){if(t.children&&0!==t.children.length){if(this.viewportQueries.isNodeVisible(t)){r(e,t,n);var i=this.nodeTraversalState(t);if(!i.nodeHasLOD||i.lodLevel!==this._maxLodLevel)for(var o=0,a=t.children;o<a.length;o++){var s=a[o],l=this.nodeIndex[s.id];l?this._traverse(s,l,r,t.baseUrl):this.viewportQueries.isNodeVisible(s)&&r(s,null,t.baseUrl)}}}else this.viewportQueries.isGeometryVisible(t)&&r(e,t,n)},e.prototype.loadErrorCallback=function(e){this.logger.warn("Error loading node: "+e)},e.prototype.updateStats=function(e){if(this._nodesMissing&&(e.nodes+=" + "+Math.round(this._nodesMissing)),this._indexMissing&&(e.index+=" + "+this._indexMissing),this._featureEstimate.estimate){var t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}},e}(),u=function(){function e(){this.update=new n,this.add=new n}return e.prototype.reset=function(e){this.add.clear(),this.update.clear(),this.cancel=e},e}(),d=function(){return function(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}();return l}.apply(null,n))||(e.exports=i)},2144:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1309)],void 0===(i=function(e,t,r){var n=function(){function e(e,t,r){this.layerViewRequiredFunctions=e,this.layerViewOptionalFunctions=t,this.lodGlobalDirtyChanged=r}return e.prototype.startNodeLoading=function(e,t,r,n,i,o){this._lodGlobalDirty=!1,this._maxLodLevel=o.maxLodLevel,this._nodeIndex=n,this._rootId=i,this._nodeTraversalState=r,this._isNodeVisible=e,this._isGeometryVisible=t,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.shouldLoadNode=function(e){var t=this._nodeTraversalState(e);return!!t.isChosen&&(t.lodLevel===this._maxLodLevel||this.childrenEmpty(e))},e.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.lodSwapBundleLoaded=function(e){this.setLodGlobalDirty()},Object.defineProperty(e.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||this.layerViewRequiredFunctions.getMemoryUsage()>1.1)},enumerable:!0,configurable:!0}),e.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var e=this._rootId,t=this.layerViewRequiredFunctions.getMemoryUsage(),r=Math.max(0,Math.floor(10*(t-1)));i.clear(),this._lodGlobalHandlingRecursion(e,r),this.layerViewRequiredFunctions.removeNodeData(i),i.clear(),this._lodGlobalDirty=!1,this.lodGlobalDirtyChanged(this._lodGlobalDirty)}},e.prototype._lodGlobalHandlingRecursion=function(e,t){var r=this._nodeIndex[e];if(null==r)return!1;var n=this._nodeTraversalState(r),o=n.isChosen&&(!n.nodeHasLOD||n.lodLevel===this._maxLodLevel),a=this.layerViewRequiredFunctions.isNodeLoaded(r);if(a&&null!=this.layerViewOptionalFunctions.setPolygonOffset){var s=!o;this.layerViewOptionalFunctions.setPolygonOffset(r,s)}if(o&&a)return this._removeChildrenRecursive(r),!0;var l=!1;if(null!=r.children&&0!==r.children.length){l=!0;for(var u=0,d=r.children;u<d.length;u++){var c=d[u],p=this._nodeIndex[c.id];if(p?this._isGeometryVisible(p):this._isNodeVisible(c)){var f=this._lodGlobalHandlingRecursion(c.id,t);l=l&&f}}}a&&!o&&(l||i.length<t)&&(i.push(r),a=!1);var h=!r.featureData||0===r.featureData.length;return l||a||h},e.prototype._removeChildrenRecursive=function(e){if(null!=e.children)for(var t=0,r=e.children;t<r.length;t++){var n=r[t],o=this._nodeIndex[n.id];null!=o&&(this._removeChildrenRecursive(o),i.push(o))}},e.prototype._subtreeEmpty=function(e){return!this.layerViewRequiredFunctions.isNodeLoaded(e)&&this.childrenEmpty(e)},e.prototype.childrenEmpty=function(e){if(null==e.children)return!0;for(var t=0,r=e.children;t<r.length;t++){var n=r[t];if(this._isNodeVisible(n)){var i=this._nodeIndex[n.id];if(null!=i&&!this._subtreeEmpty(i))return!1}}return!0},e}(),i=new r;return n}.apply(null,n))||(e.exports=i)},2145:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(23),r(108),r(5),r(6),r(19),r(1352),r(1452),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){var d=function(){function e(t,r,n,i,s){this.loader=t,this.logger=r,this.defaultGeometrySchema=n,this.requiredAttributes=i,this.options=s,this.cancelled=!1,this.loadShared=function(t){if(null==t.sharedResource)return o.resolve({});var r=a.makeAbsolute(t.sharedResource.href,t.baseUrl);return this.load(r,"json").then(function(t){return e.fixTextureEncodings(t),e.addAbsoluteHrefTexture(t,r),t})}}return e.prototype.cancelAll=function(){this.cancelled=!0},e.prototype.load=function(e,t){var n=this.loader.request(e,t),i=new r;return n.then(function(e,t){i.resolve(t)},function(t){i.reject(new Error("Failed to load: "+e))}),i.promise},e.prototype.loadAttribute=function(e,t,r){var n=a.makeAbsolute(r,e);return this.load(n,"binary").then(function(e){return s.readBinaryAttribute(t,e)})},e.prototype.loadAttributes=function(e,t,r){var n=this,i=r.map(function(r){return null==e.attributeData||null==e.attributeData[r.index]?(n.logger.error("Missing attributeData for '"+r.name+"' on node '"+e.id+"'"),o.resolve(null)):n.loadAttribute(t,r.attributeStorageInfo,e.attributeData[r.index].href).catch(function(t){return n.logger.error("Failed to load attributeData for '"+r.name+"' on node '"+e.id+"'"),null})});return o.all(i).then(function(e){for(var t={},n=0;n<r.length;++n)e[n]&&(t[r[n].name]=e[n]);return t})},e.prototype.prepareBinaryGeometryData=function(e,t,r,n){var o=e.geometries[0];if(i.mixin(o.params,r),n||null!=r.vertexAttributes.region||delete r.vertexAttributes.region,null!=r.featureAttributes){var a=r.featureAttributes;if(a.faceRange){var u=s.createTypedView(t,a.faceRange),d=a.faceRange.valuesPerElement,c=r.header.fields.featureCount;e.componentOffsets=l.convertFlatRangesToOffsets(u,c,d)}if(a.id){e.featureIds=[];var p=1,f=s.valueType2TypedArrayClassMap[a.id.valueType];"UInt64"===a.id.valueType&&(f=Uint32Array,p=2);for(var h=new f(t,a.id.byteOffset,a.id.count*a.id.valuesPerElement*p),m=0;m<r.header.fields.featureCount;m++)if(e.featureIds[m]=h[m*a.id.valuesPerElement*p],2===p){var v=h[m*a.id.valuesPerElement*p+1];if(v>=2097150)throw new Error("ID exceeded maximum range supported by javascript (max = 53bit-1 = 9007199254740991)");e.featureIds[m]+=4294967296*v}}}},e.prototype.loadBundleData=function(e,t){var r=this,n=e.baseUrl,i=null,l=this.loadShared(e),u=null;null!=this.requiredAttributes&&(u=this.loadAttributes(e,n,this.requiredAttributes));var d=null;if(null!=e.geometryData){var c=e.geometryData[t],p=a.makeAbsolute(c.href,n);d=this.load(p,"binary")}return l.then(function(n){return r.handleCancelled(),(r.options.loadFeatureData?r.loadFeatureData(e,t):o.resolve(null)).then(function(t){r.handleCancelled();var a,l=r.options.loadFeatureData?r.collectGeometries(e,t,n):r.meshPyramidGeometryData(e,n);a=null!=d?d.then(function(e){i=e;var t=Object.keys(n.materialDefinitions)[0],o=n.materialDefinitions[t].params.vertexRegions,a=s.createGeometryDataIndex(e,r.defaultGeometrySchema,o);return r.prepareBinaryGeometryData(l[0],e,a,o),l}):o.resolve(l);var c=r.loadTextures(l,n);return o.all([c,a,u])}).then(function(e){var t=e[0],o=e[1],a=e[2];r.handleCancelled();var s=null;return a&&(s={attributeData:a,loadedAttributes:r.requiredAttributes}),{allGeometryData:o,attributeDataInfo:s,geometryBuffer:i,sharedResource:n,textureData:t}})})},e.addAbsoluteHrefTexture=function(e,t){var r=e.textureDefinitions;if(null!=r)for(var n=0,i=Object.keys(r);n<i.length;n++)for(var o=0,s=r[i[n]].images;o<s.length;o++){var l=s[o];Array.isArray(l.href)?l.hrefConcat=l.href.map(function(e){return a.makeAbsolute(e,t)}):l.hrefConcat=a.makeAbsolute(l.href,t)}},e.fixTextureEncodings=function(e){var t=e.textureDefinitions;if(null!=t)for(var r in t){var n=t[r];if(Array.isArray(n.encoding))for(var i=0;i<n.encoding.length;i++){var o;"data:"===(o=n.encoding[i]).substring(0,5)&&(n.encoding[i]=o.substring(5))}else"data:"===(o=n.encoding).substring(0,5)&&(n.encoding=o.substring(5))}},e.prototype.loadTexture=function(e,t,r,n){var i=this;return n===l.DDS_ENCODING_STRING?this.load(e,"binary").then(function(e){return i.handleCancelled(),{i3sTexId:t,data:e,encoding:n}}):this.load(e,"image").then(function(e){var o=e;if(i.handleCancelled(),r&&e.width*e.height>=4096){var a=Math.ceil(e.width/2),s=Math.ceil(e.height/2),l=document.createElement("canvas");l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),o=l}return{i3sTexId:t,data:o,encoding:n}})},e.prototype.loadTextures=function(t,r){for(var n=[],i=0;i<t.length;i++){var a=t[i].geometries;if(null!=a)for(var s=0,d=a;s<d.length;s++){var c=d[s].params.textureID||"none";if("none"!==c){null!=r.textureDefinitions&&null!=r.textureDefinitions[c]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+c);var p=r.textureDefinitions[c];if(u.assert(void 0!==p,"geometry wants unknown texture "+c),0===p.images.length)continue;var f=p.images.length-1,h=p.images[f],m=this.options.textureFormat===e.TextureFormat.Compressed,v=this.options.textureFormat===e.TextureFormat.Downsampled,g=l.getAppropriateTextureEncoding(p.encoding,m),y=g>-1?p.encoding[g]:p.encoding,b=g>-1?h.hrefConcat[g]:h.hrefConcat;this.options.loadTextureData?n.push(this.loadTexture(b,c,v,y)):n.push({i3sTexId:c,encoding:y,data:null})}}}return o.all(n)},e.prototype.meshPyramidGeometryData=function(e,t){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:t.materialDefinitions?Object.keys(t.materialDefinitions)[0]:null,textureID:t.textureDefinitions?Object.keys(t.textureDefinitions)[0]:null}}],featureDataPosition:[0,0,0]}]},e.prototype.collectGeometries=function(e,t,r){for(var n=[],i=0,o=t.featureData;i<o.length;i++){var a=o[i],s=a.geometries;if(null!=s)for(var l=0;l<s.length;l++){var u=a.geometries[l];n.push({featureIds:[a.id],featureDataPosition:a.position,geometries:[u]})}else null!=a.position&&n.push({featureIds:[a.id],featureDataPosition:a.position,geometries:null})}return n},e.prototype.loadFeatureData=function(e,t){var r=a.makeAbsolute(e.featureData[t].href,e.baseUrl);return this.load(r,"json")},e.prototype.handleCancelled=function(){if(this.cancelled)throw new n},e}();return function(e){!function(e){e[e.Compressed=0]="Compressed",e[e.Normal=1]="Normal",e[e.Downsampled=2]="Downsampled"}(e.TextureFormat||(e.TextureFormat={}))}(d||(d={})),d}.apply(null,n))||(e.exports=i)},2146:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(1480),r(1341),r(1310),r(1452),r(40),r(1300),r(1353),r(74),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,d,c){return function(){function e(e,t,o,a,u,d,c,p){void 0===p&&(p={}),this.indexSR=e,this._renderCoordsHelper=t,this.extent=u,this.elevationProvider=d,this.options=p,this._computedOBBs={},this._computedMBSs={},this._isNodeVisibleCached={},this.fp=[],this._idleCamera=!0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=[0,0,0],this._tmp2=[0,0,0],this._tmp3=[0,0,0],this._tmp0=[0,0,0],this.supportedMetrics=["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"],this.screenspaceErrorBias=p.screenspaceErrorBias||1,this.progressiveLoadFactor=p.progressiveLoadFactor||1,this.enableLoD=!p.disableLod;for(var f=0;f<8;++f)this.fp[f]=l.plane.create();this.updateCamera(o),this._poi=s.vec3d.create(a),this.engineSR=this._renderCoordsHelper.spatialReference,c?(this._elevationContext=new n,this._elevationContext.featureExpressionInfoContext=i.createContext(i.extractExpressionInfo(c,!1)),this._elevationContext.mixinApi(c)):this._elevationContext=null,this.tmpPoint=new r({x:0,y:0,z:0,spatialReference:e})}return e.prototype.updateCamera=function(e){c.matrixToFrustumPlanes(e.viewMatrix,e.projectionMatrix,this.fp),this._screenSizeFactor=1/e.perPixelRatio,this._camPos=e.eye,this._isNodeVisibleCached={}},e.prototype.updateNode=function(e){delete this._isNodeVisibleCached[e]},e.prototype.updatePointOfInterest=function(e){s.vec3d.set(e,this._poi),this.maxDistance=0},e.prototype.updateScreenSpaceErrorBias=function(e){var t=this.screenspaceErrorBias;return this.screenspaceErrorBias=e,t},e.prototype.setCameraIdle=function(e){this._idleCamera!==e&&(this._idleCamera=e,this._isNodeVisibleCached={})},e.prototype.updateExtent=function(e){this.extent=e,this._isNodeVisibleCached={}},e.prototype.computeMbs=function(e){var t=this._computedMBSs[e.id];return t||(t=s.vec4d.createFrom(e.mbs[0],e.mbs[1],e.mbs[2],-1),this._computedMBSs[e.id]=t),t[3]<0&&(s.vec4d.set(e.mbs,t),this._elevationContext&&t[3]<1e5&&(this.tmpPoint.x=t[0],this.tmpPoint.y=t[1],this.tmpPoint.z=t[2],t[2]=o.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),d.mbsToMbs(t,this.indexSR,t,this.engineSR)),t},e.prototype.computeObb=function(e){if(e.obb&&!(e.obb.halfSize[0]<0)){var t=this._computedOBBs[e.id];return t||((t=u.clone(e.obb)).halfSize[0]=-1,this._computedOBBs[e.id]=t),t.halfSize[0]<0&&(t.halfSize[0]=e.obb.halfSize[0],s.vec3d.set(e.obb.center,t.center),this._elevationContext&&e.mbs[3]<1e5&&(this.tmpPoint.x=e.obb.center[0],this.tmpPoint.y=e.obb.center[1],this.tmpPoint.z=e.obb.center[2],t.center[2]=o.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),d.bufferToBuffer(t.center,this.indexSR,0,t.center,this.engineSR,0,1)),t}},e.prototype._isNodeVisible=function(e){var t=this.computeMbs(e);if(!this.isMBSinExtent(t))return!1;if(e.hasServiceOBB&&e.obb){var r=this.computeObb(e);return u.isVisible(r,this.fp)}return this.isMBSVisible(t)},e.prototype.isNodeVisible=function(e){return!this.enableLoD||(this._idleCamera?null!=this._isNodeVisibleCached[e.id]?this._isNodeVisibleCached[e.id]:(this._isNodeVisibleCached[e.id]=this._isNodeVisible(e),this._isNodeVisibleCached[e.id]):this._isNodeVisible(e))},e.prototype.isGeometryVisible=function(e){if(!this.isNodeVisible(e))return!1;if(e.hasServiceOBB)return!0;var t=this.computeObb(e);return!t||u.isVisible(t,this.fp)},e.prototype.invalidateCache=function(e){if(null==e){for(var t=0,r=Object.keys(this._computedMBSs);t<r.length;t++){var n=r[t];this._computedMBSs[n][3]=-1}for(var i=0,o=Object.keys(this._computedOBBs);i<o.length;i++){n=o[i];this._computedOBBs[n].halfSize[0]=-1}}else this._computedMBSs[e]&&(this._computedMBSs[e][3]=-1),this._computedOBBs[e]&&(this._computedOBBs[e].halfSize[0]=-1)},e.prototype.isMBSinExtent=function(e){return!this.extent||0!==a.intersectBoundingBoxWithMbs(this.extent,e)},e.prototype.isMBSVisible=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=this.fp;return o[0][0]*t+o[0][1]*r+o[0][2]*n+o[0][3]<=i&&o[1][0]*t+o[1][1]*r+o[1][2]*n+o[1][3]<=i&&o[2][0]*t+o[2][1]*r+o[2][2]*n+o[2][3]<=i&&o[3][0]*t+o[3][1]*r+o[3][2]*n+o[3][3]<=i&&o[4][0]*t+o[4][1]*r+o[4][2]*n+o[4][3]<=i&&o[5][0]*t+o[5][1]*r+o[5][2]*n+o[5][3]<=i},e.prototype.calcScreenSpaceSize=function(e,t){var r=this.computeMbs(e),n=r[3],i=s.vec3d.dist2(r,this._camPos)-n*n;return i<0?.5*Number.MAX_VALUE:t/Math.sqrt(i)*this._screenSizeFactor},e.prototype.calcCameraDistance=function(e){var t=this.computeMbs(e);return Math.max(0,s.vec3d.dist(t,this._camPos)-t[3])},e.prototype.calcAngleDependentLoD=function(e){var t=this.computeMbs(e),r=t[3],n=(Math.abs(t[0]*(t[0]-this._camPos[0])+t[1]*(t[1]-this._camPos[1])+t[2]*(t[2]-this._camPos[2]))/s.vec3d.length(t)+r)/s.vec3d.dist(t,this._camPos);return Math.min(1,n)},e.prototype.hasLOD=function(e){return null!=e.lodSelection},e.prototype.hasFeatures=function(e){return null!=e.featureData},e.prototype.getDistancePlanarMode=function(e,t,r){var n=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2],a=n+n+i*i;if(a<=r*r)return Math.abs(o);var s=Math.sqrt(a)-r;return Math.sqrt(o*o+s*s)},e.prototype.getDistanceGlobeMode=function(e,t,r){var n=s.vec3d.length(t),i=s.vec3d.length(e)-n;if(s.vec3d.scale(e,s.vec3d.dot(e,t)/s.vec3d.length2(e),this._tmp0),s.vec3d.dist2(t,this._tmp0)<=r*r)return Math.abs(i);var o=s.vec3d.scale(t,1/n,this._tmp0),a=r,l=n,u=a*a/2/l,d=s.vec3d.scale(o,l-u,this._tmp1),c=e,p=s.vec3d.subtract(c,d,this._tmp2),f=s.vec3d.subtract(p,s.vec3d.scale(o,s.vec3d.dot(o,p),this._tmp3),this._tmp2),h=s.vec3d.add(d,s.vec3d.scale(f,a/s.vec3d.length(f),this._tmp2),this._tmp2),m=s.vec3d.dist(c,h);if(i>=2e5){var v=s.vec3d.subtract(c,h,this._tmp1),g=s.vec3d.dot(v,o)/s.vec3d.length(v);g<.08&&(g=1e-4),m/=g}return m},e.prototype.getDistance=function(e,t,r){return this.engineSR===d.SphericalECEFSpatialReference?this.getDistanceGlobeMode(e,t,r):this.getDistancePlanarMode(e,t,r)},e.prototype._selectErrorMetric=function(e){for(var t=0;t<e.length;t++)if(this.supportedMetrics.indexOf(e[t].metricType)>=0)return e[t];return null},e.prototype.getLodLevel=function(e){if(!e.lodSelection||e.lodSelection.length<=0||!1===this.hasFeatures(e))return 0;if(null==e.children||0===e.children.length)return this.maxLodLevel;var t=this.enableLoD?this._selectErrorMetric(e.lodSelection):null;if(null==t)return 0;if(this.progressiveLoadFactor<1){var r=this.progressiveLoadFactor*this.screenspaceErrorBias,n=this.screenspaceErrorBias;return this.evaluateLODmetric(e,r,t)?this.evaluateLODmetric(e,n,t)?2:1:0}return this.evaluateLODmetric(e,this.screenspaceErrorBias,t)?this.maxLodLevel:0},e.prototype.evaluateLODmetric=function(e,t,r){switch(r.metricType){case"screenSpaceRelative":var n=this.computeMbs(e),i=2*this.getDistance(this._camPos,n,n[3])/this._screenSizeFactor;return r.maxError*t<=i;case"maxScreenThreshold":var o=this.calcScreenSpaceSize(e,e.mbs[3]*t);return this.options.angleDependentLoD&&(o*=this.calcAngleDependentLoD(e)),o<r.maxError;case"removedFeatureDiameter":return this.calcScreenSpaceSize(e,r.maxError)*t<10;case"distanceRangeFromDefaultCamera":return this.calcCameraDistance(e)>r.maxError*t}return!1},e.prototype.distToPOI=function(e){var t=this.computeMbs(e),r=s.vec3d.dist(t,this._poi)-t[3];return this.maxDistance=Math.max(this.maxDistance,r),r},e.prototype.distCameraToPOI=function(){return s.vec3d.dist(this._camPos,this._poi)},e}()}.apply(null,n))||(e.exports=i)},2147:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(16),r(111),r(46),r(2148),r(2150),r(2152),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function u(){var e={};for(var t in d.ClientType)e[d.ClientType[t]]=0;return e[d.ClientType.TERRAIN]=15,e[d.ClientType.SCENE]=20,e[d.ClientType.SYMBOLOGY]=5,new a(e)}var d=function(){function e(t,a,s){void 0===a&&(a=i),void 0===s&&(s=n);var l=this;this._view=t,this._budget=null,this._memoryController=null,this._streamDataLoader=u(),this._frameWorkers=[],this._nextFrameWorker=0,this._idleWorkers=[],this._nextIdleWorker=0,this._idleUpdatesStartFired=!1,this._lastTargetChangeTime=0,this._handles=new r,this._frameTask=null,this.idleTimeout=300,this.idleBudget=100,this._budget=new e.Budget(s),this._lastTargetChangeTime=s(),this._memoryController=new o(this._view),this._handles.add(this._view.watch("state.camera",function(){return l.cameraChangedHandler()},!0)),this._frameTask=a.addFrameTask({update:function(e){return l.frameUpdate(e)}})}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null),this._handles.remove(),this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null)},Object.defineProperty(e.prototype,"enableBudget",{set:function(e){this._budget.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxGpuMemory",{set:function(e){this._memoryController.setMaxGpuMemory(e)},enumerable:!0,configurable:!0}),e.prototype.setMemoryDirty=function(){this._memoryController.setDirty()},Object.defineProperty(e.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryEvents",{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0}),e.prototype.getStreamDataSupplier=function(e,t){return new s(e,this._streamDataLoader,t)},e.prototype.registerIdleFrameWorker=function(e){var t=this;l.assert(!e.idleFrame||e.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");var r={callbacks:e};return this.addIdleFrameWorker(r),{remove:function(){t.removeIdleFrameWorker(r)}}},e.prototype.registerFrameWorker=function(e){var t=this,r={callback:e};return this.addFrameWorker(r),{remove:function(){t.removeFrameWorker(r)}}},e.prototype.addIdleFrameWorker=function(e){this._idleWorkers.push(e),this.isIdle()&&this._idleUpdatesStartFired&&e.callbacks.idleBegin&&e.callbacks.idleBegin()},e.prototype.removeIdleFrameWorker=function(e){var t=this._idleWorkers,r=t.indexOf(e);l.assert(r>=0,"worker not registered"),this._idleUpdatesStartFired&&e.callbacks.idleEnd&&e.callbacks.idleEnd(),t.splice(r,1),this._nextIdleWorker>=t.length&&(this._nextIdleWorker=0)},e.prototype.addFrameWorker=function(e){this._frameWorkers.push(e)},e.prototype.removeFrameWorker=function(e){var t=this._frameWorkers,r=t.indexOf(e);l.assert(r>=0,"worker not registerted"),t.splice(r,1),this._nextFrameWorker>=this._frameWorkers.length&&(this._nextFrameWorker=0)},e.prototype.cameraChangedHandler=function(){this._lastTargetChangeTime=this._budget.now(),this.setMemoryDirty(),this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this.callIdleFrameWorkersEnd())},e.prototype.frameUpdate=function(e){var t=Math.max(e.frameDuration-e.elapsedFrameTime-5,5),r=this.idleBudget-e.elapsedFrameTime;this._view._stage&&!this._view._stage.getRenderParams().idleSuspend&&(r=t);var n=this.isIdle()?r:t;this._budget.reset(n),this._view.stateManager&&this._view.stateManager.step(e.deltaTime/1e3),this._memoryController.update();for(var i=0;i<this._frameWorkers.length;++i){var o=(this._nextFrameWorker+i)%this._frameWorkers.length;if(this._frameWorkers[o].callback(this._budget),this._budget.remaining()<3){this._nextFrameWorker=(o+1)%this._frameWorkers.length;break}}this.isIdle()&&!this._budget.done()&&(this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this.callIdleFrameWorkersBegin()),this.callIdleFrameWorkers())},e.prototype.isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout},e.prototype.callIdleFrameWorkersBegin=function(){this._idleWorkers.forEach(function(e){e.callbacks.idleBegin&&e.callbacks.idleBegin()})},e.prototype.callIdleFrameWorkersEnd=function(){this._idleWorkers.forEach(function(e){e.callbacks.idleEnd&&e.callbacks.idleEnd()})},e.prototype.callIdleFrameWorkers=function(){for(var e=0;e<this._idleWorkers.length;++e){var t=(this._nextIdleWorker+e)%this._idleWorkers.length;if(this._budget.done())return void(this._nextIdleWorker=t);var r=this._idleWorkers[t];r.callbacks.needsUpdate&&r.callbacks.needsUpdate()&&r.callbacks.idleFrame(this._budget)}},e}();return function(e){!function(e){e.TERRAIN="terrain",e.SCENE="scene",e.SYMBOLOGY="symbology"}(e.ClientType||(e.ClientType={}));var t=function(){function e(e){this._nowFunc=e,this.enabled=!0,this.begin=0,this.budget=0}return e.prototype.now=function(){return this._nowFunc()},e.prototype.reset=function(e){this.begin=this.now(),this.budget=this.enabled?e:Number.MAX_VALUE},e.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget},e.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY},e.prototype.elapsed=function(){return this.now()-this.begin},e}();e.Budget=t}(d||(d={})),d}.apply(null,n))||(e.exports=i)},2148:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(2149),r(1451)],void 0===(i=function(e,t,r,n,i){var o=r.getLogger("esri.views.3d.support.MemoryController");return function(){function e(e){this._view=e,this._minQuality=.1,this._maxQuality=1,this._memoryHWM=1,this._memoryLWM=.75,this._divideRate=1.3,this._throttle=5,this.events=new i.Evented,this._maxMemory=500,this._quality=1,this._stableQuality=0,this._throttled=0,this._memoryUsed=0,this._memoryCommitted=0,this._memoryCached=0,this.updating=!1}return e.prototype.setMaxGpuMemory=function(e){e&&e>0&&(this._maxMemory=e,this.setDirty())},e.prototype.getMemoryFactor=function(){return this._quality},e.prototype._updateQuality=function(e){return(e=Math.min(Math.max(e,this._minQuality),this._maxQuality))!==this._quality&&(this._quality=e,this.events.emit("quality-changed",this._quality),!0)},e.prototype.getUsedMemory=function(){return this._memoryUsed},e.prototype.setDirty=function(){this._stableQuality=0},e.prototype.update=function(){if(this._updateMemory(),!(this._memoryCommitted<=0)){this._unloadSuspended(),this._throttled=Math.max(0,this._throttled-1);var e=this._layersUpdating();if(e){if(this._quality<=this._minQuality)return;(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)&&(this._stableQuality>0?this._updateQuality(this._stableQuality):(0===this._throttled||this._memoryUsed>1.05)&&(this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle))}else if(this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,e=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&this._quality<this._maxQuality&&this._stableQuality!==this._quality){this._stableQuality=this._quality;var t=.1*(this._memoryLWM-this._memoryCommitted+.1);e=this._updateQuality(this._quality+t)}this.updating!==e&&(this.updating=e,this.events.emit("updating-changed",this.updating))}},e.prototype._layersUpdating=function(){var e=!1;return this._view.allLayerViews.forEach(function(t){e=e||t.updating}),e},e.prototype._unloadSuspended=function(){var e=this,t=function(){return 0!==e._memoryCached&&(e._memoryCommitted>1.1*e._memoryHWM||e._memoryUsed>e._memoryHWM||e._memoryUsed>=e._memoryLWM&&e._quality<.9)};if(t())for(var r=this._view.allLayerViews.toArray().filter(function(e){return n.isMemoryManagedLayerView(e)&&(e.getCachedMemory()>0||e.suspended)}),i=this;t()&&r.length>0;){var o=function(){var e=null,t=-1;if(r.forEach(function(r){if(n.isMemoryManagedLayerView(r)){var i=r.getCachedMemory()+(r.suspended?r.getUsedMemory():0);i>t&&(t=i,e=r)}}),!e)return{value:void 0};e.removeCachedData(),i._updateMemory()}();if("object"==typeof o)return o.value}},e.prototype._updateMemory=function(){var e=0,t=0,r=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(e+=this._view.basemapTerrain.getUsedMemory());var i=this._view._stage&&this._view._stage.view&&this._view._stage.view.getEdgeView();if(i&&(e+=i.getGpuMemoryUsage()),this._view.allLayerViews&&this._view.allLayerViews.forEach(function(i){if(n.isMemoryManagedLayerView(i)){var o=i.getUsedMemory();i.suspended?r+=o:e+=o,t+=i.getUnloadedMemory(),r+=i.getCachedMemory()}}),e>this._maxMemory&&e!==this._warnMemoryUsage){this._warnMemoryUsage=e;var a=function(e){return e.toLocaleString(void 0,{maximumFractionDigits:1})+" Mb"},s=Math.round(100*this._quality);o.warn("GPU Memory Limit exceeded! Limit: "+a(this._maxMemory)+" Current: "+a(e)+" Projected: "+a(e+t)+" Quality: "+s+"%")}this._memoryUsed=(e+r)/this._maxMemory,this._memoryCommitted=(e+t)/this._maxMemory,this._memoryCached=r/this._maxMemory},e}()}.apply(null,n))||(e.exports=i)},2149:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMemoryManagedLayerView=function(e){return"function"==typeof e.getUsedMemory}}.apply(null,n))||(e.exports=i)},2150:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(27),r(407),r(5),r(2151),r(1450),r(1354),r(1277)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u;return function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.CANCELLED=4]="CANCELLED"}(u||(u={})),function(){function e(e){this.tasks=new Map,this.clientPromiseToTask=new Map,this.loadQueue=new o(this.startLoading.bind(this),this.doneLoadingCallback,this,e)}return e.prototype.destroy=function(){var e=this;this.tasks.forEach(function(t){for(var r=0,n=t.clientPromises;r<n.length;r++){var i=n[r];i.isRejected()||i.reject(t.url,null),e.cancelTask(i)}}),this.loadQueue.clear(),this.loadQueue=null,this.tasks=null,this.clientPromiseToTask=null},e.prototype.request=function(e,t,r){var n=this,i=new a.Promise(function(){n.cancel(i)});return this.createOrUpdateTask(e,t,r,i),i},e.prototype.createTask=function(e,t,r,n,i){var o={url:e,docType:t,clientType:r,key:n,result:null,status:u.QUEUED,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(o,i),this.tasks.set(n,o),this.loadQueue.push(o)},e.prototype.cancel=function(e){this.cancelTask(e)},e.prototype.hasPendingDownloads=function(){return this.tasks.size>0},Object.defineProperty(e.prototype,"tests",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0}),e.prototype.taskKey=function(e,t,r){return e+":"+t+":"+r},e.prototype.updateTask=function(e,t){this.clientPromiseToTask.set(t,e),e.clientPromises.push(t)},e.prototype.createOrUpdateTask=function(e,t,r,n){var i=this.taskKey(e,t,r),o=this.tasks.get(i);o?this.updateTask(o,n):this.createTask(e,t,r,i,n)},e.prototype.cancelTask=function(e){var t=this.clientPromiseToTask.get(e);t&&(n.removeUnordered(t.clientPromises,e),this.clientPromiseToTask.delete(e),0===t.clientPromises.length&&(t.status===u.DOWNLOADING&&(this.loadQueue.workerCancelled(t),t.status=u.CANCELLED,t.downloadObj.cancel(),t.downloadObj=null),t.status=u.CANCELLED,this.tasks.delete(t.key)))},e.prototype.doneLoadingCallback=function(e,t){l.assert(e.status===u.DOWNLOADING);for(var r=e.result,n=0,o=e.clientPromises;n<o.length;n++){var a=o[n];this.clientPromiseToTask.delete(a),t?a.isRejected()||a.reject(e.url,t):(r||(r=i.clone(e.result)),a.done(e.url,r),r instanceof HTMLImageElement||(r=null))}this.tasks.delete(e.key)},e.prototype.startLoading=function(e,t){if(e.status===u.CANCELLED)return!1;var n,i;switch(e.status=u.DOWNLOADING,e.docType){case"binary":i="array-buffer",n=0;break;case"image":i="image";break;default:i="json"}return e.startTime=s.now(),e.downloadObj=r(e.url,{responseType:i,timeout:n,allowImageDataAccess:"image"===e.docType}),e.downloadObj.then(function(r){e.duration=s.now()-e.startTime,e.size="binary"===e.docType?r.data.byteLength:0,e.result=r.data,t(e)},function(r){e.downloadObj.isCanceled()||t(e,r)}),!0},e}()}.apply(null,n))||(e.exports=i)},2151:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(407),r(1277)],void 0===(i=function(e,t,r,n){return function(){function e(e,t,r,n){for(var i in this.workerFunc=e,this.robin=0,this.type2id={},this.tasks=[],this.typeNumWorkers=[],this.typeWorkerQuota=[],this.typeStatistics=[],this.totalNumWorkers=0,this.maxTotalNumWorkers=0,this.numTypes=0,n)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=n[i],this.type2id[i]=this.robin++,this.maxTotalNumWorkers+=n[i];this.numTypes=this.tasks.length,this.robin=0;var o=this;this.taskCallback=function(e){e._cancelledInQueue||(t.apply(r,arguments),o.taskFinished(e))}}return e.prototype.setWorkerQuota=function(e){for(var t in n.assert(r.equals(Object.keys(this.typeWorkerAllication),Object.keys(e))),this.typeWorkerAllication=e,this.maxTotalNumWorkers=0,e){var i=this.type2id[t];this.typeWorkerQuota[i]=e[t],this.maxTotalNumWorkers+=e[t]}},e.prototype.setWorkerFunc=function(e){this.workerFunc=e},e.prototype.push=function(e){var t=this.type2id[e.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[t]++,this.totalNumWorkers++,this.workerFunc(e,this.taskCallback)):this.tasks[t].push(e)},e.prototype._getStatsForType=function(e){var t=this.type2id[e];return{quota:this.typeWorkerQuota[t],workers:this.typeNumWorkers[t],queueSize:this.tasks[t].length,requestStats:this.typeStatistics[t]}},e.prototype.removeTasks=function(e,t){for(var r=[],n=0,i=this.tasks[this.type2id[t]];n<i.length;n++){var o=i[n];-1===e.indexOf(o)&&r.push(o)}this.tasks[this.type2id[t]]=r},e.prototype.workerCancelled=function(e){this.taskFinished(e),e._cancelledInQueue=!0},e.prototype.clear=function(){for(var e=0;e<this.tasks.length;e++)this.tasks[e]=[]},e.prototype.taskFinished=function(e){var t=this.type2id[e.clientType];this.typeNumWorkers[t]--,this.totalNumWorkers--,this.typeStatistics[t].requests++,this.typeStatistics[t].size+=e.size||0,this.typeStatistics[t].duration+=e.duration||0,this.typeStatistics[t].speed=this.typeStatistics[t].duration>0?this.typeStatistics[t].size/this.typeStatistics[t].duration:0,n.assert(this.typeNumWorkers[t]>=0),this.next()},e.prototype.next=function(){var e=this.robin,t=!1;do{this.typeNumWorkers[e]<this.typeWorkerQuota[e]&&this.processQueue(e)&&(t=!0),e=(e+1)%this.numTypes}while(!t&&e!==this.robin);if(!t)do{this.processQueue(e)&&(t=!0),e=(e+1)%this.numTypes}while(!t&&e!==this.robin);this.robin=e},e.prototype.processQueue=function(e){for(;this.tasks[e].length>0;)if(this.workerFunc(this.tasks[e].shift(),this.taskCallback))return this.typeNumWorkers[e]++,this.totalNumWorkers++,!0;return!1},e}()}.apply(null,n))||(e.exports=i)},2152:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e,t,r){this._clientType=e,this._loader=t,this._activeRequests=null,r&&r.trackRequests&&(this._activeRequests=new Map)}return e.prototype.request=function(e,t){var r=this,n=this._loader.request(e,t,this._clientType);if(this._activeRequests){this._activeRequests.set(e,n);var i=function(){r._activeRequests.delete(e)};n.then(i,i)}return n},e.prototype.cancelRequest=function(e){this._loader.cancel(e)},e.prototype.cancelAll=function(){var e=this;this._activeRequests&&(this._activeRequests.forEach(function(t){e._loader.cancel(t)}),this._activeRequests.clear())},e.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()},e}()}.apply(null,n))||(e.exports=i)},428:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(2),r(0),r(92),r(91),r(425),r(1475),r(27),r(420),r(17),r(8),r(16),r(24),r(5),r(7),r(115),r(6),r(19),r(1),r(18),r(161),r(20),r(214),r(75),r(1623),r(211),r(110),r(109),r(417),r(205),r(94),r(423),r(1645),r(1518),r(1519),r(1546),r(1547),r(1646),r(422),r(426),r(1476),r(1550),r(1647),r(1453),r(1483),r(1534),r(427),r(150),r(411),r(148)],void 0===(i=function(e,t,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g,y,b,_,x,w,S,C,D,E,A,T,O,I,R,P,M,L,N,F,U,V,j,k,z,B,G,H,W,q,$,Y,Q,X,Z,K){function J(e){return e&&null!=e.applyEdits}function ee(e){return e&&e.isInstanceOf&&e.isInstanceOf(A)}function te(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}var re=m({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ne="FeatureLayer",ie=g.getLogger("esri.layers.FeatureLayer");return function(e){function t(t){var r=e.call(this)||this;return r._handles=new h,r.featureReduction=null,r.copyright=null,r.displayField=null,r.definitionExpression=null,r.dynamicDataSource=null,r.editFieldsInfo=null,r.elevationInfo=null,r.fields=null,r.fullExtent=null,r.gdbVersion=null,r.geometryType=null,r.hasM=!1,r.hasZ=!1,r.heightModelInfo=null,r.historicMoment=null,r.isTable=!1,r.labelsVisible=!0,r.labelingInfo=null,r.layerId=void 0,r.legendEnabled=!0,r.maxRecordCount=void 0,r.tileMaxRecordCount=void 0,r.minScale=0,r.maxScale=0,r.objectIdField=null,r.operationalLayerType="ArcGISFeatureLayer",r.popupEnabled=!0,r.popupTemplate=null,r.relationships=null,r.returnM=void 0,r.returnZ=void 0,r.screenSizePerspectiveEnabled=!0,r.serviceDefinitionExpression=null,r.spatialReference=C.WGS84,r.templates=null,r.timeInfo=null,r.title=null,r.sublayerTitleMode="item-title",r.trackIdField=null,r.type="feature",r.typeIdField=null,r.types=null,r.indexes=new(p.ofType(N.FeatureIndex)),r.userIsAdmin=!1,r.version=void 0,r.visible=!0,r}return i(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?n({url:e},t):e},t.prototype.load=function(){var e=this,t=this.source&&(Array.isArray(this.source)||ee(this.source));if(!this.portalItem||!t){var r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]}).always(function(){if(e.url&&null==e.layerId&&/FeatureServer\/*$/i.test(e.url))return e._fetchFirstLayerId().then(function(t){null!=t&&(e.layerId=t)})}).then(function(){if(!e.url&&!e._hasMemorySource())throw new f("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return e.createGraphicsSource().then(e._initLayerProperties.bind(e))});return this.addResolvingPromise(r),this.when()}this.addResolvingPromise(b.resolve())},Object.defineProperty(t.prototype,"allRenderers",{get:function(){return this._getAllRenderers(this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){var e=this._get("capabilities");return e||!this.loaded||this.hasService?e:{data:{supportsAttachment:!1,supportsM:!1,supportsZ:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!0,supportsDelete:!0,supportsEditing:!0,supportsQuery:!0,supportsResizeAttachments:!1,supportsUpdate:!0},query:{supportsStatistics:!1,supportsCentroid:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!0,supportsGeometryProperties:!1,supportsOrderBy:!1,supportsPagination:!1,supportsQuantization:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsQueryByOthers:!1,supportsHistoricMoment:!1,supportsFormatPBF:!1},queryRelated:{supportsPagination:!1,supportsCount:!1,supportsOrderBy:!1},editing:{supportsGeometryUpdate:!0,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}},enumerable:!0,configurable:!0}),t.prototype.readCapabilities=function(e,t){return t=t.layerDefinition||t,{data:this._readDataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}},Object.defineProperty(t.prototype,"hasAttachments",{get:function(){return this.hasService&&this._get("hasAttachments")||!1},enumerable:!0,configurable:!0}),t.prototype.readIsTable=function(e,t){return"Table"===(t=t&&t.layerDefinition||t).type},Object.defineProperty(t.prototype,"hasService",{get:function(){return!this._hasMemorySource()},enumerable:!0,configurable:!0}),t.prototype.readMinScale=function(e,t){return t.effectiveMinScale||e||0},t.prototype.readMaxScale=function(e,t){return t.effectiveMaxScale||e||0},t.prototype.readObjectIdFieldFromService=function(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(var r=0,n=t.fields;r<n.length;r++){var i=n[r];if("esriFieldTypeOID"===i.type)return i.name}},Object.defineProperty(t.prototype,"outFields",{get:function(){var e=this,t=this._userOutFields,r=this.requiredFields;return t=t&&t.slice(0),r=r&&r.slice(0),t?-1===t.indexOf("*")&&r.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}):t=r,-1!==t.indexOf("*")?t=["*"]:this.loaded&&(t=(t=(t=t.filter(function(t){var r=!!e.getField(t);return t&&!r&&ie.error("[outFields] Invalid field: ",t),r},this)).map(function(t){return e.getField(t).name},this)).filter(function(e,t,r){return r.indexOf(e)===t})),t},set:function(e){var t=this,r=this.requiredFields&&this.requiredFields.slice(0);e?-1===e.indexOf("*")&&r.forEach(function(t){-1===e.indexOf(t)&&e.push(t)}):e=r,this.loaded&&(e=(e=e.filter(function(e){var r="*"===e||!!t.getField(e,t.fields);return e&&!r&&ie.error("[outFields] Invalid field: ",e),r},this)).map(function(e){return"*"===e?e:t.getField(e,t.fields).name},this)),this._userOutFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedUrl",{get:function(){var e=this.url?_.urlToObject(this.url):null;return null!=this.layerId&&null!=e&&(e.path=_.join(e.path,this.layerId.toString())),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){var t=this._getAllRenderers(e);B.fixRendererFields(t,this.fields),this._set("renderer",e)},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){var n,i,o=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(o)(n=q.read(o,t,r)||void 0)||ie.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r});else if(t.defaultSymbol)X.read(t.defaultSymbol,t,r),t.types&&t.types.length?(n=new u.UniqueValueRenderer({defaultSymbol:i,field:t.typeIdField}),t.types.forEach(function(e){o.addUniqueValueInfo(e.id,X.read(e.symbol,e,r))})):n=new u.SimpleRenderer({symbol:i});else if("Table"!==t.type){switch(t.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":i=new c.SimpleMarkerSymbol;break;case"esriGeometryPolyline":i=new c.SimpleLineSymbol;break;case"esriGeometryPolygon":i=new c.SimpleFillSymbol}n=i&&new u.SimpleRenderer({symbol:i})}return n},t.prototype.writeRenderer=function(e,t,r,n){q.writeTarget(e,t,r,n)},Object.defineProperty(t.prototype,"requiredFields",{get:function(){var e=this.timeInfo,t=[],r=[],n=[this.objectIdField,this.typeIdField,this.editFieldsInfo&&this.editFieldsInfo.creatorField,e&&e.startTimeField,e&&e.endTimeField,this.trackIdField];this.allRenderers.forEach(function(e){t=t.concat(e.requiredFields)}),this.labelingInfo&&this.labelingInfo.length&&this.labelingInfo.forEach(function(e){r=r.concat(e.requiredFields)}),r=r.map(function(e){return e.replace(/['"]+/g,"")}),n=(n=n.concat(t)).concat(r);var i=this.elevationInfo&&this.elevationInfo.featureExpressionInfo;return i&&(n=n.concat(i.requiredFields)),this.popupTemplate&&(n=n.concat(this.popupTemplate.requiredFields)),n.filter(function(e,t,r){return!!e&&r.indexOf(e)===t&&"function"!=typeof e})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{set:function(e){var t=this._get("source");t!==e&&(ee(t)&&this._resetMemorySource(t),ee(e)&&this._initMemorySource(e),this._set("source",e))},enumerable:!0,configurable:!0}),t.prototype.castSource=function(e){return e?Array.isArray(e)||function(e){return e&&e.isInstanceOf&&e.isInstanceOf(p)}(e)?new A({layer:this,items:e}):e:null},t.prototype.readSource=function(e,t){var r=Z.fromJSON(t.featureSet);return new A({layer:this,items:r&&r.features||[]})},t.prototype.readTemplates=function(e,t){var r=t.editFieldsInfo,n=r&&r.creatorField,i=r&&r.editorField;return e=e&&e.map(function(e){return j.fromJSON(e)}),this._fixTemplates(e,n),this._fixTemplates(e,i),e},t.prototype.readTitle=function(e,t){var r=t.layerDefinition&&t.layerDefinition.name||t.name,n=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){var i=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?M.titleFromUrlAndName(this.url,r):r;var o=r||this.url&&M.parse(this.url).title;if(!o)return;return"item-title-and-service-name"===this.sublayerTitleMode&&i&&(o=i+" - "+o),M.cleanTitle(o)}if("item-title"===this.sublayerTitleMode&&n)return n},t.prototype.readTitleFromWebMap=function(e,t){return t.layerDefinition&&t.layerDefinition.name||t.title},t.prototype.readTypeIdField=function(e,t){if(e=(t=t.layerDefinition||t).typeIdField){var r=this.getField(e,t.fields);r&&(e=r.name)}return e},t.prototype.readTypes=function(e,t){var r=this;e=(t=t.layerDefinition||t).types;var n=t.editFieldsInfo,i=n&&n.creatorField,o=n&&n.editorField;return e&&e.map(function(e){return e=k.fromJSON(e),r._fixTemplates(e.templates,i),r._fixTemplates(e.templates,o),e})},Object.defineProperty(t.prototype,"url",{set:function(e){var t=M.sanitizeUrlWithLayerId(this,e,ie);this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)},enumerable:!0,configurable:!0}),t.prototype.writeUrl=function(e,t,r,n){M.writeUrlWithLayerId(this,e,t)},t.prototype.readVersion=function(e,t){return(t=t.layerDefinition||t).currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3},t.prototype.readVisible=function(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0},t.prototype.applyEdits=function(e){var t,r,n=this,i={edits:e,result:b.create(function(e,n){t=e,r=n})};return this.emit("apply-edits",i),this.load().then(function(){return J(n.source)?n._processApplyEditsParams(e):b.reject(new f(ne,"Layer source does not support applyEdits capability"))}).then(function(e){if(J(n.source))return n.source.applyEdits(e).then(function(e){var r=function(e){return e.filter(function(e){return!e.error}).map(v.clone)},i={addedFeatures:r(e.addFeatureResults),updatedFeatures:r(e.updateFeatureResults),deletedFeatures:r(e.deleteFeatureResults)};return(i.addedFeatures.length||i.updatedFeatures.length||i.deletedFeatures.length)&&n.emit("edits",i),t(i),e})}).catch(function(e){throw r(e),e})},t.prototype.on=function(e,t){return this.inherited(arguments)},t.prototype.createGraphicsSource=function(){var e=this;return this._hasMemorySource()?(this.emit("graphics-source-create",{graphicsSource:this.source}),this.source.when()):b.create(function(e){return r.e(44).then(function(){var t=[r(1780)];e.apply(null,t)}.bind(this)).catch(r.oe)}).then(function(t){return new t({layer:e})}).then(function(e){return e.when()}).then(function(t){return e.emit("graphics-source-create",{graphicsSource:t}),t})},t.prototype.createGraphicsController=function(e){var t=this,i=e.layerView,o=p.ofType(s),a=this.source,l=ee(a),u=n({},e.options,{layer:this,layerView:i,graphics:l?a:new o});return(l?b.create(function(e){return r.e(24).then(function(){var t=[r(1707)];e.apply(null,t)}.bind(this)).catch(r.oe)}):"2d"===i.view.type?b.create(function(e){return r.e(45).then(function(){var t=[r(1781)];e.apply(null,t)}.bind(this)).catch(r.oe)}):b.create(function(e){return r.e(9).then(function(){var t=[r(1631)];e.apply(null,t)}.bind(this)).catch(r.oe)})).then(function(e){return new e(u)}).then(function(e){return t.emit("graphics-controller-create",{graphicsController:e}),e.when()})},t.prototype.createQuery=function(){var e=new K,t=this.get("capabilities.data");return e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=this.outFields,e.where=this.definitionExpression||"1=1",e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e},t.prototype.getFeatureType=function(e){var t=this.typeIdField,r=this.types;if(!t||!e)return null;var n=e.attributes?e.attributes[t]:void 0;if(null==n)return null;var i=null;return r.some(function(e){var t=e.id;return null!=t&&(t.toString()===n.toString()&&(i=e),!!i)}),i},t.prototype.getFieldDomain=function(e,t){var r,n=this,i=!1,o=t&&t.feature,a=o&&o.attributes,s=this.typeIdField&&a&&a[this.typeIdField];return null!=s&&this.types&&(i=this.types.some(function(t){return t.id==s&&((r=t.domains&&t.domains[e])&&"inherited"===r.type&&(r=n._getLayerDomain(e)),!0)})),i||r||(r=this._getLayerDomain(e)),r},t.prototype.getField=function(e,t){var r=this.processing?this.fields.concat(this.processing.fields):this.fields;return B.getField(e,t||r)},t.prototype.graphicChanged=function(e){this.emit("graphic-update",e)},t.prototype.queryFeatureAttachments=function(e){var t=this;return this.load().then(function(){if(!e)return b.reject(new f(ne,"A feature is required to query attachments"));var r=t,i=r.layerId,o=r.objectIdField,a=r.token,s=r.url;if(!t.get("capabilities.data.supportsAttachment"))return b.reject(new f(ne,"this layer doesn't support attachments"));var l=e.attributes;if(!l)return b.reject(new f(ne,"'attributes' are required on a feature to query attachments"));var u=l[o];if(!u)return b.reject(new f(ne,"feature is missing the identifying attribute "+o));var c=s+"/"+i+"/"+u+"/attachments";return d(c,{query:{f:"json",token:a},callbackParamName:"callback",responseType:"json"}).then(function(e){return e.data.attachmentInfos.map(function(e){var t=e.id;return n({},e,{url:_.addProxy(c+"/"+t+(a?"?token="+a:""))})})})})},t.prototype.queryFeatures=function(e,t){var r=this;return this.load().then(function(){return r.source.queryFeatures(e||r.createQuery(),t)}).then(function(e){if(e&&e.features)for(var t=0,n=e.features;t<n.length;t++){var i=n[t];i.layer=i.sourceLayer=r}return e})},t.prototype.queryFeaturesJSON=function(e,t){var r=this;return this.load().then(function(){if(!r.source.queryFeaturesJSON)return b.reject(new f(ne,"Layer source does not support queryFeaturesJSON capability"))}).then(function(){return r.source.queryFeaturesJSON(e||r.createQuery(),t)})},t.prototype.queryObjectIds=function(e,t){var r=this;return this.load().then(function(){return r.source.queryObjectIds?r.source.queryObjectIds(e||r.createQuery(),t):b.reject(new f(ne,"Layer source does not support queryObjectIds capability"))})},t.prototype.queryFeatureCount=function(e,t){var r=this;return this.load().then(function(){return r.source.queryFeatureCount?r.source.queryFeatureCount(e||r.createQuery(),t):b.reject(new f(ne,"Layer source does not support queryFeatureCount capability"))})},t.prototype.queryExtent=function(e,t){var r=this;return this.load().then(function(){return r.source.queryExtent?r.source.queryExtent(e||r.createQuery(),t):b.reject(new f(ne,"Layer source does not support queryExtent capability"))})},t.prototype.read=function(e,t){var r=e.featureCollection;if(r){var n=r.layers;n&&1===n.length&&(this.inherited(arguments,[n[0],t]),null!=r.showLegend&&this.inherited(arguments,[{showLegend:r.showLegend},t]))}return this.inherited(arguments,[e,t]),this},t.prototype.write=function(e,t){if(t&&"web-scene"===t.origin&&t.messages){if(!this.url)return t.messages.push(new f("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' require a url to a service to be written to web scenes",{layer:this})),null;if(this.isTable)return t.messages.push(new f("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' using a Table source cannot written to web scenes",{layer:this})),null}return this.inherited(arguments)},t.prototype.importLayerViewModule=function(e){switch(e.type){case"2d":return b.create(function(e){return Promise.all([r.e(11),r.e(46)]).then(function(){var t=[r(1632)];e.apply(null,t)}.bind(this)).catch(r.oe)});case"3d":return b.create(function(e){return Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(47)]).then(function(){var t=[r(1782)];e.apply(null,t)}.bind(this)).catch(r.oe)})}},t.prototype._getLayerDomain=function(e){if(!this.fields)return null;var t=null;return this.fields.some(function(r){return r.name===e&&(t=r.domain),!!t}),t},t.prototype._fetchFirstLayerId=function(){return d(this.url,{query:{f:"json"},callbackParamName:"callback",responseType:"json"}).then(function(e){var t=e.data;if(t&&Array.isArray(t.layers)&&t.layers.length>0)return t.layers[0].id})},t.prototype._initLayerProperties=function(e){var t=this;return this.source||(this.source=e),e.url&&(this.url=e.url),e.layerDefinition&&this.read(e.layerDefinition,{origin:"service",url:this.parsedUrl}),this._verifySource(),this._verifyFields(),this._addSymbolUrlTokens(),B.fixRendererFields(this._getAllRenderers(this.renderer),this.fields),this.watch("token",function(){t._addSymbolUrlTokens()}),$.loadStyleRenderer(this,{origin:"service"})},t.prototype._findUrlBasedSymbols=function(){var e=this.renderer;if(!e)return[];var t=[];e.symbol&&t.push(e.symbol),e.defaultSymbol&&t.push(e.defaultSymbol);var r=e.classBreakInfos||e.uniqueValueInfos;return r&&r.forEach(function(e){e.symbol&&t.push(e.symbol)}),t.filter(function(e){return!!e.url})},t.prototype._addSymbolUrlTokens=function(){var e=this.token;!this._hasMemorySource()&&e&&this._findUrlBasedSymbols().forEach(function(t){var r=t.url;if(r&&-1!==r.search(/https?\:/i)&&!/[?&]token=/.test(r)){var n=-1===r.indexOf("?")?"?":"&";t.url=r+n+"token="+e}})},t.prototype._getAllRenderers=function(e){if(!e)return[];var t=[];return[e,e.trackRenderer,e.observationRenderer,e.latestObservationRenderer].forEach(function(e){e&&(t.push(e),e.rendererInfos&&e.rendererInfos.forEach(function(e){e.renderer&&t.push(e.renderer)}))}),t},t.prototype._verifyFields=function(){var e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some(function(e){return"geometry"===e.type})||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")},t.prototype._fixTemplates=function(e,t){e&&e.forEach(function(e){var r=e.prototype&&e.prototype.attributes;r&&t&&delete r[t]})},t.prototype._verifySource=function(){var e=this;if(this._hasMemorySource()){if(this.url)throw new f("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url");var t=["geometryType","fields","objectIdField"];if(!t.every(function(t){return null!=e[t]}))throw new f("feature-layer:missing-property","FeatureLayer created as feature collection requires properties: "+t.join(),{requiredProperties:t})}else{if(this.isTable)throw new f("feature-layer:source-type-not-supported","The table feature service type is not yet supported",{sourceType:"Table"});if(!this.url)throw new f("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}},t.prototype._initMemorySource=function(e){var t=this;e.forEach(function(e){e.layer=t,e.sourceLayer=t}),this._handles.add([e.on("after-add",function(e){e.item.layer=t,e.item.sourceLayer=t}),e.on("after-remove",function(e){e.item.layer=null,e.item.sourceLayer=null})],"fl-source")},t.prototype._resetMemorySource=function(e){e.forEach(function(e){e.layer=null,e.sourceLayer=null}),this._handles.remove("fl-source")},t.prototype._hasMemorySource=function(){return!(this.url||!this.source)},t.prototype._readDataCapabilities=function(e){return{supportsAttachment:te(e,"hasAttachments",!1),supportsM:te(e,"hasM",!1),supportsZ:te(e,"hasZ",!1)}},t.prototype._readOperationsCapabilities=function(e,t){var r=e?e.toLowerCase().split(",").map(function(e){return e.trim()}):[],n=-1!==r.indexOf("editing"),i=n&&-1!==r.indexOf("create"),o=n&&-1!==r.indexOf("delete"),a=n&&-1!==r.indexOf("update");return n&&!(i||o||a)&&(i=o=a=!0),{supportsCalculate:te(t,"supportsCalculate",!1),supportsTruncate:te(t,"supportsTruncate",!1),supportsValidateSql:te(t,"supportsValidateSql",!1),supportsAdd:i,supportsDelete:o,supportsEditing:n,supportsQuery:-1!==r.indexOf("query"),supportsResizeAttachments:te(t,"supportsAttachmentsResizing",!1),supportsUpdate:a}},t.prototype._readQueryCapabilities=function(e){var t=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,n=e.archivingInfo,i=(e.supportedQueryFormats||"").split(",").reduce(function(e,t){var r=t.toLowerCase().trim();return r&&e.add(r),e},new Set);return{supportsStatistics:te(t,"supportsStatistics",e.supportsStatistics),supportsCentroid:te(t,"supportsReturningGeometryCentroid",!1),supportsDistance:te(t,"supportsQueryWithDistance",!1),supportsDistinct:te(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:te(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:te(t,"supportsReturningGeometryProperties",!1),supportsOrderBy:te(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:te(t,"supportsPagination",!1),supportsQuantization:te(e,"supportsCoordinatesQuantization",!1),supportsResultType:te(t,"supportsQueryWithResultType",!1),supportsSqlExpression:te(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:te(e,"useStandardizedQueries",!1),supportsQueryByOthers:te(r,"allowOthersToQuery",!0),supportsHistoricMoment:te(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:i.has("pbf")}},t.prototype._readQueryRelatedCapabilities=function(e){var t=e.advancedQueryCapabilities,r=te(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:te(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r}},t.prototype._readEditingCapabilities=function(e){var t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:te(e,"allowGeometryUpdates",!0),supportsGlobalId:te(e,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:te(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:te(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:te(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:te(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:te(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:te(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:te(t,"allowOthersToUpdate",!0)}},t.prototype._processApplyEditsParams=function(e){var t="'addFeatures', 'updateFeatures' or 'deleteFeatures' parameter is required",r="feature-layer:missing-parameters";if(!e)return b.reject(new f(r,t));if((e=n({},e)).addFeatures=e.addFeatures||[],e.updateFeatures=e.updateFeatures||[],e.deleteFeatures=e.deleteFeatures||[],e.addFeatures.length||e.updateFeatures.length||e.deleteFeatures.length){var i=function(e){var t=new s;return t.geometry=e.geometry,t.attributes=e.attributes,t};return e.addFeatures=e.addFeatures.map(i),e.updateFeatures=e.updateFeatures.map(i),this._normalizeGeometries(e)}return b.reject(new f(r,t))},t.prototype._normalizeGeometries=function(e){var t=e.addFeatures,r=e.updateFeatures,n=t.concat(r).map(function(e){return e.geometry});return D.normalizeCentralMeridian(n).then(function(n){var i=t.length,o=r.length;return n.slice(0,i).forEach(function(t,r){e.addFeatures[r].geometry=t}),n.slice(i,i+o).forEach(function(t,r){e.updateFeatures[r].geometry=t}),e})},o([x.property({types:{key:"type",base:U.default,typeMap:{selection:V.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],t.prototype,"featureReduction",void 0),o([x.property({readOnly:!0,dependsOn:["loaded","renderer","fields"]})],t.prototype,"allRenderers",null),o([x.property({readOnly:!0,dependsOn:["loaded"]})],t.prototype,"capabilities",null),o([x.reader("capabilities",["layerDefinition.capabilities","layerDefinition.advancedQueryCapabilities","layerDefinition.archivingInfo","layerDefinition.supportsStatistics","layerDefinition.supportsAdvancedQueries","layerDefinition.hasAttachments","layerDefinition.hasM","layerDefinition.hasZ","layerDefinition.supportsCalculate","layerDefinition.supportsTruncate","layerDefinition.supportsValidateSql","layerDefinition.supportsCoordinatesQuantization","layerDefinition.useStandardizedQueries","layerDefinition.ownershipBasedAccessControlForFeatures","layerDefinition.allowGeometryUpdates","layerDefinition.supportsApplyEditsWithGlobalIds","layerDefinition.supportsRollbackOnFailureParameter","layerDefinition.allowUpdateWithoutMValues","layerDefinition.supportsAttachmentsByUploadId","layerDefinition.supportedQueryFormats"]),x.reader("service","capabilities",["advancedQueryCapabilities","archivingInfo","supportsStatistics","supportsAdvancedQueries","hasAttachments","hasM","hasZ","supportsAttachmentsResizing","supportsCalculate","supportsTruncate","supportsValidateSql","supportsCoordinatesQuantization","useStandardizedQueries","ownershipBasedAccessControlForFeatures","allowGeometryUpdates","supportsApplyEditsWithGlobalIds","supportsRollbackOnFailureParameter","allowUpdateWithoutMValues","supportsAttachmentsByUploadId","capabilities","supportedQueryFormats"])],t.prototype,"readCapabilities",null),o([x.property({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),o([x.property({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),o([x.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],t.prototype,"definitionExpression",void 0),o([x.property({readOnly:!0,json:{read:X.read}})],t.prototype,"defaultSymbol",void 0),o([x.property()],t.prototype,"dynamicDataSource",void 0),o([x.property({readOnly:!0})],t.prototype,"editFieldsInfo",void 0),o([x.property({type:Q,json:{origins:{service:{read:{source:"elevationInfo"},write:{target:"elevationInfo",enabled:!1}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],t.prototype,"elevationInfo",void 0),o([x.property({type:[z],json:{origins:{service:{read:!0}},read:{source:"layerDefinition.fields"}}})],t.prototype,"fields",void 0),o([x.property({type:w,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],t.prototype,"fullExtent",void 0),o([x.property()],t.prototype,"gdbVersion",void 0),o([x.property({json:{origins:{service:{read:re.read}},read:{source:"layerDefinition.geometryType",reader:re.read}}})],t.prototype,"geometryType",void 0),o([x.property({readOnly:!0,dependsOn:["loaded"],json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasAttachments"}}})],t.prototype,"hasAttachments",null),o([x.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],t.prototype,"hasM",void 0),o([x.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],t.prototype,"hasZ",void 0),o([x.property({readOnly:!0,type:S})],t.prototype,"heightModelInfo",void 0),o([x.property({type:Date})],t.prototype,"historicMoment",void 0),o([x.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],t.prototype,"id",void 0),o([x.property({readOnly:!0})],t.prototype,"isTable",void 0),o([x.reader("service","isTable",["type"]),x.reader("isTable",["layerDefinition.type"])],t.prototype,"readIsTable",null),o([x.property({dependsOn:["loaded","url","source"],readOnly:!0})],t.prototype,"hasService",null),o([x.property(L.labelsVisible)],t.prototype,"labelsVisible",void 0),o([x.property({type:[G],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:H.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:H.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],t.prototype,"labelingInfo",void 0),o([x.property({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],t.prototype,"layerId",void 0),o([x.property({type:Boolean,json:{read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),o([x.property({type:Number,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.maxRecordCount"}}})],t.prototype,"maxRecordCount",void 0),o([x.property({type:Number,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.tileMaxRecordCount"}}})],t.prototype,"tileMaxRecordCount",void 0),o([x.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],t.prototype,"minScale",void 0),o([x.reader("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),o([x.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],t.prototype,"maxScale",void 0),o([x.reader("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),o([x.property({type:String})],t.prototype,"objectIdField",void 0),o([x.reader("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),x.reader("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),o([x.property()],t.prototype,"operationalLayerType",void 0),o([x.property({dependsOn:["requiredFields"]})],t.prototype,"outFields",null),o([x.property({readOnly:!0,dependsOn:["layerId"]})],t.prototype,"parsedUrl",null),o([x.property(L.popupEnabled)],t.prototype,"popupEnabled",void 0),o([x.property({type:l,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0),o([x.property({type:F})],t.prototype,"processing",void 0),o([x.property({type:[W],readOnly:!0})],t.prototype,"relationships",void 0),o([x.property({types:Y.types,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],t.prototype,"renderer",null),o([x.reader("service","renderer",["drawingInfo.renderer","defaultSymbol","type"]),x.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol","layerDefinition.type"])],t.prototype,"readRenderer",null),o([x.writer("renderer")],t.prototype,"writeRenderer",null),o([x.property({readOnly:!0,dependsOn:["allRenderers","labelingInfo","elevationInfo.featureExpressionInfo","popupTemplate.requiredFields"]})],t.prototype,"requiredFields",null),o([x.property({type:Boolean})],t.prototype,"returnM",void 0),o([x.property({type:Boolean})],t.prototype,"returnZ",void 0),o([x.property(L.screenSizePerspectiveEnabled)],t.prototype,"screenSizePerspectiveEnabled",void 0),o([x.property()],t.prototype,"source",null),o([x.cast("source")],t.prototype,"castSource",null),o([x.reader("portal-item","source",["featureSet"]),x.reader("web-map","source",["featureSet"])],t.prototype,"readSource",null),o([x.property({readOnly:!0,json:{origins:{service:{read:{source:"definitionExpression"}}}}})],t.prototype,"serviceDefinitionExpression",void 0),o([x.property({type:C,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],t.prototype,"spatialReference",void 0),o([x.property({type:[j]})],t.prototype,"templates",void 0),o([x.reader("templates",["editFieldsInfo","creatorField","editorField","templates"])],t.prototype,"readTemplates",null),o([x.property()],t.prototype,"timeInfo",void 0),o([x.property()],t.prototype,"title",void 0),o([x.reader("service","title",["name"]),x.reader("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],t.prototype,"readTitle",null),o([x.reader("web-map","title",["layerDefinition.name","title"])],t.prototype,"readTitleFromWebMap",null),o([x.property({type:String})],t.prototype,"sublayerTitleMode",void 0),o([x.property({type:String,readOnly:!0,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),o([x.property({json:{read:!1}})],t.prototype,"type",void 0),o([x.property({type:String,readOnly:!0})],t.prototype,"typeIdField",void 0),o([x.reader("service","typeIdField"),x.reader("typeIdField",["layerDefinition.typeIdField"])],t.prototype,"readTypeIdField",null),o([x.property({type:[k]})],t.prototype,"types",void 0),o([x.reader("service","types",["types"]),x.reader("types",["layerDefinition.types"])],t.prototype,"readTypes",null),o([x.property({type:p.ofType(N.FeatureIndex),readOnly:!0})],t.prototype,"indexes",void 0),o([x.property({type:String})],t.prototype,"url",null),o([x.writer("url")],t.prototype,"writeUrl",null),o([x.property({readOnly:!0})],t.prototype,"userIsAdmin",void 0),o([x.property({json:{origins:{"portal-item":{read:!1}}}})],t.prototype,"version",void 0),o([x.reader("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"]),x.reader("version",["layerDefinition.currentVersion","layerDefinition.capabilities","layerDefinition.drawingInfo","layerDefinition.hasAttachments","layerDefinition.htmlPopupType","layerDefinition.typeIdField","layerDefinition.types"])],t.prototype,"readVersion",null),o([x.property({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],t.prototype,"visible",void 0),o([x.reader("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],t.prototype,"readVisible",null),o([a(0,x.cast(K))],t.prototype,"queryFeatures",null),o([a(0,x.cast(K))],t.prototype,"queryFeaturesJSON",null),o([a(0,x.cast(K))],t.prototype,"queryObjectIds",null),o([a(0,x.cast(K))],t.prototype,"queryFeatureCount",null),o([a(0,x.cast(K))],t.prototype,"queryExtent",null),o([x.subclass("esri.layers.FeatureLayer")],t)}(x.declared(E,O,I,P,R,T,y))}.apply(null,n))||(e.exports=i)},430:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(2),r(0),r(8),r(6),r(1),r(75),r(1497),r(427)],void 0===(i=function(e,t,n,i,o,a,s,l,u,d,c){return function(e){function t(t,r){var n=e.call(this)||this;return n.geometryType="mesh",n.operationalLayerType="IntegratedMeshLayer",n.type="integrated-mesh",n.profile="mesh-pyramids",n.elevationInfo=null,n}return i(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?n({url:e},t):e},t.prototype.load=function(){var e=this,t=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return e._fetchService()}).then(function(){return e._verifyRootNodeAndUpdateExtent()});return this.addResolvingPromise(t),this.when()},t.prototype.importLayerViewModule=function(e){switch(e.type){case"2d":return s.reject(new a("integrated-mesh-layer:view-not-supported","IntegratedMeshLayer is only supported in 3D"));case"3d":return s.create(function(e){return Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(58)]).then(function(){var t=[r(1513)];e.apply(null,t)}.bind(this)).catch(r.oe)})}},t.prototype._validateLayer=function(e){if(e.layerType&&"IntegratedMesh"!==e.layerType)throw new a("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new a("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(this.version.major>1)throw new a("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"})},o([l.shared("esri.layers.IntegratedMeshLayer")],t.prototype,"declaredClass",void 0),o([l.property({type:String,readOnly:!0})],t.prototype,"geometryType",void 0),o([l.property()],t.prototype,"operationalLayerType",void 0),o([l.property({json:{read:!1},readOnly:!0})],t.prototype,"type",void 0),o([l.property({type:c,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],t.prototype,"elevationInfo",void 0),o([l.subclass()],t)}(l.declared(u,d))}.apply(null,n))||(e.exports=i)},458:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(2),r(0),r(78),r(425),r(27),r(8),r(7),r(6),r(19),r(1),r(84),r(43),r(428),r(75),r(1497),r(423),r(423),r(1519),r(1546),r(422),r(426),r(1476),r(1550),r(1649),r(98),r(1453),r(1483),r(1534),r(427),r(148)],void 0===(i=function(e,t,n,i,o,a,s,l,u,d,c,p,f,h,m,v,g,y,b,_,x,w,S,C,D,E,A,T,O,I,R,P,M){function L(e,t,r){return e&&((e=O.read(e,t,r)||void 0)||F.error("Failed to create renderer",{rendererDefinition:e,layer:this,context:r})),e}var N=["3DObject","Point"],F=d.getLogger("esri.layers.SceneLayer"),U=function(e){function t(t,r){var n=e.call(this)||this;return n.featureReduction=null,n.rangeInfos=null,n.operationalLayerType="ArcGISSceneServiceLayer",n.type="scene",n.fields=[],n.definitionExpression=null,n.elevationInfo=null,n.labelsVisible=!0,n.labelingInfo=null,n.legendEnabled=!0,n.cachedDrawingInfo={color:!1},n.popupEnabled=!0,n.popupTemplate=null,n.objectIdField=null,n.objectIdFilter=null,n._fieldUsageInfo={},n.screenSizePerspectiveEnabled=!0,n}return i(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?n({url:e},t):e},t.prototype.getField=function(e){return C.getField(e,this.fields)},Object.defineProperty(t.prototype,"geometryType",{get:function(){return j[this.profile]||"mesh"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){C.fixRendererFields(e,this.fields),this._set("renderer",e)},enumerable:!0,configurable:!0}),t.prototype.readCachedDrawingInfo=function(e,t){return null!=e&&"object"==typeof e||(e={}),null==e.color&&(e.color=!1),e},t.prototype.readObjectIdField=function(e,t){return!e&&t.fields&&t.fields.some(function(t){return"esriFieldTypeOID"===t.type&&(e=t.name),!!e}),e||void 0},t.prototype.readProfile=function(e,t){var r=t.store.profile;return null!=r&&V[r]?V[r]:(F.error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")},t.prototype.readNormalReferenceFrame=function(e,t){return t.store.normalReferenceFrame},t.prototype.load=function(){var e=this,t=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return e._fetchService()}).then(function(){return a([e._verifyRootNodeAndUpdateExtent(),e._setCompanionFeatureLayer()])}).then(function(){return e._applyCompanionOverrides()}).then(function(){return e._populateFieldUsageInfo()}).then(function(){return I.loadStyleRenderer(e,{origin:"service"})}).then(function(){return C.fixRendererFields(e.renderer,e.fields)});return this.addResolvingPromise(t),this.when()},t.prototype.createLayerView=function(e){var t=this;return(null==this.profile||"mesh-pyramids"===this.profile?c.create(function(e){return Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(51)]).then(function(){var t=[r(1513)];e.apply(null,t)}.bind(this)).catch(r.oe)}):c.create(function(e){return Promise.all([r.e(1),r.e(2),r.e(3),r.e(5),r.e(52)]).then(function(){var t=[r(1783)];e.apply(null,t)}.bind(this)).catch(r.oe)})).then(function(r){return new r({view:e,layer:t})})},t.prototype.createQuery=function(){var e=new M;return"mesh"!==this.geometryType&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e},t.prototype.queryExtent=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryExtent(e||t.createQuery())})},t.prototype.queryFeatureCount=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryFeatureCount(e||t.createQuery())})},t.prototype.queryFeatures=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryFeatures(e||t.createQuery())}).then(function(e){if(e&&e.features)for(var r=0,n=e.features;r<n.length;r++){var i=n[r];i.layer=t,i.sourceLayer=t}return e})},t.prototype.queryFeaturesJSON=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryFeaturesJSON(e||t.createQuery())})},t.prototype.queryObjectIds=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryObjectIds(e||t.createQuery())})},t.prototype.getFieldUsageInfo=function(e){return this._fieldUsageInfo[e]||{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}},t.prototype._getAssociatedLayerForQuery=function(){var e=this;if(!this.loaded)return this.load().then(function(){return e._getAssociatedLayerForQuery()});var t=this.associatedLayer;return null!=t?c.resolve(t):c.reject(new u("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))},t.prototype.hasCachedStatistics=function(e){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(t){return t.name===e})},t.prototype.queryCachedStatistics=function(e){if(!this.hasCachedStatistics(e))return c.reject(new u("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var t=0,r=this.statisticsInfo;t<r.length;t++){var n=r[t];if(n.name===e){var i=p.join(this.parsedUrl.path,n.href);return l(i,{query:{f:"json"},responseType:"json"}).then(function(e){return e.data})}}},t.prototype.graphicChanged=function(e){this.emit("graphic-update",e)},t.prototype._validateLayer=function(e){if(e.layerType&&-1===N.indexOf(e.layerType))throw new u("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new u("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(this.version.major>1)throw new u("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});!function(e,t){var r=!1,n=!1;if(null==e)r=!0,n=!0;else{var i=t&&t.isGeographic;switch(e){case"east-north-up":case"earth-centered":r=!0,n=i;break;case"vertex-reference-frame":r=!0,n=!i;break;default:r=!1}}if(!r)throw new u("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new u("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)},t.prototype._populateFieldUsageInfo=function(){if(this._fieldUsageInfo={},this.fields)for(var e=this,t=0,r=this.fields;t<r.length;t++){!function(t){var r=!(!e.attributeStorageInfo||!e.attributeStorageInfo.some(function(e){return e.name===t.name})),n=!!(e.associatedLayer&&e.associatedLayer.fields&&e.associatedLayer.fields.some(function(e){return e&&t.name===e.name})),i={supportsLabelingInfo:r,supportsRenderer:r,supportsPopupTemplate:r||n,supportsLayerQuery:n};e._fieldUsageInfo[t.name]=i}(r[t])}},t.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var e=0,t=this.associatedLayer.fields;e<t.length;e++){var r=t[e];this.getField(r.name)||this.fields.push(r.clone())}for(var n=["popupTemplate","popupEnabled"],i=m.getProperties(this),o=0;o<n.length;o++){var a=n[o];this._buddyIsMoreImportant(a)&&(i.setDefaultOrigin(this.associatedLayer.originOf(a)),i.set(a,this.associatedLayer[a]),i.setDefaultOrigin("user"))}}},t.prototype._setCompanionFeatureLayer=function(){var e=this;return this._fetchCompanionFeatureLayer().then(function(t){e.associatedLayer=t})},t.prototype._fetchCompanionFeatureLayer=function(){var e=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?c.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl()).then(function(e){return e.load()}).catch(function(t){return null==e.attributeStorageInfo?F.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+e.title):F.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+e.title),null})},t.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(e){var t=this;return e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(e){var r=e.filter(function(e){return"Feature Service"===e.type})[0];return r?t._fetchCompanionFeatureLayerFromPortalItem(new T({id:r.id,portal:r.portal})):c.reject()}).catch(function(){return t._fetchCompanionFeatureLayerFromUrl()})},t.prototype._fetchCompanionFeatureLayerFromPortalItem=function(e){var t=this;return e.load().then(function(e){return t._findMatchingCompanionSublayerUrl(e.url)}).then(function(t){return c.resolve(new v({url:t,portalItem:e}))})},t.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(e){return c.resolve(new v({url:e}))})},t.prototype._findMatchingCompanionSublayerUrl=function(e){var t=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!t)return c.reject();null==e&&(e=t[1]+"/FeatureServer");var r=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),n={query:{f:"json"},responseType:"json"},i=t[1]+"/SceneServer",o=parseInt(t[2],10),s=l(i,n).catch(function(e){return{layers:null}}),u=l(r,n);return a([u,s]).then(function(e){var t=e[0],n=e[1],i=n.data&&n.data.layers,a=t.data&&t.data.layers;if(!Array.isArray(a))throw new Error("expected layers array");if(Array.isArray(i))for(var s=0;s<Math.min(i.length,a.length);s++){if(i[s].id===o)return r+"/"+a[s].id}else if(o<a.length)return r+"/"+a[o].id;throw new Error("could not find matching associated sublayer")})},t.prototype._buddyIsMoreImportant=function(e){if(!this.associatedLayer)return!1;var t=h.nameToId(this.originOf(e)),r=h.nameToId(this.associatedLayer.originOf(e));return null!=r&&r<=h.OriginId.SERVICE?null==t||t<h.OriginId.SERVICE:null!=r&&r<=h.OriginId.PORTAL_ITEM&&(null==t||t<h.OriginId.PORTAL_ITEM)},o([f.shared("esri.layers.SceneLayer")],t.prototype,"declaredClass",void 0),o([f.property({types:{key:"type",base:x.default,typeMap:{selection:w.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],t.prototype,"featureReduction",void 0),o([f.property({type:[A.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],t.prototype,"rangeInfos",void 0),o([f.property()],t.prototype,"associatedLayer",void 0),o([f.property()],t.prototype,"operationalLayerType",void 0),o([f.property({json:{read:!1},readOnly:!0})],t.prototype,"type",void 0),o([f.property({type:[S]})],t.prototype,"fields",void 0),o([f.property({readOnly:!0})],t.prototype,"attributeStorageInfo",void 0),o([f.property({readOnly:!0})],t.prototype,"statisticsInfo",void 0),o([f.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],t.prototype,"definitionExpression",void 0),o([f.property({type:P,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],t.prototype,"elevationInfo",void 0),o([f.property({type:String,dependsOn:["profile"]})],t.prototype,"geometryType",null),o([f.property(b.labelsVisible)],t.prototype,"labelsVisible",void 0),o([f.property({type:[D],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:E.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:E.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],t.prototype,"labelingInfo",void 0),o([f.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),o([f.property({types:R.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:L}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:L},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],t.prototype,"renderer",null),o([f.property({json:{read:!1}})],t.prototype,"cachedDrawingInfo",void 0),o([f.reader("service","cachedDrawingInfo")],t.prototype,"readCachedDrawingInfo",null),o([f.property(b.popupEnabled)],t.prototype,"popupEnabled",void 0),o([f.property({type:s,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0),o([f.property({type:String,json:{read:!1}})],t.prototype,"objectIdField",void 0),o([f.reader("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdField",null),o([f.property()],t.prototype,"objectIdFilter",void 0),o([f.property({type:String,json:{read:!1}})],t.prototype,"profile",void 0),o([f.reader("service","profile",["store.profile"])],t.prototype,"readProfile",null),o([f.property({readOnly:!0,type:String,json:{read:!1}})],t.prototype,"normalReferenceFrame",void 0),o([f.reader("service","normalReferenceFrame",["store.normalReferenceFrame"])],t.prototype,"readNormalReferenceFrame",null),o([f.property(_.screenSizePerspectiveEnabled)],t.prototype,"screenSizePerspectiveEnabled",void 0),o([f.subclass()],t)}(f.declared(g,y)),V={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},j={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return U}.apply(null,n))||(e.exports=i)}}]);